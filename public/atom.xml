<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jedsek&#39;s blog</title>
  
  <subtitle>ä¸å…¶æµŠå¯Œ | å®æ¯”æ¸…è´«</subtitle>
  <link href="https://jedsek.xyz/atom.xml" rel="self"/>
  
  <link href="https://jedsek.xyz/"/>
  <updated>2022-07-20T03:22:42.000Z</updated>
  <id>https://jedsek.xyz/</id>
  
  <author>
    <name>Jedsek</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GNOME å…¥å‘æŒ‡å—</title>
    <link href="https://jedsek.xyz/posts/gnome/guide"/>
    <id>https://jedsek.xyz/posts/gnome/guide</id>
    <published>2022-07-20T03:22:42.000Z</published>
    <updated>2022-07-20T03:22:42.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äº GNOME çš„å…¥å‘æŒ‡å—, è®©ä½ äº†è§£, é…ç½®, ç¾åŒ–æ¡Œé¢ç¯å¢ƒ</p></blockquote><span id="more"></span><div class="tips"><p><strong>æç¤º</strong><br>æœ¬ç¯‡æ–‡ç« çš„é…ç½®çš†åœ¨æ³¨é‡ç®€æ´, é«˜æ•ˆ, ç¾è§‚, æƒ³è¦å¹³é“ºå¼, ç‚«é…·æ•ˆæœ, æ›´å¤šåŠŸèƒ½çš„, è¯·è‡ªè¡Œé…ç½®<br>è¯·æ³¨æ„GNOMEç‰ˆæœ¬æ˜¯å¦ç›¸ç¬¦, æœ‰å°‘è®¸åœ°æ–¹æˆ–å› ç‰ˆæœ¬å·®å¼‚è€Œä¸åŒ, æˆ‘å°†å°½é‡ä¿æŒåŒæ­¥, ä½¿è¯¥æ–‡ç« æœ€æ–°<br>ç›®å‰, è¯¥ç¯‡æ–‡ç« çš„GNOME ç‰ˆæœ¬ä¸º: <strong>42</strong></p></div><h1 id="cheng-pin-zhan-shi">æˆå“å±•ç¤º</h1><p>2022å¹´äº†, GNOME åˆé è°±åˆå¥½ç”¨, ä½†æœ‰äº›äººçš„ç•Œé¢ä»ç„¶åƒæ˜¯åå¹´å‰â€¦<br>æˆ‘ä¸ªäººè®¤ä¸ºç®€æ´+ç¾è§‚æ¯”è¾ƒé‡è¦, å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹è¿›è¡ŒDIY, è¯·è‡ªå·±åŠ¨æ‰‹, ä¸°è¡£è¶³é£Ÿå§!</p><details open><summary><span class="pre-summary">&nbsp;</span><strong>ä»¥ä¸‹æ˜¯æˆå“å±•ç¤º, è¯·ç‚¹å‡»éšè—/å±•å¼€å›¾åƒ</strong></summary><p><img data-src="/images/gnome/overview.png" alt="æŒ‰ä¸‹Superåçš„Overview"></p></details><hr><h1 id="dconf-amp-amp-gsettings">dconf &amp;&amp; gsettings</h1><ul class="lvl-0"><li class="lvl-2"><p><code>dconf</code>:<br>æ˜¯ä¸€å¥—åŸºäºé”®çš„é…ç½®ç³»ç»Ÿ, ååˆ†é«˜æ•ˆ, ç›¸å½“äº Windows ä¸‹çš„æ³¨å†Œè¡¨</p></li><li class="lvl-2"><p><code>gsettings</code>:<br>æ˜¯ GNOME-DE ä¸‹çš„é«˜çº§API, æ˜¯å‘½ä»¤è¡Œå·¥å…·/å‰ç«¯, ç”¨æ¥ç®€åŒ–å¯¹ dconf çš„æ“ä½œ</p></li></ul><p>ä½ å¯èƒ½åœ¨å¹´ä»½ä¹…è¿œçš„æ–‡ç« ä¸­å¬è¯´è¿‡ <code>gconf</code>, è¿™æ˜¯ä»€ä¹ˆ? ä¸ <code>dconf</code> æœ‰å•¥åŒºåˆ«?<br>ç­”: å…¶ä½œç”¨ä¹Ÿç±»ä¼¼æ³¨å†Œè¡¨, ä½†ç°åœ¨å·²ç»åœæ­¢ä½¿ç”¨, è¢«æ•ˆç‡æ›´é«˜çš„ <code>dconf</code> æ‰€å–ä»£</p><p>æ¥ä¸‹æ¥çš„å¤§éƒ¨åˆ†é…ç½®, éƒ½ä¼šä½¿ç”¨ <code>gsettings</code></p><hr><h1 id="hong-mo-ban">è§¦æ‘¸æ¿</h1><p>è§¦æ‘¸æ¿å¯æ˜¯ç¬”è®°æœ¬å…šçš„çµé­‚å•Š, å°¤å…¶å¯¹äºæˆ‘è¿™ç§ä¸‡å¹´ä¸ç”¨é¼ æ ‡, é™¤éæ‰“CSGO <s>(ä½†CSæˆ‘ä¹Ÿèƒ½ç”¨è§¦æ‘¸æ¿ç©)</s></p><h2 id="pei-zhi" id="é…ç½®">é…ç½®</h2><p>æœ‰ä¸€äº› Linux å‘è¡Œç‰ˆçš„ GNOMEæ¯”è¾ƒè´´è¿‘ä¸Šæ¸¸, <code>è½»å‡»æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»</code> é»˜è®¤æœªå¼€å¯<br>è¿™å¯¼è‡´è§¦æ‘¸æ¿å¾ˆéš¾ç”¨, å¾—æŒ‰ä¸‹å»æ‰èƒ½æ¨¡æ‹Ÿé¼ æ ‡çš„ç‚¹å‡»</p><p>ä½ æƒ³ä¸€æƒ³, ä½ æƒ³é€‰ä¸­ä¸€æ®µæ–‡å­—, å¾—é‡é‡æŒ‰ä¸‹è§¦æ‘¸æ¿, åœ¨å·¨å¤§çš„æ‘©æ“¦åŠ›ä¸‹ç§»åŠ¨æ‰‹æŒ‡â€¦<br>è€Œä¸”, é»˜è®¤çš„è§¦æ‘¸æ¿, é€Ÿåº¦å¯èƒ½æ¯”è¾ƒæ…¢, åæ­£æˆ‘ä¸é€‚åº”, å› æ­¤éœ€è¦ä¿®æ”¹â€¦<br>è¿˜æœ‰å°±æ˜¯, è§¦æ‘¸æ¿åœ¨æ‰“å­—çš„æ—¶å€™é»˜è®¤æ˜¯ç¦ç”¨çš„, è¿™å¯¹æœ‰æ—¶ä¼šç”¨è§¦æ‘¸æ¿æ‰“CSGOçš„æˆ‘æ¥è¯´å¾ˆæ„¤æ€’â€¦</p><p>ä½ å¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè°ƒæ•´:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad tap-to-click <span class="literal">true</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad speed 0.57</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad disable-while-typing <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«å¯¹åº”:</p><ul class="lvl-0"><li class="lvl-2"><p>è½»å‡»æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡», é»˜è®¤ä¸ºfalse</p></li><li class="lvl-2"><p>è°ƒæ•´è§¦æ‘¸æ¿é€Ÿåº¦, é»˜è®¤ä¸º0</p></li><li class="lvl-2"><p>æ‰“å­—æ—¶ç¦ç”¨è§¦æ‘¸æ¿, é»˜è®¤ä¸ºtrue</p></li></ul><h2 id="shou-shi" id="æ‰‹åŠ¿">æ‰‹åŠ¿</h2><ul class="lvl-0"><li class="lvl-2"><p>å•æŒ‡: ç§»åŠ¨é¼ æ ‡</p></li><li class="lvl-2"><p>åŒæŒ‡ä¸Šä¸‹: ç¿»é¡µ</p></li><li class="lvl-2"><p>ä¸‰æŒ‡å·¦å³: åˆ‡æ¢Workspace</p></li><li class="lvl-2"><p>ä¸‰æŒ‡ä¸Š: æ‰“å¼€Overview (ä¸å¸¸ç”¨, æŒ‰Superæ›´å¿«)</p></li><li class="lvl-2"><p>ä¸‰æŒ‡ä¸‹: æ˜¾ç¤ºä»»åŠ¡æ  (å½“ä½ éšè—ä»»åŠ¡æ æ—¶)</p></li></ul><hr><h1 id="an-zhuang-kuo-zhan">å®‰è£…æ‰©å±•</h1><p>GNOME çš„æ‰©å±•(Extensions)æ˜¯å…¶é‡è¦çš„ç»„æˆ, èµ‹äºˆäº†éšæ„ç»„åˆçš„è‡ªç”±ä¸å¼ºå¤§, è¯´æ˜¯ä¸€åŠçš„çµé­‚, ä¹Ÿä¸ä¸ºè¿‡ä¹‹<br>æˆ‘å°†å…ˆä»‹ç»å¦‚ä½•å®‰è£…/ä½¿ç”¨å®ƒä»¬, å› ä¸ºåé¢éœ€è¦ç”¨åˆ°æ‰©å±•</p><p>æœ‰ä¸¤ç§å®‰è£…æ–¹æ³•, ä¸€ç§ä»å‘½ä»¤è¡Œå®‰è£…, ä¸€ç§ä»æµè§ˆå™¨å®‰è£…<br>æˆ‘æ›´å€¾å‘äºå‰è€…, å› ä¸ºä¸éœ€è¦ä¸‹è½½å¯¹åº”çš„ä¸œè¥¿, é€‚åˆå¿«é€Ÿéƒ¨ç½², ä½†ä¸¤è€…æˆ‘éƒ½ä¼šä»‹ç»</p><h2 id="cong-ming-ling-xing" id="ä»å‘½ä»¤è¡Œ">ä»å‘½ä»¤è¡Œ</h2><div class="tips"><p><strong>æç¤º</strong><br>è¯·ç¡®ä¿æ‹¥æœ‰ä»¥ä¸‹å‘½ä»¤: unzip, jq, æœ‰äº›å‘è¡Œç‰ˆé»˜è®¤è¿ unzip éƒ½æ²¡æœ‰â€¦<br>ä¸‹è½½æˆåŠŸå, åˆ‡è®°è¦ logout, ç„¶åå†ç™»è¿›æ¥</p></div><p>æ¯ä¸ªGNOMEæ‰©å±•éƒ½æ‹¥æœ‰ç‹¬ä¸€æ— äºŒçš„, åä¸º <code>uuid</code> çš„æ ‡è¯†ç¬¦, æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>uuid</code>, ä¸‹è½½æ‰©å±•</p><p>ä½ å¯ä»¥åœ¨ <a href="https://extensions.gnome.org/">Extensions-GNOME</a> è¿™ä¸ªç½‘ç«™ä¸Š, æµè§ˆå¹¶ä¸‹è½½æ‰©å±•<br>è¯·å°†ä»¥ .zip ç»“å°¾çš„æ‰©å±•æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹, å‡è®¾è¯¥ç›®å½•å« <code>exts_list</code></p><p>ä¸‹é¢æ˜¯ Bash/Fish è„šæœ¬, ä¼ å…¥è¯¥ç›®å½•çš„è·¯å¾„, è‡ªåŠ¨è¿›è¡Œå®‰è£…:</p><div class="tabs" id="install-extensions"><ul class="nav-tabs"><li class="tab active"><a href="#install-extensions-1">Bash</a></li><li class="tab"><a href="#install-extensions-2">Fish</a></li></ul><div class="tab-content"><div class="tab-pane active" id="install-extensions-1"><figure class="highlight bash"><figcaption><span>install-extensions.sh</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">declare</span> -a UUID_LIST</span><br><span class="line">EXTS_DIR=<span class="variable">$HOME</span>/.<span class="built_in">local</span>/share/gnome-shell/extensions</span><br><span class="line">EXTS_LIST=<span class="variable">$&#123;1&#125;</span></span><br><span class="line"><span class="function"><span class="title">str_join</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;$*&quot;</span> | sed <span class="string">&#x27;s/&quot;&quot;/&quot;,&quot;/g&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">mkdir -p <span class="variable">$EXTS_DIR</span></span><br><span class="line">chmod -R 755 <span class="variable">$HOME</span>/.<span class="built_in">local</span>/</span><br><span class="line"><span class="keyword">for</span> EXT <span class="keyword">in</span> <span class="variable">$EXTS_LIST</span>/*.zip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  UUID=$(unzip -p <span class="variable">$EXT</span> metadata.json | jq -r <span class="string">&quot;.uuid&quot;</span>)</span><br><span class="line">  mkdir -p <span class="variable">$EXTS_DIR</span>/<span class="variable">$UUID</span></span><br><span class="line">  unzip -q -o <span class="variable">$EXT</span> -d <span class="variable">$EXTS_DIR</span>/<span class="variable">$UUID</span></span><br><span class="line">  UUID_LIST+=<span class="string">&quot;\&quot;<span class="variable">$UUID</span>\&quot;&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">UUID_LIST=[$(str_join <span class="variable">$&#123;UUID_LIST[@]&#125;</span>)]</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell enabled-extensions <span class="variable">$&#123;UUID_LIST[@]&#125;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="install-extensions-2"><figure class="highlight bash"><figcaption><span>install-extensions.fish</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> exts_list <span class="variable">$argv</span>[1]</span><br><span class="line"><span class="built_in">set</span> exts_dir <span class="variable">$HOME</span>/.<span class="built_in">local</span>/share/gnome-shell/extensions/</span><br><span class="line"><span class="built_in">set</span> uuid_list</span><br><span class="line">mkdir -p <span class="variable">$exts_dir</span></span><br><span class="line"><span class="keyword">for</span> ext <span class="keyword">in</span> exts_list/*.zip</span><br><span class="line">  <span class="built_in">set</span> uuid ( unzip -p <span class="variable">$ext</span> metadata.json | jq -r <span class="string">&quot;.uuid&quot;</span> )</span><br><span class="line">  mkdir -p <span class="variable">$ext_dir</span>/<span class="variable">$uuid</span></span><br><span class="line">  unzip -q -o <span class="variable">$ext</span> -d <span class="variable">$ext_dir</span>/<span class="variable">$uuid</span></span><br><span class="line">  <span class="built_in">set</span> -a uuid_list \<span class="string">&#x27;$uuid\&#x27;</span></span><br><span class="line">end</span><br><span class="line"><span class="built_in">set</span> uuid_list [( string join <span class="string">&quot;,&quot;</span> <span class="variable">$uuid_list</span> )]</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell enabled-extensions <span class="variable">$uuid_list</span></span><br></pre></td></tr></table></figure></div></div></div><p>å‡è®¾ä½¿ç”¨Bash: æ‰§è¡Œ <code>sh install-extensions.sh exts_list</code> ä¸‹è½½è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ’ä»¶<br><strong>æ³¨æ„ logout, å†ç™»è¿›æ¥</strong></p><p>ä¹Ÿå¯ä»¥é€šè¿‡dbuså®‰è£…, ä½†è·å–uuidè¿˜å¾—è§£å‹zip, ä½•ä¸ç›´æ¥åƒä¸Šé¢é‚£æ ·æ‰‹åŠ¨å®‰è£…? æ‰€ä»¥ä¸æ¨è:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dbus-send --<span class="built_in">type</span>=method_call --dest=org.gnome.Shell /org/gnome/Shell \</span><br><span class="line">  org.gnome.Shell.Extensions.InstallRemoteExtension string:<span class="string">&#x27;xxxxx_uuid&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="cong-liu-lan-qi" id="ä»æµè§ˆå™¨">ä»æµè§ˆå™¨</h2><p>è¯¥æ–¹æ³•å…¶å®ä¹Ÿè›®æ–¹ä¾¿çš„, ä½†ä¸é€‚åˆå¿«é€Ÿéƒ¨ç½²<br>ä½ éœ€è¦å®‰è£…ä¸¤ä¸ªç©æ„, æ‰èƒ½ç›´æ¥ä» <a href="https://extensions.gnome.org/">Extension-GNOME</a> ä¸Šç›´æ¥ä¸‹è½½</p><ul class="lvl-0"><li class="lvl-2"><p><code>chrome-gnome-shell</code>:<br>æœ¬åœ°è½¯ä»¶, ä½ å¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨, ç›´æ¥æœè¿™ä¸ªåå­—</p></li><li class="lvl-2"><p><code>GNOME Shell integration</code>:<br>æµè§ˆå™¨æ’ä»¶, Chrome/Firefox çš„æµè§ˆå™¨å•†åº—éƒ½æœ‰å®ƒ<br>Edge çš„æ’ä»¶å•†åº—é‡Œæ— , ä½†å¯ä»¥ä¸‹è½½ iGuge (è°·æ­Œè®¿é—®åŠ©æ‰‹), ç„¶åä¸‹Chromeçš„æ’ä»¶</p></li></ul><p>ä¸€ä¸ªåœ¨æœ¬åœ°, ä¸€ä¸ªåœ¨æµè§ˆå™¨,  å› æ­¤å¯ä»¥æ”¯æŒä½ ä» <a href="https://extensions.gnome.org/">ç½‘ç«™</a> ä¸Š ç›´æ¥å®‰è£…åˆ°æœ¬åœ°</p><hr><h1 id="cha-kan-pei-zhi-kuo-zhan">æŸ¥çœ‹/é…ç½®æ‰©å±•</h1><p>é€šè¿‡ <code>gnome-extensions</code> è¿™ä¸ªå‘½ä»¤, æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹/é…ç½®å½“å‰æ‰©å±•</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å–å¸®åŠ©, `Command` ä¸ºå¯é€‰é¡¹</span></span><br><span class="line">gnome-extensions <span class="built_in">help</span> [Command]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰©å±•åˆ—è¡¨</span></span><br><span class="line">gnome-extensions list --user    <span class="comment"># æŸ¥çœ‹ç”¨æˆ·çº§æ‰©å±•</span></span><br><span class="line">gnome-extensions list --system  <span class="comment"># æŸ¥çœ‹ç³»ç»Ÿçº§æ‰©å±•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰©å±•çš„ä¿¡æ¯</span></span><br><span class="line">gnome-extensions info launch-new-instance@gnome-shell-extensions.gcampax.github.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨/ç¦ç”¨æŸä¸ªæ‰©å±•</span></span><br><span class="line">gnome-extensions <span class="built_in">enable</span> nothing-to-say@extensions.gnome.wouter.bolsterl.ee</span><br><span class="line">gnome-extensions <span class="built_in">disable</span> nothing-to-say@extensions.gnome.wouter.bolsterl.ee</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æŸä¸ªæ‰©å±• (æ‰“å¼€ GUI ç•Œé¢)</span></span><br><span class="line">gnome-extensions prefs nothing-to-say@extensions.gnome.wouter.bolsterl.ee</span><br></pre></td></tr></table></figure><p>æˆ–è€…é€šè¿‡ <code>gsettings</code> æ¥é…ç½®æŸä¸ªæ‰©å±•, ä½†ä¸æ¨è, å› ä¸ºéº»çƒ¦:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªæ‰©å±•çš„æ‰€æœ‰é€‰é¡¹</span></span><br><span class="line">gsettings --schemadir ~/.<span class="built_in">local</span>/share/gnome-shell/extensions/nothing-to-say@extensions.gnome.wouter.bolsterl.ee/schemas/  \</span><br><span class="line">  list-recursively org.gnome.shell.extensions.nothing-to-say</span><br><span class="line">  </span><br><span class="line"><span class="comment"># å¾—åˆ°/é‡ç½®/è®¾ç½® æŸä¸ªæ‰©å±•çš„æŸé€‰é¡¹å½“å‰çš„å€¼ (æ ¹æ®ä¸Šé¢è¿™æ¡å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰é€‰é¡¹)</span></span><br><span class="line">gsettings --schemadir ~/.<span class="built_in">local</span>/share/gnome-shell/extensions/nothing-to-say@extensions.gnome.wouter.bolsterl.ee/schemas/  \</span><br><span class="line">  get    org.gnome.shell.extensions.nothing-to-say show-osd</span><br><span class="line"><span class="comment"># reset  org.gnome.shell.extensions.nothing-to-say show-osd</span></span><br><span class="line"><span class="comment"># set    org.gnome.shell.extensions.nothing-to-say show-osd</span></span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥å‚è€ƒæˆ–<a href="#jia-zai-pei-zhi"><strong>ç›´æ¥åŠ è½½</strong></a>æˆ‘åšå®¢ä¸‹çš„ <a href="/downloads/gnome/dconf.settings"><strong>dconf.settings</strong></a><br><strong>æ³¨æ„</strong>: å¦‚ä½•ä½ é€‰æ‹©ç›´æ¥åŠ è½½æˆ‘çš„é…ç½®, è¯·æ³¨æ„ <code>picture-uri</code> ç¬¦åˆè‡ªå·±å®é™…</p><hr><h1 id="tui-jian-de-kuo-zhan">æ¨èçš„æ‰©å±•</h1><p>ä»¥ä¸‹æ˜¯æˆ‘ç›®å‰æ­£åœ¨ä½¿ç”¨, æ¨èçš„æ‰©å±•</p><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/16/auto-move-windows/">auto-move-windows</a>:<br>é€šè¿‡æŒ‡å®šçª—å£è§„åˆ™, ä½¿å¾—æ‰“å¼€æŸä¸ªappæ—¶, å°†å…¶è‡ªåŠ¨åˆ†é…åˆ°ç‰¹å®šå·¥ä½œåŒº (éœ€è¦æŒ‡å®šçš„.desktopæ–‡ä»¶)<br><strong>æ— å›¾ç‰‡</strong></p></li></ul><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/905/refresh-wifi-connections/">refresh-wifi-connections</a><br>å½“ä½ é€šè¿‡å³ä¸Šè§’çš„èœå•é€‰æ‹© WIFI æ—¶, ä¼šå¤šå‡ºæ¥ä¸€ä¸ªåˆ·æ–°é”®</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/refresh-wifi-connections.png" alt="refresh-wifi-connections"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/1446/transparent-window-moving/">transparent-window-moving</a><br>åœ¨å¯¹çª—å£è¿›è¡Œç§»åŠ¨/è°ƒæ•´å¤§å°æ—¶, ä½¿çª—å£å˜å¾—é€æ˜</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/transparent-window-moving.png" alt="transparent-window-moving"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3843/just-perfection/">just-perfection</a><br>æˆ‘æœ€å–œæ¬¢çš„ä¸€ä¸ªæ‰©å±•, ç”¨äºå¯¹ç•Œé¢è¿›è¡Œå¤§é‡è‡ªå®šä¹‰ä¸ç²¾ç®€<br>æ¯”å¦‚, å¯ä»¥éšè— Dash (æŒ‰Superååº•éƒ¨çš„ä¸€è¡Œ), æ”¹å˜é¡¶æ å…ƒç´ ç­‰</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview.png" alt="just-perfection"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3139/eye-extended/">eye-extended</a><br>å¾ˆæœ‰è¶£çš„æ‰©å±•, å¹³æ—¶å½“ä½œå°æŒ‚ä»¶, ä½†å±æœºæ—¶æˆ–è®¸å¯ä»¥æ´¾ä¸Šç”¨åœº<br>åœ¨é¡¶æ æ˜¾ç¤ºä¸€ä¸ªçœ¼ç›, çœ¼ç å­ä¼šä¸€ç›´æ³¨è§†ç€ä½ çš„é¼ æ ‡, ç‚¹ä¸€ä¸‹ä¼šå‡ºç°ä»¥ä½ é¼ æ ‡ä¸ºä¸­å¿ƒçš„é»„è‰²åœ†åœˆ</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/eye-extended.png" alt="eye-extended"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/1113/nothing-to-say/">nothing-to-say</a><br>ç”¨äºåˆ‡æ–­/æ¢å¤å£°éŸ³çš„è¾“å…¥, å¯¹æˆ‘æ¥è¯´è›®æœ‰ç”¨çš„:<br>å½“ä¸åŒå­¦æ‰“æ¸¸æˆ, æ’ä¸Šçˆ¸å¦ˆæŸ¥æˆ¿, ç«‹åˆ»æŒ‰ä¸‹ <code>Super+\</code>, é˜²æ­¢çˆ¸å¦ˆè®­æˆ‘çš„å£°éŸ³æµå…¥åŒå­¦è€³ä¸­, ç»´æŠ¤å°Šä¸¥ ğŸ˜ƒ</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/nothing-to-say.png" alt="nothing-to-say"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/5090/space-bar/">space-bar</a><br>æ¨¡ä»¿ I3/Sway/Bspwm ç­‰çª—å£ç®¡ç†å™¨, å°†å·¦ä¸Šè§’çƒ¦äººçš„ <code>Activities</code> æ›¿æ¢ä¸º <code>Workspaces</code>, æœ‰äº›ç±»ä¼¼çš„æ‰©å±•, ä½†è¿™ä¸ªæœ€å¥½</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/space-bar.png" alt="space-bar"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4696/static-background-in-overview/">static-background-in-overview</a><br>åœ¨æŒ‰ä¸‹ <code>Super</code> è¿›å…¥ <code>Overview</code> æ—¶, èƒŒæ™¯å›¾ç‰‡èƒ½å¤Ÿå¡«è¡¥å››è¾¹çš„ç©ºç¼º, æ¯”èµ·é»˜è®¤çš„å››å‘¨é»‘æ¡†æ¡†æ›´åŠ å¥½çœ‹</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview.png" alt="static-background-in-overview"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4788/workspace-switcher-manager/">workspace-switcher-manager</a><br>ç¾åŒ–é€šè¿‡é”®ç›˜(æˆ‘é…æˆäº† <code>Super + 1..9</code>), åˆ‡æ¢å·¥ä½œåŒºæ—¶çš„åŠ¨ç”»æ•ˆæœ, å¾ˆèµå¾ˆå¥½çœ‹, å¯ä»¥é«˜åº¦ DIY</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/workspace-switcher-manager.png" alt="workspace-switcher-manager"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4290/disable-workspace-switch-animation-for-gnome-40/">disable-workspace-switch-animation-for-GNOME40+</a><br>æ¶ˆé™¤é€šè¿‡é”®ç›˜åˆ‡æ¢å·¥ä½œåŒºæ—¶çš„è¿‡æ¸¡åŠ¨ç”», è·å¾—æ€¥é€Ÿåˆ‡æ¢çš„ä½“éªŒæ„Ÿ<br><strong>æ— å›¾ç‰‡</strong></p></li></ul><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/1319/gsconnect/">gsconnect</a><br>GNOMEç‰ˆçš„ <code>kdeconnect</code>, ç”¨äºç”µè„‘ä¸æ‰‹æœºäº’è¿ (ä¸€ä¸ªç½‘ä¸‹), åœ¨å³ä¸Šè§’èœå•æ·»åŠ å¯¹åº”èœå•, ä»¥ä¾¿å¿«é€Ÿæ‰“å¼€<br>æ‰‹æœºéœ€å®‰è£… <code>kdeconnect</code>, ä½ å¯ä»¥ä»æœ¬åšå®¢ä¸‹è½½ apk è¿›è¡Œå®‰è£…: <a href="/downloads/gnome/kdeconnect.apk">kdeconnect</a></p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/gsconnect.png" alt="gsconnect"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3193/blur-my-shell/">blur-my-shell</a><br>ç”¨äºè®©é¢æ¿, é¡¶æ , Overview, é”å±, gnomeè‡ªå¸¦çš„æˆªå±, ç”šè‡³ç‰¹å®šçš„app, éƒ½èƒ½è¢«æ¯›ç»ç’ƒåŒ–, å¾ˆå¼ºå¤§çš„æ‰©å±•</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview.png" alt="blur-my-shell"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3488/big-avatar/">big-avatar</a><br>è®©å³ä¸Šè§’èœå•å‡ºç°ä½ çš„å¤´åƒ, ç‚¹å‡»ä¹‹åè§¦å‘è‡ªå®šä¹‰çš„å‘½ä»¤, ä½†è¿™åŠŸèƒ½ä¸å¸¸ç”¨, æå‡é€¼æ ¼è€Œå·²</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/big-avatar.png" alt="big-avatar"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4530/cpudots/">cpudots</a><br>ç›‘è§†ä½ å½“å‰çš„CPUé¢‘ç‡, ä»¥ç™¾åˆ†æ•°çš„å½¢å¼å‘ˆç°åœ¨é¡¶æ </p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/right-corner.png" alt="cpudots"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4817/colorful-battery-indicator/">colorful-battery-indicator</a><br>è®©å³ä¸Šè§’çš„ç”µæ± å˜æˆå½©è‰², æ ¹æ®ç”µé‡, åˆ†åˆ«å‘ˆç°ç»¿è‰², é»„è‰², é»„è‰², ç¾è§‚ä¸”æç¤ºä½œç”¨å¼º</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/right-corner.png" alt="colorful-battery-indicator"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4158/gnome-40-ui-improvements/">gnome40-ui-improvements</a><br>æŒ‰ä¸‹ <code>Super</code>, è¿›å…¥ <code>Overview</code> å, åœ¨ä¸­ä¸Šæ–¹æ˜¾ç¤ºå·¥ä½œåŒºçš„å†…å®¹</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/gnome40-ui-improvements.png" alt="gnome40-ui-improvements"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3956/gnome-fuzzy-app-search/">gnome-fuzzy-app-search</a><br>å‡ºäºæŸäº›ç›®çš„, é»˜è®¤çš„ <code>GNOME</code> åœ¨ <code>Overview</code> ä¸­ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥æ‰¾, å¯ä»¥é€šè¿‡è¯¥æ‰©å±•ä¿®æ”¹</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/gnome-fuzzy-app-search.png" alt="gnome-fuzzy-app-search"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4691/pip-on-top/">pip-on-top</a><br>å½“ä½ é€šè¿‡æµè§ˆå™¨ä¸­çš„ç”»ä¸­ç”»æ¨¡å¼, è§‚çœ‹è§†é¢‘æ—¶, è®©çª—å£ä¸€ç›´ä¿æŒåœ¨æœ€é¡¶éƒ¨, å³ä½¿ç„¦ç‚¹åœ¨åˆ«çš„çª—å£<br><strong>æ— å›¾ç‰‡</strong></p></li></ul><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/4792/frequency-boost-switch/">frequency-boost-switch</a><br>åœ¨å³ä¸Šè§’èœå•ä¸­çš„ <code>ç”µæ± ç­–ç•¥</code> ä¸­æ·»åŠ ä¸€ä¸ª <code>Checkox</code>, ç”¨äºåˆ‡æ¢ <code>æ˜¯å¦å…è®¸è¶…é¢‘</code></p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/frequency-boost-switch.png" alt="frequency-boost-switch"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/1702/overview-navigation/">overview-navigation</a><br>å½“æŒ‰ä¸‹ <code>Super</code> è¿›å…¥ <code>Overview</code> å, å¯ä»¥æŒ‰ä¸‹ <code>ç©ºæ ¼é”®</code>, çª—å£ä¸Šä¼šå‡ºç°å­—æ¯<br>è¾“å…¥å°å†™å­—æ¯å°±åˆ‡æ¢åˆ°å¯¹åº”çª—å£, æŒ‰ä¸‹ <code>Shift</code> ä¼šä½¿å­—æ¯é¢œè‰²å˜çº¢, æ­¤æ—¶è¾“å…¥å­—æ¯ä¼šå…³é—­å¯¹åº”çª—å£</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview-navigation.png" alt="overview-navigation"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3759/cleaner-overview/">cleaner-overview</a><br>è¿›å…¥ <code>Overview</code> æ—¶, å°†çª—å£æ’åˆ—æ•´é½, ç®€å•å®ç”¨</p></li></ul><details><summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview-navigation.png" alt="cleaner-overview"></p></details><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/19/user-themes/">user-theme</a><br>ä»ç”¨æˆ·ç›®å½•åŠ è½½å¯¹åº”çš„ä¸»é¢˜ (ä¹‹åçš„æ¢ä¸»é¢˜æ•™ç¨‹ä¸­ä¼šè®²åˆ°)<br>æ³¨æ„: è¿˜éœ€è¦ä½¿ç”¨ <code>gnome-extensions prefs user-theme@gnome-shell-extensions.gcampax.github.com</code> æŒ‡å®šä¸»é¢˜<br><strong>æ— å›¾ç‰‡</strong></p></li></ul><br><ul class="lvl-0"><li class="lvl-2"><p><a href="https://extensions.gnome.org/extension/3414/user-stylesheet-font/">user-syle-sheet</a><br>è¯»å– <code>~/.local/share/gnome-shell/gnome-shell.css</code> ç›´æ¥ä¿®æ”¹ GNOME çš„é»˜è®¤CSS, ååˆ†é€†å¤©, é€‚åˆé‡åº¦ DIY æ‚£è€…<br><strong>æ— å›¾ç‰‡</strong></p></li></ul><hr><h1 id="mei-hua">ç¾åŒ–</h1><p>ä»¥ä¸‹ç¾åŒ–å·¥ä½œæ¶‰åŠæš—æ¨¡å¼, èƒŒæ™¯, å¤´åƒ, ä¸»é¢˜, å­—ä½“, Dashç­‰<br>è¿˜æœ‰å¾ˆå¤šæ‰©å±•æœ‰å¸®åŠ©, ä¸Šé¢ <a href="#tui-jian-de-kuo-zhan">æ¨èçš„æ‰©å±•</a> é‡Œæœ‰æåˆ°, æ¯”å¦‚é‚£ä¸ªæ›´æ”¹cssçš„, è¿™é‡Œä¸è¯´äº†</p><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨æš—æ¨¡å¼:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.interface color-scheme <span class="string">&quot;prefer-dark&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>èƒŒæ™¯å£çº¸: æš—æ¨¡å¼ä¸‹çš„èƒŒæ™¯ä¸æ™®é€šæ¨¡å¼å¯ä»¥ä¸ä¸€æ ·, å› æ­¤ä¹Ÿè¦æ³¨æ„è®¾ç½®ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.background picture-uri <span class="string">&#x27;file:///usr/share/backgrounds/aaa.png&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.background picture-uri-dark <span class="string">&#x27;file:///usr/share/backgrounds/aaa.png&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¤´åƒ: å‡è®¾ç”¨æˆ·åæ˜¯ <code>Xyz</code>, åˆ™éœ€è¦å°†å›¾ç‰‡å‘½åä¸º <code>Xyz</code>, éšåæ”¾åˆ° <code>/var/lib/AccountsService/icons/</code> ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mv ./Xyz /var/lib/AccountsService/icons/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–å°†å›¾ç‰‡å‘½åä¸º.face, æ”¾åˆ°å®¶ç›®å½•</span></span><br><span class="line"><span class="comment"># mv ./Xyz ~/.face  </span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸»é¢˜: å•ç”¨æˆ·çš„æ”¾ <code>~/.themes/</code> , å¤šç”¨æˆ·çš„æ”¾ <code>/usr/share/themes/</code>, å¯å‰å¾€ <a href="https://www.gnome-look.org/">gnome-look</a> æŒ‘é€‰ä¸»é¢˜</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»¥ Nordic ä¸ºä¾‹å­</span></span><br><span class="line">mkdir ~/.themes/ &amp;&amp; <span class="built_in">cd</span> ~/.themes/</span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/mirror_jedsek/Nordic.git</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.interface gtk-theme <span class="string">&#x27;Nordic&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.preferences theme <span class="string">&#x27;Nordic&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `user-theme` è¿™ä¸ªæ‰©å±•è¿›è¡Œè®¾ç½®:  </span></span><br><span class="line">mkdir ~/.themes/ &amp;&amp; <span class="built_in">cd</span> ~/.themes/</span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/mirror_jedsek/Nordic.gi</span><br><span class="line">gnome-extensions prefs user-theme@gnome-shell-extensions.gcampax.github.com</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å­—ä½“: å°†é¡¶æ å­—ä½“æ¢æˆ <code>Fira Code</code>, é¡ºä¾¿è°ƒæ•´ä¸‹å¤§å°</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.interface font-name <span class="string">&#x27;Fira Code 11.8&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>éšè— <code>Dash</code> æ : å¯¹æˆ‘ä¸ªäººæ¥è®², Dash æ¯«æ— ç”¨å¤„è¿˜å åœ°æ–¹, å¿«æ·é”®+Overviewçš„æœç´¢, å¯ä»¥åº”ä»˜ä¸€åˆ‡å·¥ä½œäº†</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell favorite-apps <span class="string">&quot;[]&quot;</span></span><br></pre></td></tr></table></figure><div class="tips"><p><strong>æ³¨æ„</strong><br>ä»¥ä¸Šå‘½ä»¤ä»…ä»…ç§»é™¤ Dash ä¸­çš„app, ä½†ä»ç„¶ä¼šç•™ä¸‹ä¸€ä¸ªç©ºçš„Dashæ , å½»åº•éšè—, è¯·ä½¿ç”¨ <code>Just-perfection</code> æ‰©å±•<br>æ­¤æ‰©å±•å¾—åˆ°å®˜æ–¹æ”¯æŒ, å¯ä»¥å°†æ¡Œé¢ <code>åŒ–ç®€</code>, åŒ…æ‹¬Dash<br>å¦‚æœä½ åªæ˜¯ä½¿ç”¨æ‰©å±•, å°† Dash éšè—, æœªç½®ç©ºåˆ—è¡¨, ç›¸å…³å¿«æ·é”®ä»ç„¶ç”Ÿæ•ˆ, éœ€è¢«ç¦ç”¨è€Œå½»åº•æ¶ˆé™¤Dash, è¯·çœ‹ä¸‹é¢çš„<a href="#jin-yong-kuai-jie-jian">ç¦ç”¨å¿«æ·é”®</a></p></div><ul class="lvl-0"><li class="lvl-2"><p>å»æ‰å·¦ä¸Šè§’çš„ <code>Activities</code>: å¯å°†å…¶æ¢æˆ I3/Sway å¼, æ˜¾ç¤ºå·¥ä½œåŒºåç§° (è¯·å®‰è£…æ‰©å±•: <code>space-bar</code> æˆ– <code>workspace-bar</code>)</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰å·¥ä½œåŒºçš„åç§°, ä¸ç„¶å°±æ˜¯é»˜è®¤çš„æ•°å­—</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.preferences workspace-names <span class="string">&quot;[&#x27;Browser&#x27;, &#x27;Terminal&#x27;, &#x27;Game&#x27;, &#x27;Box&#x27;, &#x27;Other&#x27;]&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>éšè—é¡¶æ : å®‰è£… <code>just-perfection</code> &amp;&amp; <code>blur-my-shell</code>, é…ç½®åå°±æ˜¯æœ¬æ–‡ <a href="#cheng-pin-zhan-shi">æˆå“å±•ç¤º</a> ä¸­çš„äº†, å¤„äº <code>Overview</code> ä¸­æ‰æ˜¾ç¤ºé¡¶æ </p></li></ul><hr><h1 id="kuai-jie-jian">å¿«æ·é”®</h1><p>è¿™ä¹Ÿæ˜¯ä¸ªå¾ˆå½±å“ä½“éªŒçš„åœ°æ–¹, å¦‚æœä½ å¯¹è‡ªå¸¦çš„å¿«æ·é”®ä¸æ»¡æ„, å®Œå…¨å¯ä»¥è‡ªå·±æ›´æ”¹</p><p>æˆ‘ä¸ªäººå°±ä¸å–œæ¬¢ <code>Alt+Fnæ•°å­—</code>, å› ä¸ºå¤ªè¿œäº†, è€Œä¸”è®°ä¸æ¸…, å¹²è„†æ¢äº›ç®€å•æ˜“è®°çš„, åƒ <code>I3/Sway</code> é‚£æ ·<br>å½“ç„¶, ä½ è¿˜å¯ä»¥ç¦ç”¨ä¸€äº›å¿«æ·é”®, åšåˆ°ä¸€äº›äº‹æƒ…, æ¯”å¦‚æ¶ˆé™¤ Dash</p><div class="tips"><p><strong>æ³¨æ„</strong><br>å¿«æ·é”®ä¹‹é—´æœ‰å†²çªçš„è¯, å¯èƒ½æ— æ³•ç”Ÿæ•ˆ, è¯·é€šè¿‡ <code>gnome-control-center keyboard</code> æŸ¥çœ‹å¿«æ·é”®å†²çª</p></div><h2 id="cha-zhao-kuai-jie-jian" id="æŸ¥æ‰¾å¿«æ·é”®">æŸ¥æ‰¾å¿«æ·é”®</h2><p>é¦–å…ˆ, æˆ‘ä»¬å¾—æ˜ç™½å¦‚ä½•æŸ¥æ‰¾å¯¹åº”çš„å¿«æ·é”®</p><p>ä¸‹é¢çš„å‘½ä»¤ä¼šåˆ—å‡ºæå¤§éƒ¨åˆ†çš„å¿«æ·é”®:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings list-recursively | grep -E <span class="string">&quot;Super|Alt|Ctrl|Shift|F[0-9]|Page|Up|Down|Right|Left&quot;</span> | cat</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨åé¢é€šè¿‡ pipeline, è¿½åŠ ä¸€ä¸ª grep, æœç´¢ theme, font, workspace, switch, move ç­‰è¯è¯­<br>å¦‚æœå®åœ¨æ‰¾ä¸åˆ°, ä¸€ç‚¹ç‚¹çœ‹è¿‡å»ä¹Ÿè¡Œ ğŸ˜ƒ</p><h2 id="jin-yong-kuai-jie-jian" id="ç¦ç”¨å¿«æ·é”®">ç¦ç”¨å¿«æ·é”®</h2><p>æŸå‘½ä»¤çš„å¿«æ·é”®, ä¸€èˆ¬å¯ä»¥æœ‰å¤šä¸ª, å³æŸå‘½ä»¤çš„å¿«æ·é”®æ˜¯ä¸€ä¸ªæ•°ç»„<br>æƒ³è¦ç¦ç”¨è¯¥å¿«æ·é”®, å°†å¯¹åº”çš„æ•°ç»„è®¾ç½®ä¸ºç©ºå°±è¡Œäº†</p><p>ä¸¾ä¸ªä¾‹å­, ç¦ç”¨Dashçš„å¿«æ·é”® (è§ä¸Šæ–‡çš„ç½®ç©º <code>favorite-apps</code>):</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Default: Super+&quot;1..9&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 9)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    gsettings <span class="built_in">set</span> org.gnome.shell.keybindings switch-to-application-<span class="variable">$i</span> <span class="string">&quot;[]&quot;</span>  </span><br><span class="line"><span class="keyword">done</span>    </span><br></pre></td></tr></table></figure><p>ç¦ç”¨å¿«æ·é”®è¿˜å¯ä»¥è®©ä½ é¿å…å†²çª, æ¯”å¦‚:<br>æŸä¸ªæ“ä½œç»‘å®šäº†å¿«æ·é”®A, å¦ä¸€ä¸ªæ“ä½œä¹Ÿç»‘å®šäº†å¿«æ·é”®A, å¯èƒ½é”®Aå°±å¤±æ•ˆäº†, æˆ‘é‡åˆ°è¿‡å¥½å‡ æ¬¡<br>è¿™æ—¶å°±è¦å€ŸåŠ© GUI çš„åŠ›é‡äº†: è¾“å…¥ <code>gnome-control-center keyboard</code>, ç„¶åè¿›å…¥è‡ªå®šä¹‰é‚£æ , ä¼šæ˜¾ç¤ºå†²çªçš„é”®</p><p>ä¸¾ä¸ªä¾‹å­, æˆ‘æƒ³ä¿®æ”¹ <code>Super+Esc</code> å˜æˆé”å±, æˆ‘å°±è¦è¿™æ ·åš:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.settings-daemon.plugins.media-keys screensaver <span class="string">&quot;[&#x27;&lt;Super&gt;Escape&#x27;]&quot;</span> <span class="comment">#Default: Sup+L</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.mutter.wayland.keybindings restore-shortcuts <span class="string">&quot;[]&quot;</span> <span class="comment"># Default: Sup+Esc</span></span><br></pre></td></tr></table></figure><h2 id="xiu-gai-kuai-jie-jian" id="ä¿®æ”¹å¿«æ·é”®">ä¿®æ”¹å¿«æ·é”®</h2><p>ä¿®æ”¹, ä¹Ÿå°±æ˜¯è¦†å†™é»˜è®¤çš„å¿«æ·é”®, ä¸ä¸‹æ–‡è¦è®²çš„ <a href="#tian-jia-kuai-jie-jian">æ·»åŠ å¿«æ·é”®</a> ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µ<br>å•çº¯çš„æ”¹æ”¹æ”¹è€Œå·², ä¸‹é¢æ˜¯æˆ‘ä¸ªäººä¿®æ”¹çš„ä¸€å¥—å¿«æ·é”®, ä¾›å¤§å®¶å‚è€ƒ</p><ul class="lvl-0"><li class="lvl-2"><p>Vim å¼çš„æ¡ˆä»¶, æ”¹å˜çª—å£å¸ƒå±€, æ›¿ä»£åŸæœ‰çš„ <code>Super+æ–¹å‘é”®</code>:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¶å®è¿˜æœ‰æ›´ä¸§å¿ƒç—…ç‹‚çš„, å¯ä»¥ç»‘å®šå¿«æ·é”®, å°†çª—å£æ”¾å·¦ä¸Šè§’, å³ä¸Šè§’, ä¸­é—´å·¦è¾¹, ä¸­é—´å³è¾¹çš„......</span></span><br><span class="line"></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.mutter.keybindings      toggle-tiled-left  <span class="string">&quot;[&#x27;&lt;Super&gt;h&#x27;]&quot;</span> <span class="comment"># æ”¾å·¦è¾¹</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings  maximize           <span class="string">&quot;[&#x27;&lt;Super&gt;j&#x27;]&quot;</span> <span class="comment"># æœ€å¤§åŒ–</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings  unmaximize         <span class="string">&quot;[&#x27;&lt;Super&gt;k&#x27;]&quot;</span> <span class="comment"># æœ€å°åŒ–</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.mutter.keybindings      toggle-tiled-right <span class="string">&quot;[&#x27;&lt;Super&gt;l&#x27;]&quot;</span> <span class="comment"># æ”¾å³è¾¹</span></span><br></pre></td></tr></table></figure><p>å¯¹äº†, å¦‚æœä½ è¿½æ±‚å¹³é“ºå¼çš„è¯, æ‰©å±•å¯ä»¥æ»¡è¶³ä¸€éƒ¨åˆ†è¦æ±‚, ä½†è‚¯å®šæ¯”ä¸ä¸Šä¸“ä¸šçš„çª—ç®¡â€¦</p><ul class="lvl-0"><li class="lvl-2"><p>move, resize, kill ä¸€ä¸ªçª—å£:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Move</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings begin-move   <span class="string">&quot;[&#x27;&lt;Super&gt;x&#x27;]&quot;</span>        <span class="comment">#Default: Alt+F7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Resize</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings begin-resize <span class="string">&quot;[&#x27;&lt;Super&gt;r&#x27;]&quot;</span>        <span class="comment">#Default: Alt+F8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kill</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings close        <span class="string">&quot;[&#x27;&lt;Super&gt;&lt;Shift&gt;q&#x27;]&quot;</span> <span class="comment">#Default: Alt+F4</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>toggle-max, max, min, toggle-fullscreen, show-desktop:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Toggle max</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings toggle-maximized  <span class="string">&quot;[&#x27;&lt;Super&gt;m&#x27;]&quot;</span>     <span class="comment">#Default: Alt+F10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Max/Min</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings maximize          <span class="string">&quot;[&#x27;&lt;Super&gt;j&#x27;]&quot;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings unmaximize        <span class="string">&quot;[&#x27;&lt;Super&gt;k&#x27;]&quot;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings minimize          <span class="string">&quot;[&#x27;&lt;Super&gt;comma&#x27;]&quot;</span> <span class="comment">#Default: Super+H</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Toggle fullscreen</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings toggle-fullscreen <span class="string">&quot;[&#x27;&lt;Super&gt;f&#x27;]&quot;</span>     <span class="comment">#Default: None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show desktop</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings show-desktop      <span class="string">&quot;[&#x27;&lt;Super&gt;d&#x27;]&quot;</span>     <span class="comment">#Default: None</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿˜æœ‰å¥—å¾ˆé‡è¦çš„å¿«æ·é”®, å°±æ˜¯åˆ‡æ¢å·¥ä½œåŒºäº†, æ­é…æ¶ˆé™¤è¿‡æ¸¡åŠ¨ç”»/å¢åŠ ç‰¹æ•ˆçš„æ‰©å±•, æµç•…æ„ŸMax:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 9)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings switch-to-workspace-<span class="variable">$i</span> <span class="string">&quot;[&#x27;&lt;Super&gt;<span class="variable">$i</span>&#x27;]&quot;</span></span><br><span class="line">  gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings move-to-workspace-<span class="variable">$i</span>   <span class="string">&quot;[&#x27;&lt;Super&gt;&lt;Shift&gt;<span class="variable">$i</span>&#x27;]&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings switch-to-workspace-10   <span class="string">&quot;[&#x27;&lt;Super&gt;0&#x27;]&quot;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings move-to-workspace-10     <span class="string">&quot;[&#x27;&lt;Super&gt;&lt;Shift&gt;0&#x27;]&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å†æ¯”å¦‚, è¦†å†™ <code>run-dialog</code> çš„å¿«æ·é”® (é»˜è®¤æ˜¯æŒ‰Alt-F2, ä½†å¤ªè¿œäº†â€¦):</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings panel-run-dialog <span class="string">&quot;[&#x27;&lt;Super&gt;c&#x27;]&quot;</span> <span class="comment">#Default: Alt+F2</span></span><br></pre></td></tr></table></figure><h2 id="tian-jia-kuai-jie-jian" id="æ·»åŠ å¿«æ·é”®">æ·»åŠ å¿«æ·é”®</h2><p>æ­¤å¤„æŒ‡çš„æ˜¯çœŸæ­£çš„, æ·»åŠ è‡ªå·±çš„å¿«æ·é”®. ä¸æ˜¯ç®€å•çš„è¦†å†™<br>æ¯”å¦‚ <code>Super+Return</code> æ‰“å¼€ä¸€ä¸ªç»ˆç«¯, <code>Super+B</code> æ‰“å¼€æµè§ˆå™¨, <code>Super+E</code> æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨â€¦</p><p>åºŸè¯ä¸å¤šè¯´, ä½ æŒ‰ä¸‹é¢ç…§çŒ«ç”»è™, å°±é˜”ä»¥äº†:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gp0=<span class="string">&quot;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings&quot;</span></span><br><span class="line">gp1=<span class="string">&quot;org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:\</span></span><br><span class="line"><span class="string">/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom Keys</span></span><br><span class="line"><span class="comment"># æ³¨æ„!!!!!!!</span></span><br><span class="line"><span class="comment"># ä¸è¦åœ¨æœ€åæ·»åŠ é€—å·</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.settings-daemon.plugins.media-keys custom-keybindings <span class="string">&quot;[     \</span></span><br><span class="line"><span class="string">    &#x27;<span class="variable">$gp0</span>/custom0/&#x27;, &#x27;<span class="variable">$gp0</span>/custom1/&#x27;, &#x27;<span class="variable">$gp0</span>/custom2/&#x27;, &#x27;<span class="variable">$gp0</span>/custom3/&#x27;               \</span></span><br><span class="line"><span class="string">]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Terminal</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom0/ name     <span class="string">&#x27;Terminal&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom0/ <span class="built_in">command</span>  <span class="string">&#x27;alacritty&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom0/ binding  <span class="string">&#x27;&lt;Super&gt;Return&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Files</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom1/ name     <span class="string">&#x27;Files&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom1/ <span class="built_in">command</span>  <span class="string">&#x27;nautilus&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom1/ binding  <span class="string">&#x27;&lt;Super&gt;e&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Browser</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom2/ name     <span class="string">&#x27;Browser&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom2/ <span class="built_in">command</span>  <span class="string">&#x27;microsoft-edge-beta&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom2/ binding  <span class="string">&#x27;&lt;Super&gt;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Fcitx5 Reload</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom3/ name     <span class="string">&#x27;Fcitx5_Reload&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom3/ <span class="built_in">command</span>  <span class="string">&#x27;fcitx5 -r&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom3/ binding  <span class="string">&#x27;&lt;Alt&gt;space&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ç›¸ä¿¡ä½ ä¸ä¼šå°†æ—¶é—´æµªè´¹åœ¨æ‰åœ¨å‘é‡Œé¢äº†<br>ä¸Šé¢çš„ä¸€åˆ‡å·²ç»éå¸¸éå¸¸å…¨äº†</p><hr><h1 id="jia-zai-pei-zhi">åŠ è½½é…ç½®</h1><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ dconf è¿™ä¸ªå·¥å…·, å¯¼å…¥æˆ–å¯¼å‡ºè®°è½½ç€ GNOME æ•°æ®çš„é…ç½®æ–‡ä»¶<br>ä½ å¯ä»¥å¯¼å‡ºè®°è½½å½“å‰DEçš„é…ç½®æ–‡ä»¶, ç„¶åå¯¼å‡ºåˆ°å¦ä¸€å°æœºå™¨ä¸Š<br>è¿™æ„å‘³ç€, å½“ä½ é‡è£…ç³»ç»Ÿæ—¶, æŒ‰ä¸‹é¢çš„æ–¹æ³•èƒ½å¿«é€Ÿæ¢å¤åˆ°å…ˆå‰çš„DE</p><p>ä½ ä¹Ÿå¯ä»¥å‚è€ƒæˆ–ç›´æ¥åŠ è½½æˆ‘åšå®¢ä¸‹çš„ <a href="/downloads/gnome/dconf.settings"><strong>dconf.settings</strong></a></p><h2 id="dui-yu-fei-nixos" id="å¯¹äºéNixos">å¯¹äºéNixos</h2><p>å¯¹äºæ™®é€šçš„Linuxå‘è¡Œç‰ˆ, ç›´æ¥æŒ‰ä¸‹é¢çš„æ–¹å¼</p><ul class="lvl-0"><li class="lvl-2"><p>å¯¼å‡ºå½“å‰çš„dconfæ•°æ®åˆ°æŸä¸ªæ–‡ä»¶:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dconf dump / &gt; dconf.settings</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŠ è½½/å¯¼å…¥æŸä¸ªdconfæ–‡ä»¶åˆ°å½“å‰ç³»ç»Ÿ:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat dconf.settings | dconf load -f /</span><br></pre></td></tr></table></figure><p>å¯¹äºèƒŒæ™¯ä¸å¤´åƒ, ä½ å¯ä»¥å†™ä¸€æ®µè„šæœ¬, å°†å…¶å¤åˆ¶åˆ°ç›¸åº”ä½ç½®, ç„¶åå†æ·»åŠ ä¸Šé¢çš„ä»£ç åŠ è½½é…ç½®<br>åŒæ—¶ç¡®è®¤ <code>dconf.settings</code> ä¸­çš„ <code>picture-uri</code> / <code>picture-uri-dark</code> æŒ‡å‘å¯¹åº”æ–‡ä»¶</p><h2 id="dui-yu-nixos" id="å¯¹äºNixos">å¯¹äºNixos</h2><p>å¦‚æœä½ ä½¿ç”¨ Nixos, è¯·å…ˆç¡®ä¿å·²ç»å®‰è£…äº† <a href="https://github.com/nix-community/home-manager">HomeManager</a><br>HomeManager æ˜¯ Nixos ä¸­ç”¨æ¥ç®¡ç†ç”¨æˆ·é…ç½®, æ”¯æŒå›æ»šçš„å·¥å…·</p><p>è™½ç„¶ä¹Ÿèƒ½æŒ‰ä¸Šé¢çš„æ–¹æ³•é…ç½® Nixos çš„ GNOME, ä½†è¿˜æ˜¯æ¨èä½¿ç”¨ HomeManager, åŸå› ç•¥è¿‡, è‡ªçœ‹æ–‡æ¡£<br>è¯·å…ˆä¸‹è½½ <code>dconf2nix</code>, è¿™æ˜¯ä¸€ä¸ªå°† dconfæ–‡ä»¶, è½¬æ¢ä¸º nix è¡¨è¾¾å¼çš„å·¥å…·<br>éšå, åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å†…å®¹, å¾—åˆ° <code>dconf.nix</code> :</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dconf dump / &gt; dconf.settings</span><br><span class="line">dconf2nix -i dconf.settings -o dconf.nix</span><br></pre></td></tr></table></figure><p>åœ¨ä½ çš„ ~/.config/nixpkgs ä¸­, ä¿æŒè¿™æ ·çš„ç›®å½•ç»“æ„ (å½“ç„¶äº†, å¯ä»¥éšä½ æƒ³æ³•):</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nixpkgs/</span><br><span class="line">â”œâ”€â”€ gnome</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ .background</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ .face</span><br><span class="line">â”‚Â Â  â””â”€â”€ dconf.nix</span><br><span class="line">â””â”€â”€ home.nix</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>dconf.nix</code> å°±æ˜¯åˆšåˆšè½¬æ¢å¾—åˆ°çš„nixè¡¨è¾¾å¼, åœ¨ <code>home.nix</code> ä¸­å¯¼å…¥å®ƒ:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">imports = [</span><br><span class="line">  ./gnome/dconf.nix</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>ä»‹äº HomeManager çš„æƒé™é—®é¢˜, å¿…é¡»å°†èƒŒæ™¯å›¾ç‰‡/äººç‰©å¤´åƒ, ä¿æŒåœ¨ <code>$HOME</code> ä¸‹<br>è¿™é‡Œå°†ä¸¤ä¸ªå›¾ç‰‡æ”¾åœ¨äº† <code>~/.config/nixpkgs/gnome/</code> ä¸‹, å› æ­¤è¦ä¿®æ”¹ä¸‹ç›¸åº”æ–‡ä»¶</p><ul class="lvl-0"><li class="lvl-2"><p>å¯¹äºèƒŒæ™¯å›¾åƒ, ä¿®æ”¹ <code>dconf.nix</code> ä¸­çš„ <code>picture-uri</code>:</p></li></ul><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;org/gnome/desktop/background&quot;</span> =</span><br><span class="line"><span class="keyword">let</span> <span class="attr">picture</span> = ../.background.png; <span class="keyword">in</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">picture-uri</span> = <span class="string">&quot;file://<span class="subst">$&#123;picture&#125;</span>&quot;</span>;</span><br><span class="line">  <span class="attr">picture-uri-dark</span> = <span class="string">&quot;file://<span class="subst">$&#123;picture&#125;</span>&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯¹äºäººç‰©å¤´åƒ, åœ¨ <code>home.nix</code> æ·»åŠ ä»¥ä¸‹å†…å®¹:</p></li></ul><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">home.file.<span class="string">&quot;.face&quot;</span>.<span class="attr">source</span> = ./.face;</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆ!  æˆ‘ç›¸ä¿¡è¿™æ˜¯æœ€æœ€æœ€æœ€æœ€å…¨çš„ä¸€ä»½ GNOME å…¥å‘æŒ‡å—äº†</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å…³äº GNOME çš„å…¥å‘æŒ‡å—, è®©ä½ äº†è§£, é…ç½®, ç¾åŒ–æ¡Œé¢ç¯å¢ƒ&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="GNOME" scheme="https://jedsek.xyz/tags/GNOME/"/>
    
  </entry>
  
  <entry>
    <title>haskell-basic-p5: ç±»å‹ä¸ç±»å‹ç±»</title>
    <link href="https://jedsek.xyz/posts/haskell-basic/p5"/>
    <id>https://jedsek.xyz/posts/haskell-basic/p5</id>
    <published>2022-07-18T08:24:44.000Z</published>
    <updated>2022-07-18T08:24:44.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äº Haskell ä¸­çš„ç±»å‹(Type), ä¸ç±»å‹ç±»(Typeclass)</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p><h1 id="kai-pian">å¼€ç¯‡</h1>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å…³äº Haskell ä¸­çš„ç±»å‹(Type), ä¸ç±»å‹ç±»(Typeclass)&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Haskell" scheme="https://jedsek.xyz/tags/Haskell/"/>
    
  </entry>
  
  <entry>
    <title>haskell-basic-p4: åŸºç¡€è¯­æ³•</title>
    <link href="https://jedsek.xyz/posts/haskell-basic/p4"/>
    <id>https://jedsek.xyz/posts/haskell-basic/p4</id>
    <published>2022-07-12T13:46:05.000Z</published>
    <updated>2022-07-12T13:46:05.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äº Haskell çš„æ•°å­—, Bool, List, Ifè¯­å¥</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p><p>Haskell æ˜¯ä¸€é—¨é™æ€å¼ºç±»å‹è¯­è¨€, æˆ‘ä»¬æ¥ä¸‹æ¥å°†å­¦ä¹ ä¸€äº›åŸºç¡€ç±»å‹<br>ä½ å¯ä»¥åœ¨ç»ˆç«¯æ•²ä¸‹ <code>ghci</code> è¿›å…¥äº¤äº’è§£é‡Šå™¨, å»æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç </p><h1 id="shu-zi">æ•°å­—</h1><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">(<span class="number">2</span> + <span class="number">8</span>) * <span class="number">9</span> - <span class="number">10</span>   <span class="comment">-- 80</span></span><br><span class="line"><span class="number">5</span> / <span class="number">2</span>              <span class="comment">-- 2.5</span></span><br><span class="line"><span class="number">5</span> ^ <span class="number">2</span>              <span class="comment">-- 25</span></span><br><span class="line"><span class="number">5</span> ^  (<span class="number">2.0</span>)         <span class="comment">-- error</span></span><br><span class="line"><span class="number">5</span> ** (<span class="number">2.0</span>)         <span class="comment">-- 25.0 </span></span><br></pre></td></tr></table></figure><p>åŠ å‡ä¹˜é™¤å°±ä¸è¯´äº†, å¯¹äº <code>^</code> ä¸ <code>**</code> éƒ½æ˜¯å¹‚å‡½æ•°, åº•æ•°çš„ç±»å‹éšæ„<br>ä½† <code>^</code> æ¥å—çš„æŒ‡æ•°æ˜¯ä¸ªæ•´æ•°, <code>**</code> åˆ™å¯ä»¥æ¥å—å°æ•°/æ•´æ•° (ç±»å‹æ–¹é¢ä¹‹åå†è®², è¿™é‡Œæœ‰ç‚¹ä¸å‡†ç¡®)<br>ä»¥ä¸Šçš„è¿ç®—ç¬¦å·, å®é™…ä¸Šéƒ½æ˜¯å‡½æ•°</p><p>æ¯”å¦‚, ä½ å¯ä»¥é”®å…¥ <code>:t (+)</code>, æ¥å¾—åˆ° <code>+</code> è¿™ä¸ªå‡½æ•°çš„ç±»å‹:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">(+) :: <span class="type">Num</span> a =&gt; a -&gt; a -&gt; a</span><br></pre></td></tr></table></figure><p><code>=&gt;</code> åé¢çš„è¡¨ç¤ºå‚æ•°ä¸è¿”å›å€¼çš„ç±»å‹<br><code>=&gt;</code> å‰çš„ä¸€å—æ˜¯ç±»å‹ç±»(Typeclass), èµ·ç±»å‹çº¦æŸçš„ä½œç”¨, ç›¸å½“äºå…¶ä»–è¯­è¨€çš„ trait/interface</p><p>çœ‹ä¸æ‡‚æ²¡å…³ç³», ä¹‹åä¼šå­¦, è·³è¿‡å³å¯, æ­¤å¤„åªæ˜¯ä¸ºäº†å‘Šè¯‰ä½ , åœ¨ <code>ghci</code> ä¸­, å¦‚ä½•æŸ¥çœ‹ç±»å‹è€Œå·²<br>ä»¥ä¸Šçš„ä¸œè¥¿, å®é™…ä¸Šç±»ä¼¼äº:</p><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="params">(+)</span>&lt;<span class="title">a</span>: <span class="title">Num</span>&gt; <span class="params">(a, a, a)</span> -&gt;</span> a &#123; &#125;</span><br></pre></td></tr></table></figure><p>Haskell ä¸­çš„å°å†™å­—æ¯ç›¸å½“äºæ— çº¦æŸçš„æ³›å‹, å•¥éƒ½èƒ½åŒ¹é…<br>Num è¿™ä¸ªç±»å‹ç±»äº†, ä¾¿èµ·åˆ°ä¸€ä¸ªçº¦æŸçš„ä½œç”¨</p><p>åŒæ—¶, ç”±äºåŠ æ³•å‡½æ•°çš„å®šä¹‰, <code>&quot;ABC&quot; + 123</code> è¿™æ ·çš„è¡¨è¾¾å¼, ä¼šç›´æ¥æŠ¥é”™<br>å› ä¸ºä¸æ»¡è¶³ä¼ å…¥å‚æ•°çš„è¦æ±‚: ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å¿…é¡»ç›¸ç­‰, å› ä¸ºå®ƒä»¬éƒ½æ˜¯a</p><hr><h1 id="bool">Bool</h1><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="type">True</span> &amp;&amp; <span class="type">False</span>      <span class="comment">-- False</span></span><br><span class="line"><span class="type">True</span> || <span class="type">False</span>      <span class="comment">-- True</span></span><br><span class="line"><span class="title">not</span> <span class="type">True</span>           <span class="comment">-- False</span></span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥ç”¨ <code>==</code> æˆ– <code>/=</code> æ¥å¾—åˆ°ä¸€ä¸ªBoolå€¼:<br>(æ³¨: æˆ‘çš„åšå®¢å¯èƒ½å¯ç”¨äº†è¿ä½“å­—, ä¸Šé¢çš„ç­‰å·æ˜¯ä¸¤ä¸ªç­‰å·, ä¸ç­‰å·æ˜¯æ–œæ +ç­‰å·)</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> == <span class="number">0</span>             <span class="comment">-- False</span></span><br><span class="line"><span class="number">2</span> + <span class="number">3</span> == <span class="number">1</span> + <span class="number">4</span>     <span class="comment">-- True</span></span><br><span class="line"><span class="string">&quot;ABC&quot;</span> /= <span class="string">&quot;AB&quot;</span>      <span class="comment">-- True</span></span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯, ç­‰å·ä¸ä¸ç­‰å·çš„å·¦å³, ä¸¤ä¸ªå€¼çš„ç±»å‹å¿…é¡»ç›¸ç­‰<br>è¿™æ˜¯å› ä¸º Haskell ä¸­çš„è¿ç®—ç¬¦éƒ½æ˜¯å‡½æ•°, å·²ç»å®šä¹‰å¥½äº†ç±»å‹<br>å¯ä»¥é”®å…¥ <code>:t (==)</code> æŸ¥çœ‹å…¶ç±»å‹:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">(==) :: <span class="type">Eq</span> a =&gt; a -&gt; a -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºæ¥å—çš„ä¸¤ä¸ªå‚æ•°, å…¶ç±»å‹ç›¸åŒ, éƒ½æ˜¯a<br>å¹¶ä¸”aç±»å‹å¿…é¡»å…·æœ‰ç›¸ç­‰æ€§, è¿”å›å€¼æ˜¯Boolç±»å‹</p><p>æ³¨æ„:<br>ç”±äºå…¶å®šä¹‰, <code>&quot;ABC&quot; == 123</code> è¿™æ ·çš„è¡¨è¾¾å¼, ä¼šç›´æ¥æŠ¥é”™<br>åŸå› ä¸å…ˆå‰çš„åŠ æ³•å‡½æ•°åŒç†</p><p>ç­‰åˆ°åé¢, æˆ‘ä»¬å¯ä»¥è‡ªå·±åŠ¨æ‰‹, å®ç° <code>&amp;&amp;</code>, <code>||</code>, <code>not</code> è¿™ä¸‰ä¸ªå‡½æ•°<br>ç”šè‡³è¿ Ifè¯­å¥, æˆ‘ä»¬éƒ½å¯ä»¥è‡ªå·±å†™ä¸ªå‡½æ•°æ¥ä»£æ›¿</p><p>Ifè¯­å¥åœ¨ Haskell ä¸­ä»…ä»…æ˜¯ä¸ªè¯­æ³•ç³–è€Œå·²<br>åœ¨ Haskell-Wiki ä¸Š, ç”šè‡³æœ‰ä¸ªè®¨è®º, æ­£ååŒæ–¹è¾©è®ºè¦ä¸è¦æŠ›å¼ƒ <code>if-else</code> è¿™æ ·çš„è¯­æ³•ç³–<br>æ„Ÿå…´è¶£çš„è¯, å¯ä»¥è‡ªå·±å»çœ‹ä¸‹: <a href="https://wiki.haskell.org/If-then-else">ä¼ é€é—¨</a></p><hr><h1 id="list">List</h1><p>List(åˆ—è¡¨), åœ¨ Haskell ä¸­æ‰®æ¼”ç€ä¸€ä¸ªéå¸¸é‡è¦çš„è§’è‰²<br>å°±åƒæ˜¯å…¶ä»–è¯­è¨€çš„æ•°ç»„ä¸€æ ·, ä½†å´æ›´åŠ å¼ºå¤§</p><h2 id="sheng-lue-you-duan" id="çœç•¥å³ç«¯">çœç•¥å³ç«¯</h2><p>åƒä¸‹é¢, å°±åˆ›å»ºäº†ä¸€ä¸ªæœ‰åä¸ªå…ƒç´ çš„List:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„List, ç±»å‹ä¸º <code>Num a =&gt; [a]</code><br>a å®é™…ä¸Šå°±æ˜¯å…ƒç´ çš„ç±»å‹, [a] è¡¨ç¤ºè£…ç€è¿™ç§ç±»å‹å…ƒç´ çš„List</p><p>è™½ç„¶æˆ‘æƒ³æŠŠå¸¸ç”¨çš„å‡½æ•°æ”¾åˆ°ä¹‹åå†è®², ä½†è¿˜æ˜¯å¾—å…ˆæ•™ä½ ä¸€ä¸ª: <code>take</code><br>ä½ å¯ä»¥æŸ¥çœ‹å®ƒçš„ç±»å‹:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">take</span> :: <span class="type">Int</span> -&gt; [a] -&gt; [a]</span><br></pre></td></tr></table></figure><p>è¿™è¡¨ç¤º, å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°, ç¬¬ä¸€ä¸ªè¡¨ç¤ºè¦å–å‰é¢å¤šå°‘ä¸ªå…ƒç´ , ç¬¬äºŒä¸ªæ˜¯ä»»æ„ç±»å‹çš„List, éšåè¿”å›æ–°çš„List<br>æ¯”å¦‚:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">take</span> <span class="number">5</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]      <span class="comment">-- [1,2,3,4,5]</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä½ é©¬ä¸Šå°±ä¼šç”¨åˆ°, åœ¨å¤„ç†æ— é™å…ƒç´ çš„Listæ—¶éå¸¸å¥½ç”¨</p><p>å›åˆ°åˆšæ‰, ä½ å¯ä»¥ä¸€ä¸ªä¸ªåœ°è¾“å…¥å…ƒç´ , åˆ›å»ºList<br>ä¸è¿‡è¿™å¤ªéº»çƒ¦äº†, å¦‚æœæˆ‘æƒ³è¦ä¸€ç™¾ä¸ª, ä¸€åƒä¸ªè¿ç»­çš„æ•´æ•°å‘¢? ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1.</span><span class="number">.10</span>]</span><br><span class="line">[<span class="number">1.</span><span class="number">.100</span>]</span><br><span class="line">[<span class="number">1.</span><span class="number">.1000</span>]</span><br></pre></td></tr></table></figure><p>è¯¸å¦‚ <code>[m..n]</code> è¿™æ ·çš„å½¢å¼, ä¼šåˆ›å»ºä¸€ä¸ªé—­åŒºé—´, ä»méå†åˆ°n<br>å½“ç„¶, å¾—å…ˆä¿è¯å…ƒç´ æœ¬èº«çš„ç±»å‹, æ˜¯å¯ä»¥è¿›è¡Œéå†çš„, å³å…ƒç´ æœ¬èº«æ˜¯ <code>Enum</code> è¿™ä¸ªç±»å‹ç±»çš„æˆå‘˜<br>ä» Rust, Scala, Java ç­‰è¯­è¨€å‡ºå‘, ç›¸å½“äºå®ç°äº† <code>Enum</code> è¿™ä¸ª Trait/Interface</p><p>ä½ ç”šè‡³å¯ä»¥èˆå»å³ç«¯, å†™ä¸‹ <code>[1..]</code> è¿™æ ·çš„å¼å­æ¥è¡¨è¾¾1åˆ°æ— ç©·<br>ä½ è¿˜å¯ä»¥ç”Ÿæˆ [Char], æ¯”å¦‚ <code>['a'..'z']</code> å°†ä¼šç”Ÿæˆ <code>&quot;abcdefghijklmnopqrstuvwxyz&quot;</code>, å› ä¸ºStringç±»å‹ç­‰ä»·äº [Char]</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯, å¿½ç•¥å³ç«¯ç‚¹æ—¶, ç”Ÿæˆçš„Listå¯èƒ½æ— ç©·å¤§, ä¹Ÿå¯èƒ½æ˜¯æœ‰ç•Œçš„, æˆ‘ä»¬å…ˆå‡è®¾å…ƒç´ çš„ç±»å‹ä¸ºa<br>å½“aä¹Ÿæ˜¯ <code>Bounded</code> ç±»å‹ç±»çš„æˆå‘˜æ—¶, è¯´æ˜è¿™ç§ç±»å‹ä¸€å®šæœ‰è¾¹ç•Œ, æ¯”å¦‚ <code>Int</code>, <code>Char</code> ç­‰<br>ä¸ç„¶çš„è¯, aå°†æ— ç•Œ, æ¯”å¦‚ <code>[1..]</code> ä¾¿æ˜¯ä¸€ä¸ªçœŸæ­£çš„, ä»1åˆ°æ­£æ— ç©·çš„List, ç±»å‹ä¸º <code>Num a =&gt; [a]</code></p><p>å½“ä½ çœ‹åˆ°è¿™é‡Œæ—¶, å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®: 1 çš„ç±»å‹ä¸åº”è¯¥æ˜¯Intå—?  ä¸ºä»€ä¹ˆä¼šæ˜¯ <code>Num a =&gt; a</code> å‘¢?</p><p>äº‹å®ä¸Š, è¿™æ˜¯ Haskell ä¸­ä¸ºæ•°ä¸å¤šçš„éšå¼è¡Œä¸º<br>ä»»ä½•æ•´æ•°çš„å­—é¢é‡, ä¸ºäº†è¿ç®—æ–¹ä¾¿, éƒ½æŠŠå®ƒä»¬çœ‹ä½œå®ç°äº†Numç±»å‹ç±»çš„ç±»å‹, ä»¥ä¾¿äºå‘ä¸‹è½¬å‹</p><p>ä¸¾ä¸ªä¾‹å­, ä½ ä½¿ç”¨äº†Integer(æ— é™ç²¾åº¦çš„Int) ä¸ æ•´æ•°å­—é¢é‡:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">a</span> = <span class="number">100</span>::<span class="type">Integer</span>      <span class="comment">-- 100</span></span><br><span class="line"><span class="title">a</span> + <span class="number">1</span>                 <span class="comment">-- 101</span></span><br><span class="line"><span class="title">a</span> + <span class="number">1</span>::<span class="type">Int</span>            <span class="comment">-- error</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆå£°æ˜äº†a, åˆ†åˆ«ä¸æ•´æ•°å­—é¢é‡, Intç±»å‹æ•°å­—ç›¸åŠ <br>å¯¹äºç¬¬ä¸€ä¸ªåŠ æ³•, 1æ˜¯ä¸ªå­—é¢é‡, æ˜¯Num, ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡º1åº”è¯¥ä¹Ÿæ˜¯Integerç±»å‹çš„<br>æ ¹æ® <a href="#shu-zi">(+)å‡½æ•°</a> çš„å®šä¹‰, åŒæ—¶ä¹Ÿå› ä¸ºIntegeræ˜¯Numè¿™ä¸ªTypeclassçš„æˆå‘˜</p><p>å›åˆ°å…ˆå‰çš„ <code>[1..]</code>, 1æ˜¯Num, å½“ List äº§ç”Ÿçš„æ•°å­—è¶…è¶Š Int çš„æœ€å¤§å€¼æ—¶, ä¸ä¼šæº¢å‡º, è€Œæ˜¯è½¬æˆ Integer ä»¥æ»¡è¶³éœ€æ±‚</p><h2 id="she-zhi-bu-chang" id="è®¾ç½®æ­¥é•¿">è®¾ç½®æ­¥é•¿</h2><p>å…ˆå‰æˆ‘ä»¬è®²åˆ°, ä½ é™¤äº†å‚»ä¹ä¹åœ°å»ä¸€ä¸ªä¸ªåœ°å¡«å†™Listçš„å…ƒç´ , è¿˜å¯ä»¥çœç•¥å³ç«¯ç‚¹<br>åŒæ—¶, å–å†³äºå…ƒç´ çš„ç±»å‹, ä¼šäº§ç”Ÿæ— é™æˆ–æœ‰ç•Œçš„List</p><p>ä½†æ˜¯, æ¯”å¦‚ [1â€¦5] ä¼šç”Ÿæˆ <code>[1,2,3,4,5]</code>, é»˜è®¤æƒ…å†µä¸‹çš„æ­¥é•¿æ˜¯1<br>å¦‚æœä½ æƒ³è°ƒæ•´æ­¥é•¿çš„è¯, å¯ä»¥åƒä¸‹é¢è¿™æ ·:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">3.</span>.]          <span class="comment">-- æ­¥é•¿æ˜¯2, [1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33..]</span></span><br><span class="line">[<span class="number">5</span>,<span class="number">10.</span>.]         <span class="comment">-- æ­¥é•¿æ˜¯5, [5,10,15,20,25,30,35,40,45,50,55,60,65,70..]</span></span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥è®¾ç½®å°æ•°çš„æ­¥é•¿, æ¯”å¦‚:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1.0</span>, <span class="number">1.5</span>..]     <span class="comment">-- æ­¥é•¿æ˜¯0.5, [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0..]</span></span><br></pre></td></tr></table></figure><p>å“‡å¡, çœŸæ˜¯ä¸ªèªæ˜çš„ç¼–è¯‘å™¨å‘¢, å½“ç„¶, ç¼–è¯‘å™¨æœ‰æ—¶å€™ä¹Ÿä¸ä¼šå¦‚ä½ æ‰€æ„¿çš„ ğŸ˜ƒ</p><h2 id="lie-biao-tui-dao" id="åˆ—è¡¨æ¨å¯¼">åˆ—è¡¨æ¨å¯¼</h2><p>Haskell ä¸­çš„ List, è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„åœ°æ–¹, é‚£å°±æ˜¯ <code>List Comprehension (åˆ—è¡¨æ¨å¯¼)</code><br>å¬ç€æŒºæ‡µçš„, æ¥ä¸ªä¾‹å­å§, ä»¥ä¸‹è¡¨è¾¾å¼å°†åˆ›å»ºä¸€ä¸ªæ— é™çº§List, å…ƒç´ æ˜¯2çš„å€æ•°</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[x | x &lt;- [<span class="number">1.</span>.], mod x <span class="number">2</span> == <span class="number">0</span>]  <span class="comment">-- [2,4,6,8,10,12,14,16,18, 20..]</span></span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°, ä¸Šé¢è¡¨ç¤ºè¿™æ ·ä¸€ä¸ªListçš„æ–¹æ³•, å’Œé«˜ä¸€å­¦çš„é›†åˆçš„è¡¨ç¤ºæ³•éå¸¸ç›¸è¿‘ <s>(å› ä¸ºå°±æ˜¯è¿™æ ·æŠ„æ¥çš„å•Š)</s><br>å¸Œæœ›ä½ è¿˜æ²¡å¿˜è®°é«˜ä¸€å­¦ä¹ çš„, è¡¨ç¤ºé›†åˆçš„æ–¹æ³•ä¹‹ä¸€, åˆ—ä¸¾æ³•: <code>&#123;x | n âˆˆ Z, x = 2n&#125;</code> , è¡¨ç¤ºäº†å¶æ•°é›†</p><p>Haskell ä¸­çš„ <code>List Comprehension</code> ä¹Ÿæœ‰è¿™ä¹ˆä¸ªæ :</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[ x | x &lt;- xs, bool_expr1, bool_expr2 ]   </span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç”¨ <code>|</code> åˆ†å‰²ç»„æˆçš„è¡¨è¾¾å¼, ä¸åé¢çš„æ¨å¯¼</p></li><li class="lvl-2"><p>xs è¡¨ç¤ºä¸€ä¸ªList, å› ä¸ºæ˜¯ x çš„å¤æ•°, ä¹Ÿæ˜¯å°¾å·´åé¢åŠ ä¸Šs, å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª</p></li><li class="lvl-2"><p><code>bool_expr</code> è¡¨ç¤ºè¦æ»¡è¶³çš„æ¡ä»¶, åªæœ‰å½“ x ä»£å…¥è¿™ä¸ªè¡¨è¾¾å¼, æ»¡è¶³æ¡ä»¶æ‰è¡Œ, å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ª</p></li></ul><p>å¯èƒ½ä½ è¿˜æ˜¯æœ‰ç‚¹æ‡µ? æ²¡äº‹, å¤šçœ‹ç‚¹ä¾‹å­, ç›´è§‰ä¸Šæ˜ç™½å°±å¯ä»¥äº†</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[x + y | x &lt;- [<span class="number">1.</span><span class="number">.3</span>], y &lt;- [<span class="number">1.</span><span class="number">.3</span>]]                   <span class="comment">-- [2,3,4,3,4,5,4,5,6]</span></span><br><span class="line">[x | x &lt;- [<span class="number">1.</span><span class="number">.100</span>], x `mod` <span class="number">2</span> == <span class="number">0</span>, x `mod` <span class="number">3</span> == <span class="number">0</span>]  <span class="comment">-- [6,12,18,24,30,36,42,48,54,60,66,72,78,84,90,96]</span></span><br></pre></td></tr></table></figure><p>å…¶å®, å°±ç›¸å½“äº <code>å¤šé‡forå¾ªç¯</code> + <code>æœ€åä¸€é‡forå¾ªç¯ä¸­çš„é›¶ä¸ªæˆ–å¤šä¸ªifè¯­å¥</code><br>éšååˆ©ç”¨æ»¡è¶³æ¡ä»¶çš„å€¼, åˆ›å»ºæ–°çš„è¡¨è¾¾å¼, æ”¾è¿›æ–°çš„é›†åˆå¹¶è¿”å›:</p><ul class="lvl-0"><li class="lvl-2"><p>ç¬¬ä¸€ä¸ªå¼å­ <code>[x + y | x &lt;- [1..3], y &lt;- [1..3]]</code>, ç›¸å½“äº:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> new_array</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>..<span class="number">3</span>]</span><br><span class="line">  <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">1</span>..<span class="number">3</span>]</span><br><span class="line">    (x + y) -&gt; new_array</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¬¬äºŒä¸ªå¼å­ <code>[x | x &lt;- [1..100], x </code>mod<code>2 == 0, x</code>mod<code> 3 == 0]</code>, ç›¸å½“äº:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> new_array</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>..<span class="number">100</span>]</span><br><span class="line">  <span class="keyword">if</span> x `<span class="keyword">mod</span>` <span class="number">2</span> == <span class="number">0</span> &amp;&amp; x `<span class="keyword">mod</span>` <span class="number">3</span> == <span class="number">0</span></span><br><span class="line">    (x) -&gt; new_array</span><br></pre></td></tr></table></figure><p>å› æ­¤, ä½ å¯ä»¥å¯¹æ¯”ä¸‹ä¸‹é¢ä¸¤ç§å¼å­:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[ x * y | x &lt;- [<span class="number">1.</span><span class="number">.10</span>], y &lt;- [<span class="number">1.</span>.x]  ]</span><br><span class="line">[ x * y | x &lt;- [<span class="number">1.</span>.y],  y &lt;- [<span class="number">1.</span><span class="number">.10</span>] ]</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§åˆæ³•, ä½†ç¬¬äºŒç§ä¸åˆæ³•, æŠŠå®ƒä»¬ç†è§£ä¸ºforå¾ªç¯, ä½ å°±çŸ¥é“åŸå› äº†, æ­¤å¤„è·³è¿‡</p><p>å¥½äº†, å…³äºList, æš‚æ—¶å…ˆåˆ°è¿™å§<br>å…¶å®åé¢è¿˜æœ‰å¾ˆå¤šå…³äºListçš„, æ¯•ç«Ÿå®ƒå¤ªé‡è¦äº†</p><hr><h1 id="if-yu-ju">Ifè¯­å¥</h1><p>å…ˆå‰è¯´é“, Ifè¯­å¥ä»…ä»…æ˜¯ä¸ªè¯­æ³•ç³–, ä½†æˆ‘ä»¬è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¸‹è¿™ä¸ªè¯­æ³•çš„<br>é¡ºä¾¿æ‰¾ä¸ªæœºä¼š, æ•™ä¸‹å¦‚ä½•å°†ä»£ç å†™è¿›æ–‡ä»¶å¹¶ç¼–è¯‘, è„±ç¦» ghci</p><p>æ¯•ç«Ÿ Haskell æ¯”è¾ƒç‰¹æ®Š, ä¸ºäº†å‡½æ•°çš„ <a href="/posts/haskell-basic/p3/#chun-han-shu">çº¯åº¦</a> , ç‰¹æ„æäº†ä¸€å †ä¸œè¥¿<br>å†ä¸è®²ææ€•ä¹‹åéƒ½è®²ä¸äº†å‘¢, æ‰€ä»¥æˆ‘æ‰“ç®—å¼ºç¡¬ç‚¹ç©¿æ’ç€è®² (æ‚å˜´ç¬‘)</p><p>å¼€å§‹å§!</p><h2 id="dan-if" id="å•if">å•if</h2><p>é¦–å…ˆ, è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶, å‘½åä¸º <code>demo.hs</code></p><p>BMI, Body Mass Index (èº«ä½“è´¨é‡æŒ‡æ•°)<br>å®ƒä¸ä½“å†…è„‚è‚ªæ€»é‡å¯†åˆ‡ç›¸å…³ï¼Œå¸¸ç”¨æ¥è¡¡é‡äººä½“èƒ–ç˜¦ç¨‹åº¦ã€æ˜¯å¦å¥åº·</p><p>è®©æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªç¨‹åº, æ ¹æ®è¾“å…¥çš„bmiåˆ¤æ–­èƒ–ä¸ç˜¦å§</p><div class="tips"><p><strong>ä½ å¯ä»¥è¿™æ ·è¿è¡Œä»¥ .hs ç»“å°¾çš„æ–‡ä»¶:</strong></p><ol><li class="lvl-3">åœ¨ <code>demo.hs</code> æ‰€åœ¨çš„ç›®å½•ä¸‹, è¾“å…¥ <code>runghc demo.hs</code>, ä¸ä¼šç•™ä¸‹ç›®æ ‡æ–‡ä»¶</li><li class="lvl-3">è¾“å…¥ <code>ghc demo.hs</code>, ç•™ä¸‹ç›®æ ‡æ–‡ä»¶ <code>./demo</code></li></ol></div><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>  bmi &gt; <span class="number">25</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">  <span class="keyword">else</span> putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure><p>å…ˆåˆ«åœ¨æ„é‚£ä¸ª <code>do</code> ä¸ <code>&lt;-</code> æ˜¯å•¥, æ— è§†å³å¯, åæ­£è¿™æ®µä»£ç ä½ åº”è¯¥ä¹Ÿçœ‹å¾—æ‡‚:<br>ç¨‹åºä¼šè¯»å–è¾“å…¥, ä½œä¸º <code>bmi</code> çš„å€¼, éšåæ ¹æ®å¤§å°, åˆ¤æ–­æ˜¯èƒ–æ˜¯ç˜¦</p><p>å½“ç„¶, å¦‚æœä½ ä½¿ç”¨LSP, ä»£ç æ ¼å¼åŒ–ä¹‹å, ä½ å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸€æ®µ:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> bmi &gt; <span class="number">25</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">    <span class="keyword">else</span> putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿè›®ç¾è§‚çš„, ä½†æˆ‘æ›´å–œæ¬¢å‹è¡Œ ğŸ˜ƒ</p><h2 id="duo-if" id="å¤šIf">å¤šIf</h2><p>å…¶å®åœ¨ Haskell ä¸­æ ¹æœ¬ä¸å­˜åœ¨å¤šé‡Ifè¿™ç§ç©æ„å„¿, ä½ å¾€ä¸‹çœ‹å°±ä¼šæ‡‚â€¦</p><p>å…ˆå‰çš„ å•If å®åœ¨ä¸å¤Ÿ, æ²¡æœ‰åŒºåˆ†è¾“å…¥ä¸å¯¹åŠ²çš„æƒ…å†µ<br>è€Œä¸”åªæ˜¯ç®€å•åœ°åˆ¤æ–­äº†èƒ–ç˜¦, è®©æˆ‘ä»¬å†åŠ ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦å¥åº·çš„æƒ…å†µå§</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> bmi &lt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;What?&quot;</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> bmi &gt; <span class="number">25</span> </span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> bmi &lt;= <span class="number">25</span> &amp;&amp; bmi &lt;= <span class="number">18.5</span> </span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Healthy!!!&quot;</span></span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">    putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure><p>å“‡, çœ‹ç€å¥½ç¾, å¥½ç†Ÿæ‚‰!<br>æ‰€ä»¥ä½ ä¸ºä»€ä¹ˆè¯´æ²¡æœ‰å¤šé‡Ifå‘¢?</p><p>åˆ«æ€¥, æ ¼å¼åŒ–ä¹‹å:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line">  <span class="keyword">if</span> bmi &lt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;What?&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">if</span> bmi &gt; <span class="number">25</span></span><br><span class="line">        <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">if</span> bmi &lt;= <span class="number">25</span> &amp;&amp; bmi &lt; <span class="number">18.5</span></span><br><span class="line">            <span class="keyword">then</span> putStrLn <span class="string">&quot;12&quot;</span></span><br><span class="line">            <span class="keyword">else</span> putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure><p>æ‡‚äº†å§? å®ƒåªæ˜¯ else ä¸­å†å¥—ä¸€ä¸ª if-else è€Œå·²<br>è€Œä¸”å°±è¿ if-else, æˆ‘ä»¬éƒ½å¯ä»¥ç”¨è‡ªå·±å®šä¹‰çš„å‡½æ•°å–ä»£æ‰ (ä¹‹åä¼šè®²)<br>å°±ç®—æˆ‘ä»¬ä¸å–ä»£ if-else, å®ƒçš„ä½¿ç”¨ç‡ä¹Ÿå¾ˆä½, æ¨¡å¼åŒ¹é…æ›´åŠ ç¾è§‚, ä¹Ÿæ›´å¼ºå¤§ (Guardä¹Ÿæ˜¯ä¹‹åä¼šè®²)</p><p>è¿™èŠ‚å°±åˆ°è¿™, çœ‹è¾‰å¤œ3çš„æœ€åä¸€é›†å»äº†~~</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å…³äº Haskell çš„æ•°å­—, Bool, List, Ifè¯­å¥&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Haskell" scheme="https://jedsek.xyz/tags/Haskell/"/>
    
  </entry>
  
  <entry>
    <title>haskell-basic-p3: å‡½æ•°å¼ä»‹ç»</title>
    <link href="https://jedsek.xyz/posts/haskell-basic/p3"/>
    <id>https://jedsek.xyz/posts/haskell-basic/p3</id>
    <published>2022-06-26T08:16:10.000Z</published>
    <updated>2022-06-26T08:16:10.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½•ä¸ºå‡½æ•°å¼ç¼–ç¨‹(FP, å³Functional Programming) ?</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p><p>æœ¬èŠ‚æˆ‘ä»¬å°†ä»‹ç»ä¸‹å‡½æ•°å¼ç¼–ç¨‹, å°½é‡ä¸æ¶‰åŠä»£ç , éƒ½æ˜¯æ¦‚å¿µä¸Šçš„ä¸œè¥¿<br>é‚£ä¹ˆ, å¼€å§‹å§!</p><h1 id="bian-cheng-fan-shi">ç¼–ç¨‹èŒƒå¼</h1><h2 id="gai-lan" id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2><p>FP, æ˜¯ä¸€ç§åå«å‡½æ•°å¼çš„, å¼ºå¤§çš„ç¼–ç¨‹èŒƒå¼, å› æ­¤, æˆ‘æƒ³å…ˆè®²ä¸€è®²ä»€ä¹ˆæ˜¯ç¼–ç¨‹èŒƒå¼</p><p>ç¼–ç¨‹èŒƒå¼æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼, æŠ€æœ¯, è¯­è¨€èŒƒå¼, ç¼–ç¨‹æ¨¡å‹<br>åœ¨ä¸–ç•Œä¸Š, æœ‰è®¸å¤šç¼–ç¨‹èŒƒå¼, æœ€ä¸»è¦çš„æœ‰:</p><table><thead><tr><th>ç®€ç§°</th><th>ä¸­æ–‡å</th><th>è‹±æ–‡å</th></tr></thead><tbody><tr><td>FP</td><td>å‡½æ•°å¼ç¼–ç¨‹</td><td>Functional Programming</td></tr><tr><td>OOP</td><td>é¢å‘å¯¹è±¡ç¼–ç¨‹</td><td>Object-Oriented Programming</td></tr><tr><td>POP</td><td>é¢å‘è¿‡ç¨‹ç¼–ç¨‹</td><td>Procedure-Oriented Programming</td></tr><tr><td>LP</td><td>é€»è¾‘å¼ç¼–ç¨‹</td><td>Logic Programming</td></tr><tr><td>DP</td><td>å£°æ˜å¼ç¼–ç¨‹</td><td>Declarative Programming</td></tr><tr><td>IP</td><td>å‘½ä»¤å¼ç¼–ç¨‹</td><td>Imperative Programming</td></tr></tbody></table><p>ç¼–ç¨‹èŒƒå¼å®åœ¨å¤ªå¤š, ä½†ä¸ç”¨åˆ»æ„å»è®°å¿†, è¿™äº›éƒ½æ˜¯äº›é¡¾åæ€ä¹‰çš„ä¸œè¥¿<br>è®°ä½FPä¸OOPè¿™ä¸¤ä¸ªç¼©å†™å³å¯, è¿™ä¸¤ä¸ªæ˜¯æœ€å¸¸è¢«æåŠçš„, å…¶ä»–çš„æ— éœ€è®°å¿†</p><p>ç¼–ç¨‹èŒƒå¼, å®ƒå°±åƒæ˜¯å›½å®¶çš„æ„è¯†å½¢æ€ä¸€æ ·, å…·æœ‰æŒ‡å¯¼æ„ä¹‰, å¯¹å¦‚ä½•ç¼–ç¨‹æ±‚è§£é—®é¢˜çš„æ€è€ƒæ–¹æ³•æœ‰å·¨å¤§å½±å“<br>ä¸‹é¢æ˜¯ä¸€äº›ç¼–ç¨‹èŒƒå¼çš„ä¾‹å­:</p><div class="tips"><p><strong>æç¤º</strong><br>å¦‚æœä½ å·²ç»äº†è§£è¿‡ä»¥ä¸‹èŒƒå¼, ç›´æ¥è·³åˆ° <a href="#zong-jie"><strong>æ€»ç»“</strong></a> å§</p></div><ul class="lvl-0"><li class="lvl-2"><p>é¢å‘è¿‡ç¨‹:<br>ä¼˜ç‚¹:<br>è§£å†³é—®é¢˜æ—¶, å¼ºè°ƒè¿‡ç¨‹, ä¸äººæœ¬èº«çš„æ€è€ƒæ–¹å¼ä¸€è‡´, ç¬¦åˆç›´è§‰<br>ç¼ºç‚¹:<br>ä»£ç å¤ç”¨èƒ½åŠ›å·®, æ‰©å±•æ€§å·®, ç¹ç</p></li><li class="lvl-2"><p>é¢å‘å¯¹è±¡:<br>ä¼˜ç‚¹:<br>å°†é—®é¢˜æŠ½è±¡ä¸ºä¸€ä¸ªä¸ªå¯¹è±¡, é€šè¿‡å»ºç«‹æ¨¡å‹, ä½¿ç”¨ç»§æ‰¿/å¤šæ€ç­‰æ¥æè¿°ä¸–ç•Œ, å¤ç”¨ä»£ç çš„èƒ½åŠ›å¼ºæ‚<br>ç¼ºç‚¹:<br>ä¸èƒ½é€‚ç”¨äºæ‰€æœ‰é—®é¢˜, ç¡¬å¥—èŒƒå¼å¯èƒ½ä¼šè®©ä»£ç å˜å¾—æ›´åŠ ç¹ç</p></li><li class="lvl-2"><p>é€»è¾‘å¼:<br>ä¼˜ç‚¹:<br>é€šè¿‡å»ºç«‹ <code>äº‹å®</code>, å‘Šè¯‰ç¼–ç¨‹å™¨è¿™äº›éƒ½æ˜¯ç»å¯¹æ­£ç¡®çš„, éšåæ ¹æ®é€»è¾‘å…³ç³»ç›´æ¥æ±‚è§£, ååˆ†ç¥å¥‡<br>ç¼ºç‚¹:<br>ç„å­¦ç¼–ç¨‹, å¯èƒ½æƒ³è±¡ä¸åˆ°æ€ä¹ˆæ ·å»ºç«‹å‡º <code>èƒ½æ­£ç¡®æ±‚è§£çš„å‰ææ¡ä»¶/å®šä¹‰</code>, ä¹Ÿå¯èƒ½å› æ¨ç†è¿‡äºå¤æ‚, å¯¼è‡´æ€§èƒ½ä½ä¸‹</p></li><li class="lvl-2"><p>å‡½æ•°å¼:<br>ä¼˜ç‚¹:<br>é€šè¿‡ä»¥æ•°å­¦ä¸­çš„ <code>å‡½æ•°</code> ä¸ºæŒ‡å¯¼, å¼ºè°ƒç»“æœ, ä¸å…³æ³¨è¿‡ç¨‹, é€šè¿‡æ•°æ®ä¸å¯å˜æå¤§å‡å°‘å¤æ‚æ€§<br>ç¼ºç‚¹:<br>å­¦ä¹ éš¾åº¦è¾ƒå¤§, æ€§èƒ½å› ä¸å¯å˜æ•°æ®, ä¸å¯é¿å…åœ°ä¼šä½ä¸‹ä¸€äº›</p></li><li class="lvl-2"><p>å‘½ä»¤å¼:<br>æœ‰äº›è¯´æ³•æ˜¯å‘½ä»¤å¼æŒ‡ç±»ä¼¼æ±‡ç¼–è¿™ç§çš„, è¿˜æœ‰çš„è¯´å‘½ä»¤å¼ä¸é¢å‘è¿‡ç¨‹å«æ³•ä¸åŒè€Œå·²<br>æˆ‘å…¶å®ä¹Ÿä¸æ˜¯å¤ªèƒ½åŒºåˆ†è¿™ä¸¤è€…, å¤§å®¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ç›´æ¥è®¤ä¸ºä¸¤è€…çº¦ç­‰äºå³å¯<br>æ¯•ç«Ÿéƒ½2022å¹´äº†, ç°åœ¨ä¸å¤ªéœ€è¦å…³æ³¨è¿™äº›ä½çº§å±‚é¢çš„å·®å¼‚äº†<br>ç°åœ¨è¯¥å…³æ³¨çš„, æ˜¯æ›´å¤§å·®å¼‚çš„èŒƒå¼ä»¬, æ¯”å¦‚é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡, å‡½æ•°å¼ä¸é¢å‘å¯¹è±¡ç­‰ç­‰</p></li><li class="lvl-2"><p>å£°æ˜å¼:<br>æŒ‡ä½ ç¼–ç¨‹ä¾é æè¿°, è€Œéé¢å‘è¿‡ç¨‹åœ°å»æ€è€ƒ<br>è¿™ç§èŒƒå¼å¸¸è§äºä¸€äº›DSL(é¢†åŸŸç‰¹å®šè¯­è¨€), ä»¥æ­¤ç®€åŒ–åœ¨æŸé¢†åŸŸä¸‹çš„å¼€å‘<br>DSL, å³ä¸ºä¸“é—¨é¢†åŸŸåˆ›é€ çš„è¯­æ³•, æ˜¯ä¸ºäº†ä¸“æ³¨äºè¯¥é¢†åŸŸçš„å¼€å‘, æ¯”å¦‚HTMLå†™ç½‘é¡µ, SQLå†™æ•°æ®åº“<br>ç‰¹ç‚¹æ˜¯ä¸€æ—¦è„±ç¦»ç›¸å…³é¢†åŸŸ, è¯­æ³•å°±ä¸å†ä¾¿åˆ©</p></li></ul><h2 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h2><p>å„ç§ç¼–ç¨‹èŒƒå¼æœ‰å„è‡ªçš„ç‰¹ç‚¹, äººä»¬é€šè¿‡ç ”ç©¶å®ƒä»¬, æ¢ç©¶é«˜æ•ˆçš„ç¼–ç¨‹æ–¹å¼<br>ç¼–ç¨‹èŒƒå¼å¹¶éä¸¥æ ¼çš„äº’ç›¸ç‹¬ç«‹çš„, å®ƒä»¬å¤§å¤šåœ¨æ¦‚å¿µä¸Šä¹Ÿå­˜åœ¨äº¤é›†</p><p>æ¯”å¦‚:</p><ul class="lvl-0"><li class="lvl-2"><p>é¢å‘è¿‡ç¨‹/é¢å‘å¯¹è±¡ &amp;&amp; å‘½ä»¤å¼</p></li><li class="lvl-2"><p>å‡½æ•°å¼/é€»è¾‘å¼ &amp;&amp; å£°æ˜å¼</p></li><li class="lvl-2"><p>æ··åˆä¸€ç§, ä¸¤ç§, ç”šè‡³å„ç§èŒƒå¼</p></li></ul><p>å†æ¯”å¦‚, ç°ä»£çš„ç¼–ç¨‹è¯­è¨€, ä¸€èˆ¬éƒ½æ±²å–äº†å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„æ€æƒ³<br>æ¯”å¦‚åŒ¿åå‡½æ•°, é«˜é˜¶å‡½æ•°ç­‰åœ¨å‡½æ•°å¼è¯­è¨€ä¸­è¾ƒä½çº§çš„æ¦‚å¿µ, è¢«ä¸€äº›é¢å‘å¯¹è±¡çš„è¯­è¨€ä½¿ç”¨å, ä¹Ÿèƒ½çˆ†å‘å‡ºä¸ä¿—çš„å¨åŠ›<br>å†æ¯”å¦‚ Rust ä¸­çš„ Option/Result, æœ‰ç€ Haskell çš„å½±å­</p><p>ç›¸ä¿¡ç»è¿‡æœ¬å°èŠ‚, ä½ å¯¹ä»€ä¹ˆæ˜¯ç¼–ç¨‹èŒƒå¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤çŸ¥<br>æ¥ä¸‹æ¥, æˆ‘ä»¬å°±è¦ä¸“æ³¨äºæœ¬èŠ‚çš„ä¸»è§’, å‡½æ•°å¼</p><p>ç®€å•æ¥è¯´, å‡½æ•°å¼ç¼–ç¨‹ä¾é ç€æ•°å­¦çš„å¨åŠ›, å°†å…¶å¼•å…¥ç¼–ç¨‹çš„æ¦‚å¿µä¹‹ä¸­<br>è®©æˆ‘ä»¬å¼€å§‹å¯¹å‡½æ•°å¼çš„æ­£å¼ä»‹ç»å§!</p><hr><h1 id="gao-jie-han-shu">é«˜é˜¶å‡½æ•°</h1><p>é«˜é˜¶å‡½æ•°(HOF, Higher-order Functions), æŒ‡ä¸€ä¸ªä½œä¸ºå‚æ•°, æˆ–å½“ä½œè¿”å›å€¼çš„å‡½æ•°</p><p>ä½ å¯èƒ½ç»å¸¸ä¼šå¬åˆ°è¿™ä¹ˆä¸€å¥è¯: åœ¨ XXX è¯­è¨€ä¸­, å‡½æ•°è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘<br>å‡½æ•°è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘, æŒ‡å‡½æ•°åœ°ä½çªå‡º, ä¸ä¼šè¢«é™åˆ¶, é€šå¸¸ä¸é‚£äº›ä¸æ”¯æŒHOFçš„ç¼–ç¨‹è¯­è¨€åšæ¯”è¾ƒ<br>æ¯”å¦‚åŒ¿åå‡½æ•°, Lambdaè¡¨è¾¾å¼, é—­åŒ…, å…¶å®éƒ½æ˜¯å› ä¸ºHOF(å‡½æ•°å¯ä»¥è¢«å½“ä½œå‚æ•°ä¼ é€’)<br><s>(è¯è¯´2022å¹´äº†, ä¸»æµè¯­è¨€æˆ–å¤šæˆ–å°‘éƒ½æ”¯æŒHOFäº†, è¿Cè¯­è¨€éƒ½èƒ½æ¨¡æ‹Ÿå‡ºæ¥å‘¢)</s></p><p>ä¸€å¥è¯æ¦‚æ‹¬: å‡½æ•°èƒ½è¢«è½»æ¾éšæ„åœ°ä¼ é€’, å¾ˆè‡ªç”±, å°±åƒä¸€ç­‰å…¬æ°‘</p><hr><h1 id="bu-ke-bian-shu-ju">ä¸å¯å˜æ•°æ®</h1><p>ä¸å¯å˜æ•°æ®(Immutable Data), æŒ‡ä½ æ— æ³•ä¿®æ”¹å·²ç»å­˜åœ¨çš„æ•°æ®</p><p>æ¢å¥è¯è¯´, å½“ä½ æƒ³è¿›è¡Œæ–°è¿ç®—, å¾—åˆ°æ–°æ•°æ®æ—¶, ä¸æ˜¯æ›¿æ¢è¿›åŸæœ‰çš„æ•°æ®, è€Œæ˜¯æ–°å¼€è¾Ÿä¸€å—ç©ºé—´æ¥å­˜æ”¾å®ƒ<br>è¢«åˆ›å»ºçš„å€¼, ä½ å°†æ°¸è¿œæ— æ³•ä¿®æ”¹, å°±å¦‚åŒæ•°å­¦é‡Œé‚£æ ·, ç›¸ä¿¡æˆ‘, å½“ä½ ç¬¬ä¸€æ¬¡å­¦ç¼–ç¨‹æ—¶, æ€»ä¼šå¯¹ <code>å˜é‡</code> æ„Ÿåˆ°å›°æƒ‘</p><p>è¿™ä¹Ÿæ„å‘³ç€, ä½ ä¸å†éœ€è¦å…³æ³¨ä¸€äº›ä¸è®¡ç®—æœºåº•å±‚æœ‰å…³çš„å¥‡æŠ€æ·«å·§, è€Œæ˜¯ä¸“æ³¨äºé—®é¢˜æœ¬èº«<br>ä½†æœ‰ä¸ªé“ç†äº˜å¤ä¸å˜: éšç€æŠ½è±¡ç­‰çº§çš„æé«˜, å°±è¶Šåç§»åº•å±‚, å¯èƒ½ä¼šé€ æˆæ›´å¤šçš„èµ„æºæµªè´¹</p><p>è€Œä¸”, å¯å˜æ€§è¿˜ä¼šå½±å“å¹¶å‘æ€§, å‡ºç°ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯, å¾—å­¦ä¹ å„ç§é”æ¨¡å‹æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶<br>ä½†ä¸å¯å˜çš„æ•°æ®èƒ½å¤Ÿæœ‰æ•ˆé™ä½å¹¶å‘çš„éš¾åº¦</p><p>è€Œä¸”ä¹Ÿåˆ«å¤ªæ‹…å¿ƒæ•ˆç‡, è™½ç„¶è‚¯å®šä¼šä½ç‚¹, ä½†ä¹Ÿæ²¡å°ç§ç°ä»£ç¼–è¯‘å™¨çš„ç–¯ç‹‚ä¼˜åŒ–å•Š<br>æ¯”å¦‚æ¯æ¬¡è®¡ç®—ä¸ä¸€å®šä¼šäº§ç”Ÿæ–°å€¼, è€Œæ˜¯é€šè¿‡å…±äº«å†…å­˜, è¾¾åˆ°é‡å¤ä½¿ç”¨æ—§å€¼</p><hr><h1 id="fu-zuo-yong">å‰¯ä½œç”¨</h1><p>å‰¯ä½œç”¨(Side Effects), æŒ‡ä¸å¤–ç•Œå‘ç”Ÿçš„äº¤äº’</p><p>å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°:<br>å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ä½œä¸ºæ–‡ä»¶å, è¿›è¡Œè¯»å–, è¾“å‡ºå†…å®¹, å³ä½¿è¿™ä¹ˆç®€å•, ä¹Ÿåšä¸åˆ°ç›¸åŒçš„è¾“å…¥, èƒ½å¾—åˆ°ç›¸åŒçš„è¾“å‡º<br>å¯èƒ½ä½ æ— æƒè¯»å–æ–‡ä»¶, å¯èƒ½æ–‡ä»¶ä¸å­˜åœ¨, å¯èƒ½æ–‡ä»¶è¢«ä¿®æ”¹è¿‡, æ‰€ä»¥, è¾“å…¥ä¸€ä¸ªå›ºå®šè·¯å¾„, ä¸ä¸€å®šèƒ½å¾—åˆ°å›ºå®šçš„è¾“å‡º</p><p>å› æ­¤, è¿™ç§IOæ“ä½œ, ä¾¿æ˜¯ç§å‰¯ä½œç”¨, å› ä¸ºå®ƒæ¶‰åŠåˆ°ä¸å¤–ç•Œçš„äº¤äº’, å¯èƒ½äº§ç”Ÿæ— æ³•é¢„æµ‹çš„äº‹æƒ…<br>è¿™ç§è¶…è„±äºè¯­è¨€, æ¥è‡ªæ›´çœŸå®ä¸–ç•Œçš„äº¤äº’, æˆ‘ä»¬ç§°ä¹‹ä¸º <code>å‰¯ä½œç”¨</code></p><p>å‰¯ä½œç”¨åŒ…æ‹¬, ä½†ä¸é™äº:</p><ul class="lvl-0"><li class="lvl-2"><p>å‘é€ç½‘ç»œè¯·æ±‚</p></li><li class="lvl-2"><p>è®¿é—®ç³»ç»ŸçŠ¶æ€</p></li><li class="lvl-2"><p>æ“ä½œæ•°æ®åº“</p></li><li class="lvl-2"><p>æ“ä½œDOM</p></li><li class="lvl-2"><p>IOæ“ä½œ</p></li><li class="lvl-2"><p>ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡</p></li><li class="lvl-2"><p>ä½¿ç”¨å…·æœ‰å‰¯ä½œç”¨çš„å‡½æ•° (ä¼ æ’­æ€§)</p></li></ul><p>ä½ ä¼šæ³¨æ„åˆ° <code>ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡</code>, å®ƒä¹Ÿå¯ä»¥çœ‹ä½œ <code>ä¸å¤–ç•Œçš„äº¤äº’</code><br>æ¯”å¦‚, è‹¥è¯¥å‡½æ•°ä¿®æ”¹äº†ä¸€ä¸ªå‡½æ•°å¤–éƒ¨çš„å€¼, å¹¶ä¸”è¿”å›å€¼ä¾é è¿™ä¸ªä¸å›ºå®šçš„å€¼<br>é‚£ä¹ˆè¿™å°†æ— æ³•ä¿è¯ç›¸åŒè¾“å…¥, èƒ½å¾—åˆ°ç›¸åŒè¾“å‡º</p><p>ä½†æ˜¯, ç¨‹åºå°±æ˜¯ä¾é å‰¯ä½œç”¨æ¥äº§ç”Ÿä»·å€¼çš„, å‰¯ä½œç”¨è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´æ”¹å¤–éƒ¨æ¡ä»¶, è¿›è¡Œäº¤äº’<br>ç»å¯¹çš„æ²¡æœ‰å‰¯ä½œç”¨, æ„å‘³ç€è¿™ä¸ªç¨‹åºç»å¯¹çš„æ²¡ç”¨</p><hr><h1 id="yin-yong-tou-ming">å¼•ç”¨é€æ˜</h1><p>å¼•ç”¨é€æ˜(RT, Referential Transparency), æŒ‡æŸä¸ªè¡¨è¾¾å¼, èƒ½æ›¿æ¢ä¸ºå®ƒè®¡ç®—å¾—åˆ°çš„å€¼, ä¸”æ›¿æ¢å‰åçš„è¯­ä¹‰ä¸€å®šç­‰ä»·</p><p>å¼•ç”¨é€æ˜æ€§, æ˜¯ä¸ªå­˜åœ¨äºä¼—å¤šå­¦è¯´ä¸­çš„çŸ¥è¯†, ä¸å…‰æ˜¯è®¡ç®—æœº, è¿˜æœ‰æ•°å­¦, å“²å­¦, è¯­è¨€å­¦ç­‰<br>ä»¥ä¸‹æ˜¯æ•°å­¦ä¸­çš„ RT, ç®€å•æ¥è®², å°±æ˜¯ç­‰å¼æ¨å¯¼:</p><p>f(x) = (x+1)<sup>2</sup><br>f(2) = (2+1)<sup>2</sup> = (3)<sup>2</sup> = 9</p><p>å¯ä»¥çœ‹åˆ°, <code>2+1</code>å¯ä»¥è¢«<code>3</code>ä»£æ›¿, ä¸”æ›¿æ¢å‰åçš„è¯­ä¹‰ä¸€è‡´, è¿™ä¾¿æ˜¯æ•°å­¦ä¸­çš„ RT, æˆ–è€…ç§°å‘¼å®ƒä¸º <code>ç­‰å¼æ¨å¯¼</code>:<br>æŸä¸ª <code>çˆ¶è¡¨è¾¾å¼</code> ç”±è®¸å¤š <code>å­è¡¨è¾¾å¼</code> ç»„æˆ, å¦‚æœå¯ä»¥å°†è¿™äº› <code>å­è¡¨è¾¾å¼</code> æ›¿æ¢ä¸ºå®ƒä»¬è®¡ç®—å¾—åˆ°çš„å¯¹åº”å€¼, å°±èƒ½ç®€åŒ–è¿™ä¸ª <code>çˆ¶è¡¨è¾¾å¼</code><br>è®¡ç®—æœºä¸­çš„ RT, ä¹Ÿå·®ä¸å¤šæ˜¯è¿™ä¸ªæ„æ€, åªè¦æŸä¸ªè¡¨è¾¾å¼èƒ½è¢«æ›¿æ¢, ä¸”è¯­ä¹‰ä¸å˜, å°±å…·æœ‰ RT</p><p>æ€»è€Œè¨€ä¹‹, å°±æ˜¯æ›¿æ¢, æ›¿æ¢, è¿˜æ˜¯æ›¿æ¢<br>å³ä½¿æ•ˆç‡å˜åŒ–, åªè¦è¯­ä¹‰ä¸å˜å°±è¡Œ, è¿™æœ‰åˆ©äºè®©æ¨å¯¼é—®é¢˜å˜å¾—å®¹æ˜“, åˆ é™¤å¤§é‡å†—æ‚çš„ä»£ç , æ–¹ä¾¿è¿›è¡Œé‡æ„ç­‰</p><p>RT è¿˜èƒ½ä¸ non-RT(éå¼•ç”¨é€æ˜) è¿›è¡Œå¯¹æ¯”, ä½“ç° RT çš„å¥½å¤„:<br>è‹¥æœ‰è¿™ä¹ˆä¸ªå‡½æ•°:</p><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">double_x</span>(x: <span class="type">Int</span>): <span class="type">Int</span> &#123;</span><br><span class="line">    println(x);</span><br><span class="line">    return x+x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ, å®ƒå°±ä¸å…·æœ‰ RT, å› ä¸ºå®ƒæ¶‰åŠåˆ°äº† IOæ“ä½œ(æ‰“å°äº†x)<br>æ­¤æ—¶è¿›è¡Œæ›¿æ¢çš„è¯, æ¯”å¦‚ <code>double_x(10) -&gt; 20</code>, å› ä¸ºåè€…å°‘äº†æ¬¡æ‰“å°, è¯­ä¹‰ä¸ä¸€è‡´<br>å‡è®¾ä½ å°†å…¶ä¸­10æ¬¡å¯¹ <code>double_x(x)</code> çš„è°ƒç”¨, éƒ½ç”¨ <code>x+x</code> æ¥æ›¿æ¢, é‚£ä½ å°†ç¼ºå°‘10æ¬¡æ‰“å°</p><p>è¿™åªæ˜¯ä¸ªç®€å•çš„ä¾‹å­, ä½ å®Œå…¨èƒ½å°†å‡½æ•°ä¸­çš„ <code>println(x)</code>, æ¢æˆå…¶ä»–å…·æœ‰å‰¯ä½œç”¨, è€Œéå•çº¯æ•°è¿ç®—çš„è¡¨è¾¾å¼<br>ä½¿ç”¨è¿™äº› non-RT çš„å®¶ä¼™, ä½ å°†ä¸§å¤±è¿›è¡Œæ’ç­‰çš„èƒ½åŠ›, é—®é¢˜æ¨å¯¼æ›´åŠ å¤æ‚, æ’æŸ¥é”™è¯¯ååˆ†å›°éš¾<br>ä½ å°†éœ€è¦é¢å¤–ä½¿ç”¨å¤æ‚çš„å·¥å…·, å»åˆ†æä¸€æ®µå¤æ‚çš„ä»£ç <br>è¿™é€šå¸¸æ˜¯ä¸€äº› BUG çš„æ¥æº</p><p>RT, å³å¼•ç”¨é€æ˜, æ³¨å®šä¸å‰¯ä½œç”¨äº’æ–¥</p><hr><h1 id="chun-han-shu">çº¯å‡½æ•°</h1><p>çº¯å‡½æ•°(Pure Functions), è¡¨ç¤ºå¼•ç”¨é€æ˜çš„å‡½æ•°</p><p>å¼•ç”¨é€æ˜çš„æ€§è´¨, ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥æ‹¥æœ‰, ä¸€ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æ‹¥æœ‰, æˆ‘ä»¬æŠŠè¿™æ ·çš„å‡½æ•°å«çº¯å‡½æ•°, ä»…æ­¤è€Œå·²<br>ç›¸å¯¹åº”çš„, è¿˜æœ‰çº¯æ“ä½œ, çº¯è¡¨è¾¾å¼, çº¯ä»£ç ç­‰ç­‰å·®ä¸å¤šæ„æ€çš„è¡¨è¿°, çŸ¥é“å°±å¥½</p><p>å› ä¸ºçº¯å‡½æ•°çš„å¼•ç”¨é€æ˜æ€§, å®ƒä¸ä¼šå»ä¿®æ”¹å¤–ç•ŒçŠ¶æ€, ä¸å»äº¤äº’, åªæ˜¯æ ¹æ®å‚æ•°, è‡ªç»™è‡ªè¶³åœ°ç®—å‡ºç»“æœè€Œå·²<br>ç®€å•æ¦‚æ‹¬: çº¯å‡½æ•°æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°, å¤–é¢å‘ç”Ÿäº†ä»€ä¹ˆé¸Ÿäº‹, å’Œæˆ‘æœ‰å±å…³ç³»</p><p>ä¸€ä¸ªå‡½æ•°ç‹¬ç«‹, å¯èƒ½æ²¡å•¥, ä¸€å †å‡½æ•°ç‹¬ç«‹, è¡¨ç¤ºå®ƒä»¬å¯ä»¥ä¸€èµ·è®¡ç®—, å› ä¸ºå®ƒä»¬ä¹‹é—´æ²¡æœ‰äº¤äº’, æ¯”å¦‚:<br>æœ‰ä¸‰ä¸ªçº¯å‡½æ•°: <code>f(x), h(x), g(x)</code>, é‚£ä¹ˆ <code>f(x) + h(x) + g(x)</code> ä¸­, ä¸‰ä¸ªå‡½æ•°ç›´æ¥å¹¶è¡Œè®¡ç®—å³å¯<br>è¿™æ„å‘³ç€, åƒ Haskell è¿™ç§è¯­è¨€, æœ¬èº«å°±å…·æœ‰å¼ºå¤§çš„å¹¶å‘æ€§</p><p>ä½†çº¯å‡½æ•°ä¸æ˜¯ç¥, æ— å¯é¿å…è¦ä¾é å‰¯ä½œç”¨, å³ä½¿å¦‚æ­¤, ä½ ä¹Ÿåº”å°½é‡å°† éçº¯å‡½æ•° ä¸­çº¯çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥</p><hr><h1 id="qi-ta">å…¶ä»–</h1><p>ä»¥ä¸Šæ˜¯å¯¹å‡½æ•°å¼çš„å°å°æ¦‚æ‹¬<br>è¿˜æœ‰è¯¸å¦‚æŸ¯é‡ŒåŒ–, æƒ°æ€§æ±‚å€¼, å¤šæ€æ€§, ç±»å‹çº¦æŸç­‰å†…å®¹, å°†ä¼šæ”¾åœ¨åé¢é…åˆä»£ç è®²è§£</p><p>ä¸ºäº†å¸å¼•å°å´½å­ä»¬æ¥å­¦ Haskell, èƒ½éª—å‡ ä¸ªæ˜¯å‡ ä¸ª, ç‰¹æ„æ¥å‡ æ®µæ— æ¯”ç®€æ´çš„ä»£ç </p><ul class="lvl-0"><li class="lvl-2"><p>åŸƒæ°ç­›æ±‚ç´ æ•°:</p></li></ul><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">primes</span> = filterPrime [<span class="number">2.</span>.]</span><br><span class="line">  <span class="keyword">where</span> filterPrime (p:xs) = p : filterPrime [x | x &lt;- xs, x `mod` p /= <span class="number">0</span>]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ–æ³¢é‚£å¥‘æ•°åˆ—:</p></li></ul><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">fibs</span> = <span class="number">0</span> : <span class="number">1</span> : zipWith (+) fibs (tail fibs)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¿«é€Ÿæ’åˆ—:</p></li></ul><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">qsort</span> [] = []</span><br><span class="line"><span class="title">qsort</span> (x : xs) = qsort sList ++ [x] ++ qsort bList</span><br><span class="line">  <span class="keyword">where</span> (sList, bList) = partition (&lt; x) xs</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¾—è½¬ç›¸é™¤æ³•æ±‚æœ€å¤§å…¬çº¦æ•°:</p></li></ul><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">gcd&#x27;</span> x y</span><br><span class="line">  | y == <span class="number">0</span> = x</span><br><span class="line">  | otherwise = gcd&#x27; y (x `mod` y)</span><br></pre></td></tr></table></figure><p>æ„Ÿè°¢ä½ çš„è§‚çœ‹, å’‹ä»¬ä¸‹æœŸè§!!<br>å…ˆè®©æˆ‘é¸½å‡ å¤© ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä½•ä¸ºå‡½æ•°å¼ç¼–ç¨‹(FP, å³Functional Programming) ?&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Haskell" scheme="https://jedsek.xyz/tags/Haskell/"/>
    
  </entry>
  
  <entry>
    <title>haskell-basic-p2: ç¯å¢ƒæ­å»º</title>
    <link href="https://jedsek.xyz/posts/haskell-basic/p2"/>
    <id>https://jedsek.xyz/posts/haskell-basic/p2</id>
    <published>2022-06-25T13:57:14.000Z</published>
    <updated>2022-06-25T13:57:14.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é¦–å…ˆ, æˆ‘ä»¬å¾—æ­å»ºå¥½ Haskell çš„ç¯å¢ƒ</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p><h1 id="bian-yi-qi-amp-amp-bao-guan-li">ç¼–è¯‘å™¨ &amp;&amp; åŒ…ç®¡ç†</h1><p>æœ¬æ–‡å‡è®¾ä½ ä½¿ç”¨çš„æ˜¯Linuxç³»ç»Ÿ</p><p>é€šè¿‡Linuxå‘è¡Œç‰ˆè‡ªå¸¦çš„åŒ…ç®¡ç†å™¨, ä¸‹è½½ <code>haskell-platform</code> æ¥ç›´æ¥é…ç½®ç¯å¢ƒ<br>éšå, ä½ ä¼šè·å¾— <code>ghc</code>, <code>ghci</code>, <code>cabal</code></p><ul class="lvl-0"><li class="lvl-2"><p><code>ghc</code>: Haskell çš„ç¼–è¯‘å™¨</p></li><li class="lvl-2"><p><code>ghci</code>: ä¸€ä¸ªREPL, å³ç”¨äºæ–°æ‰‹å­¦ä¹ çš„äº¤äº’å¼è§£é‡Šå™¨</p></li><li class="lvl-2"><p><code>cabal</code>: Hsakellçš„åŒ…ç®¡ç†å™¨</p></li></ul><p>(æ³¨, ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸‹è½½å¦ä¸€ä¸ªå« <code>stack</code> çš„åŒ…ç®¡ç†å™¨, ä¸è¿‡æˆ‘é€‰æ‹©äº† <code>cabal (å®˜æ–¹çš„)</code>, ä»…æ­¤è€Œå·²)</p><p>è¯·ç¡®ä¿éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºç‰ˆæœ¬:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ghc -V</span><br><span class="line">ghci -V</span><br><span class="line">cabal -V</span><br></pre></td></tr></table></figure><p>æœ¬ç³»åˆ—æš‚æ—¶åªæ¶‰åŠ Haskell çš„è¯­æ³•éƒ¨åˆ†ï¼Œ å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨ <code>ghci</code>, å› æ­¤ <code>cabal-install (å³ä¸Šé¢çš„ cabal)</code> è¿™ä¸œè¥¿ä¸å¤ªä¼šç”¨åˆ°</p><hr><h1 id="dai-ma-bian-ji">ä»£ç ç¼–è¾‘</h1><p>æ¨èçš„ä»£ç ç¼–è¾‘å™¨:</p><ul class="lvl-0"><li class="lvl-2"><p>Helix (å¼ºæ¨)</p></li><li class="lvl-2"><p>Nvim/Vim</p></li><li class="lvl-2"><p>Emacs</p></li><li class="lvl-2"><p>Vscode</p></li></ul><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Vscode, ç›´æ¥ä¸‹è½½å¯¹åº”çš„Haskellæ’ä»¶<br>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>Helix/Vim/Emacs</code>, è¦ä¸‹è½½å¯¹åº”çš„LSP: <code>haskell-language-server</code></p><p>æ¯”å¦‚, æˆ‘ç°åœ¨ç”¨çš„æ˜¯Fedora-Linux, å¯ä»¥è¿™æ ·ä¸‹è½½LSP:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dnf copr <span class="built_in">enable</span> -y petersen/haskell-language-server</span><br><span class="line">sudo dnf install -y haskell-language-server</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <a href="https://helix-editor.com/">Helix</a>, LSPå°†ä¼šç›´æ¥å¯ç”¨<br>å½“ç„¶, ä½ ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨å…¶ä»–ä»£ç ç¼–è¾‘å™¨, æœ€å¥½èƒ½æ”¯æŒLSP</p><hr><h1 id="huan-yuan">æ¢æº</h1><p>Haskellçš„åŒ…éƒ½æ”¾åœ¨ <a href="https://hackage.haskell.org/">hackage</a>, ä¸‹è½½ä¾èµ–æ—¶, é€Ÿåº¦å¯èƒ½ææ…¢<br>è¿™æ—¶, æˆ‘ä»¬åº”è¯¥è¿›è¡Œå°†å…¶æ¢æˆé•œåƒæº</p><p>è‹¥ä½ ä½¿ç”¨cabal, å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„åš:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cabal user-config init</span><br><span class="line">sed -i <span class="string">&#x27;s/repository hackage.haskell.org/repository mirrors.ustc.edu.cn/g&#x27;</span> ~/.cabal/config</span><br><span class="line">sed -i <span class="string">&#x27;s/http:\/\/hackage.haskell.org\//http:\/\/mirrors.ustc.edu.cn\/hackage\//g&#x27;</span> ~/.cabal/config</span><br><span class="line">sed -i <span class="string">&#x27;s/-- secure: True/secure: True/g&#x27;</span> ~/.cabal/config</span><br><span class="line">cabal update</span><br></pre></td></tr></table></figure><p>è¿™ä¼šç”Ÿæˆcabalçš„é…ç½®æ–‡ä»¶, å¹¶ä¸”å°†urlæ›¿æ¢ä¸ºä¸­ç§‘å¤§çš„æº</p><p>è‡³æ­¤, ç¯å¢ƒå‡†å¤‡å·¥ä½œå·²å…¨éƒ¨å®Œæˆ<br>ä¸‹ä¸€èŠ‚, æˆ‘ä»¬å°†æ­£å¼å¼€å§‹å­¦ä¹  Haskell</p><hr><h1 id="geng-gai-ghci-ti-shi-fu">æ›´æ”¹ghciæç¤ºç¬¦</h1><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œ <code>ghci</code> æ—¶, ä½ ä¼šå‘ç°å‰ç½®çš„æç¤ºç¬¦ä¸º <code>Prelude&gt;</code>, è¿™æ˜¯é»˜è®¤æ ·å¼<br>ä½†å®ƒä¼šéšç€ä½ å¼•å…¥çš„æ¨¡å—çš„å¢å¤š, è€Œå˜å¾—å†—æ‚, æ¯”å¦‚:</p><p>å½“ä½ è¾“å…¥ <code>:m Data.Time</code> (è¡¨ç¤ºå¼•å…¥ä¸€ä¸ªæ¨¡å—, åé¢ä¼šå­¦), å‰ç½®æç¤ºç¬¦å˜æˆäº† <code>Prelude Data.Time&gt;</code></p><p>ä¸ºäº†é˜²æ­¢æ¯å¼•å…¥æ¨¡å—è¿‡å¤š, å¯¼è‡´å‰ç½®æç¤ºç¬¦è¿‡äºæ‚ä¹±, å¯ä»¥é€‰æ‹©ä¿®æ”¹ ghci çš„å‰ç½®ç¬¦, æ¯”å¦‚:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;:set prompt &quot;ghci&gt; &quot;&#x27;</span> &gt; ~/.ghci</span><br><span class="line">chmod go-w ~/.ghci</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œæ›´æ”¹æç¤ºç¬¦<br>ç¬¬äºŒè¡Œç§»é™¤å¯å†™æƒé™, é˜²æ­¢ä»–äººæ›´æ”¹, ä¸ç„¶ ghci ä¼šè­¦å‘Š, ç„¶åæ‹’ç»æ›´æ”¹</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;é¦–å…ˆ, æˆ‘ä»¬å¾—æ­å»ºå¥½ Haskell çš„ç¯å¢ƒ&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Haskell" scheme="https://jedsek.xyz/tags/Haskell/"/>
    
  </entry>
  
  <entry>
    <title>haskell-basic-p1: ç³»åˆ—è¯´æ˜</title>
    <link href="https://jedsek.xyz/posts/haskell-basic/p1"/>
    <id>https://jedsek.xyz/posts/haskell-basic/p1</id>
    <published>2022-06-25T13:22:14.000Z</published>
    <updated>2022-06-25T13:22:14.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¬¢è¿å¤§å®¶æ¥åˆ° Haskell çš„å­¦ä¹ ç³»åˆ—</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p><h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1><p>æœ¬ç³»åˆ—ä¼šä»‹ç»ä¸‹Haskell, åŒæ—¶å­¦ä¹ å®ƒçš„è¯­æ³•ä¸æ€æƒ³<br>è¿™å°†ä¼šæ˜¯ä¸ªæ¼«é•¿çš„è¿‡ç¨‹, é¢„è®¡æ›´æ–°ä¼šå¾ˆæ…¢, åŠ¡å¿…åšå¥½å¿ƒç†å‡†å¤‡ ğŸ˜ƒ<br><s>(æ¯•ç«Ÿæ˜¯Haskell)</s></p><hr><h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1><ol><li class="lvl-3"><p>ä¹¦ç±</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="http://learnyouahaskell.com/chapters">Learn You a Haskell for Great Good! (è¶£å­¦æŒ‡å—)</a></p></li><li class="lvl-2"><p><a href="https://www.haskell.org/tutorial/">A Gentle Introduction to Haskell, Version 98</a></p></li></ul><ol start="2"><li class="lvl-3"><p>è®ºå›</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://discourse.haskell.org/">Haskell Discourse</a></p></li></ul><ol start="3"><li class="lvl-3"><p>åšå®¢</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="http://cgnail.github.io/tags/#lambda%E6%BC%94%E7%AE%97">Lambda Calculus (Lambdaæ¼”ç®—)</a></p></li><li class="lvl-2"><p><a href="https://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">Functors In Pictures (å›¾è§£å‡½å­)</a></p></li></ul><ol start="4"><li class="lvl-3"><p>Wiki</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://wiki.haskell.org/">Haskell Wiki</a></p></li></ul><hr><h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1><p>å‘ç°é”™è¯¯çš„è¯,è¯·åŠæ—¶è·Ÿæˆ‘è”ç³»,æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p><p>æœ€å,è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶æ¥åˆ° Haskell çš„å­¦ä¹ ç³»åˆ—&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Haskell" scheme="https://jedsek.xyz/tags/Haskell/"/>
    
  </entry>
  
  <entry>
    <title>rust-tui-p1: ç³»åˆ—è¯´æ˜</title>
    <link href="https://jedsek.xyz/posts/rust-tui/p1"/>
    <id>https://jedsek.xyz/posts/rust-tui/p1</id>
    <published>2022-06-19T04:59:50.000Z</published>
    <updated>2022-06-19T04:59:50.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ TUI ç³»åˆ—</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-tui">rust-tui</a></p><h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1><p>æœ¬ç³»åˆ—ä¼šä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>TUI(Text-based User Interface)</code><br>å½“ç„¶, è¿˜ä¼šä»‹ç»Rustä¸­çš„ä¸¤ä¸ªcrate: <code>tui</code> &amp;&amp; <code>crossterm</code></p><hr><h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1><ol><li class="lvl-3"><p>åšå®¢:</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://monkeypatch.io/blog/2021/2021-05-31-rust-tui/">Playing with tui-rs</a></p></li><li class="lvl-2"><p><a href="https://blog.logrocket.com/rust-and-tui-building-a-command-line-interface-in-rust/">Building a command-line interface in Rust</a></p></li></ul><ol start="2"><li class="lvl-3"><p>æ–‡æ¡£:</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://docs.rs/tui/latest/tui/">tui-rs</a></p></li><li class="lvl-2"><p><a href="https://docs.rs/crossterm/latest/crossterm/">crossterm</a></p></li></ul><hr><h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1><p>å‘ç°é”™è¯¯çš„è¯, è¯·åŠæ—¶è·Ÿæˆ‘è”ç³»<br>ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p><p>æœ€å, è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ TUI ç³»åˆ—&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="TUI" scheme="https://jedsek.xyz/tags/TUI/"/>
    
  </entry>
  
  <entry>
    <title>rust-gtk4-p3: GObject-å†…å­˜ç®¡ç†</title>
    <link href="https://jedsek.xyz/posts/rust-gtk4/p3"/>
    <id>https://jedsek.xyz/posts/rust-gtk4/p3</id>
    <published>2022-01-30T04:01:22.000Z</published>
    <updated>2022-01-30T04:01:22.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Widget, ç”±æ­¤å‡ºå‘, åˆ›å»ºä¸€ä¸ªåŒæŒ‰é’®åŠ å‡æ•°å­—çš„ç»å…¸ç¨‹åº, æ¢è®¨å†…å­˜ç®¡ç†, é˜²æ­¢å†…å­˜æ³„æ¼</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gtk4">rust-gtk4</a><br>GNOMEå…¥å‘æŒ‡å—: <a href="/posts/gnome/guide">gnome-guide</a></p><h1 id="widget">Widget</h1><p>ä»»ä½•ä¸€ä¸ªGtkåº”ç”¨, éƒ½ç”±è®¸å¤šéƒ¨ä»¶ç»„æˆ, è€Œè¿™äº›éƒ¨ä»¶, å°±å« <code>Widget</code>, æ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€èŠ‚çš„ <code>ApplicationWindow</code> å°±æ˜¯ä¸€ä¸ª Widget<br>å†æ¯”å¦‚, <code>Button(æŒ‰é’®)</code>, <code>Container(å®¹å™¨)</code>, éƒ½å±äº <code>Widget</code></p><p><a href="https://docs.gtk.org/gtk4/visual_index.html">Widget Gallery</a> æ˜¯Gtkæä¾›çš„ç½‘ç«™, ä½ å¯ä»¥é€šè¿‡æµè§ˆå®ƒ, æ›´å¥½åœ°é€‰æ‹© <code>Widget</code></p><p>æˆ‘ä»¬ç”šè‡³èƒ½è‡ªå®šä¹‰å‡ºæ–°çš„Widget, é€šè¿‡<code>ç»§æ‰¿/å­ç±»åŒ–</code>, å› ä¸º Gtk æ˜¯é¢å‘å¯¹è±¡çš„GUIæ¡†æ¶<br>ä¾‹å¦‚ <code>Button</code>, å…¶ç»§æ‰¿æ ‘å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GObject</span><br><span class="line">â””â”€â”€ Widget</span><br><span class="line">    â””â”€â”€ Button</span><br></pre></td></tr></table></figure><p>GObject, ä¹Ÿå°±æ˜¯ <code>gtk::glib::object::Object</code>, æ˜¯ Gtk å¯¹è±¡å±‚çº§ä¸­çš„åŸºç±», ç»§æ‰¿ GObject å¯ä»¥è·å–å…¶ç‰¹æ€§<br>ä¸¾ä¸ªä¾‹å­, GObject å…·æœ‰ <code>å¼•ç”¨è®¡æ•°</code> çš„ç‰¹æ€§, GObject çš„å­ç±»å¯¹è±¡ä¹Ÿå…·æœ‰è¯¥ç‰¹æ€§, å½“æŒ‡å‘è‡ªèº«çš„å¼ºå¼•ç”¨å½’é›¶æ—¶, è‡ªåŠ¨é‡Šæ”¾å†…å­˜</p><p>æ¥ä¸‹æ¥, æˆ‘ä»¬å°±æ¥åˆ›å»ºä¸€ä¸ªåŒæŒ‰é’®åŠ å‡æ•°å­—çš„ç¨‹åº, æ¢è®¨ä¸€ä¸‹ç›¸å…³çš„æ³¨æ„äº‹é¡¹, è¿™æ˜¯æ¥è‡ªå®˜æ–¹ä¹¦ç±ä¸­çš„ä¾‹å­:</p><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªçª—å£, ä¸Šé¢æœ‰ä¸¤ä¸ªæŒ‰é’® <code>btn_inc</code>, <code>btn_dec</code>, åˆšåˆšå¼€å§‹åˆ†åˆ«æ˜¾ç¤º <code>Increase</code> ä¸ <code>Decrease</code>, ä¼šåŠ å‡åˆå§‹å€¼ä¸ºé›¶çš„æ•°å­—</p></li><li class="lvl-2"><p>æŒ‰ä¸‹ <code>btn_inc</code>, åˆ™å°†æ•°å­—åŠ ä¸€, éšååœ¨ <code>btn_dec</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p></li><li class="lvl-2"><p>æŒ‰ä¸‹ <code>btn_dec</code>, åˆ™å°†æ•°å­—å‡ä¸€, éšååœ¨ <code>btn_inc</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p></li></ul><hr><h1 id="cuo-wu-shi-xian">é”™è¯¯å®ç°</h1><p>é¦–å…ˆè¯·æ³¨æ„, æˆ‘éƒ½è¯´äº†è¿™æ˜¯é”™è¯¯çš„å®ç°, æ¥ä¸‹æ¥çš„æ€è€ƒæ˜¯æœ‰ç‘•ç–µ, æœªè€ƒè™‘å®Œå…¨çš„ ğŸ˜ƒ</p><p>ä¸ºäº†å®ç°è¿™æ ·ä¸€ä¸ªç¨‹åº, æˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰è¿™ä¸¤ä¸ªæŒ‰é’®, å¹¶ä¸”å°†å®ƒä»¬æ˜¾ç¤ºåœ¨çª—å£ä¸Š, ä¸Šä¸€èŠ‚è®²çš„æ²¡å¿˜å§?<br>ä¸‹é¢æ˜¯ä»£ç , å·²ç»è®²è¿‡çš„æ¦‚å¿µä¸å†é‡å¤:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow, Button, Orientation&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ªæŒ‰é’®, è®¾ç½®Label</span></span><br><span class="line">    <span class="keyword">let</span> btn_inc = Button::builder()</span><br><span class="line">        .label(<span class="string">&quot;Increase&quot;</span>)</span><br><span class="line">        .margin_top(<span class="number">12</span>)</span><br><span class="line">        .margin_bottom(<span class="number">20</span>)</span><br><span class="line">        .margin_start(<span class="number">12</span>)</span><br><span class="line">        .margin_end(<span class="number">12</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">let</span> btn_dec = Button::builder()</span><br><span class="line">        .label(<span class="string">&quot;Decrease&quot;</span>)</span><br><span class="line">        .margin_top(<span class="number">12</span>)</span><br><span class="line">        .margin_bottom(<span class="number">20</span>)</span><br><span class="line">        .margin_start(<span class="number">12</span>)</span><br><span class="line">        .margin_end(<span class="number">12</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `Clicked` äº‹ä»¶å‘ç”Ÿåçš„å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="comment">// å‡ºäºç®€å•æ¼”ç¤ºçš„ç›®çš„, è¿™é‡Œåªæ˜¯å•çº¯çš„åŠ å‡æ•°å­—è€Œå·²</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> num = <span class="number">0</span>;</span><br><span class="line">    btn_inc.connect_clicked(|_| &#123;</span><br><span class="line">        num += <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    btn_dec.connect_clicked(|_| &#123;</span><br><span class="line">        num -= <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå®¹å™¨, æŒ‡å®šå…¶æ–¹å‘ä¸ºå‚ç›´, å³æ·»åŠ å…ƒç´ çš„ä½ç½®æ˜¯ä¸Šè‡³ä¸‹</span></span><br><span class="line">    <span class="comment">// å› æ­¤, ä»ä¸Šå¾€ä¸‹ç¬¬ä¸€ä¸ªæ˜¯btn_inc, ç¬¬äºŒä¸ªæ˜¯btn_dec</span></span><br><span class="line">    <span class="keyword">let</span> gtk_box = gtk::<span class="built_in">Box</span>::builder()</span><br><span class="line">        .orientation(Orientation::Vertical)</span><br><span class="line">        .build();</span><br><span class="line">    gtk_box.append(&amp;btn_inc);</span><br><span class="line">    gtk_box.append(&amp;btn_dec);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çª—å£åªèƒ½è®¾ç½®ä¸€ä¸ªchild, å› æ­¤æŠŠå®¹å™¨æ·»åŠ è¿›å»</span></span><br><span class="line">    <span class="comment">// éšååœ¨å®¹å™¨ä¸­æ·»åŠ å¾ˆå¤š widget, è¾¾åˆ°å…¨æ·»åŠ è¿›å»çš„ç›®çš„</span></span><br><span class="line">    <span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">        .child(&amp;gtk_box)</span><br><span class="line">        .build();</span><br><span class="line">    win.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶, éƒ½è¯´äº†æ˜¯é”™è¯¯æ¼”ç¤º, è‡ªç„¶ä¼šæŠ¥é”™, è€Œä¸”è¿™é‡Œæ˜¯ç¼–è¯‘æœŸçš„æŠ¥é”™<br>å¦‚æœçœ‹ä¸‹ <code>connect_clicked</code> çš„å®šä¹‰, ä¼šå‘ç°å®ƒè¦æ±‚ä¼ å…¥çš„é—­åŒ…, å¿…é¡»æœ‰ 'static çš„ lifetime</p><p>é“ç†å¾ˆç®€å•, é¬¼çŸ¥é“ç”¨æˆ·å•¥æ—¶å€™ä¼šç‚¹æŒ‰é’®, è°ƒç”¨è¯¥å›è°ƒå‡½æ•°, è¦æ˜¯é—­åŒ…è¿˜æ´»ç€, numè¿™å˜é‡å·²ç»æ²¡äº†å’‹åŠ?<br>å› æ­¤, é—­åŒ…æœ‰ä¸ª 'static çš„ lifetime, åœ¨ç¼–è¯‘æœŸå°±èƒ½é™åˆ¶å¼€å‘è€…å†™å‡ºä¸å®‰å…¨çš„ä»£ç , æ‹’ç»æ´»å¾—æ²¡é—­åŒ…ä¹…çš„å˜é‡</p><p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸ºé—­åŒ…æ·»åŠ å‰ç¼€, å³æ·»åŠ å…³é”®å­— <code>move</code>, è®©è¢«é—­åŒ…æ•è·çš„å˜é‡, å…¶æ‰€æœ‰æƒè½¬ç§»åˆ°é—­åŒ…ä¸­<br>è¿™æ ·å­, é—­åŒ…æ­»ä¹‹å‰è‚¯å®šå¯ä»¥ä¸€ç›´è®¿é—®åˆ° num è¿™ä¸ªå˜é‡, æ¯•ç«Ÿæ‰€æœ‰æƒéƒ½è¿›å»äº†, è¿˜æ€•å®ƒé€ƒä¸æˆ?</p><p>ä½†é—®é¢˜æ˜¯, è¿™æ ·çš„æ“ä½œåªèƒ½æ»¡è¶³ä¸€ä¸ªé—­åŒ…, æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‰é’®, éœ€è¦å†™ä¸¤ä¸ªå›è°ƒå‡½æ•°, è€Œæ‰€æœ‰æƒåªèƒ½è½¬ç§»ä¸€æ¬¡!<br>æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•, è®©è¿™ä¸¤ä¸ªé—­åŒ…éƒ½èƒ½æ‹¥æœ‰numçš„æ‰€æœ‰æƒ?</p><p>è¯·çœ‹ä¸‹é¢çš„æ­£ç¡®å®ç°, é€šè¿‡å¼•ç”¨è®¡æ•°çš„æ–¹å¼ ğŸ˜ƒ</p><hr><h1 id="yin-yong-ji-shu">å¼•ç”¨è®¡æ•°</h1><p>å˜¿! è¿™ä¸å°±æ˜¯å¤šæ‰€æœ‰æƒé—®é¢˜å˜›, è¿˜æ˜¯åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ <s>(GUIæ¡†æ¶å¥½åƒéƒ½æ˜¯å•çº¿ç¨‹çš„?)</s><br>é‚£å°±å¯ä»¥ä½¿ç”¨ <code>std::rc::Rc</code> è¿™ä¸ªç±»å‹, é€šè¿‡å¼•ç”¨è®¡æ•°, ç»•è¿‡ç¼–è¯‘æœŸçš„æ£€æŸ¥, å®ç°å¤šæ‰€æœ‰æƒ</p><p>å¤šæ‰€æœ‰æƒçš„é—®é¢˜å·²ç»è¾¾æˆäº†, ä½†æˆ‘ä»¬è¿˜éœ€è¦å†…éƒ¨å¯å˜æ€§, å› æ­¤è¿˜éœ€è¦ä½¿ç”¨ <code>std::cell::Cell</code><br>äºæ˜¯, numå˜é‡çš„ç±»å‹, ä»ç®€å•çš„i32, å˜æˆäº†ä¸€ä¸ªWrapperç±»å‹, å³ <code>Rc&lt;Cell&lt;i32&gt;&gt;</code></p><div class="tips"><p><strong>å°æç¤º</strong><br>å¯¹äºå®ç°äº†Copyçš„ç±»å‹, è¯·ç›´æ¥ä½¿ç”¨Cell, è€ŒéRefcell<br>å› ä¸ºCellç®€å•, æ˜¯ç›´æ¥ä½¿ç”¨memcpyæ¥æ”¹å˜å€¼çš„, æ•ˆç‡é«˜, æ˜“ç†è§£</p></div><p>ä¸‹é¢æ˜¯ä»£ç , è¯·åŠ¡å¿…è®°å¾—useä¸€ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line"><span class="keyword">let</span> num_clone = num.clone();</span><br><span class="line"></span><br><span class="line">btn_inc.connect_clicked(|_| &#123;</span><br><span class="line">    num_clone.set(num_clone.get() + <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">btn_dec.connect_clicked(|_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ„Ÿè°¢å¼ºå¤§çš„ç¼–è¯‘å™¨ä¸èªæ˜çš„åº“ä½œè€…, ä»–ä»¬é€¼è¿«ç€ä½ , è®©ä½ è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µ, ä¸ç„¶åˆ«æƒ³ç¼–è¯‘é€šè¿‡<br>å…¶ä»–è¯­è¨€ä¸­å¯èƒ½ä¼šè½»æ˜“å‡ºç°çš„Bug, ä½ æ— æ³•åœ¨Rustä¸­å¤ç°, GNOMEçš„è½¯ä»¶ç”¨Rustè¿›è¡Œé‡å†™, å¯èƒ½å°±å› ä¸ºè¿™?</p><p>è®©æˆ‘ä»¬å°†è¿™ä¸ªåˆæ­¥çš„ä»£ç å‡ä¸ªçº§, å®ç°æœ¬èŠ‚å¼€ç¯‡æ‰€æè¿°çš„ç¨‹åº:</p><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªçª—å£, ä¸Šé¢æœ‰ä¸¤ä¸ªæŒ‰é’® <code>btn_inc</code>, <code>btn_dec</code>, åˆšåˆšå¼€å§‹åˆ†åˆ«æ˜¾ç¤º <code>Increase</code> ä¸ <code>Decrease</code>, ä¼šåŠ å‡åˆå§‹å€¼ä¸ºé›¶çš„æ•°å­—</p></li><li class="lvl-2"><p>æŒ‰ä¸‹ <code>btn_inc</code>, åˆ™å°†æ•°å­—åŠ ä¸€, éšååœ¨ <code>btn_dec</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p></li><li class="lvl-2"><p>æŒ‰ä¸‹ <code>btn_dec</code>, åˆ™å°†æ•°å­—å‡ä¸€, éšååœ¨ <code>btn_inc</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p></li></ul><p>æˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†æŒ‰ä¸‹æŒ‰é’®åæ•°å­—çš„åŠ å‡, å¹¶å€Ÿç”±ç¼–è¯‘å™¨ä¹‹çœ¼çœ‹åˆ°äº†å±é™©, åˆ©ç”¨æ ‡å‡†åº“æä¾›çš„ç±»å‹, è®©ç¨‹åºå˜å¾—å®‰å…¨<br>è¦åšçš„ä¸‹ä¸€æ­¥, å°±æ˜¯è®©æŸæŒ‰é’®è¢«æŒ‰ä¸‹å, åœ¨å¦ä¸€ä¸ªæŒ‰é’®ä¸Šæ˜¾ç¤ºå½“å‰çš„æ•°å€¼</p><p>åœ¨æœ¬èŠ‚å¼€ç¯‡, æåŠè¿‡Buttonçš„ç»§æ‰¿æ ‘: å®ƒç»§æ‰¿äº†GObject, å› æ­¤å…·æœ‰å¼•ç”¨è®¡æ•°çš„ç‰¹ç‚¹, ç›¸å½“äºRustä¸­çš„Rc<T><br>å› æ­¤, å¯ä»¥å¤ç”¨å¯¹ä»˜numçš„æ–¹æ³•, æ¥å¯¹ä»˜ btn_inc ä¸ btn_dec, ç›´æ¥clone, ç„¶åä½¿ç”¨è¢«cloneå‡ºæ¥çš„è¿™ä¸ªå˜é‡</p><p>ä½†æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨clone, åˆ›å»ºæ–°å˜é‡, è¿™æ˜¯ä¸æ˜¯å¤ªéº»çƒ¦äº†ç‚¹?<br>æ‰€å¹¸ Gtk4 çš„å¼€å‘äººå‘˜, å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿‡ç¨‹å®, ä¸“é—¨åŒ–ç®€æ‰‹åŠ¨cloneçš„ç¹çæ“ä½œ</p><hr><h1 id="clone">clone!</h1><p>Yeah, è¿™ä¸ªå®çš„åå­—å°±å«clone: <code>glib::clone</code><br>è¯·åŠ¡å¿…æ³¨æ„useå¿…é¡»åƒä¸‹é¢è¿™æ ·å†™, ä½ å¾—å…ˆ <code>use gtk::glib</code>, éšå <code>use glib::clone</code>:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::Cell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> glib::clone;</span><br><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;glib, Application, ApplicationWindow, Button, Orientation&#125;;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå®å‘¢?  å¦‚ä¸‹, æ˜ç™½æ€ä¹ˆå†™å°±å®Œäº‹äº†, è¿˜æ˜¯è›®ç®€å•çš„:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line">btn_inc.connect_clicked(clone!(@weak num, @strong btn_dec =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() + <span class="number">1</span>);</span><br><span class="line">    btn_dec.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br><span class="line">btn_dec.connect_clicked(clone!(@strong btn_inc =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">    btn_inc.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>clone!</code> è¿™ä¸ªå®, ç”Ÿæˆäº†å˜é‡çš„å…‹éš†å€¼, å¹¶æŒ‡å®šè¯¥å…‹éš†åˆ°åº•æ˜¯å¼ºå¼•ç”¨(strong), è¿˜æ˜¯å¼±å¼•ç”¨(weak)<br>è‹¥æ˜¯strong, é‚£è‡ªç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨, æ¯•ç«Ÿä¸€ä¸ªRcç±»å‹çš„å˜é‡, åªæœ‰å¼ºå¼•ç”¨æ•°å½’é›¶æ—¶æ‰ä¼šé‡Šæ”¾å†…å­˜<br>è‹¥æ˜¯weak, å˜é‡å¯èƒ½å·²ç»é‡Šæ”¾, å› æ­¤ä¼šå°è¯•å…ˆå‡çº§åˆ°strong, å˜é‡æ²¡æ­»å°±å‡çº§æˆåŠŸ, ä¸ç„¶ç›´æ¥ä»é—­åŒ…è¿”å›</p><p>æ‡‚äº†åŸºç¡€çš„åŸç†å <s>(æˆ‘ä¸ªäººå–œæ¬¢æŠŠè¯»è€…å½“å‚»å­, å› æ­¤å°½é‡æä¸€å˜´)</s>, æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢è¿™æ®µä»£ç :</p><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ç¬¬ä¸€ä¸ªé—­åŒ…ä¸­, num çš„ weak-ref, ä¸ btn_dec çš„ strong-ref è¢«åˆ›å»º<br>è€Œ num çš„æ‰€æœ‰æƒè¢«è½¬ç§»åˆ°ç¬¬äºŒä¸ªé—­åŒ…ä¸­, è€Œè¯¥é—­åŒ…çš„ lifetime æ˜¯ 'static, å› æ­¤ weak-ref ä¸€ç›´å¯ä»¥å‡çº§å¹¶è®¿é—® num</p></li><li class="lvl-2"><p>ä¸¤ä¸ªé—­åŒ…ä¸­, æˆ‘ä»¬éƒ½åˆ›å»ºäº†å¦ä¸€ä¸ªæŒ‰é’®çš„ strong-ref<br>æˆ‘ä»¬è·å–äº†å¤šæ‰€æœ‰æƒ, å°±åƒå˜é‡ num ä¸€æ ·, åªæœ‰å•æ‰€æœ‰æƒæ—¶, è¢«moveåˆ°é—­åŒ…åçš„å˜é‡åœ¨ä¹‹åä¼šè¢«ä½¿ç”¨, ç¼–è¯‘æŠ¥é”™, å¦‚ btn_dec</p></li></ul><p>è‡³æ­¤, å·²ç»å¯ä»¥é¡ºåˆ©å®ç°åŠŸèƒ½äº†, ä½†ä»ç„¶æœ‰ä¸€ä¸ªå°é—®é¢˜, é‚£å°±æ˜¯å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼!<br>Ruståªä¿éšœå†…å­˜å®‰å…¨, ä¸ä¿éšœå†…å­˜ä¸æ³„æ¼, è®©æˆ‘ä»¬çœ‹çœ‹é—®é¢˜æ‰€åœ¨<br><s>(å¤§ä½¬ä»¬å¯èƒ½ä¸€çœ¼å°±çœ‹å‡ºæ¥å“ªé‡Œå¾ªç¯å¼•ç”¨äº†â€¦)</s></p><hr><h1 id="xun-huan-yin-yong">å¾ªç¯å¼•ç”¨</h1><p>è´´ä¸€ä»½åˆšåˆšçš„ä»£ç :</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line">btn_inc.connect_clicked(clone!(@weak num, @strong btn_dec =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() + <span class="number">1</span>);</span><br><span class="line">    btn_dec.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br><span class="line">btn_dec.connect_clicked(clone!(@strong btn_inc =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">    btn_inc.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>è¯´èµ·æ¥ä¹Ÿå¾ˆç®€å•, é‚£å°±æ˜¯ btn_inc äº§ç”Ÿäº†å¯¹ btn_dec çš„ strong-ref, btn_dec ä¹Ÿäº§ç”Ÿäº†å¯¹ btn_inc çš„ strong-ref<br>ä¸¤ä¸ª strong äº’ç›¸æŒ‡å‘, å¯¼è‡´æ¯ä¸ªå˜é‡çš„å¼ºå¼•ç”¨çš„è®¡æ•°éƒ½è‡³å°‘æ˜¯1, æ°¸è¿œä¸ä¼šå½’é›¶, æ°¸è¿œä¸ä¼šé‡Šæ”¾å†…å­˜</p><p>æœ‰é‚£ä¹ˆä¸€å°å—å†…å­˜æ°¸è¿œè¢«å®ƒä»¬æŠ¢èµ°äº†, åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½å¾—ä¸åˆ°å¤ç”¨, è¿™å°±æ˜¯ <code>å†…å­˜æ³„æ¼</code></p><p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜? éå¸¸ç®€å•, æŠŠ strong-ref æ”¹æˆ weak-ref ä¸å°±Okäº†?</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Widget, ç”±æ­¤å‡ºå‘, åˆ›å»ºä¸€ä¸ªåŒæŒ‰é’®åŠ å‡æ•°å­—çš„ç»å…¸ç¨‹åº, æ¢è®¨å†…å­˜ç®¡ç†, é˜²æ­¢å†…å­˜æ³„æ¼&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="GUI" scheme="https://jedsek.xyz/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>rust-gtk4-p2: åˆ›å»ºçª—å£</title>
    <link href="https://jedsek.xyz/posts/rust-gtk4/p2"/>
    <id>https://jedsek.xyz/posts/rust-gtk4/p2</id>
    <published>2021-11-07T02:16:57.000Z</published>
    <updated>2021-11-07T02:16:57.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è®©æˆ‘ä»¬ä½¿ç”¨Gtk, åˆ›å»ºä¸€ä¸ªçª—å£, äº†è§£ä¸‹å¤§è‡´çš„æ¡†æ¶, ä½œä¸ºæ—…é€”çš„èµ·ç‚¹å§</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gtk4">rust-gtk4</a><br>GNOMEå…¥å‘æŒ‡å—: <a href="/posts/gnome/guide">gnome-guide</a></p><h1 id="bei-jing-liao-jie">èƒŒæ™¯äº†è§£</h1><h2 id="gtk" id="GTK">GTK</h2><p>GTK, ç®€å•æ¥è¯´æ˜¯ä¸ªæœ‰åçš„GUIåº“, å¼€æºå…è´¹, ç”¨Cç¼–å†™<br>åœ¨gtk3å, ç”±äºGI(<a href="https://gi.readthedocs.io/en/latest/">GObject Introspection</a>) çš„åº”ç”¨, å¯ä»¥è½»æ¾åœ°, åˆ›å»ºå…¶ä»–è¯­è¨€çš„ç»‘å®š<br>è¿™ä½¿ä½ èƒ½åˆ©ç”¨ä¸åŒè¯­è¨€ç¼–å†™GUI, æ¯”å¦‚Rust, Nim, Vala, Python, Javascriptâ€¦ <s>(ä¸ä¼šçœŸçš„æœ‰äººç”¨Cè¯­è¨€å†™Gtkå§?)</s></p><p>åŸºæœ¬ä¸Šåæ°”ç¨å¾®å¤§ç‚¹çš„è¯­è¨€, éƒ½æœ‰å¯¹åº”çš„GTKç»‘å®š</p><h2 id="gtk-rs" id="gtk-rs">gtk-rs</h2><p>ç›®å‰æœ‰ä¸ªé¡¹ç›®, å«åš <a href="https://gtk-rs.org/">gtk-rs</a>, è´Ÿè´£GTKçš„Rustç»‘å®š, åœ¨ <a href="https://crates.io/">crates.io</a> ä¸Šæœç´¢ gtk, æ‰€çœ‹åˆ°çš„ <a href="https://crates.io/crates/gtk">gtk</a> ä¸ <a href="https://crates.io/crates/gtk4">gtk4</a>, å°±å±äºgtk-rs</p><p>gtk4è¿™ä¸ªcrate, æ˜¯Rustè¯­è¨€çš„ç»‘å®š, è€ŒéåŒçº¯Cç¼–å†™çš„é‚£ä¸ªgtk4æœ¬èº«<br>æ‰€ä»¥è¿›è¡Œæ¥ä¸‹æ¥çš„æ­¥éª¤å‰, è¯·ç¡®ä¿ç¯å¢ƒå†…, å·²æœ‰gtk4æœ¬èº«çš„æ­£ç¡®ç‰ˆæœ¬, ä¸ç„¶crateä¼šè£…ä¸ä¸Š</p><hr><h1 id="xiang-mu-pei-zhi">é¡¹ç›®é…ç½®</h1><p>é¦–å…ˆ, ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®, éšåä¿®æ”¹ Cargo.toml, å¦‚ä¸‹:</p><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">gtk</span> = &#123;version = <span class="string">&quot;0.3.1&quot;</span>, package = <span class="string">&quot;gtk4&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°† gtk4(crate), é‡å‘½åä¸º gtk, æ–¹ä¾¿ä¹‹åç¼–å†™, éšå, è¯·runä¸€ä¸‹, å®‰è£…ä¾èµ– (è¯·ç¡®ä¿å®‰è£…äº†gtk4)<br>ä¸‹é¢å°±æ˜¯æ­£å¼çš„ç¼–ç ç¯èŠ‚äº†</p><hr><h1 id="ji-chu-zhi-shi">åŸºç¡€çŸ¥è¯†</h1><p>ä¸€ä¸ªGTK4åº”ç”¨çš„åˆ›å»º, éœ€è¦ç”¨åˆ° <code>gtk::Application</code><br>åŒæ—¶è¿˜éœ€ <code>use gtk::prelude::*</code>, åŸå› ä¸ <a href="https://doc.rust-lang.org/std/prelude/index.html">std::prelude</a> ä¸€æ ·</p><p>å…ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨, å®ƒç›®å‰è¿çª—å£ä¹Ÿæ²¡æœ‰:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•å§? ä½†åˆ«æ€¥ç€è¿è¡Œ, å…ˆçœ‹çœ‹ä¸‹é¢ä¸¤å¤„:</p><ul class="lvl-0"><li class="lvl-2"><p><a href="https://developer.gnome.org/documentation/tutorials/application-id.html">application_id</a>:<br>æ¯ä¸ªGTKåº”ç”¨, éƒ½å¸¦æœ‰ä¸€ä¸ªid, å³ <code>application_id</code>, å®ƒå¿…é¡»æ˜¯å…¨ä¸–ç•Œå”¯ä¸€çš„, ä¸€èˆ¬ä½¿ç”¨ååŸŸåä½œä¸ºid, å¦‚ â€œorg.gnome.geditâ€<br><code>app_id</code> ä½œä¸ºAppçš„å”¯ä¸€æ ‡è¯†ç¬¦, ç”¨äºAppä¹‹é—´çš„é€šä¿¡ä¸è¯†åˆ«, å› æ­¤è¦æ…é‡è€ƒè™‘, æœ€å¥½ç¬¬ä¸€æ¬¡å°±å®šå¥½, é¿å…ä¹‹åçš„éº»çƒ¦!</p></li><li class="lvl-2"><p><a href="http://chuxiuhong.com/chuxiuhong-rust-patterns-zh/patterns/builder.html">Builder Pattern (ä¸€ç§Rustä¸­å¸¸è§çš„è®¾è®¡æ¨¡å¼)</a>:<br>æˆ‘ä»¬åˆ©ç”¨å®ƒè¿›è¡Œé“¾å¼æ„é€ , è®©æ„é€ çš„è¿‡ç¨‹æ›´åŠ æ¸…æ™°, è¿™é‡Œæˆ‘ä»¬åœ¨é“¾å¼ä¸­, æŒ‡å®šäº†ç¨‹åºçš„id: <code>application_id(id: &amp;str)</code><br>åœ¨gtk4ä¸­, å®ƒè¢«é«˜é¢‘æ¬¡åœ°ä½¿ç”¨, æœ€åè°ƒç”¨çš„ <code>build</code> ä¼šç”Ÿæˆæ¯”å¦‚çª—å£, æŒ‰é’®ç­‰éƒ¨ä»¶çš„å®ä¾‹<br>å½“ç„¶, ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™XMLæ–‡ä»¶, æ¥æ„é€ å¯¹åº”çš„éƒ¨ä»¶, æŒ‡å®šå…¶å¸ƒå±€, ä½†è¿™æ˜¯åè¯</p></li></ul><hr><h1 id="xin-hao-liang-de-gai-nian">ä¿¡å·é‡çš„æ¦‚å¿µ</h1><p>æ¥å§! å½“ä½ è·ƒè·ƒæ¬²è¯•, <code>cargo run</code> ä¹‹å, ä¼šçœ‹åˆ°:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GLib-GIO-WARNING : Your application does not implement g_application_activate()</span><br><span class="line">and has no handlers connected to the <span class="string">&#x27;activate&#x27;</span> signal.  </span><br><span class="line">It should <span class="keyword">do</span> one of these.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®é™…ä¸Šè¿˜è¦æ·»åŠ ä¸€ä¸ªåä¸º activate çš„ä¿¡å·é‡(Signal), ä½ å¾—åƒä¸‹é¢è¿™æ ·å†™:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    todo!()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶, ç°åœ¨è¿˜æ— æ³•æ‰§è¡Œ, è¯·æ³¨æ„ <code>build_ui</code> å‡½æ•°ä¸­çš„ <code>todo!()</code>, æˆ‘ä»¬è¿˜æ²¡æœ‰å¡«å……è¿™ä¸ªå‡½æ•°!<br>å› ä¸ºæˆ‘æƒ³é€æ­¥åœ°è®²è§£, å¯¹ä¸Šé¢çš„ä¸œè¥¿æ¥ç‚¹å°å°çš„è§£é‡Š</p><p>Gtkåº”ç”¨çš„ç†å¿µæ˜¯: Appåªå…³å¿ƒåœ¨ç‰¹å®šçš„æ—¶å€™éœ€è¦åšä»€ä¹ˆäº‹<br>ä»€ä¹ˆæ—¶å€™åš ? Gtkå·²ç»å¸®æˆ‘ä»¬å®‰æ’å¥½äº†, è‡³äº <code>äº‹æƒ…çš„å†…å®¹</code>, åˆ™äº¤ç”±å¼€å‘è€…è‡ªå·±å†³å®š</p><p>æ¥å£æ–¹é¢, Gtkå·²ç»å¸®æˆ‘ä»¬åˆ†ç±»å¥½ä¸€äº›è™šå‡½æ•°, å®ƒä»¬ä¹Ÿè¢«ç§°ä¸º <code>ä¿¡å·(Signal)</code>, æˆ‘ä»¬åªéœ€è¦å®ç°è¿™äº›è™šå‡½æ•°å³å¯<br>ä½ å¯ä»¥å°†è™šå‡½æ•°, ç®€å•ç†è§£ä¸º, å…¶å‡½æ•°ä½“æ˜¯ç©ºçš„, åº“ä½œè€…æƒ³è®©ä½ ç”¨, ä½†å…·ä½“æ€ä¹ˆç”¨éšä½ , éœ€è¦è‡ªå·±æ¥å¡«å……å‡½æ•°ä½“<br>å®ƒä»¬çš„è°ƒç”¨é¡ºåºå·²ç»è¢«å®‰æ’å¥½äº†, åªæ˜¯éœ€è¦ç­‰å¾…æˆ‘ä»¬å®ç°å‡½æ•°ä½“è€Œå·²<br>(ä¹Ÿå°±æ˜¯äº‹ä»¶, ä¸äº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œå¤„ç†çš„å›è°ƒå‡½æ•°)</p><p>ä¸‹é¢æ˜¯å››ä¸ªå¾…å“åº”çš„ä¿¡å·, ä¹Ÿå°±æ˜¯å¾…å®ç°çš„è™šå‡½æ•°:</p><ul class="lvl-0"><li class="lvl-2"><p>startup:<br>åœ¨Appç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è¢«è°ƒç”¨, ç”¨äºä¸UIæ˜¾ç¤ºæ— å…³çš„åˆå§‹åŒ–ä»»åŠ¡</p></li><li class="lvl-2"><p>shutdown:<br>åœ¨Appç»“æŸæ—¶è°ƒç”¨, æ¸…ç†èµ„æº, è¿›è¡Œå–„å, ä¸è¿‡è¿™å¥½åƒå¯¹Rustæ²¡å•¥ç”¨? Dropèƒ½è‡ªåŠ¨æ¸…ç†, ä½†æ¯•ç«Ÿæºç æ˜¯C</p></li><li class="lvl-2"><p>activate:<br>GtkAppæ€»å¾—æœ‰è‡³å°‘ä¸€ä¸ªçª—å£, è¯¥å‡½æ•°å†³å®šå¦‚ä½•æ˜¾ç¤º/ç»˜åˆ¶çª—å£</p></li><li class="lvl-2"><p>open<br>å½“Appéœ€è¦æ‰“å¼€æŸä¸ªæ–‡ä»¶æ—¶è¢«æ‰§è¡Œ, æ–‡ä»¶ä¼šåœ¨æ–°çª—å£æ˜¾ç¤º, æ¯”å¦‚æµè§ˆå™¨æ‰“å¼€äº†pdfæ–‡ä»¶</p></li></ul><p>æ­£å¦‚ä¸Šé¢ç¬¬ä¸‰ä¸ªä¿¡å·æ‰€è¯´, ä¸€ä¸ªGtkAppè‡³å°‘å¾—æœ‰ä¸€ä¸ªçª—å£<br>å½“æŸä¸ªAppè¯•å›¾æ‰“å¼€ç¬¬äºŒä¸ªçª—å£, Gtkå…¨å±€ç³»ç»Ÿ, ä¼šå‘é€Signal(activate/open)ç»™ç¬¬ä¸€ä¸ªçª—å£<br>æ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œéƒ½åº”åœ¨startupä¸­å®Œæˆ, å“ªæ€•æ˜¯ç¬¬äºŒä¸ªçª—å£ç›¸å…³çš„åˆå§‹åŒ–</p><p>è¿™äº›åªæ˜¯Gtkç»™æˆ‘ä»¬çš„è™šå‡½æ•°ä¸­æœ€ä¸ºå¸¸è§çš„å‡ ä¸ª, å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šä¿¡å·, å¸®ä½ è‡ªå®šä¹‰è®¾è®¡App<br>æœ¬èŠ‚åé¢, ä¼šå†è®²ä¸‹å…³äºæŒ‰é’®è¢«ç‚¹å‡»æ—¶çš„ä¿¡å·é‡, å¸®ä½ åŠ æ·±å°è±¡, æ­¤å¤„æš‚å…ˆç•¥è¿‡</p><hr><h1 id="chuang-jian-kong-bai-chuang-kou">åˆ›å»ºç©ºç™½çª—å£</h1><p>å›åˆ°ä¹‹å‰çš„ä»£ç , å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    todo!()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">Your <span class="built_in">application</span> <span class="keyword">does</span> <span class="keyword">not</span> implement g_application_activate()</span><br><span class="line"><span class="keyword">and</span> has no handlers connected <span class="keyword">to</span> <span class="keyword">the</span> &#x27;<span class="built_in">activate</span>&#x27; signal. </span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ åº”è¯¥æ˜ç™½, ä¸ºä»€ä¹ˆä¹‹å‰ä¼šæŠ¥å‡ºä¸€ä¸ªè­¦å‘Š, è¦æ±‚è¿æ¥activateè¿™ä¸ªä¿¡å·äº†å§?<br>(<code>connect_xxxx</code> ç›¸å…³çš„æ–¹æ³•, ä»£è¡¨ç€è¿æ¥ä¿¡å·/å®ç°è™šå‡½æ•°)</p><p>æˆ‘ä»¬å¾—è°ƒç”¨ <code>connect_activate</code>, å¹¶ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°<br>æ ¹æ®å®šä¹‰, è¿™ä¸ªè¢«ä¼ å…¥çš„å‡½æ•°, å…·æœ‰é™æ€çš„ç”Ÿå‘½å‘¨æœŸ, å‚æ•°çš„ç±»å‹æ˜¯ <code>&amp;Application</code></p><p>æˆ‘ä»¬åˆ›å»ºçš„è¿™ä¸ªå‡½æ•°, åä¸º <code>build_ui</code>, æ­£æ˜¯ä¸ºäº†æ¶ˆé™¤è¯¥è­¦å‘Š, çœŸæ­£æ˜¾ç¤ºçª—å£, æ¯•ç«Ÿä¸€ä¸ªGUIç¨‹åºè‹¥æ— ä»»ä½•æ˜¾ç¤º, è¿™â€¦å•§, ä¸å¤ªèªæ˜?</p><p>ç›´æ¥ä¸Š <code>build_ui</code> çš„ä»£ç , æ³¨æ„ use é‚£è¾¹å¤šäº†ä¸œè¥¿:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My App&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    win.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨builderæ¨¡å¼, æŒ‡å®šäº†çª—å£å¯¹åº”çš„Appæ˜¯è°, æ ‡é¢˜æ˜¯å•¥, å¹¶åœ¨æœ€åæ˜¾ç¤ºå®ƒ<br>å¦‚æœä½ å¤„äºGNOME-DE, å¹¶å¯ç”¨äº†ç›¸å…³ä¸»é¢˜, å°†ä¼šçœ‹è§ä¸€ä¸ªå…·æœ‰å¯¹åº”ä¸»é¢˜çš„ç©ºç™½çª—å£, æ ‡é¢˜æ˜¯ <code>My App</code></p><p>åœ¨Appå¯åŠ¨ä¹‹åçš„æŸæ—¶åˆ», <code>activate</code> ä¿¡å·å¯¹åº”çš„è™šå‡½æ•°è¢«è°ƒç”¨, ä¹‹å‰å› ä¸ºæ²¡æœ‰å®ç°å®ƒ, ä¸€ä¸ªè­¦å‘Šå‡ºç°<br>ä½†ç°åœ¨, æˆ‘ä»¬å·²ç»å°†å®ƒè¦†ç›–æˆè‡ªå·±çš„ <code>build_ui</code> äº†, å› æ­¤è­¦å‘Šä¸å†å‡ºç°</p><hr><h1 id="xin-zeng-an-niu">æ–°å¢æŒ‰é’®</h1><p>è®©æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæŒ‰é’®, æç¤ºä¿¡æ¯æ˜¯ <code>Press me!</code>, åœ¨æŒ‰ä¸‹ä¹‹å, å˜æˆæ˜¾ç¤º <code>Hello World!</code>:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::&#123;prelude::*, Button&#125;;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="keyword">let</span> btn = Button::builder().label(<span class="string">&quot;Press me!&quot;</span>).build();</span><br><span class="line">    btn.connect_clicked(|btn| btn.set_label(<span class="string">&quot;Hello World!&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My App&quot;</span>)</span><br><span class="line">        .child(&amp;btn)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    win.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰è¯´è¿‡, æˆ‘ä»¬å¯ä»¥è¦†å†™çš„è™šå‡½æ•°/ä¿¡å·é‡, è¿œè¿œä¸æ­¢é‚£å››ä¸ª, è¿™é‡Œä¸ºbtnè¿æ¥äº†åå«clickedçš„ä¿¡å·é‡</p><p>å†æ¬¡åŠ æ·±ä¸€ä¸‹å°è±¡:<br>åº“çš„ä½œè€…ä¸ºä½ é¢„å…ˆå®šä¹‰å¥½äº†å¾ˆå¤šè™šå‡½æ•°, ä»€ä¹ˆæ—¶å€™è°ƒç”¨å·²ç»å®šå¥½äº†, ä½†è°ƒç”¨ä¹‹åä¼šåšä»€ä¹ˆ, åˆ™è‡ªå·±å†³å®š<br>è¿™é‡Œ, æŒ‰é’®è¢«æŒ‰ä¸‹è¿™ä¸ªäº‹ä»¶å‘ç”Ÿå, è°ƒç”¨äº†å¯¹åº”çš„å‡½æ•°, æœ¬æ¥è¿™åº”è¯¥æ˜¯ä¸ªè™šå‡½æ•°<br>ä½†æˆ‘ä»¬è¦†å†™äº†å®ƒ, è¢«ç‚¹å‡»å, ä¼šå°†æŒ‰é’®ä¸Šçš„ä¿¡æ¯(Label)è®¾ç½®ä¸º <code>Hello World!</code></p><p>clickedè¿™ä¸ªäº‹æƒ…å‘ç”Ÿå, æœ¬æ¥å°±èƒ½å•¥ä¹Ÿä¸åš, å› æ­¤å³ä½¿ä½ ä¸è°ƒç”¨connect_clicked, ä¹Ÿä¸ä¼šå‡ºç°è­¦å‘Š</p><p>ç„¶å, æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>Builder Pattern</code> æ„é€ çª—å£æ—¶, è°ƒç”¨child, å°†è¯¥æŒ‰é’®çš„å¼•ç”¨ä¼ å…¥, è®©æŒ‰é’®ä¹Ÿå‡ºç°åœ¨çª—å£ä¸­<br>æ³¨æ„: è¿™é‡Œä¼šä½¿å¾—æŒ‰é’®çš„å¼ºå¼•ç”¨æ•°é‡+1, å› ä¸ºButtonæ˜¯GObjectçš„å­ç±», è€ŒGObjectå…·æœ‰å¼•ç”¨è®¡æ•°çš„ç‰¹ç‚¹, ä¸‹èŠ‚ä¼šè®²</p><hr><h1 id="bu-chong">è¡¥å……</h1><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®é—´è·:<br>è¿è¡Œå…ˆå‰çš„ä»£ç , ä½ ä¼šå‘ç°æŒ‰é’®å æ»¡äº†æ•´ä¸ªçª—å£<br>æˆ‘ä»¬å¯ä»¥åœ¨é“¾å¼æ„é€ ä¸€ä¸ªæŒ‰é’®æ—¶, é¡ºå¸¦ç€è®¾ç½®å®ƒä¸å››å‘¨çš„é—´è·, ä»£ç å¾ˆç®€å•, å¦‚ä¸‹:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = Button::builder()</span><br><span class="line">    .label(<span class="string">&quot;Press me!&quot;</span>)</span><br><span class="line">    .margin_top(<span class="number">12</span>)</span><br><span class="line">    .margin_bottom(<span class="number">12</span>)</span><br><span class="line">    .margin_start(<span class="number">12</span>)</span><br><span class="line">    .margin_end(<span class="number">12</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€æ˜è®¾ç½®:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">    .application(app)</span><br><span class="line">    .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">    .opacity(<span class="number">0.8</span>)         <span class="comment">// çª—å£ä¸é€æ˜åº¦, è¶Šä½è¶Šé€æ˜, è¶Šé«˜è¶Šä¸é€æ˜</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤é«˜å®½:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">    .application(app)</span><br><span class="line">    .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">    .default_height(<span class="number">100</span>)</span><br><span class="line">    .default_width(<span class="number">200</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure><p>è‡³æ­¤, æœ¬å°èŠ‚ç»“æŸ, åˆè¦æ„‰å¿«åœ°é¸½é¸½é¸½äº†å‘¢ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä½¿ç”¨Gtk, åˆ›å»ºä¸€ä¸ªçª—å£, äº†è§£ä¸‹å¤§è‡´çš„æ¡†æ¶, ä½œä¸ºæ—…é€”çš„èµ·ç‚¹å§&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="GUI" scheme="https://jedsek.xyz/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>rust-gtk4-p1: ç³»åˆ—è¯´æ˜</title>
    <link href="https://jedsek.xyz/posts/rust-gtk4/p1"/>
    <id>https://jedsek.xyz/posts/rust-gtk4/p1</id>
    <published>2021-10-23T12:18:17.000Z</published>
    <updated>2021-10-23T12:18:17.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ gkt-rs ç³»åˆ—</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gtk4">rust-gtk4</a><br>GNOMEå…¥å‘æŒ‡å—: <a href="/posts/gnome/guide">gnome-guide</a></p><h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1><p><a href="https://www.gtk.org/">Gtk</a>, æ˜¯ä¸€ä¸ªè‘—åçš„GUIåº“, æ˜¯ GNOME é¡¹ç›®çš„å…³é”®ç»„æˆ, ç”±äºæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™, å„ç±»è¯­è¨€éƒ½èƒ½ä½¿ç”¨å®ƒå¼€å‘GUIç¨‹åº</p><p>Rustè¯­è¨€è‡ªæ˜¯å…¶ä¸­ä¹‹ä¸€, å…·æœ‰ç›¸å…³çš„ç»‘å®šåº“: <a href="https://gtk-rs.org/">gtk-rs</a> (gtkå®˜æ–¹ç½‘é¡µæ‰€æŒ‡å®š)<br>åŒæ—¶, éå¸¸å»ºè®®ä½ ä½¿ç”¨Linuxä½œä¸ºå¼€å‘ç¯å¢ƒ, Gtkå¯ä»¥è¯´æ˜¯Linuxå¹³å°ä¸‹å¼€å‘GUIç¨‹åºçš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€äº†</p><p>ä¸å®šæœŸæ›´æ–°, æ¯•ç«Ÿæˆ‘åªæœ‰å‘¨æœ«æ‰èƒ½ç¢°åˆ°ç”µè„‘<br><s>(è€Œä¸”, ç©ºæ´éª‘å£«, CSGO, è€æ»š5, å·«å¸ˆ3, äººç±»ä¸€è´¥æ¶‚åœ°å®ƒä»¬ä¸é¦™å—?)</s></p><hr><h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1><p>èµ„æ–™æ­£åœ¨æŒç»­æ›´æ–°ing. . .</p><ol><li class="lvl-3"><p>ä¹¦ç±(å®˜æ–¹åœ£ç», è´¨é‡æ æ†çš„)</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://gtk-rs.org/gtk4-rs/stable/latest/book/">GUI development with Rust and GTK 4</a></p></li></ul><ol start="2"><li class="lvl-3"><p>åšå®¢/æ–‡æ¡£</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://turbomack.github.io/posts/2019-07-28-rust-vs-gui.html">Rust Vs GUI</a></p></li><li class="lvl-2"><p><a href="https://gi.readthedocs.io/en/latest/#gobject-introspection">GObject Introspection</a></p></li><li class="lvl-2"><p><a href="https://developer.gnome.org/documentation/tutorials.html">GNOME Developer Doc/Tutorials</a></p></li></ul><hr><h1 id="huan-jing-pei-zhi">ç¯å¢ƒé…ç½®</h1><p>é¦–å…ˆè¯·å‚ç…§ <a href="https://www.gtk.org/docs/installations/">GTKå®˜æ–¹é¡µé¢</a> , ä¸‹è½½ GTK4, ä¸‹é¢æ˜¯æˆ‘ä¸ºäº†æ–¹ä¾¿è¯»è€…, å¤åˆ¶ç²˜è´´è¿‡æ¥çš„:</p><ul class="lvl-0"><li class="lvl-2"><p>Fedora, åŠå…¶è¡ç”Ÿ:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dnf install gtk4-devel gcc</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Debian, åŠå…¶è¡ç”Ÿ:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install libgtk-4-dev build-essential</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Arch, åŠå…¶è¡ç”Ÿ:</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S gtk4 base-devel</span><br></pre></td></tr></table></figure><p>Windowsç³»ç»Ÿä¸‹, å»ºè®®ä½¿ç”¨WSL2, åœ¨Linuxç¯å¢ƒä¸‹å¼€å‘, äº²æµ‹å¯ä»¥åšGUI, è™½ç„¶ç›®å‰è¿˜æœ‰è­¦å‘Š <s>(æ— è§†å³å¯)</s><br>æ¯”å¦‚, ä½¿ç”¨ Arch ä½œä¸º WSL2, é‚£ä¹ˆå¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•, ç›´æ¥å®‰è£…å³å¯</p><p>è¯·è‡ªå·±æŸ¥æ‰¾èµ„æ–™, å–„ç”¨æœç´¢å¼•æ“ä¸å®˜æ–¹æ–‡æ¡£, é…ç½®Gtk</p><hr><h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1><p>å‘ç°é”™è¯¯çš„è¯, è¯·åŠæ—¶è·Ÿæˆ‘è”ç³», æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p><p>æœ€å, è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ gkt-rs ç³»åˆ—&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="GUI" scheme="https://jedsek.xyz/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>rust-dm-p5: å«ç”Ÿæ€§</title>
    <link href="https://jedsek.xyz/posts/rust-decl-macro/p5"/>
    <id>https://jedsek.xyz/posts/rust-decl-macro/p5</id>
    <published>2021-10-16T06:04:12.000Z</published>
    <updated>2021-10-16T06:04:12.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬èŠ‚å°†ä»‹ç»å®çš„ å«ç”Ÿæ€§(hygienic)</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨:</p><ul class="lvl-0"><li class="lvl-2"><p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p></li><li class="lvl-2"><p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p></li></ul><h1 id="kai-pian">å¼€ç¯‡</h1><p>ä»€ä¹ˆæ˜¯ å«ç”Ÿæ€§(Hygienic) å‘¢?<br>ç®€å•æ¥è¯´,å°±æ˜¯æ ‡è¯†ç¬¦(ident)åœ¨å®çš„å¤„ç†ä¸å±•å¼€æ—¶,æ˜¯æ— æ­§ä¹‰çš„,ä¸è¢«åŒåæ ‡è¯†ç¬¦æ±¡æŸ“<br>å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦æ­¤æ¦‚å¿µ, æˆ‘ä¸ä¿¡ä½ ä¸ä¼šæ‡µé€¼<br>ä¸è¿‡å®é™…ä¸Š, è¿™ä¸ªæ¦‚å¿µç†è§£èµ·æ¥ä¸ç®—å›°éš¾</p><p>è®©æˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸ªé—®é¢˜, è¯·çœ‹ä¸‹é¢çš„ä»£ç :</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> create_var &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    create_var!();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥å¤åˆ¶è¯¥æ®µä»£ç , ç„¶åè¿è¡Œ, å°†å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯, æç¤ºæ‰¾ä¸åˆ°a</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ¬èŠ‚å°†ä»‹ç»å®çš„ å«ç”Ÿæ€§(hygienic)&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Macro" scheme="https://jedsek.xyz/tags/Macro/"/>
    
  </entry>
  
  <entry>
    <title>rust-dm-p4: é‡å¤</title>
    <link href="https://jedsek.xyz/posts/rust-decl-macro/p4"/>
    <id>https://jedsek.xyz/posts/rust-decl-macro/p4</id>
    <published>2021-10-09T14:36:00.000Z</published>
    <updated>2021-10-09T14:36:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å®ä¸­éå¸¸é‡è¦çš„è¯­æ³•: é‡å¤(repetition)</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨:</p><ul class="lvl-0"><li class="lvl-2"><p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p></li><li class="lvl-2"><p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p></li></ul><h1 id="jie-shao">ä»‹ç»</h1><p><code>é‡å¤ (Repetition)</code> æ˜¯å®ä¸­æ— æ¯”é‡è¦çš„æ ¸å¿ƒçº§è¯­æ³•, æƒ³å‘æŒ¥å®çš„å¼ºå¤§å°±å¿…é¡»ç”¨åˆ°å®ƒ</p><p>è¯¥è¯­æ³•, å¯ä»¥é‡å¤ä¸€æ®µæ¨¡å¼(ä¸€äº›Token), å‡ºç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹:</p><ul class="lvl-0"><li class="lvl-2"><p>Matcher: å°†ä¸€æ®µæŒ‡å®šçš„æ¨¡å¼, é‡å¤åœ°åŒ¹é…ä¸æ•è·</p></li><li class="lvl-2"><p>Transcriber: å°†ä¸€æ®µæŒ‡å®šçš„æ¨¡å¼, é‡å¤åœ°å±•å¼€</p></li></ul><p><s>(åºŸè¯, Rustçš„å£°æ˜å®ä¸å°±è¿™ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†å˜›)</s></p><p>å‡è®¾ä½ è¦è®¾è®¡ä¸€ä¸ªå®, è¿›è¡Œæ±‚å’Œ(å‚æ•°ä¸ªæ•°ä¸ç¡®å®š):</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Examples:</span></span><br><span class="line"><span class="built_in">assert_eq!</span>( <span class="number">0</span>,  sum!() );</span><br><span class="line"><span class="built_in">assert_eq!</span>( <span class="number">15</span>, sum!(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>) );</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹, å¦‚ä½•ä½¿ç”¨é‡å¤å§</p><h1 id="yu-fa">è¯­æ³•</h1><p>å…³é”®åœ¨äºå‚æ•°çš„ä¸ªæ•°ä¸ç¡®å®š, å› æ­¤æˆ‘ä»¬åº”ä½¿ç”¨é‡å¤è¯­æ³•:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> sum &#123;</span><br><span class="line">    ($($a:expr),*) =&gt; &#123;</span><br><span class="line">        <span class="number">0</span> $(+ $a)*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    sum!();          <span class="comment">// 0</span></span><br><span class="line">    sum!(<span class="number">5</span>);         <span class="comment">// 5</span></span><br><span class="line">    sum!(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>); <span class="comment">// 15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ªä»£ç è¡¨ç¤º:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">$( Pattern )   Sep    RepOp</span><br><span class="line">$(   æ¨¡å¼   )  åˆ†éš”ç¬¦  é‡å¤ç¬¦å·</span><br></pre></td></tr></table></figure><p>å®ƒå¯ä»¥è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p><ul class="lvl-0"><li class="lvl-2"><p>æ¨¡å¼(Pattern):<br>è¢«åŒ…è£¹äº <code>$( )</code>, ç”¨äºåŒ¹é…æ•è·(åœ¨Matcher), æˆ–é‡å¤å±•å¼€(åœ¨Transcriber)</p></li><li class="lvl-2"><p>åˆ†éš”ç¬¦(Separator):<br>ç”¨æ¥åˆ†å‰²é‡å¤çš„æ¨¡å¼, æ¯”å¦‚ <code>vec![1,2,3]</code> ä¸­çš„é€—å·</p></li><li class="lvl-2"><p>é‡å¤ç¬¦å·(Repetition Operator):<br>å¯¹æ¨¡å¼åŒ¹é…æ¬¡æ•°, è¿›è¡Œè¯´æ˜é™åˆ¶, ä¸ç¬¦åˆå°±ç¼–è¯‘æŠ¥é”™</p></li></ul><p>ä»¥ <code>sum!</code> ä¸ºä¾‹å­<br>å®ƒåœ¨ç¬¬äºŒä¸ªruleä¸­ç”¨åˆ°äº†é‡å¤:</p><ul class="lvl-0"><li class="lvl-2"><p>In Matcher:<br>æ¨¡å¼: <code>$a:expr</code> æ˜¯é‡å¤çš„æ¨¡å¼, è¡¨ç¤ºé‡å¤åœ°åŒ¹é…ä¸æ•è·expr<br>åˆ†å‰²: æ¯ä¸ªæ¨¡å¼ä¹‹é—´ç”¨é€—å·åˆ†å‰², è¡¨ç¤ºä¼ å‚æ—¶è¦ä¼ å…¥é€—å·è¿›è¡ŒåŒ¹é…<br>æ¬¡æ•°: *å·, è¯´æ˜äº†é‡å¤æ¨¡å¼çš„ä¸ªæ•°, å®ƒè¢«é™åˆ¶ä¸º&gt;=0</p></li><li class="lvl-2"><p>In Transcriber:<br>æ¨¡å¼: <code>+ $a</code> æ˜¯é‡å¤æ¨¡å¼, æ¯”å¦‚ä¼ å…¥ <code>1,2,3,4,5</code> æ—¶, ä¼šè¢«å±•å¼€ä¸º <code>0+1+2+3+4+5</code><br>åˆ†å‰²: æ²¡æ·»åŠ åˆ†å‰²ç¬¦å·, è¡¨ç¤ºå±•å¼€æ—¶, æ¯ä¸ªæ¨¡å¼ä¹‹é—´ä¸ä¼šæ·»åŠ sep<br>æ¬¡æ•°: åŒ Matcher</p></li></ul><p><code>$()</code> ä¸ <code>RepOp</code> æ˜¯å¿…å¡«çš„, <code>Sep</code> æ˜¯å¯é€‰çš„</p><p>RepOp æœ‰ä¸‰ç§å¯é€‰é¡¹, æœ‰ç‚¹åƒæ­£åˆ™:</p><ul class="lvl-0"><li class="lvl-2"><p><code>*</code> è¡¨ç¤º æ¨¡å¼åŒ¹é…çš„æ¬¡æ•° &gt;= 0<br>è®°å¿†æ³•-&gt; è¯¥ç¬¦å·çœ‹ä¸Šå»åƒæ˜¯ä¸€ä¸ªç‚¹, è”æƒ³ä¸º0</p></li><li class="lvl-2"><p><code>+</code> è¡¨ç¤º æ¨¡å¼åŒ¹é…çš„æ¬¡æ•° &gt;= 1<br>è®°å¿†æ³•-&gt; è”æƒ³ä¸ºæ­£æ•°, é‚£å°±&gt;=1</p></li><li class="lvl-2"><p><code>?</code> è¡¨ç¤º æ¨¡å¼åŒ¹é…çš„æ¬¡æ•° = 0 or 1<br>è®°å¿†æ³•-&gt; é—®å·è¡¨ç¤ºç–‘é—®, ä»£è¡¨ æœ‰ or æ²¡æœ‰</p></li></ul><p>æœ‰ä¸€äº›æ³¨æ„ç‚¹:</p><ol><li class="lvl-3"><p>å½“ RepOp ä¸º ? æ—¶, ä¸å¯ä»¥æ·»åŠ  Sep(å› ä¸ºæœ€å¤šä¹Ÿå°±åŒ¹é…åˆ°ä¸€æ¬¡, ä½ æ€ä¹ˆåˆ†å‰²?)</p></li><li class="lvl-3"><p>Sep æ˜¯æœ‰é™åˆ¶çš„, <a href="/posts/rust-decl-macro/p3#qi-yi-xian-zhi">p3#æ­§ä¹‰é™åˆ¶</a> æåˆ°è¿‡, è¯¦æƒ…å¯è§ <a href="https://doc.rust-lang.org/stable/reference/macros-by-example.html#follow-set-ambiguity-restrictions">rust-reference</a></p></li></ol><p>ä»¥åæƒ³åˆ°äº†å†è¡¥å……ä¸€äº›ä¸œè¥¿, å…ˆåˆ°è¿™é‡Œå§, è°¢è°¢æ‚¨çš„è§‚çœ‹</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å®ä¸­éå¸¸é‡è¦çš„è¯­æ³•: é‡å¤(repetition)&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Macro" scheme="https://jedsek.xyz/tags/Macro/"/>
    
  </entry>
  
  <entry>
    <title>rust-dm-p3: å£°æ˜ä¸ä½¿ç”¨</title>
    <link href="https://jedsek.xyz/posts/rust-decl-macro/p3"/>
    <id>https://jedsek.xyz/posts/rust-decl-macro/p3</id>
    <published>2021-09-20T12:06:15.000Z</published>
    <updated>2021-09-20T12:06:15.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ­£å¼ç³»ç»Ÿçš„å…³äº macro çš„ å£°æ˜ä¸ä½¿ç”¨</p></blockquote><span id="more"></span>  <p>åŒç³»åˆ—ä¼ é€é—¨:</p><ul class="lvl-0"><li class="lvl-2"><p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p></li><li class="lvl-2"><p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p></li></ul><h1 id="kuang-jia-jian-li">æ¡†æ¶å»ºç«‹</h1><p>å‰ä¸€èŠ‚,æˆ‘ä»¬å¤§æ¦‚æ¸…æ¥šäº†macroçš„ç»“æ„<br>ç°åœ¨è®©æˆ‘ä»¬å†æ¥ç®€å•å¤ä¹ ä¸€é:</p><ol><li class="lvl-3"><p><code>macro_rules!(è¿™æ˜¯ç‰¹ç‚¹è¯­æ³•)</code>æ¥åˆ›å»ºä¸€ä¸ªmacro</p></li><li class="lvl-3"><p><code>rule(s)(åŒ¹é…åˆ†æ”¯,ä»¥ &quot;å‚æ•°=&gt;å±•å¼€ä»£ç &quot; çš„å½¢å¼)</code>æ”¾åœ¨æœ€å¤–å±‚çš„èŠ±æ‹¬å·å†…</p></li><li class="lvl-3"><p>è°ƒç”¨å®æ—¶,å®å+æ„Ÿå¹å·+æ‹¬å·å†…ä¼ å‚,æ¯”å¦‚: <code>println!(some_str)</code></p></li></ol><p>ç°åœ¨ç¨å¾®æ·±å…¥ä¸€ç‚¹:<br>ä¸€ä¸ª <code>rule</code> å¯ä»¥è¢«è¿™æ ·æŠ½è±¡åœ°è¡¨ç¤º: (matcher)=&gt;(transcriber)<br>å®ƒç”±ä¸‰ä¸ªé‡è¦çš„éƒ¨åˆ†ç»„æˆ:</p><ul class="lvl-0"><li class="lvl-2"><p><code>matcher (åŒ¹é…å™¨)</code>:<br>ç”¨æ¥åŒ¹é…ä¼ å…¥çš„å‚æ•°</p></li><li class="lvl-2"><p><code>metavariable/literal (å…ƒå˜é‡/å­—é¢é‡)</code>:<br>ç»‘å®šä¼ å…¥çš„ä»£ç ç‰‡æ®µ,å‡ºç°äº <code>matcher</code></p></li><li class="lvl-2"><p><code>transcriber (è½¬å½•å™¨)</code>:<br>ç”¨æ¥åœ¨å®åŒ¹é…æˆåŠŸå,è¿›è¡Œä»£ç æ›¿æ¢</p></li></ul><p>ä»¥<code>println!</code>ä¸ºä¾‹å­,æˆ‘ä»¬å‘å…¶ä¼ å…¥äº†ä¸€äº›å‚æ•°,å®ƒç»™æˆ‘ä»¬æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸Š<br>å› ä¸ºåŸæœ¬çš„<code>println!</code>æ¶‰åŠåˆ°<code>å«ç”Ÿæ€§</code>,<code>é‡å¤è¯­æ³•</code>,<code>è·¯å¾„ä½œç”¨åŸŸ</code>ç­‰,ä¸é€‚åˆæ–°é¸Ÿé˜…è¯»,æ‰€ä»¥æˆ‘æŠ½è±¡äº†å®ƒ:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    (<span class="comment">/* ç©ºå‚åŒ¹é… */</span>) =&gt; (<span class="comment">/* `æ¢è¡Œ` çš„ä»£ç  */</span>);</span><br><span class="line">    (<span class="comment">/* æœ‰å‚åŒ¹é… */</span>) =&gt; (<span class="comment">/* `æ‰“å°å‚æ•° + æ¢è¡Œ` çš„ä»£ç  */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>println</code>ç”±ä¸¤ä¸ª<code>rule</code>ç»„æˆ,æ¯ä¸ªçš„å½¢å¼éƒ½æ˜¯: <code>matcher=&gt;transcriber</code><br>ä»ä¸Šå¾€ä¸‹,æ¯ä¸ªruleçš„<code>matcher</code>ä¼šä¸ä¼ å…¥å‚æ•°å°è¯•åŒ¹é…<br>åŒ¹é…æ—¶, æ‹¬å·å…·æœ‰å¤šæ ·æ€§, è¯·çœ‹ä¸‹é¢</p><ol><li class="lvl-3"><p>åŒ¹é…è§„åˆ™:</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p>åŒ¹é…åˆ°: å°±æ›¿æ¢ä¸º<code>transcriber</code>é‡Œé¢çš„ä»£ç </p></li><li class="lvl-2"><p>åŒ¹é…ä¸åˆ°: æ‰€æœ‰<code>matcher</code>éƒ½æ— æ³•ä¸<code>ä¼ å…¥å‚æ•°</code>è¿›è¡ŒåŒ¹é…,åˆ™ç¼–è¯‘æŠ¥é”™</p></li></ul><ol start="2"><li class="lvl-3"><p>æ‹¬å·å¤šæ ·æ€§:</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p>æ¦‚å¿µ: <code>matcher</code>ä¸<code>transcriber</code>çš„æ‹¬å·,å¯ä»¥æ˜¯(),[],{}ä¸‰ç§ä¹‹ä¸€</p></li><li class="lvl-2"><p>å®šä¹‰æ—¶: æ¯”å¦‚, ruleå¯å†™æˆ <code>[pattern]=&gt;&#123;expansion&#125;</code></p></li><li class="lvl-2"><p>è°ƒç”¨æ—¶: ä¸€æ ·éµä»è¯¥è§„åˆ™, æ¯”å¦‚ <code>vec![0, 1,2,3]</code> ä¸ <code>pritnln!(&quot;xx&quot;)</code></p></li></ul><p>è€Œ<code>metavariable/literal</code>åˆ™å‡ºç°åœ¨<code>matcher</code>ä¸­,ç”¨äºåŒ¹é…å¹¶æ•è·ä»£ç ç‰‡æ®µ<br>åœ¨å¯¹åº”çš„<code>transcriber</code>ä¸­,åˆ™å¯ä»¥æ“æ§è¿™äº›<code>å…ƒå€¼</code>,å³æ“æ§æ•è·åˆ°çš„ä»£ç ç‰‡æ®µ</p><p>ç¨å¾®æœ‰ç‚¹è’™? æˆ‘ä¹Ÿæ²¡è®©ä½ èƒŒå“Ÿ, å¤šçœ‹å¤šç”¨å°±ä¼šäº†</p><hr><h1 id="liang-chong-hong-can-shu">ä¸¤ç§å®å‚æ•°</h1><p>æ˜¯æ—¶å€™å¼•å…¥ä¸€äº›æ–°çš„ä¸œè¥¿äº†, é¡ºä¾¿åŠ æ·±ä¸‹ä½ çš„å°è±¡</p><h2 id="yuan-bian-liang" id="å…ƒå˜é‡">å…ƒå˜é‡</h2><p>å…ƒå˜é‡, å³Metavariable<br>è®©æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> my_macro &#123;</span><br><span class="line">    ($a: expr) =&gt; &#123;</span><br><span class="line">        $a</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ($a: expr, $b: expr) =&gt; &#123;</span><br><span class="line">        $a + $b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    my_macro!(<span class="number">1</span>);</span><br><span class="line">    my_macro!(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å®å…¨éƒ¨å±•å¼€å, å¯ä»¥ç†è§£ä¸ºä¸‹é¢: </span></span><br><span class="line"><span class="comment">fn main() &#123;</span></span><br><span class="line"><span class="comment">    1;</span></span><br><span class="line"><span class="comment">    1 + 2;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ä½ ä¼šæ³¨æ„åˆ°,æ¯ä¸ªruleä¹‹é—´çš„å‚æ•°, å…¶å£°æ˜éƒ½æœ‰ç‚¹å¥‡æ€ª:<br>æ¯”å¦‚: <code>$a:expr</code> -&gt; <code>$+å‚æ•°æ ‡è¯†ç¬¦+ç±»å‹</code></p><ol><li class="lvl-3"><p><code>$</code> è¿™ä¸ªå‰ç¼€æ˜¯å¹²å˜›çš„?<br>è¿™æ˜¾å¼è¯´æ˜, å®ƒæ˜¯ <code>metavariable</code>, å¯ä»¥åŒ¹é…å¹¶æ•è·ä»£ç ç‰‡æ®µ, è¿™é‡Œä¼šæ•è·è¡¨è¾¾å¼<br>è‡³äºä¸ºä½•è¦ç‰¹æ„åŠ $å‰ç¼€æ¥è¯´æ˜, åƒå‡½æ•°å‚æ•°é‚£æ ·ç›´æ¥ç”¨ä¸è¡Œå—?<br>ä¸‹é¢å°±è¦è®²åˆ°å•¦, åˆ«ç€æ€¥~</p></li><li class="lvl-3"><p>å…ˆçœ‹çœ‹ <code>expr</code> ç±»å‹:<br><code>expr</code>, å…¨ç§°ä¸º <code>expression(è¡¨è¾¾å¼)</code><br>ç¬¬ä¸€æ¬¡å®è°ƒç”¨æ—¶, ä¼ å…¥äº† <code>1(ä¸€ä¸ªå­—é¢é‡)</code>, è¿™å½“ç„¶æ˜¯ä¸ªexpr, ä¸ç¬¬ä¸€ä¸ªruleæˆåŠŸåŒ¹é…<br>è¿™æ—¶, <code>my_macro!(1)</code> è¿™ä¸ªéƒ¨åˆ†, å°±ä¼šè¢«æ›¿æ¢ä¸ºç›¸åº”çš„å±•å¼€ä»£ç `<br>(matcher(åŒ¹é…å™¨),metavariable(å…ƒå˜é‡),transcriber(è½¬å½•å™¨)éƒ½ç”¨åˆ°äº†å‘¢)</p></li></ol><p>ç®€å•æ¥è®², macroçš„æœ¬è´¨, å°±æ˜¯åŒ¹é…æ•è·ä¼ å…¥å‚æ•°, å°†è°ƒç”¨éƒ¨åˆ†æ›¿æ¢/å±•å¼€ä¸ºç›¸åº”ä»£ç <br>macroå°±åƒä¸ªcode generator: ä¸€æ®µç”¨æ¥ç”Ÿæˆcodeçš„code</p><p>æ³¨æ„:<br>macroå®é™…ä¸Š, æ˜¯å°†ä¼ å…¥éƒ¨åˆ†è§£æä¸ºä¸€ä¸ªASTèŠ‚ç‚¹<br>ç„¶åå°†è°ƒç”¨éƒ¨åˆ†, æ›¿æ¢ä¸ºä¸€ä¸ªæ–°çš„ASTèŠ‚ç‚¹<br>åœ¨æœ¬èŠ‚ä¸‹é¢, ä¼šæ›´è¯¦ç»†åœ°è®²è®²</p><h2 id="yuan-zi-mian-liang" id="å…ƒå­—é¢é‡">å…ƒå­—é¢é‡</h2><p>å…ƒå­—é¢é‡, å³Metaliteral<br>ä¸ºäº†åŠ æ·±å°è±¡ä¸å¼•å‡º <code>metaliteral</code> , æˆ‘ä»¬æ¥ç©ä¸ªå¯¹åº”æ¸¸æˆ:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">($a: expr) =&gt; &#123;$a&#125;;                     <span class="comment">// the first rule</span></span><br><span class="line">  |             |  </span><br><span class="line">  |         |</span><br><span class="line">( <span class="number">1</span>      )      <span class="number">1</span>                       <span class="comment">// pass &amp;&amp; expand </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">($a: expr, $b: expr) =&gt; &#123; $a + $b&#125;;    <span class="comment">// the second rule</span></span><br><span class="line">  |      |  |              |    |</span><br><span class="line">  |      |  |              |    |</span><br><span class="line">( <span class="number">1</span>      ,  <span class="number">2</span>      ) =&gt;    <span class="number">1</span> +  <span class="number">2</span>      <span class="comment">// pass &amp;&amp; expand</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä½¿ç”¨ <code>|</code> æ¥è”ç³» <code>å½¢å‚ -- å®å‚</code><br>ä½ ä¼šæƒŠè®¶çš„å‘ç°, ä¼ å‚æ—¶çš„å¯¹åº”å…³ç³»ä»¬, é™¤äº† <code>$a -- 1</code> ä¸ <code>$b -- 2</code>, è¿˜æœ‰ä¸ª <code>, -- ,</code></p><p>å¯¹äºç¬¬äºŒä¸ªrule, å®ƒçš„å®šä¹‰ä¸­, åˆ†å‰²ä¸¤ä¸ªexprçš„é€—å·æœ¬èº«, ä¹Ÿæ˜¯å½¢å‚<br>è¿™ç§å›ºå®šçš„å‚æ•°, å¦‚åŒtokenä¸­çš„å­—é¢é‡ä¸€æ ·<br>æˆ‘å§‘ä¸”ç§°å®ƒä¸º <code>Literal Token(å­—é¢é‡æ ‡è®°)</code>, æˆ–è€… <code>Metaliteral (å…ƒå­—é¢é‡)</code><br>(å› ä¸ºæˆ‘ä¹Ÿä¸çŸ¥é“æœ‰ä»€ä¹ˆå¯¹åº”æœ¯è¯­, æ‰€ä»¥ç”¨äº† â€œå§‘ä¸”â€, çŸ¥é“çš„éº»çƒ¦å‘Šè¯‰æˆ‘)</p><p>å‡è‹¥ rule ä¸­çš„å‚æ•°æ²¡æœ‰ $å‰ç¼€ è¿›è¡ŒåŒºåˆ†:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> fuck &#123;</span><br><span class="line">    (a:expr) =&gt; &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    fuck!(<span class="number">1</span>);       <span class="comment">// No</span></span><br><span class="line">    fuck!(a:expr);  <span class="comment">// Yes ~~(Oh~)~~</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå®šä¹‰ä¸­çš„ â€œa:exprâ€(å®ƒæ˜¯ <code>MetaLiteral</code>)<br>ä¼ å…¥å›ºå®šå½¢å¼çš„ â€œa:exprâ€ æ—¶æ‰å¯å‘ç”ŸåŒ¹é…</p><p>åˆ‡è®°:<br>å½“ä½ æƒ³ç»‘å®šä¸€æ®µä»£ç ç‰‡æ®µ,å‚æ•°åå‰,å¿…é¡»åŠ ä¸Š$è¿›è¡Œå‰ç¼€ä¿®é¥°</p><h2 id="li-zi" id="ä¾‹å­">ä¾‹å­</h2><p>å‡è®¾æœ‰è¿™ä¹ˆä¸ªå® <code>map!</code>(è”æƒ³ä¸€ä¸‹<code>vec!</code>)<br>å®ƒèƒ½æ ¹æ® <code>=&gt;</code> åˆ¤æ–­å‡º <code>Key/Value</code>, ç„¶åç”Ÿæˆä¸€ä¸ª <code>HashMap</code><br>å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> m = map![</span><br><span class="line">        <span class="string">&quot;å‰è‰¯å‰å½±&quot;</span> =&gt; <span class="number">33</span>,</span><br><span class="line">        <span class="string">&quot;ç©ºæ¡æ‰¿å¤ªéƒ&quot;</span> =&gt; <span class="number">41</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">// `m` çš„ç±»å‹ä¸º: std::collections::HashMap&lt;&amp;str, i32&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªè¿™æ ·çš„å®å§!<br>ä¸è¿‡æˆ‘ä»¬è¿˜æœªå­¦ä¹  <code>é‡å¤è¯­æ³•</code>, æ— æ³•å†™å‡ºæ¥æ”¶å¯å˜å‚æ•°çš„ <code>map!</code>, æ‰€ä»¥ç°åœ¨åªè®¨è®ºç®€é™‹ç‰ˆ:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> map &#123;</span><br><span class="line">    ($key:expr =&gt; $val:expr) =&gt; &#123;&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> m = std::collections::HashMap::&lt;_,_&gt;::new();</span><br><span class="line">        m.insert($key, $val);</span><br><span class="line">        m</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> m = map!(<span class="string">&quot;æ™®é€šä¸Šç­æ—&quot;</span> =&gt; <span class="number">33</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å±•å¼€å, å¯ä»¥çœ‹ä½œæ˜¯:</span></span><br><span class="line"><span class="comment">fn main() &#123;</span></span><br><span class="line"><span class="comment">    let m = &#123;</span></span><br><span class="line"><span class="comment">        let mut m = std::collections::HashMap::&lt;_,_&gt;::new();</span></span><br><span class="line"><span class="comment">        m.insert(&quot;æ™®é€šä¸Šç­æ—&quot;, 33);</span></span><br><span class="line"><span class="comment">        m</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    println!(&quot;&#123;:?&#125;&quot;,m);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ä¸€ä¸ªç®€é™‹çš„DSL, ä½ å®šä¹‰äº†åˆ›å»ºHashMapçš„æ–°è¯­æ³•: <code>Key=&gt;Value</code><br>æ¥çœ‹çœ‹ä¸¤ç§å®å‚æ•°åœ¨å®ä¸­, å‘æŒ¥ç€æ€æ ·çš„ä½œç”¨:</p><ul class="lvl-0"><li class="lvl-2"><p><code>Metavariable</code>: å°†æ•è·çš„ä¼ å…¥çš„ä»£ç ç‰‡æ®µç»‘å®šåˆ°è‡ªèº«<br>å¹¶åœ¨ <code>Transcriber</code> ä¸­è¢«ä½¿ç”¨, æœ€åå±•å¼€ä¸ºæ–°ä»£ç </p></li><li class="lvl-2"><p><code>Metaliteral </code>: é™å®šäº†åŒ¹é…, ä¼ å…¥çš„ä»£ç ç‰‡æ®µ, å¿…é¡»ä»¥ =&gt; åˆ†å‰², æ‰èƒ½æˆåŠŸåŒ¹é…è‹¥æ”¹æˆ <code>map!(&quot;æ™®é€šä¸Šç­æ—&quot;, 33)</code>, åˆ™æ¯ä¸ªruleçš„ <code>Matcher</code> éƒ½æ— æ³•åŒ¹é…ä¸Š<br>(è¿™é‡Œåªæœ‰ä¸€ä¸ªrule, ç©ºåŒ¹é…çš„æ‡’å¾—æ”¾é‡Œé¢äº†)</p></li></ul><p>å…¶å®è¯´äº†è¿™ä¹ˆå¤š, ç®€å•è®²å°±æ˜¯ä¸€ä¸ªå¯¹åº”æ¸¸æˆ, å¯¹åº”ä¸Šçš„è¯, å°±ä¼šæ›¿æ¢ä¸ºä¸€äº›ä»£ç <br>è€ƒè™‘çš„äº‹: åŒ¹é…çš„è¯­æ³•ç¾ä¸ç¾è§‚, ç®€ä¸ç®€å•, ç„¶åå°†å¤æ‚çš„ä»£ç éšè—, å°±è¿™æ ·è€Œå·²<br>ä¹‹åä¼šè€ƒè™‘è®²å‡ ä¸ªå°ä¾‹å­: æ¯”å¦‚æˆ‘åœ¨Bç«™ä¸Šå·²ç»å½•è¿‡çš„é€’æ¨åºåˆ—ç”Ÿæˆå™¨æ•™ç¨‹, æºè‡ªå®å°å†Œ<br>(åšå®¢çš„è¯, æˆ‘å‘¨å…­æ”¾å­¦å›æ¥æ…¢æ…¢æ›´å§â€¦)<br><s>(æ½œå°è¯æ˜¯éšæ—¶ä¼šé¸½å­)</s></p><hr><h1 id="ben-zhi">æœ¬è´¨</h1><p>macroçš„æœ¬è´¨, æ˜¯ç”Ÿæˆä¸€ä¸ªASTèŠ‚ç‚¹å¯ä»¥é…å¥—çœ‹çœ‹æˆ‘åœ¨Bç«™ä¸Šå®è§†é¢‘, è§†é¢‘è®²å¾—å¾ˆæµ…, å®¹æ˜“ç†è§£</p><p>å‡è‹¥ç”±ä½ æ¥è®¾è®¡ä¸€ä¸ªRustç¼–è¯‘å™¨<br>é¦–å…ˆ, ä¸åŒçš„äººå†™ä»£ç çš„é£æ ¼ä¸åŒ, é‚£ä¹ˆä½ å¦‚ä½•åˆ†æä¸åŒæºç , å¹¶ç”Ÿæˆç›®æ ‡ç ?</p><p>è‹¥æˆ‘ä»¬å°†æ¯éæ‰«æå¹¶åšç‚¹äº‹æƒ…çš„è¿‡ç¨‹, ç§°ä¸º<code>pass</code><br>passä¸€æ¬¡å°±ç”Ÿæˆäº†, å¯¹äºå¾ˆå¤§çš„æºç æ¥è¯´, è¿™ä¸ç°å®å§</p><p>é‚£æˆ‘ä»¬å°±passå¤šæ¬¡, å°† <code>ä»æºç ç¼–è¯‘ä¸ºç›®æ ‡ç </code> è¿™ä¸ªå¤§é—®é¢˜, åˆ†è§£ä¸ºä¸€å¤§å †å°é—®é¢˜<br>æ¯ä¸€æ¬¡passéƒ½è§£å†³ä¸€ä¸ªå°é—®é¢˜, é‚£ä¸å°±Okäº†å—</p><p>è¿™ç§ <code>ä¸­é—´è¡¨ç¤º</code>, å°±ç§°ä¸º <code>IR (Intermediate Representation )</code></p><p>æˆ‘ä»¬å¯ä»¥å…ˆæŠŠæºç æŠ½è±¡ä¸ºAST(æŠ½è±¡è¯­æ³•æ ‘, Abstract Syntax Tree)<br>é‚£æ˜¯ä¸€ç§ä»£ç è¢«æŠ½è±¡åçš„æ ‘çŠ¶ç»“æ„<br>æ¯”å¦‚æˆ‘ä»¬ç”¨Rustçš„enumè¡¨ç¤ºä¸€ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯¥æšä¸¾: ä¸€ä¸ªASTèŠ‚ç‚¹å¯ä»¥æ˜¯Intè¡¨è¾¾å¼æˆ–äºŒå…ƒè¿ç®—è¡¨è¾¾å¼  </span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ASTNode</span></span> &#123;</span><br><span class="line">    Int(<span class="built_in">i32</span>), </span><br><span class="line">    BinaryExpr &#123;</span><br><span class="line">        op: Op,</span><br><span class="line">        lhs: <span class="built_in">Box</span>&lt;ASTNode&gt;,</span><br><span class="line">        rhs: <span class="built_in">Box</span>&lt;ASTNode&gt;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒå…ƒè¿ç®—çš„ç¬¦å·: è¿™é‡ŒåªæŠ½è±¡äº†åŠ æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Op</span></span> &#123;</span><br><span class="line">    Plus, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ åªéœ€æ˜ç™½ASTæ˜¯å¯¹æºç å°è£…çš„ä¸€å±‚æŠ½è±¡äº§ç‰©å°±å¯ä»¥äº†</p><p>å¯¹äºå¾ˆå°‘çš„æºç , å·²ç»å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºç›®æ ‡ç äº†, æ¯•ç«Ÿè¿™æ—¶å€™ASTä¹Ÿå°<br>ä½†æ˜¯, å¦‚æœæºç å¾ˆå¤§å‘¢? ASTå·²ç»å¾ˆå¤æ‚äº†é‚£å°±å†æŠ½è±¡ä¸€å±‚å§, å‘ç›®æ ‡è¯­è¨€é€æ¸é æ‹¢, æ¯”å¦‚å‘æ±‡ç¼–é æ‹¢, æé«˜æ€§èƒ½</p><p>åŸºäºAST, æˆ‘ä»¬å¯ä»¥å†æ¥ä¸€äº›<code>IR</code>, å±‚å±‚é€’è¿›, ä»¥è¾¾ç›®çš„<br>æ³¨æ„,æ˜¯ä¸€äº›,è€Œä¸æ˜¯ä¸€ä¸ª,è¿™å¾ˆå¥½ç†è§£,å› ä¸ºä¸€å±‚å¯èƒ½è¿˜æ˜¯ä¸å¤Ÿå˜›</p><p><code>AST</code>å¾ˆé‡è¦, æ˜¯ç”Ÿæˆç›®æ ‡ç çš„å…³é”®, æ˜¯ä»£ç çš„éª¨æ¶<br>è€Œå¦å¤–çš„IR, ä¹Ÿæ˜¯æœ‰å¿…è¦çš„, è¿™ä¹Ÿå¢å¼ºäº†å¯ç»´æŠ¤æ€§<br>ç¼–è¯‘å™¨åœ¨ASTçš„åŸºç¡€ä¸Š, æœ€ç»ˆç”Ÿæˆäº†ç›®æ ‡ç </p><p>é—®: ç”ŸæˆASTéœ€è¦ç‚¹å•¥? æˆ–è€…è¯´, å®ƒç”±ä»€ä¹ˆç»„æˆ?<br>ç­”: ç”± expr(è¡¨è¾¾å¼), stmt(è¯­å¥), ;(æ ‡ç‚¹ç¬¦å·) ç­‰ç»„æˆ, è¿™äº›éƒ½å«åš <code>token</code></p><p>åœ¨è¿™äº›å°ç©æ„çš„åŸºç¡€ä¸Š, ç»„æˆä¸€ä¸ªæ›´åŠ åºå¤§å¤æ‚çš„æ•´ä½“ç»“æ„<br>å®ƒå°†tokenä»¬è”ç³»èµ·æ¥, è¡¨è¾¾äº†ä»£ç çš„éª¨æ¶<br>è¿™ä¸ªåºç„¶å¤§ç‰©ä¾¿æ˜¯ AST äº†</p><hr><h1 id="hui-dao-macro">å›åˆ°Macro</h1><h2 id="token-lei-xing-biao" id="Tokenç±»å‹è¡¨">Tokenç±»å‹è¡¨</h2><p>ç”ŸæˆASTéœ€è¦TokenååŠ©<br>macro ä¸­, å…¶å‚æ•°çš„ç±»å‹, ä¾¿æ˜¯tokenç±»å‹</p><p>macroè¦æ“æ§ä¼ å…¥çš„token (æˆ–ASTèŠ‚ç‚¹, ç­‰ä¼šè®²)<br>é‚£ä¹ˆæˆ‘ä»¬æ€»å¾—çŸ¥é“tokenç±»å‹å§, ä¸ç„¶æ€çŸ¥å’‹æ“æ§?</p><p>åªæœ‰è§„å®šå®å‚æ•°çš„ç±»å‹, æ‰èƒ½ä¿è¯macroè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®çš„ (è¿™é‡ŒæŒ‡ <code>Metavariable</code>)</p><p>æ‰€ä»¥, è¾›è‹¦ä½ å°†ä¸‹é¢çš„è®°ä¸€ä¸‹<br>ç¨å¾®è®°ä¸‹, æœ‰å°è±¡å³å¯, å¤šç”¨å‡ ä¸‹ä¿è¯ä½ ç†Ÿæ‚‰å¾—ä¸è¡Œ:</p><table><thead><tr><th>åç§°</th><th>å¯¹åº”</th></tr></thead><tbody><tr><td>ident</td><td>æ ‡è¯†ç¬¦, å¦‚å‡½æ•°å, å˜é‡å, å…³é”®å­—</td></tr><tr><td>expr</td><td>expression, è¡¨è¾¾å¼,å¦‚<code>x</code>ä¸<code>1_i32</code></td></tr><tr><td>literal</td><td>literal expression, å³å­—é¢é‡è¡¨è¾¾å¼, æ˜¯exprçš„å­é›†</td></tr><tr><td>pat</td><td>pattern, æ¯”å¦‚åœ¨matchè¡¨è¾¾å¼ä¸‹çš„ (pattern) =&gt; todo!()</td></tr><tr><td>path</td><td>è·¯å¾„, æ³¨æ„è¿™é‡Œä¸æŒ‡æ–‡ä»¶è·¯å¾„, è€Œæ˜¯ç±»ä¼¼ std::io::stdin çš„</td></tr><tr><td>ty</td><td>type, å¦‚ i32, u32, String, Option<T>ç­‰</td></tr><tr><td>tt</td><td>token tree, ä¹‹åæˆ‘ä¼šå•ç‹¬å†è®²è§£ä¸‹å®ƒçš„</td></tr><tr><td>meta</td><td>å…ƒæ¡ç›®/é¡¹, æ¯”å¦‚ <code>#[allow(unsued)]</code>, <code>meta</code> å°±å¯¹åº” <code>allow(unuse)</code></td></tr><tr><td>vis</td><td>visibility, å¯è§æ€§, æ¯”å¦‚pub, pub(crate)ç­‰, ä¹Ÿå¯èƒ½ä¸ºç©º</td></tr><tr><td>lifetime</td><td>ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td>item</td><td>æ¡ç›®/é¡¹, ä¾‹å¦‚å‡½æ•°å®šä¹‰</td></tr><tr><td>block</td><td>ä»£ç å—</td></tr><tr><td>stmt</td><td>statemen, è¯­å¥</td></tr></tbody></table><h2 id="tt" id="TT">TT</h2><p>è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ <code>tt (Token Tree)</code><br>ä»å­—é¢ä¸Šçš„æ„æ€æ¥è®², å°±æ˜¯ç”±Tokenç»„æˆçš„æ ‘(æ•°æ®ç»“æ„ä¸Šçš„æ ‘)å‘—~~(åºŸè¯)~~</p><p><code>tt</code>,å¯ä»¥æ•è·<code>Single Token</code>,æˆ–ç”±(),[],{}åŠæ‹¬å·åŒ…è£¹èµ·æ¥çš„ä¸œè¥¿<br>ä½œä¸º Token Tree çš„æ ¹èŠ‚ç‚¹, å…ˆè®©æˆ‘ä»¬æ¥ç‚¹ä¾‹å­:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> aa &#123;</span><br><span class="line">    ($a:tt) =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="built_in">stringify!</span>($a));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// Single Token</span></span><br><span class="line">    aa!(<span class="number">123</span>);          <span class="comment">// Yes: 123</span></span><br><span class="line">    aa!(FuckYou);      <span class="comment">// Yes: FuckYou</span></span><br><span class="line">    <span class="comment">// aa!(Fuck You);     // No</span></span><br><span class="line">    <span class="comment">// aa!(123 + 11);     // No</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (), [], &#123;&#125;</span></span><br><span class="line">    aa!([<span class="number">123</span>]);        <span class="comment">// Yes: [123]</span></span><br><span class="line">    aa!(&#123;<span class="number">123</span> + <span class="number">123</span>&#125;);  <span class="comment">// Yes: &#123; 123 + 123 &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç , å±•ç¤ºäº† <code>tt</code> å¯ä»¥åŒ¹é…æ•è·å“ªäº›ä¸œè¥¿<br>è¯·çœ‹ä»¥ä¸‹å†…å®¹, ä»¥ç†è§£å®ƒ, æˆ‘ä»¬ä»¥<code>&lt;&lt;xxx&gt;&gt;</code>, æ¥è¡¨ç¤º <code>xxx</code> æ˜¯ä¸€é¢— <code>Token Tree</code></p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½ çš„çœ¼ä¸­:</span></span><br><span class="line"><span class="number">1</span> + <span class="number">2</span> + (<span class="number">3</span> + <span class="number">4</span>)</span><br><span class="line"><span class="comment">// ttçš„çœ¼ä¸­:</span></span><br><span class="line">&lt;&lt;<span class="number">1</span>&gt;&gt; &lt;&lt;+&gt;&gt; &lt;&lt;<span class="number">2</span>&gt;&gt; &lt;&lt;+&gt;&gt; &lt;&lt;( )&gt;&gt;</span><br><span class="line">                           |</span><br><span class="line">                           |</span><br><span class="line">                   &lt;&lt;<span class="number">3</span>&gt;&gt; &lt;&lt;+&gt;&gt; &lt;&lt;<span class="number">4</span>&gt;&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„Token Treeå…±æœ‰5ä¸ª:</p><ol><li class="lvl-3"><p>&lt;&lt;1&gt;&gt;</p></li><li class="lvl-3"><p>&lt;&lt;+&gt;&gt;</p></li><li class="lvl-3"><p>&lt;&lt;2&gt;&gt;</p></li><li class="lvl-3"><p>&lt;&lt;+&gt;&gt;</p></li><li class="lvl-3"><p>&lt;&lt;(3 + 4)&gt;&gt;</p></li></ol><p>å¯¹äºå‰é¢4ä¸ª, éƒ½æ˜¯Single Token, ä¹Ÿå°±æ˜¯åªæœ‰æ ¹èŠ‚ç‚¹è‡ªå·±çš„Tree<br>å¯¹äºç¬¬5ä¸ª, å› ä¸ºæœ‰()åŒ…è£¹, &lt;&lt;(â€¦)&gt;&gt; ä½œä¸ºæ ¹èŠ‚ç‚¹, å®ƒè¿˜æœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹(è¿™é‡Œæ­£å¥½åŒå±‚)</p><p>æœ‰æ²¡æœ‰å¯¹ <code>Tokenåé¢è·Ÿç€Tree</code> æ›´åŠ ç†è§£?</p><h2 id="ast-jie-dian" id="ASTèŠ‚ç‚¹">ASTèŠ‚ç‚¹</h2><p>macro ä¼šå°†ä¼ å…¥çš„token, è§£æä¸ºå¯¹åº”ç±»å‹çš„ASTèŠ‚ç‚¹(é™¤äº†å°‘é‡tokenç±»å‹, ç­‰ä¸‹ä¼šè®²)<br>æ¯”å¦‚ <code>map!</code> ä¸­, <code>$key:value</code> ä¸ <code>$val:expr</code>, éƒ½ä¼šè¢«è§£æä¸ºexprç±»å‹çš„ASTèŠ‚ç‚¹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> map &#123;</span><br><span class="line">    ($key:expr =&gt; $val:expr) =&gt; &#123;&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> m = std::collections::HashMap::&lt;_,_&gt;::new();</span><br><span class="line">        m.insert($key, $val);</span><br><span class="line">        m</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> m = map!(<span class="string">&quot;æ™®é€šä¸Šç­æ—&quot;</span> =&gt; <span class="number">33</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å±•å¼€å, å¯ä»¥çœ‹ä½œæ˜¯:</span></span><br><span class="line"><span class="comment">fn main() &#123;</span></span><br><span class="line"><span class="comment">    let m = &#123;</span></span><br><span class="line"><span class="comment">        let mut m = std::collections::HashMap::&lt;_,_&gt;::new();</span></span><br><span class="line"><span class="comment">        m.insert(&quot;æ™®é€šä¸Šç­æ—&quot;, 33);</span></span><br><span class="line"><span class="comment">        m</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    println!(&quot;&#123;:?&#125;&quot;,m);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ macro , ç«™åœ¨äº†æ›´æŠ½è±¡çš„è§†è§’ä¸Š<br>æ“æ§ä¼ å…¥çš„token(æˆ–è§£ætokenåå½¢æˆçš„ASTèŠ‚ç‚¹), ç»„æˆæ–°ASTèŠ‚ç‚¹(ç”Ÿæˆæ–°ä»£ç )</p><p>è¿™å¯ä»¥å¤§é‡ç®€åŒ–æ‰‹å†™é‡, å¦‚stdä¸­å‘å®ä¼ å…¥ç‰¹å®šç±»å‹, è‡ªåŠ¨ç”Ÿæˆä¸ºå®ƒä»¬å®ç°traitçš„ä»£ç </p><p>å€¼å¾—æ³¨æ„çš„æ˜¯, å®å°†ä¼ å…¥å‚æ•°ç»™ASTèŠ‚ç‚¹åŒ–æ—¶, æœ‰æ—¶æ„å‘³ç€ä¼šäº§ç”Ÿä¸æœŸæœ›çš„ç»“æœ<br>æˆ‘ç›´æ¥ç”¨ <a href="https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/mbe-min-captures-and-expansion-redux.md">å®å°å†Œ</a> ä¸Šé¢çš„ä»£ç äº†:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> capture_then_match_tokens &#123;</span><br><span class="line">    ($e:expr) =&gt; &#123;match_tokens!($e)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">macro_rules!</span> match_tokens &#123;</span><br><span class="line">    ($a:tt + $b:tt) =&gt; &#123;<span class="string">&quot;got an addition&quot;</span>&#125;;</span><br><span class="line">    (($i:ident)) =&gt; &#123;<span class="string">&quot;got an identifier&quot;</span>&#125;;</span><br><span class="line">    ($($other:tt)*) =&gt; &#123;<span class="string">&quot;got something else&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;\n&#123;&#125;\n&#123;&#125;\n&quot;</span>,</span><br><span class="line">        match_tokens!((caravan)),</span><br><span class="line">        match_tokens!(<span class="number">3</span> + <span class="number">6</span>),</span><br><span class="line">        match_tokens!(<span class="number">5</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;\n&#123;&#125;\n&#123;&#125;&quot;</span>,</span><br><span class="line">        capture_then_match_tokens!((caravan)),</span><br><span class="line">        capture_then_match_tokens!(<span class="number">3</span> + <span class="number">6</span>),</span><br><span class="line">        capture_then_match_tokens!(<span class="number">5</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¼šæ˜¯:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">got an identifier</span><br><span class="line">got an addition</span><br><span class="line">got something <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">got something <span class="keyword">else</span></span><br><span class="line">got something <span class="keyword">else</span></span><br><span class="line">got something <span class="keyword">else</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¿™é‡Œ, <code>match_tokens</code> æ•è·token, ç„¶åå°†å‚æ•°è§£æä¸ºä¸€ä¸ªexprç±»å‹çš„ASTèŠ‚ç‚¹<br>å®ƒä¸å†æ˜¯token, è€Œæ˜¯ä¸ªASTèŠ‚ç‚¹äº†!</p><p>æ¯”å¦‚ <code>5 + 7</code>, åŸæœ¬æ˜¯å¯ä»¥ä¸ <code>$a:tt + $b:tt</code> ç›¸åŒ¹é…, ä¹Ÿå¯ä»¥ä¸ <code>$a: expr</code> åŒ¹é…<br>ä½†ç»äºŒæ¬¡ä¼ å…¥å(å‘ <code>capture_then_match_tokens</code>ä¼ å…¥çš„å‚æ•°åˆä¼ ç»™ <code>match_tokens</code>)<br><code>5 + 7</code> å˜æˆASTè¡¨è¾¾å¼èŠ‚ç‚¹, åªèƒ½ä¸ <code>$a: expr</code>, è€Œä¸èƒ½ä¸ <code>$a:tt + $b:tt</code> åŒ¹é…</p><p>åªæœ‰ <code>tt</code>, <code>ident</code>, <code>lifetime</code> èƒ½å…é­ ASTèŠ‚ç‚¹åŒ–, å¯ä»¥å¥½å¥½ç†è§£ä¸‹è¿™å—</p><p>æ€»ç»“:<br>å®å°†ä¸€äº›æ•è·çš„tokenç»™ASTèŠ‚ç‚¹åŒ–, éšååˆå±•å¼€ä¸ºä¸€ä¸ªæ–°ASTèŠ‚ç‚¹<br>è¿™ä¸ªæ–°çš„ASTèŠ‚ç‚¹, ä¼šç”¨æ¥æ›¿æ¢å®è°ƒç”¨éƒ¨åˆ†çš„ASTèŠ‚ç‚¹, å› æ­¤ä½ å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹è°ƒç”¨å®<br>(åªè¦å®å±•å¼€çš„ASTèŠ‚ç‚¹æ­£ç¡®å³å¯ ğŸ˜„)</p><p>å®å±•å¼€çš„ç»“æœæ˜¯ä¸ªæŸç±»å‹çš„ASTèŠ‚ç‚¹, è¿™ç›¸æ¯”äºCè¯­è¨€çš„ <code>#define</code> å®, æœ‰ä»€ä¹ˆå¥½å¤„?<br>æœ€ç›´æ¥çš„å¥½å¤„, å¦‚ä¸‹ <s>(ç›¸å½“äºè‡ªåŠ¨ç»™ä½ åŠ ä¸Šäº†æ‹¬å·)</s>:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Cè¯­è¨€: ç®€å•çš„æ–‡æœ¬æ›¿æ¢</span></span><br><span class="line">#define SUM(a,b) a+b</span><br><span class="line">int main(void) &#123;</span><br><span class="line">    SUM(<span class="number">2</span>, <span class="number">2</span>);     <span class="comment">// 2 * 2</span></span><br><span class="line">    <span class="number">5</span> * SUM(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// 5 * 2 + 2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rustè¯­è¨€: æ ¹æ®ä¸Šä¸‹æ–‡æ¨æµ‹å®è°ƒç”¨çš„ASTèŠ‚ç‚¹åº”è¢«å±•å¼€ä¸ºexprç±»å‹çš„ASTèŠ‚ç‚¹</span></span><br><span class="line"><span class="built_in">macro_rules!</span> sum &#123;</span><br><span class="line">    ($a:expr,$b:expr) =&gt; &#123;$a + $b&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    sum!(<span class="number">2</span>,<span class="number">2</span>);     <span class="comment">// 2 + 2</span></span><br><span class="line">    <span class="number">5</span> * sum!(<span class="number">2</span>,<span class="number">2</span>); <span class="comment">// 5 * (2 + 2)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pi-pei-zhu-yi-dian" id="åŒ¹é…æ³¨æ„ç‚¹">åŒ¹é…æ³¨æ„ç‚¹</h2><p>åœ¨æˆ‘ä»¬ä¼ å‚æ—¶, æœ‰ä¸ªå¾ˆå¸¸è§çš„è¯¯è§£, ä¸ä¸ºäº†ä»¥åå®çš„å‘å±•è€Œæœ‰çš„é™åˆ¶<br>å³ä¸‹é¢è¦è®²çš„ä¸œè¥¿, æœ‰æ—¶é—´çš„ä¹Ÿå¯ä»¥å»çœ‹çœ‹ <a href="https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/mbe-min-captures-and-expansion-redux.md">å®å°å†Œ</a></p><h3 id="pi-pei-wu-qu" id="åŒ¹é…è¯¯åŒº">åŒ¹é…è¯¯åŒº</h3><p>æ¥çœ‹çœ‹ä¸‹é¢ä¸€æ®µä»£ç :</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> aa &#123;</span><br><span class="line">    ($a: expr) =&gt; &#123;&#125;;</span><br><span class="line">    ($a: ident +) =&gt; &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    aa!(a);   <span class="comment">// Yes</span></span><br><span class="line">    aa!(a+);  <span class="comment">// No</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä½ çš„ç›´è§‰, <code>aa!(a+)</code> åº”è¯¥ä¼šä¸ç¬¬äºŒä¸ª rule ç›¸åŒ¹é…<br>ä½†æ˜¯å®é™…ä¸Šä¼šæŠ¥è¿™ä¹ˆä¸€ä¸ªé”™è¯¯:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">expected expression, found end of <span class="keyword">macro</span> arguments</span><br><span class="line"><span class="comment">// æœŸæœ›è¡¨è¾¾å¼, å´å‘ç°å®å‚æ•°ç»“æŸäº†</span></span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°å®é™…ä¸Šéƒ½æ˜¯åœ¨ä¸ç¬¬ä¸€ä¸ªruleå°è¯•ç€è¿›è¡ŒåŒ¹é…:</p><p><code>a (lhs, left hand side)</code> èƒ½è¢«ç¬¬ä¸€ä¸ªruleåŒ¹é…<br>è€Œ <code>+ (äºŒå…ƒåŠ )</code> å› ä¸ºå¯ä»¥å°¾éšè¡¨è¾¾å¼, ä¹Ÿå¯ä»¥è¢«ç¬¬ä¸€ä¸ªruleåŒ¹é…ä½†ç”±äºç¼ºå°‘ <code>rhs</code>, æ­¤æ—¶ä¼šç›´æ¥æŠ¥é”™, è€Œä¸æ˜¯å»å°è¯•åŒ¹é…ä¸‹ä¸€ä¸ªrule</p><p>è¿™é¿å…äº†æŸäº›æƒ…å†µä¸‹, å‘ç”Ÿä¸æœŸæœ›çš„åŒ¹é…, ä½†ä½ å´ä¸çŸ¥, å› æ­¤ruleçš„é¡ºåºå¾ˆé‡è¦</p><h3 id="qi-yi-xian-zhi" id="æ­§ä¹‰é™åˆ¶">æ­§ä¹‰é™åˆ¶</h3><p>ç”±äºä¸€äº›æ­§ä¹‰, ä¸ºäº†å‘åå…¼å®¹æ€§ä¸ä¸ç ´åä»£ç <br>å½“å‰å¯¹ <code>Metavariable</code> åé¢å¯ä»¥è·Ÿçš„å†…å®¹æœ‰æ‰€é™åˆ¶, è¯¦æƒ…å¯è§ <a href="https://doc.rust-lang.org/stable/reference/macros-by-example.html#follow-set-ambiguity-restrictions">Rust-Reference: é™åˆ¶</a><br>è¿™é‡Œåªéœ€ç¨å¾®çœ‹çœ‹, ç•™ä¸ªå°è±¡, å®é™…ä½¿ç”¨æ—¶, è‹¥åœ¨æ­¤æ–¹é¢æŠ¥é”™, åˆ™æ ¹æ®ç¼–è¯‘å™¨çš„æç¤ºæ¥æ”¹å³å¯<br><s>(åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆ xxx ç±»å‹åé¢, åŠ  yyy è¿™ä¸ªç¬¦å·ä¸å…è®¸)</s><br><s>(å› ä¸ºæˆ‘ä¹Ÿæ²¡æœ‰å…¨éƒ¨ææ‡‚)</s></p><p>å½“ç„¶, éšç€Rustå£°æ˜å®çš„é€æ¸å®Œå–„, é™åˆ¶ä¼šé€æ¸å‡å°‘(è™½ç„¶ä¹Ÿä¸å¤š)</p><p>é‚£ä¹ˆ, ä»Šå¤©å°±åˆ°è¿™äº†, è°¢è°¢æ‚¨çš„è§‚çœ‹ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ­£å¼ç³»ç»Ÿçš„å…³äº macro çš„ å£°æ˜ä¸ä½¿ç”¨&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Macro" scheme="https://jedsek.xyz/tags/Macro/"/>
    
  </entry>
  
  <entry>
    <title>rust-dm-p2: ä»printlnå¼€å§‹</title>
    <link href="https://jedsek.xyz/posts/rust-decl-macro/p2"/>
    <id>https://jedsek.xyz/posts/rust-decl-macro/p2</id>
    <published>2021-09-19T14:50:27.000Z</published>
    <updated>2021-09-19T14:50:27.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æˆ‘ä»¬ä»ç†Ÿæ‚‰çš„ println! å¼€å§‹, äº†è§£ä¸‹å£°æ˜å®çš„å¤§è‡´ç»“æ„å§</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨:</p><ul class="lvl-0"><li class="lvl-2"><p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p></li><li class="lvl-2"><p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p></li></ul><h1 id="kai-pian">å¼€ç¯‡</h1><p>å¤§å®¶åº”è¯¥éƒ½ç”¨è¿‡ä¸€ä¸ªå®<br>å®ƒå°±æ˜¯<code>println!</code>:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> s = <span class="string">&quot;Rush B!!!!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">    <span class="built_in">println!</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½ åˆšåˆšæ¥è§¦å®ƒçš„æ—¶å€™, å¯èƒ½ä¼šæ„Ÿåˆ°äº›è®¸ç–‘æƒ‘:<br>ä¸ºä»€ä¹ˆåé¢è¦è·Ÿä¸ªæ„Ÿå¹å·?<br>ä¸ºä»€ä¹ˆæ‹¬å·é‡Œé¢çš„å‚æ•°å¯ä»¥ä¸ä¸€æ ·?</p><p>äº²çˆ±çš„TRPlåœ¨æ•™ä½ å†™ <a href="https://kaisery.github.io/trpl-zh-cn/ch01-02-hello-world.html#%E5%88%86%E6%9E%90%E8%BF%99%E4%B8%AA-rust-%E7%A8%8B%E5%BA%8F">Hello World!</a> çš„æ—¶å€™<br>å‘Šè¯‰è¿‡ä½ : åå­—ååŠ ä¸ªæ„Ÿå¹å·,å°±æ˜¯ä¸ª<code>å®(macro)</code><br>æ³¨: macro çš„è¯»éŸ³: [ËˆmÃ¦kroÊŠ]</p><p>å¯æ˜¯macroåˆ°åº•æ˜¯å•¥?<br><s>(ç®—äº†ç®—äº†,åæ­£åªè¦ä¼šç”¨å°±è¡Œäº†,äºæ˜¯ä½ ç‚¹å‡»äº†è¯¥ç½‘é¡µçš„å‰å‰)</s></p><hr><h1 id="cha-kan-ding-yi">æŸ¥çœ‹å®šä¹‰</h1><p>è®©æˆ‘ä»¬æŒ‰ä½Ctrl,é¼ æ ‡å·¦é”®ç‚¹å‡»println!<br>(ä»¥ VSCode ä¸ºä¾‹)</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    () =&gt; ($crate::<span class="built_in">print!</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line"></span><br><span class="line">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class="line">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ å¯èƒ½ä¼šçœ‹åˆ°, åœ¨ println! çš„ä¸Šé¢</span></span><br><span class="line"><span class="comment">// æœ‰ç€ç±»ä¼¼ä¸‹é¢çš„ç©æ„:  </span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// #[macro_export]</span></span><br><span class="line"><span class="comment">// #[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]</span></span><br><span class="line"><span class="comment">// #[allow_internal_unstable(print_internals, format_args_nl)]</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// è¿™äº›ä¹Ÿå±äºå®, ä¸è¿‡æ˜¯ `è¿‡ç¨‹å®`</span></span><br><span class="line"><span class="comment">// è€Œè¯¥ç³»åˆ—è¦è®²çš„æ˜¯ `å£°æ˜å®`, å› æ­¤ç•¥è¿‡</span></span><br></pre></td></tr></table></figure><p>ä½ æ‚²å‚¬åœ°å‘ç°æ ¹æœ¬çœ‹ä¸æ‡‚è¿™ä¸€å¤§å †é¬¼ç”»ç¬¦â€¦<br>ä½†çœ‹ä¸æ‡‚æ ¹æœ¬æ²¡å…³ç³»,åé¢å‡ èŠ‚è¿‡å,ä½ è‚¯å®šæ‡‚äº†<br>ç°åœ¨åªéœ€æ˜ç™½çš„,æ˜¯å¤§è‡´ç»“æ„:</p><ol><li class="lvl-3"><p>æˆ‘ä»¬å°†<code>macro_rules!</code>æ”¾åœ¨<code>println</code>å‰é¢,è¯´æ˜åè€…æ˜¯ä¸ªå®<br>(<code>macro_rules!</code>å½“ä½œç‰¹å®šè¯­æ³•å³å¯)</p></li><li class="lvl-3"><p>ä¹‹åç”¨èŠ±æ‹¬å·åŒ…èµ·æ¥,é‡Œé¢æ˜¯è¯¥å®çš„å…·ä½“å®šä¹‰</p></li></ol><p>é—®é¢˜æ¥äº†,å…³é”®æ˜¯<code>println</code>çš„å…·ä½“å®šä¹‰<br>èŠ±æ‹¬å·å†…,åˆ°åº•åœ¨è®²è¿°ç€å•¥?</p><p>è¯·å®¹è®¸æˆ‘æ¥å¸®ä½ ç²—æš´åœ°ç±»æ¯”ä¸€ä¸‹<code>matchè¡¨è¾¾å¼ &amp;&amp; macro</code>:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// match</span></span><br><span class="line"><span class="keyword">match</span> num &#123;</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&quot;1&quot;</span>.repeat(<span class="number">10</span>),</span><br><span class="line">    <span class="number">2</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;2&quot;</span>.repeat(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    _ =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Fuck you! I just want the  numer 1 or 2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// macro</span></span><br><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    () =&gt; ($crate::<span class="built_in">print!</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line"></span><br><span class="line">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class="line">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>macroæœ‰ç‚¹åƒæ˜¯match,èƒ½æ ¹æ®ä¸åŒå‚æ•°,å±•å¼€ä¸åŒçš„ä»£ç <br>åœ¨macroæœ€å¤–å±‚çš„èŠ±æ‹¬å·ä¸­,æœ‰è®¸å¤šåŒ¹é…åˆ†æ”¯</p><p>matchè¡¨è¾¾å¼,ç§°å‘¼æ¯ä¸ªåŒ¹é…åˆ†æ”¯ä¸º<code>arm</code><br>é€—å·åˆ†å‰²å®ƒä»¬å½¼æ­¤,æˆ–è€…ä¸ç”¨é€—å·è€Œç”¨èŠ±æ‹¬å·åŒ…è£¹æ¥åˆ†å‰²<br>æœ€åä¸€ä¸ªarmå¯çœç•¥é€—å·</p><p>macro,åˆ™ç§°å‘¼æ¯ä¸ªåŒ¹é…åˆ†æ”¯ä¸º<code>rule</code>(æ˜ç™½ä¸ºä»€ä¹ˆä½¿ç”¨<code>macro_rules!</code>åˆ›å»ºå®äº†å—)<br>å¿…é¡»ä½¿ç”¨èŠ±æ‹¬å·åŒ…è£¹,ä½¿ç”¨åˆ†å·åˆ†éš”å½¼æ­¤<br>æœ€åä¸€ä¸ªruleå¯çœç•¥åˆ†å·</p><p>ä½ å¹¶ä¸éœ€ææ¸…æ‰€æœ‰ç»†èŠ‚,ç°åœ¨å…ˆä¸ç”¨è¯•å›¾è®°å¿†å…·ä½“è¯­æ³•,æœ‰å°è±¡å³å¯<br>ç°åœ¨å†æ¥çœ‹çœ‹ <code>println</code>,æ˜¯ä¸æ˜¯ç¨å¾®æœ‰ç‚¹æ„Ÿè§‰äº†(çœ‹ä¸æ‡‚çš„åœ°æ–¹ä¾ç„¶ç›´æ¥è·³å³å¯):</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰éƒ¨åˆ†</span></span><br><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    <span class="comment">// ç©ºå‚æ—¶, åªè¾“å‡ºæ¢è¡Œç¬¦</span></span><br><span class="line">    () =&gt; ($crate::<span class="built_in">print!</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ‰å‚æ—¶, è¾“å‡ºå‚æ•°, å¹¶æ¢è¡Œ</span></span><br><span class="line">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class="line">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line"><span class="built_in">println!</span>();</span><br></pre></td></tr></table></figure><hr><h1 id="zong-jie">æ€»ç»“</h1><ol><li class="lvl-3"><p>åˆ›å»ºä¸€ä¸ªå‡è®¾å«xxxçš„macro,èŠ±æ‹¬å·åŒ…è£¹å…·ä½“å®šä¹‰:</p></li></ol><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> xxx &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>ç„¶ååˆ›å»ºä¸¤ä¸ªåŒ¹é…åˆ†æ”¯:<br>(åŒ¹é…ç©ºå‚ =&gt; ä¸åšä»»ä½•äº‹)<br>(åŒ¹é…123 =&gt; æ‰“å°123)</p></li></ol><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> xxx &#123;</span><br><span class="line">    () =&gt; &#123;&#125;;</span><br><span class="line">    (<span class="number">123</span>) =&gt; &#123;<span class="built_in">println!</span>(<span class="string">&quot;123&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>è°ƒç”¨æ—¶, è¦åšåˆ°: å®å+æ„Ÿå¹å·+ä¼ å‚:<br>(ä¼ å…¥çš„å‚æ•°,è‹¥ä¸ä»»ä½•ruleéƒ½ä¸åŒ¹é…,åˆ™æŠ¥é”™)</p></li></ol><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> xxx &#123;</span><br><span class="line">    () =&gt; &#123;&#125;;</span><br><span class="line">    (<span class="number">123</span>) =&gt; &#123;<span class="built_in">println!</span>(<span class="string">&quot;123&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    xxx!();      <span class="comment">// Nothing</span></span><br><span class="line">    xxx!(<span class="number">123</span>);   <span class="comment">// println!(&quot;123&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬èŠ‚åªæ˜¯ä¸ºäº†ç•™ä¸ªå¤§è‡´å°è±¡, å»ºç«‹ä¸€ä¸ªæ•´ä½“ç»“æ„çš„è®¤çŸ¥<br>ç›¸ä¿¡ä½ è‚¯å®šè¿˜æœ‰ä¸€äº›ç–‘æƒ‘, åé¢ä¼šæ¯”è¾ƒç³»ç»Ÿåœ°è®²è§£<br>å’±ä»¬ä¸‹æœŸè§</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬ä»ç†Ÿæ‚‰çš„ println! å¼€å§‹, äº†è§£ä¸‹å£°æ˜å®çš„å¤§è‡´ç»“æ„å§&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Macro" scheme="https://jedsek.xyz/tags/Macro/"/>
    
  </entry>
  
  <entry>
    <title>rust-dm-p1: ç³»åˆ—è¯´æ˜</title>
    <link href="https://jedsek.xyz/posts/rust-decl-macro/p1"/>
    <id>https://jedsek.xyz/posts/rust-decl-macro/p1</id>
    <published>2021-09-19T13:51:27.000Z</published>
    <updated>2021-09-19T13:51:27.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ å£°æ˜å®(declarative-macro) ç³»åˆ—</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨:</p><ul class="lvl-0"><li class="lvl-2"><p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p></li><li class="lvl-2"><p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p></li></ul><h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1><p>æ­¤ç³»åˆ—,æˆ‘ä»¬å°†å­¦ä¹ Rustä¸­çš„ <code>å£°æ˜å®</code><br>è¯·æ³¨æ„, æ˜¯å£°æ˜å®, è¿‡ç¨‹å®æ—¥åå†è¯´</p><hr><h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1><ol><li class="lvl-3"><p>ä¹¦ç±</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://zjp-cn.github.io/tlborm/">å®å°å†Œ</a></p></li><li class="lvl-2"><p><a href="https://rustcc.gitbooks.io/rustprimer/content/macro/macro.html">RustPrimer</a></p></li><li class="lvl-2"><p><a href="https://kaisery.github.io/trpl-zh-cn/ch19-06-macros.html">TRPL</a></p></li></ul><ol start="2"><li class="lvl-3"><p>æ–‡ç« </p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://zhuanlan.zhihu.com/p/353421021">ã€è¯‘ã€‘Rustå®: æ•™ç¨‹ä¸ç¤ºä¾‹ (ä¸€)</a></p></li><li class="lvl-2"><p><a href="https://zhuanlan.zhihu.com/p/356427780">ã€è¯‘ã€‘Rustå®: æ•™ç¨‹ä¸ç¤ºä¾‹ (äºŒ)</a></p></li></ul><hr><h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1><p>å‘ç°é”™è¯¯çš„è¯, è¯·åŠæ—¶è·Ÿæˆ‘è”ç³», æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p><p>æœ€å, è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ å£°æ˜å®(declarative-macro) ç³»åˆ—&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Macro" scheme="https://jedsek.xyz/tags/Macro/"/>
    
  </entry>
  
  <entry>
    <title>rust-async-p4: çŠ¶æ€çš„ä¿å­˜ä¸å˜æ¢</title>
    <link href="https://jedsek.xyz/posts/rust-async/p4"/>
    <id>https://jedsek.xyz/posts/rust-async/p4</id>
    <published>2021-09-12T06:50:14.000Z</published>
    <updated>2021-09-12T06:50:14.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æµ…æ˜¾çš„åŸç†ç¬¬ä¸€ç¯‡: çŠ¶æ€çš„ä¿å­˜/å˜æ¢</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p><h1 id="kai-pian">å¼€ç¯‡</h1><p><strong>æ³¨: å‚è€ƒäº†ã€ŠWriting an OS in Rustã€‹ä¸­çš„asyncç¯‡,å¯ä»¥è‡ªå·±æœç´¢ä¸‹çœ‹çœ‹</strong><br>ä¸ºäº†æ›´å¥½åœ°ç†è§£<code>Rustå¼‚æ­¥</code>èƒŒåçš„åŸç†,æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ä¸€äº›æ¦‚å¿µ<br>å½“ç„¶,ä¸ç”¨å¤ªæ·±å…¥,åªæ˜¯å°è¡¥å……è€Œå·²:</p><ul class="lvl-0"><li class="lvl-2"><p><code>æŠ¢å å¼/åä½œå¼å¤šä»»åŠ¡</code></p></li><li class="lvl-2"><p><code>çŠ¶æ€æœº</code></p></li><li class="lvl-2"><p><code>è‡ªå¼•ç”¨ç»“æ„ä½“</code></p></li></ul><p>ç°åœ¨,è®©æˆ‘ä»¬å¼€å§‹å§!</p><hr><h1 id="liang-chong-duo-ren-wu">ä¸¤ç§å¤šä»»åŠ¡</h1><h2 id="jie-shao" id="ä»‹ç»">ä»‹ç»</h2><p><code>æŠ¢å å¼å¤šä»»åŠ¡</code>ä¸<code>åä½œå¼å¤šä»»åŠ¡</code>,éƒ½å±äº<code>å¤šä»»åŠ¡</code></p><ul class="lvl-0"><li class="lvl-2"><p>æŠ¢å å¼å¤šä»»åŠ¡:<br>æ“ä½œç³»ç»Ÿå†³å®šCPUçš„è¿è¡Œæƒ<br>æ¯”å¦‚,æ“ä½œç³»ç»Ÿå…ˆè®©ç½‘æ˜“äº‘éŸ³ä¹è¿è¡Œä¸€ä¼š,å†è®©VSCodeè¿è¡Œä¸€ä¼š<br>å„ä¸ªç¨‹åºä¸­çš„ä»»åŠ¡ä»¬,è¿è¡Œæ—¶é—´å¾ˆçŸ­,ä½†åˆ‡æ¢é€Ÿåº¦ä¹Ÿå¾ˆå¿«,é€ æˆä¸€ç§<code>ä»»åŠ¡ä»¬åŒæ—¶è¿è¡Œ</code>çš„æ„Ÿè§‰<br>è¿™æ˜¯å¼ºè¿«/æŠ¢å çš„</p></li><li class="lvl-2"><p>åä½œå¼å¤šä»»åŠ¡:<br>ä»»åŠ¡ä»¬æœ¬èº«è¿›è¡Œåè°ƒ,å†³å®šCPUçš„è¿è¡Œæƒ<br>æ¯”å¦‚Rustä¸­,è¿è¡Œæ—¶è°ƒç”¨æŸTask(top-level Future)çš„pollæ–¹æ³•é˜»å¡æ—¶,è¿”å›Poll::Pending<br>è‡ªå·±æ”¾å¼ƒç»§ç»­æ‰§è¡Œ,å¹¶é€šçŸ¥è¿è¡Œæ—¶æ‰§è¡Œå…¶ä»–Task<br>è¿™æ˜¯è‡ªæ„¿/åä½œçš„,Taskä»¬<code>è‡ªæ„¿æ”¾å¼ƒCPUçš„æ‰§è¡Œæƒ</code><br>(ä¸Šæ–‡ä¸­çš„<code>ä»»åŠ¡</code>ä¸<code>Task</code>è¯·åŒºåˆ†ä¸€ä¸‹,å‰è€…æ¯”åè€…å¹¿æ³›,åè€…åœ¨è¿™ç”¨äºRustçš„ä¸¾ä¾‹)</p></li></ul><h2 id="zhuang-tai-de-hui-fu-bao-cun" id="çŠ¶æ€çš„æ¢å¤-ä¿å­˜">çŠ¶æ€çš„æ¢å¤/ä¿å­˜</h2><p>æ—¢ç„¶ä»»åŠ¡ä»¬èƒ½äº’ç›¸åˆ‡æ¢æ‰§è¡Œ,é‚£ä¹ˆ,å½“å†æ¬¡è½®åˆ°æŸä»»åŠ¡æ‰§è¡Œæ—¶<br>è¯¥ä»»åŠ¡,åº”å½“ä»å…ˆå‰æš‚åœçš„åœ°æ–¹å¼€å§‹,ç»§ç»­æ‰§è¡Œ<br>å› æ­¤æˆ‘ä»¬åº”å½“å¤‡ä»½æŸä»»åŠ¡çš„å…ˆå‰çŠ¶æ€,ä»¥ä¾¿äºä¹‹åçš„ç»§ç»­æ‰§è¡Œ,è¿™å°±æ˜¯<code>çŠ¶æ€ä¿å­˜</code></p><p>å¯¹äº<code>æŠ¢å å¼</code>ä¸<code>åä½œå¼</code>,å¤„ç†<code>çŠ¶æ€ä¿å­˜</code>çš„æ€è·¯æ˜¯ä¸ä¸€æ ·çš„:</p><ul class="lvl-0"><li class="lvl-2"><p>æŠ¢å å¼:<br>å› ä¸ºæ˜¯å¼ºè¿«åˆ‡æ¢æ‰§è¡Œçš„,ä»»åŠ¡ä¼šåœ¨ä»»æ„æŸä¸ªæ—¶åˆ»è¢«ä¸­æ–­<br>ä»»åŠ¡æ­¤æ—¶è¿è¡Œåˆ°äº†å“ªé‡Œ?æˆ‘ä»¬ä¸çŸ¥é“å•Š!<br>é‚£ä¹ˆ,å°±åªå¥½å°†ä»»åŠ¡çš„æ‰€æœ‰çŠ¶æ€å…¨éƒ¨ä¿å­˜,åŒ…æ‹¬è°ƒç”¨æ ˆ(call stack)</p></li></ul><p>åæ­£,ä½ åªéœ€æ˜ç™½,æ“ä½œç³»ç»Ÿå¼ºåˆ¶åˆ‡æ¢ä»»åŠ¡,ä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ç›¸å¯¹å…¬å¹³çš„æ‰§è¡Œæ—¶é—´<br>ä½†æ˜¯,ä»£ä»·ä¹Ÿæœ‰,æ¯”å¦‚ä¸å¾—ä¸ä¸ºæ¯ä¸ªä»»åŠ¡ä¿å­˜å®ƒçš„æ‰€æœ‰çŠ¶æ€,å†…å­˜å¼€é”€å¤§</p><ul class="lvl-0"><li class="lvl-2"><p>åä½œå¼:<br>å› ä¸ºæ˜¯è‡ªæ„¿/åä½œåœ°åˆ‡æ¢æ‰§è¡Œ,æ¯ä¸ªä»»åŠ¡ä¼šåœ¨å“ªé‡Œæ”¾å¼ƒæ‰§è¡Œéƒ½æ˜¯æ¸…æ¥šçš„<br>è¿™ç§æ”¾å¼ƒæ‰§è¡Œæƒçš„æ“ä½œ,æˆ‘ä»¬ç§°ä¸º<code>yield</code></p></li></ul><p>æ¯”å¦‚åœ¨Rustä¸­,<code>xxx.await</code>ä¼šæ‰§è¡Œä¸€ä¸ªFuture  <br>æ„å‘³ç€å½“ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œæ—¶,å¯èƒ½ä¼š<code>yield</code>(pollè¿”å›Poll::Pending,è‡ªæ„¿æ”¾å¼ƒæ‰§è¡Œæƒ)</p><p><code>xxx.await</code>å°±æ˜¯ä¸€ä¸ª<code>stop/yield point</code>,ä»£è¡¨æ‰§è¡Œåˆ°æ­¤å¤„æ—¶,å¯èƒ½ä¼šå‘ç”Ÿæš‚åœå¹¶yield<br>ç§,æ‰€æœ‰å¯èƒ½yieldçš„åœ°æ–¹ä½ éƒ½çŸ¥é“,è¿™å°±æ–¹ä¾¿äº†ä¿å­˜çŠ¶æ€(ä½ å¯ä»¥èˆå¼ƒå·²ç»ä¸éœ€è¦çš„ä¸­é—´å˜é‡)<br>å› æ­¤,æˆ‘ä»¬å¯ä»¥å‡†ç¡®åˆ†é…Futureæ‰§è¡Œæ‰€éœ€è¦çš„æœ€å¤§ç©ºé—´</p><p>å…¶å®,æ¯ä¸ª<code>.await(ä¹Ÿå°±æ˜¯yield point)</code>,å°±ä»£è¡¨ç€<code>ä¸€ç§çŠ¶æ€</code>(ä¹‹åä¼šè®²)</p><p>åä½œå¼çš„å¥½å¤„åœ¨äº:<br>èƒ½è‡ªå·±æŒæ¡æ‰€æœ‰<code>yield point</code>,ä»è€Œç²¾æ‰“ç»†ç®—åœ°é€‰æ‹©æœ€ä¼˜çš„ç­–ç•¥, è€Œéè®©æ“ä½œç³»ç»Ÿä¸ºä½ æš—åœ°é‡Œå¤„ç†<br>æ¯•ç«Ÿæœºå™¨å®šä¹‰çš„åˆ†é…ç­–ç•¥, æ€»æ˜¯æ²¡æœ‰æ¯”ä¸è¿‡æˆ‘ä»¬ç‰¹æ„è®¾è®¡çš„<br>åœ¨ä»»åŠ¡æš‚åœå¹¶è½¬è®©æ‰§è¡Œæƒå‰,å‡†ç¡®ä¿å­˜<code>ä¸‹æ¬¡ç»§ç»­æ‰€éœ€è¦çš„çŠ¶æ€</code>,å†…å­˜/æ€§èƒ½ä¼˜åŠ¿å¾ˆå¤§<br>ä½†åå¤„ä¹Ÿæœ‰: å› ä¸ºè¿™æ˜¯è‡ªæ„¿/åä½œçš„,å½“æŸä¸ªä»»åŠ¡å‡ºç°Bug,æ°¸ä¸æ”¾å¼ƒæ‰§è¡Œæƒ,å…¶ä»–ä»»åŠ¡ä¾¿æ— æ³•æ‰§è¡Œ</p><hr><h1 id="zhuang-tai-ji-de-gai-nian">çŠ¶æ€æœºçš„æ¦‚å¿µ</h1><p>åœ¨Rustä¸­çš„å¼‚æ­¥,æˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´è¿‡,å±äº<code>åä½œå¼å¤šä»»åŠ¡</code><br>è€Œå…¶<code>çŠ¶æ€ä¿å­˜</code>çš„å®ç°,å°±æ˜¯åˆ©ç”¨<code>çŠ¶æ€æœº(state machine)</code>æ¥å®ç°</p><p><code>çŠ¶æ€æœº(state machine)</code>ä¸€èˆ¬æŒ‡<code>æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº</code>,æ˜¯ä¸€ç§æ•°å­¦æ¨¡å‹</p><ol><li class="lvl-3"><p>çŠ¶æ€(state):<br>æ¯”å¦‚æœ‰ä¸€æ‰‡é—¨,å®ƒçš„çŠ¶æ€å°±å¤„äºä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€: Open or Closed</p></li><li class="lvl-3"><p>äº‹ä»¶(event):<br>æŸäº‹ä»¶å‘ç”Ÿå,ä¼šè§¦å‘ç›¸åº”åŠ¨ä½œ,å¯èƒ½æ”¹å˜çŠ¶æ€<br>æ¯”å¦‚: ç”¨é’¥åŒ™é”é—¨(event)=&gt;å…³é—¨(action)=&gt;é—¨è¢«é”ä½(state)</p></li><li class="lvl-3"><p>åŠ¨ä½œ (action):<br>äº‹ä»¶å‘ç”Ÿå,ä¼šè§¦å‘åŠ¨ä½œ</p></li><li class="lvl-3"><p>å˜æ¢ (transition):<br><code>State_X=&gt;State_Y</code>å°±å«<code>å˜æ¢</code>,æ¯”å¦‚é—¨çš„çŠ¶æ€ä»<code>Open=&gt;Closed</code></p></li></ol><p>ç¨å¾®äº†è§£ä¸‹<code>çŠ¶æ€æœº</code>çš„æ¦‚å¿µå³å¯</p><p>é‚£ä¹ˆç°åœ¨,å°±è¦çœ‹å…·ä½“ä»£ç äº†</p><p>å¦‚æœä½ æƒ³äº²è‡ªè¿è¡Œä¸€ä¸‹,å…ˆç¡®ä¿ä½ çš„<code>Cargo.toml</code>ä¸­çš„ä¾èµ–å¦‚ä¸‹:</p><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">async-std</span> = &#123;version = <span class="string">&quot;1&quot;</span>, features = [<span class="string">&quot;attributes&quot;</span>, <span class="string">&quot;unstable&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹ä»£ç ,è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„è¡Œæ•°<br>ä½ å¯ä»¥é€šè¿‡ <code>cargo run -- ./src/main.rs</code> è¿è¡Œ<br>(é€šè¿‡targetç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶,åŠ ä¸Šå‚æ•°åè¿è¡Œ,ä¹Ÿå¯ä»¥å“¦)</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;</span><br><span class="line">    env::args,</span><br><span class="line">    process,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> async_std::&#123;</span><br><span class="line">    prelude::*,</span><br><span class="line">    fs::File,</span><br><span class="line">    io::&#123;<span class="keyword">self</span>,BufReader&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[async_std::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; io::<span class="built_in">Result</span>&lt;()&gt; &#123;              <span class="comment">// Start</span></span><br><span class="line">    <span class="keyword">let</span> path = args().nth(<span class="number">1</span>).unwrap_or_else(||&#123;</span><br><span class="line">        eprintln!(<span class="string">&quot;Fuck you! No path for reading&quot;</span>);</span><br><span class="line">        process::exit(<span class="number">1</span>);</span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="keyword">let</span> file = File::open(path).<span class="keyword">await</span>?;          <span class="comment">// Yield point</span></span><br><span class="line">    <span class="keyword">let</span> lines = BufReader::new(file).lines();</span><br><span class="line">    <span class="keyword">let</span> count = lines.count().<span class="keyword">await</span>;             <span class="comment">// Yield point</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;This file contains &#123;&#125; lines&quot;</span>,count);</span><br><span class="line">    <span class="literal">Ok</span>(())</span><br><span class="line">&#125;                                                <span class="comment">// Done</span></span><br></pre></td></tr></table></figure><p>mian()äº§ç”Ÿä¸€ä¸ªæ–°å®ä¾‹,å¼‚æ­¥è¿è¡Œ<code>open(path)</code>ä¸<code>count()</code>  <br>å¯¹äºç¼–è¯‘å™¨,æ¯ä¸€ä¸ª<code>.await</code>å…¶å®éƒ½ä»£è¡¨ä¸€ç§çŠ¶æ€</p><p>Futureå®ä¾‹,å®é™…ä¸Šæ˜¯ä¸ªçŠ¶æ€æœº<br>åœ¨è¿™é‡Œå…±æœ‰å››ç§çŠ¶æ€/é˜¶æ®µ(å…¶ä¸­åŒ…æ‹¬ä¸¤ä¸ª<code>.await point(yield point)</code>):</p><ol><li class="lvl-3"><p>Start: æ­¤Futureåˆšå¼€å§‹æ‰§è¡Œ</p></li><li class="lvl-3"><p>Yield1: ç¬¬ä¸€ä¸ª yield point</p></li><li class="lvl-3"><p>Yield2: ç¬¬äºŒä¸ª yield point</p></li><li class="lvl-3"><p>Done: æ­¤Futureæ‰§è¡Œå®Œæ¯•</p></li></ol><p>è¿™äº›çŠ¶æ€çš„å«ä¹‰æ˜¯: <code>è¡¨ç¤ºå½“å‰Futureæ‰§è¡Œåˆ°äº†å“ªä¸€ä¸ªé˜¶æ®µ</code><br>æ‰§è¡Œå™¨è°ƒç”¨å½“å‰Futureçš„pollæ¨åŠ¨è¿›åº¦æ—¶,è‹¥åœ¨<code>æŸä¸€é˜¶æ®µ</code>è¿”å›äº†<code>Poll::Pending</code>,åˆ™æ”¾å¼ƒæ‰§è¡Œæƒ<br>å½“å†æ¬¡è°ƒç”¨å½“å‰Futureçš„pollæ¨åŠ¨è¿›åº¦æ—¶,åˆ™ä»ä¸Šæ¬¡æš‚åœçš„çŠ¶æ€<code>æ¢å¤(resume)</code>,ç»§ç»­æ‰§è¡Œ</p><p>å®˜æ–¹ç›®å‰ä¼¼ä¹é‡‡ç”¨<code>Generator(ç”Ÿæˆå™¨)</code>ä¸ºå¼‚æ­¥è¯­æ³•ç”ŸæˆçŠ¶æ€æœº<br>æ¯ä¸€ä¸ªçŠ¶æ€éƒ½ä¼šå­˜å‚¨ä¸€äº›æ•°æ®, ä¾¿äºè¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€</p><p><strong>Note 1</strong>:<br>StartçŠ¶æ€,ä¼šå­˜å‚¨ä¼ å…¥å‡½æ•°çš„å‚æ•°(å¦‚æœæœ‰å‚æ•°)</p><p><strong>Note 2</strong>:<br>DoneçŠ¶æ€ä¸‹,è‹¥è¿›è¡Œresume,åˆ™å¯èƒ½å¾—åˆ°panic!<br>å› ä¸ºæ¢å¤å·²ç»“æŸçš„è®¡ç®—æ˜¯ä¸å¯èƒ½, ä¹Ÿä¸åº”è¯¥çš„</p><p><strong>Note 3</strong>:<br>æ€ä¹ˆåˆ¤æ–­æ¯ä¸ªçŠ¶æ€éœ€è¦ä¿å­˜å“ªäº›å˜é‡? å¾ˆç®€å•çš„ä¸€å¥è¯:<br><code>æŸä¸ªyield pointä¹‹å‰å®šä¹‰, ä¸”pointä¹‹åè¿˜éœ€è¦ä½¿ç”¨çš„å˜é‡</code><br>å¦‚ä¸Šæ®µä»£ç ä¸­çš„ <code>file</code> ä¸ <code>count</code>å°±éœ€è¦è¢«ä¿å­˜,å› ä¸ºä»æš‚åœä¸­æ¢å¤åè¿˜éœ€è¦ä½¿ç”¨<br>å…¶ä»–çš„å˜é‡,æ˜¯ä¸€æ¬¡æ€§æ‰§è¡Œå®Œçš„,ä¸ä¼šå‡ºç°ä»€ä¹ˆæš‚åœä¸€ä¸‹,ç­‰ä¼šç»§ç»­çš„ç°è±¡<br>æ‰€ä»¥ä¸éœ€è¦ç‰¹æ®Šçš„æŒä¹…åŒ–æ“ä½œ</p><hr><h1 id="zi-yin-yong-jie-gou-ti">è‡ªå¼•ç”¨ç»“æ„ä½“</h1><h2 id="bao-cun-yin-yong" id="ä¿å­˜å¼•ç”¨">ä¿å­˜å¼•ç”¨</h2><p>å½“æ¯ä¸ªçŠ¶æ€å­˜å‚¨æ•°æ®æ—¶,å¯èƒ½ä¼šå¯¼è‡´å‘ç”Ÿ<code>è‡ªå¼•ç”¨</code>,æ¯”å¦‚:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">example</span></span>() -&gt; <span class="built_in">i32</span> &#123;                            <span class="comment">// Start</span></span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> element = &amp;arr[<span class="number">2</span>];</span><br><span class="line">    write_file(<span class="string">&quot;foo.txt&quot;</span>, element.to_string()).<span class="keyword">await</span>;  <span class="comment">// Yield1</span></span><br><span class="line">    *element                                           <span class="comment">// Done</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸‰ä¸ªçŠ¶æ€: <code>Start</code>,<code>Yield1</code>,<code>Done</code><br>è€Œåœ¨<code>Yield1</code>è¿™ä¸ªçŠ¶æ€,å­˜å‚¨çš„æ•°æ®å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çŠ¶æ€çš„å®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Yield1State</span></span> &#123;</span><br><span class="line">    arr: [<span class="built_in">i32</span>; <span class="number">3</span>],</span><br><span class="line">    element: *<span class="keyword">const</span> <span class="built_in">i32</span>, <span class="comment">// æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŠ¶æ€çš„å®ä¾‹</span></span><br><span class="line">Yield1State &#123;</span><br><span class="line">    arr: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    element: &amp;arr[<span class="number">2</span>] <span class="keyword">as</span> *<span class="keyword">const</span> <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­‰ç­‰,ä½ å¯èƒ½ä¼šå¯¹ä¸Šé¢çš„ä»£ç æœ‰ç–‘æƒ‘:<br>ä¸æ˜¯è¯´,çŠ¶æ€åªéœ€è¦ä¿å­˜ <code>åœ¨yield pointä¹‹å‰å®šä¹‰, å¹¶ä¸”è¯¥pointä¹‹åè¿˜éœ€è¦ä½¿ç”¨çš„å˜é‡</code> å—<br>ä¸Šé¢çš„ä»£ç ,åªæœ‰elementè¿™ä¸ªå¼•ç”¨éœ€è¦è¢«ä¿å­˜å§?</p><p>è¿™æ˜¯å› ä¸º,å®ƒæ˜¯<code>å¼•ç”¨</code>å˜›!<br>æ²¡äº†<code>å¼•ç”¨</code>èƒŒåçš„å®é™…æ•°æ®,é‚£å®ƒè¿˜æœ‰å•¥ç”¨,ä¸å°±æ˜¯<code>æ‚¬å‚å¼•ç”¨</code>äº†å—?</p><p>å› æ­¤æˆ‘ä»¬è¿˜å¾—ä¿å­˜,<code>è¯¥å¼•ç”¨</code>æŒ‡å‘çš„èƒŒåæ•°æ®: <code>arr</code><br>å¹¶<strong>ä¸€èµ·</strong>å­˜å‚¨åœ¨åŒä¸ª<code>struct(ä»£è¡¨åŒä¸€çŠ¶æ€)</code>ä¸­</p><p>åƒè¿™ç§ <code>ç»“æ„ä½“å†…éƒ¨çš„æŒ‡é’ˆ,æŒ‡å‘ç»“æ„ä½“æœ¬èº«</code><br>å°±å« <code>è‡ªå¼•ç”¨ç»“æ„</code></p><p>æ¯”å¦‚ä¸Šé¢ä»£ç : åŒä¸€ç»“æ„ä½“ä¸‹,æˆå‘˜elementæŒ‡å‘äº†æˆå‘˜arr</p><h2 id="nei-cun-yi-dong-wen-ti" id="å†…å­˜ç§»åŠ¨é—®é¢˜">å†…å­˜ç§»åŠ¨é—®é¢˜</h2><p>å¦‚ä¸Šæ‰€è¿°, è¿™å¯èƒ½å¯¼è‡´æ‚¬å‚å¼•ç”¨çš„äº§ç”Ÿ:<br>è‹¥è¯¥structå®ä¾‹çš„<code>å†…å­˜åœ°å€å‘ç”Ÿæ”¹å˜</code><br>(æ¯”å¦‚ä½¿ç”¨<code>std::mem</code>,è®©structå®ä¾‹çš„å†…å­˜åœ°å€,å‘ç”Ÿç§»åŠ¨)</p><p>ä»¥ä¸Šé¢çš„é‚£æ®µä»£ç ä¸ºä¾‹,å¦‚ä¸‹:</p><ul class="lvl-0"><li class="lvl-2"><p>arr:<br>å†…å­˜åœ°å€ä¼šè·Ÿç€ç»“æ„ä½“å®ä¾‹è€Œæ”¹å˜<br>ä½†æ˜¯, <code>å€¼ä»ç„¶æ˜¯ [1,2,3]</code></p></li><li class="lvl-2"><p>element:<br>å†…å­˜åœ°å€ä¼šè·Ÿç€ç»“æ„ä½“å®ä¾‹è€Œæ”¹å˜<br>ä½†æ˜¯,å€¼ä»ç„¶æ˜¯<code>å…ˆå‰arrçš„åœ°å€</code><br><code>æ³¨æ„,æ˜¯å…ˆå‰çš„ ! è€Œä¸æ˜¯åæ¥arrçš„æ–°åœ°å€</code></p></li></ul><p>è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜: å¼•ç”¨å¯èƒ½æ˜¯å¤±æ•ˆ/é”™è¯¯çš„(æ‚¬å‚å¼•ç”¨)</p><p>å®˜æ–¹æå‡ºäº†<code>std::pin::Pin(trait)</code><br>æ¥è§£å†³è‡ªå¼•ç”¨ç»“æ„ä½“æ–¹é¢çš„æ‚¬å‚æŒ‡é’ˆ/å¼•ç”¨é—®é¢˜</p><p>å…¶å®ä½ å¬åå­—ä¹Ÿå¾ˆå¥½ç†è§£:<br><code>Pin(ä¸­æ–‡æ„æ€æ˜¯é’‰å­)</code>çš„ä½œç”¨æ˜¯,é˜²æ­¢å†…å­˜åœ°å€å‘ç”Ÿæ”¹å˜(ç»™çˆ·é’‰æ­»å§!)</p><p>ä½†æ˜¯å®ƒåˆæ˜¯æ€ä¹ˆpinä½çš„å‘¢?<br>ä¸‹ä¸€èŠ‚å†æ…¢æ…¢è®²å§</p><p>é‚£åˆæ˜¯ä¸€ä¸ªå€¼å¾—æ¢è®¨çš„è¯é¢˜äº†<br>æ¬²çŸ¥åäº‹å¦‚ä½•, ä¸”å¬ä¸‹å›åˆ†è§£</p><p><s>(ç–¯ç‹‚çœç•¥, å› ä¸ºæˆ‘ç´¯æ­»äº†, å¤šä¹ˆå¸Œæœ›èµ¶ç´§ç»“æŸè¿™ä¸€På•Š ! !)</s></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æµ…æ˜¾çš„åŸç†ç¬¬ä¸€ç¯‡: çŠ¶æ€çš„ä¿å­˜/å˜æ¢&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Async" scheme="https://jedsek.xyz/tags/Async/"/>
    
  </entry>
  
  <entry>
    <title>rust-async-p3: Future</title>
    <link href="https://jedsek.xyz/posts/rust-async/p3"/>
    <id>https://jedsek.xyz/posts/rust-async/p3</id>
    <published>2021-09-12T05:56:48.000Z</published>
    <updated>2021-09-12T05:56:48.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Rust ä¸­çš„ Future/async/.await è¯´æ˜</p></blockquote><span id="more"></span>  <p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p><h1 id="kai-pian">å¼€ç¯‡</h1><p>å¤§å®¶å¥½! æˆ‘ä»¬ä¸Šä¸€èŠ‚å·²ç»çŸ¥æ™“å¼‚æ­¥çš„åŸºç¡€æ¦‚å¿µ<br>ç°åœ¨,æ¥çœ‹çœ‹Rustä¸­çš„å¼‚æ­¥è¯­æ³•å§</p><p>åœ¨æœ¬èŠ‚,æˆ‘ä»¬ä¼šçŸ¥æ™“ä»¥ä¸‹ä¸‰ä¸ªæ¦‚å¿µçš„å¤§è‡´å«ä¹‰:<br>(æš‚æ—¶ä¸æ¶‰åŠèƒŒååŸç†,åŸç†ä¹‹åä¸“é—¨å‡ºå¥½å‡ èŠ‚æ¥è®²)</p><ul class="lvl-0"><li class="lvl-2"><p>Future (trait)</p></li><li class="lvl-2"><p>async (keyword)</p></li><li class="lvl-2"><p>.await (keyword)</p></li></ul><p>å¼€å§‹æ—…é€”å§</p><hr><h1 id="future">Future</h1><h2 id="gai-nian" id="æ¦‚å¿µ">æ¦‚å¿µ</h2><p><code>Future</code>,ä¸€ä¸ªæ ‡å‡†/æ ¸å¿ƒåº“ä¸­çš„trait<br>å…¶å®Œæ•´è·¯å¾„ä¸º<code>std/core::future::Future</code></p><p>æ­¤èŠ‚æˆ‘åªä¼šè®²å®ƒçš„å¤§è‡´å«ä¹‰,åŸç†åˆ™æ”¾åˆ°åé¢å‡ èŠ‚ä¸“é—¨æ¥è®² <s>(åŸç†å¤ªéš¾, ä¸€èŠ‚æ ¹æœ¬ä¸å¤Ÿ)</s></p><p>åœ¨Rustä¸­,ä¸€ä¸ªå®ç°äº†Future(trait)çš„ç±»å‹<br>è¯¥ç±»å‹çš„å®ä¾‹(æœ‰æ—¶å€™ç›´æ¥è¢«ç®€ç§°ä¸º <code>ä¸€ä¸ªFutureå®ä¾‹</code>)ä¾¿ä»£è¡¨ <code>ä¸€æ¬¡å¼‚æ­¥è®¡ç®—</code><br>å¯ä»¥å°†å…¶äº¤ç»™<code>Runtime(è¿è¡Œæ—¶)</code>,ä»è€Œå¼‚æ­¥æ‰§è¡Œ</p><p><code>å¼‚æ­¥æ‰§è¡Œ</code>, ä¹Ÿå°±æ˜¯æŒ‡:<br>å½“å…¶ä»–å¼‚æ­¥ä»»åŠ¡é˜»å¡æ—¶,å½“å‰å¼‚æ­¥ä»»åŠ¡æœ‰æœºä¼šæ‰§è¡Œ<br>æˆ–å½“å‰å¼‚æ­¥ä»»åŠ¡é˜»å¡æ—¶,å…¶ä»–å¼‚æ­¥ä»»åŠ¡æœ‰æœºä¼šæ‰§è¡Œ<br>æ€»è€Œè¨€ä¹‹,é˜»å¡æ—¶æœŸæ‰§è¡Œå…¶ä»–ä»»åŠ¡,ä¸ç»™cpuç©ºé—²çš„æœºä¼š</p><p><strong>æ³¨æ„ä¸¤ä¸ªåè¯çš„åŒºåˆ«:</strong></p><ul class="lvl-0"><li class="lvl-2"><p><code>å¼‚æ­¥ è®¡ç®—</code></p></li><li class="lvl-2"><p><code>å¼‚æ­¥ ä»»åŠ¡</code></p></li></ul><p>ä¸¤è€…æœ‰ç€åŒºåˆ«,ä¸¾ä¸ªä¾‹å­ä½ å°±æ˜ç™½äº†:</p><p>å‡è®¾æœ‰è¿™ä¹ˆä¸ªçˆ¶è®¡ç®—, ç”±ä¸¤ä¸ªå­è®¡ç®—ç»„æˆ:</p><ol><li class="lvl-3"><p>Open: å…ˆå¼‚æ­¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶(async open)</p></li><li class="lvl-3"><p>Read: å†å¼‚æ­¥è¯»å–è¯¥æ–‡ä»¶(async read)</p></li></ol><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡º,ä¸€æ¬¡è®¡ç®—, æ˜¯å¯ä»¥ç”±å¤šä¸ªå­è®¡ç®—ç»„æˆçš„<br>åŒæ—¶, è‹¥Opené™·å…¥é˜»å¡,Runtimeä¸èƒ½è°ƒåº¦Readå¡«å……è¿™æ®µé˜»å¡æ—¶æœŸ<br>å› ä¸º<code>å­è®¡ç®—ä»¬å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»</code> (åœ¨è¿™é‡Œçš„ä¾‹å­ä¸­ä¹Ÿç¡®å®å­˜åœ¨)</p><p>å› æ­¤,å½“æŸä¸ªå­è®¡ç®—é˜»å¡æ—¶,å®ƒæ‰€å±çš„æœ€é¡¶å±‚çš„çˆ¶è®¡ç®—ä¹Ÿåº”é˜»å¡,é¿å…Runtimeè°ƒåº¦éæ³•è®¡ç®—<br>(æˆ‘ä»¬å°†<code>æœ€é¡¶å±‚çš„çˆ¶è®¡ç®—(top-level Future, å³æœ€é¡¶å±‚çš„Futureå®ä¾‹)</code>ç§°ä¸º<code>Task(ä»»åŠ¡)</code>)</p><p><code>å½“å‰Task</code>é˜»å¡æ—¶,æ¥ç®¡æ‰§è¡Œæƒçš„,ä¸èƒ½æ˜¯å½“å‰Taskä¸­çš„<code>å…¶ä»–å­è®¡ç®—</code><br>åªèƒ½æ˜¯<code>å…¶ä»–Taskä¸­çš„å­è®¡ç®—</code></p><p>æ¥ç‚¹æ€»ç»“å§:</p><ul class="lvl-0"><li class="lvl-2"><p>Taskæ˜¯ä¸€ä¸ªé¡¶å±‚Futureå®ä¾‹ (å³ä¸€æ¬¡é¡¶å±‚å¼‚æ­¥è®¡ç®—)</p></li><li class="lvl-2"><p>ä¸€ä¸ªFutureå¯ä»¥ç”±å¤šä¸ªFutureç»„æˆ,å³ä¸€ä¸ªFutureé‡Œå¯ä»¥æ‰§è¡Œå¤šä¸ªFuture</p></li><li class="lvl-2"><p>Task_Aé˜»å¡æ—¶,æ¥ç®¡æ‰§è¡Œçš„æ˜¯å…¶ä»–Taskä¸­çš„å­è®¡ç®—,ä¸èƒ½æ˜¯Task_Aä¸­çš„å­è®¡ç®—</p></li><li class="lvl-2"><p>Taskå¯ä»¥åªæ˜¯ä¸€æ¬¡å•ç‹¬è®¡ç®—</p></li></ul><p><code>ä¸€ä¸ªFuture (ä¸€æ¬¡å¼‚æ­¥è®¡ç®—)</code><br>å¯ç†è§£ä¸º,æ˜¯ç»„æˆ<code>ä¸€ä¸ªTask (ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡)</code>çš„æœ€å°å•ä½</p><p>äº†è§£åˆ°äº†é‚£ä¹ˆä¸€ç‚¹ç‚¹å,ç°åœ¨æ¥æ­£å¼çœ‹çœ‹å‘— ?</p><h2 id="ding-yi" id="å®šä¹‰">å®šä¹‰</h2><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å®šä¹‰:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Future</span></span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Output</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(<span class="keyword">self</span>: Pin&lt;&amp;<span class="keyword">mut</span> <span class="keyword">Self</span>&gt;, cx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ç®€å•äº†è§£ä¸€ä¸‹:</p><ul class="lvl-0"><li class="lvl-2"><p>Future:<br>ä»£è¡¨ä¸€æ¬¡å¼‚æ­¥è®¡ç®—</p></li><li class="lvl-2"><p>Output:<br>ä»£è¡¨è¯¥Future,å¼‚æ­¥æ‰§è¡Œå®Œæ¯•å,äº§å‡ºçš„å€¼çš„ç±»å‹</p></li><li class="lvl-2"><p>poll:<br>æ‰€æœ‰æ‰§è¡Œæ“ä½œéƒ½ä¼šæ”¾åœ¨è¯¥å‡½æ•°ä¸­<br>Runtime ä¼šä¸æ–­è°ƒç”¨<code>pollå‡½æ•°</code>æ¥æ¨è¿›<code>è¯¥å¼‚æ­¥è®¡ç®—</code>çš„å®Œæˆ<br>æ¯æ¬¡pollçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæšä¸¾å˜ä½“,ä»£è¡¨æ˜¯å¦å®Œæˆ</p></li><li class="lvl-2"><p>Poll<T>:<br>æšä¸¾ç±»å‹,ä½œä¸ºpollå‡½æ•°çš„è¿”å›å€¼ç±»å‹,å…¶å˜ä½“æœ‰:<br><code>Poll::Pending</code>:<br>æŒ‡æ˜è¯¥è®¡ç®—å¤„äºé˜»å¡,è°ƒåº¦ç¨‹åºåœ¨è¯¥è®¡ç®—é˜»å¡å®Œæ¯•å,ç»§ç»­è°ƒç”¨poll(å› ä¸ºä¹‹åå¯èƒ½è¿˜ä¼šé˜»å¡)<br><code>Poll::Ready(T)</code>:<br>æŒ‡æ˜è¯¥è®¡ç®—æ‰§è¡Œå®Œæ¯•,å¹¶äº§å‡ºä¸€ä¸ªç±»å‹ä¸ºTçš„å€¼</p></li></ul><p>è‹¥åªæ˜¯æ™®é€šä½¿ç”¨è€…,å¹¶ä¸éœ€äº†è§£<code>Futureçš„å®šä¹‰</code>èƒŒåä¹‹åŸç†<br>ä½†è‹¥ä¸äº†è§£å®ƒ,åˆå¦‚ä½•ä¸ºæŸç±»å‹å®ç° Future å‘¢?</p><p>åˆ«æ€¥,Rustä¸ºæˆ‘ä»¬æä¾›äº†å…³é”®å­—<code>async</code>,æ¥ç€å¾€ä¸‹çœ‹å§</p><hr><h1 id="async">Async</h1><p><code>async</code>: ä¸€ä¸ªå…³é”®å­—<br>ç”¨æ¥åˆ›å»º<code>ä¸€ä¸ªåŒ¿åç»“æ„ä½“çš„å®ä¾‹, è¯¥ç»“æ„ä½“å®ç°äº†Future</code><br>å³,å®ƒç”¨æ¥åˆ›å»ºä¸€ä¸ª <code>Futureå®ä¾‹</code></p><p>æ¥ä¸ªä¾‹å­,çœ‹çœ‹asyncçš„å¥½å¤„:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1 </span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_str_1</span></span>() -&gt; <span class="built_in">String</span> &#123; </span><br><span class="line">    <span class="built_in">String</span>::from(<span class="string">&quot;Hello! World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HelloStr</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Future <span class="keyword">for</span> HelloStr &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Output</span></span> = <span class="built_in">String</span>;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(<span class="keyword">self</span>: Pin&lt;&amp;<span class="keyword">mut</span> <span class="keyword">Self</span>&gt;, _cx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="built_in">str</span> = <span class="built_in">String</span>::from(<span class="string">&quot;Hello! World!&quot;</span>);</span><br><span class="line">        Poll::Ready(<span class="built_in">str</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">hello_str_2</span></span>() -&gt; <span class="keyword">impl</span> Future&lt;Output = <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    HelloStr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥è§‚å¯Ÿåˆ°,ä½¿ç”¨ async è¿›è¡Œäº†ç¬¦åˆç›´è§‰çš„ç®€åŒ–<br>è¿™ä¸¤ç§å‡½æ•°,å®é™…ä¸Šæ˜¯ç­‰ä»·çš„</p><p>çœ‹çœ‹å®ƒä»¬ä¸¤çš„è¿”å›å€¼,å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_str_1</span></span>() -&gt; <span class="built_in">String</span> &#123; </span><br><span class="line">    <span class="built_in">String</span>::from(<span class="string">&quot;Hello! World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">hello_str_1() <span class="comment">// è¿”å›å€¼ä¸º `impl Future&lt;Output = String&gt;`</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">hello_str_2</span></span>() -&gt; <span class="keyword">impl</span> Future&lt;Output = <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    HelloStr <span class="comment">// Future&lt;Output = String&gt; çš„å®ä¾‹</span></span><br><span class="line">&#125;</span><br><span class="line">hello_str_2() <span class="comment">// è¿”å›å€¼ä¸º `impl Future&lt;Output = String&gt;`  </span></span><br></pre></td></tr></table></figure><p>æ³¨æ„,å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨,åªæ˜¯è¿”å›ä¸€ä¸ª Futureå®ä¾‹<br><strong>ä½†å¹¶æ²¡æœ‰å¼€å§‹æ‰§è¡Œ, å®ƒæ˜¯æƒ°æ€§çš„</strong><br><strong>åªæœ‰è°ƒç”¨Futureçš„pollæ–¹æ³•, æ‰èƒ½æ¨åŠ¨å®ƒçš„æ‰§è¡Œ</strong><br><strong>è€Œè°ƒç”¨pollæ–¹æ³•çš„å·¥ä½œ, åˆ™äº¤ç»™äº†è¿è¡Œæ—¶(æ‰§è¡Œå™¨)</strong></p><p>è¿™æ ·çš„å¥½å¤„å°±åœ¨äº:<br>å°†ä¸€ä¸ªå¼‚æ­¥è®¡ç®—çœ‹ä½œä¸€ä¸ªå˜é‡,æ–¹ä¾¿äº†ä¼ å‚ç­‰å·¥ä½œ</p><p>æ¯”å¦‚,ä½ æƒ³èˆå¼ƒæŸæ¬¡å¼‚æ­¥ä»»åŠ¡,åªéœ€å°†å¯¹åº”çš„Futureå®ä¾‹ç»™dropæ‰, ä½¿å…¶æ‰€æœ‰æƒä¸¢å¤±å³å¯</p><p>asyncçš„ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªFutureå®ä¾‹:</p><ul class="lvl-0"><li class="lvl-2"><p><code>async fn</code>: å¼‚æ­¥å‡½æ•°, è¦æ±‚è¿”å›ä¸€ä¸ª Futureå®ä¾‹</p></li><li class="lvl-2"><p><code>async block</code>: å¼‚æ­¥ä»£ç å—, åˆ›å»ºä¸€ä¸ª Futureå®ä¾‹</p></li><li class="lvl-2"><p><code>async closure</code>: å¼‚æ­¥é—­åŒ…, (ç›®å‰æ˜¯ä¸ç¨³å®šç‰¹æ€§) åˆ›å»ºä¸€ä¸ª Futureå®ä¾‹</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ä¸º `impl Future&lt;Output = String&gt;`</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello</span></span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// è¯¥ä»£ç å—åˆ›å»ºäº†ç±»å‹ä¸º `impl Future&lt;Output = i32&gt;` çš„å®ä¾‹</span></span><br><span class="line"><span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">1_i32</span>;</span><br><span class="line">    a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `async block` ä¹Ÿå¯ä»¥ä½¿ç”¨move  </span></span><br><span class="line"><span class="comment">// è·å¾—å…¶ä¸­ä½¿ç”¨çš„å˜é‡çš„æ‰€æœ‰æƒ  </span></span><br><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::new();</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">    &amp;s </span><br><span class="line">&#125;</span><br><span class="line">s; <span class="comment">// Error: use of moved value</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// é—­åŒ…å› ä¸ºä¸ç¨³å®š, æˆ‘ä¹Ÿæ‡’å¾—è®²äº†......</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªFutureå®ä¾‹, æƒ³å¿…å¤§å®¶å·²ç»äº†è§£ä¸€äºŒ<br>ä½†æ˜¯å¦‚ä½•æ‰§è¡Œä¸€ä¸ªFutureå®ä¾‹?</p><p>è¯·æ¥ç€å¾€ä¸‹çœ‹</p><hr><h1 id="zhi-xing">æ‰§è¡Œ</h1><h2 id="bei-jing-jie-shao" id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h2><p>Rustæœ¬èº«å¹¶ä¸æä¾› <code>å¼‚æ­¥è¿è¡Œæ—¶ (async runtime)</code>, ä»¥ä¾¿è¯­è¨€å†…æ ¸ç²¾å°, ä¾¿äºè¿›åŒ–/è¿­ä»£/ç»´æŠ¤<br>å¼‚æ­¥è¿è¡Œæ—¶ ç”±ç¤¾åŒºæä¾›, å›´ç»•è¯­è¨€æœ¬èº«æä¾›çš„å®šä¹‰ (å¦‚ Future) è¿›è¡Œæ‰©å……, æ¥æ”¯æŒå¼‚æ­¥ç¨‹åº</p><p>å¯ä»¥ä»”ç»†çœ‹çœ‹ Future çš„å®Œæ•´è·¯å¾„: std::future/core::Future<br>æ³¨æ„åˆ°æ²¡æœ‰, å®ƒä¹Ÿå­˜åœ¨äºæ ¸å¿ƒåº“ä¸­ (æ ¸å¿ƒåº“ä¸­å¯¹å¼‚æ­¥çš„æ”¯æŒ, å¹¶ä¸åªæœ‰ Future)</p><p>è¿™æ„å‘³ç€åªè¦ä½ èƒ½ä½¿ç”¨Rust, è¯­è¨€æœ¬èº«å°±ä¼šæä¾› Future ç­‰å®šä¹‰<br>å†åŠ ä¸Šå¼‚æ­¥è¿è¡Œæ—¶æ˜¯å¯é€‰çš„, å‡­å€Ÿ <code>cartes.io</code> ä¸Šæä¾›çš„å¼‚æ­¥è¿è¡Œæ—¶ç›¸å…³çš„carte<br>åœ¨åµŒå…¥å¼ç¯å¢ƒä¸‹, ä¹Ÿèƒ½å¤Ÿè½»æ¾è¿è¡Œå¼‚æ­¥ç¨‹åº</p><p>åœ¨æ­£å¼å¼€å§‹ä¹‹å‰è¯·ç¡®ä¿ä½ å·²ç»åœ¨ <code>Cargo.toml</code> ä¸­æ·»åŠ äº†å¦‚ä¸‹ä»£ç :</p><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">async-std</span> = &#123; version = <span class="string">&quot;1.9&quot;</span>, features = [<span class="string">&quot;attributes&quot;</span>] &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ <code>async-std</code> è¿™ä¸ªæ¯”è¾ƒä¸»æµ, å¯¹æ–°äººå‹å¥½çš„ <code>å¼‚æ­¥è¿è¡Œæ—¶crate</code> ä¸ºä¾‹å­<br>æˆ‘ä»¬æŒ‡å®šäº†ç‰ˆæœ¬, å¹¶ä¸”å¯ç”¨äº† <code>attributes</code> è¿™ä¸ªç‰¹æ€§</p><h2 id="runtime-zhi-xing" id="Runtimeæ‰§è¡Œ">Runtimeæ‰§è¡Œ</h2><p>æˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ª <code>æ‰“å° &quot;hello world&quot; çš„Future</code> å§<br>å¹¶ä¸”ä½¿ç”¨ <code>async-std</code> è¿™ä¸ªå¼‚æ­¥è¿è¡Œæ—¶ç¯å¢ƒæ¥æ‰§è¡Œå®ƒ:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> async_std::task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_world</span></span>() &#123; </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello wrold!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123; </span><br><span class="line">    <span class="keyword">let</span> fut = hello_world();</span><br><span class="line">    task::block_on(fut);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨æœ¬èŠ‚å¼€å§‹ä¸ä¹…,å°±æåˆ°è¿‡çš„<code>å¼‚æ­¥ä»»åŠ¡ (Top-level Future, å³é¡¶å±‚çš„å¼‚æ­¥è®¡ç®—)</code> å—?<br>async_std::task,è¯¥æ¨¡å—,ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡api,æ¥æ‰§è¡Œ/æ“æ§ è¿™äº› <code>Task</code></p><p>æ¯”å¦‚è¿™é‡Œå‡ºç°çš„<code>task::block_on</code>:<br>ä¼ å…¥ä¸€ä¸ªFutureå®ä¾‹,Runtimeä¼šæ‰§è¡Œå®ƒ(è°ƒç”¨pollæ–¹æ³•),å¹¶é˜»å¡è°ƒç”¨çº¿ç¨‹<br>è¯¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åäº§å‡ºçš„å€¼,ä¼šä½œä¸º<code>block_on</code>çš„è¿”å›å€¼</p><p>æˆ‘ä»¬æ‰§è¡Œäº†ä¸€ä¸ªTask,å¹¶ä¸”è¿™ä¸ªTaskæ˜¯å•ä¸ªçš„Future<br>ä½†è‹¥æˆ‘ä»¬æƒ³æ‰§è¡Œç”±å¤šä¸ªå­Futureæ‰€ç»„æˆçš„Task,åˆè¯¥æ€ä¹ˆåŠ?</p><p><code>.await</code> å…³é”®å­—å‡ºåœºäº†!</p><hr><h1 id="await">Await</h1><p><code>.await</code> åªèƒ½å‡ºç°åœ¨ <code>async fn/block</code> å†…éƒ¨<br>åœ¨æŸä¸ªFutureå®ä¾‹çš„åé¢,å¢åŠ <code>.await</code>,é‚£ä¹ˆ<code>è¯¥Futureå®ä¾‹</code>åˆ™ä¼šæ‰§è¡Œ<br>ä½†æ˜¯,å®ƒåªæ˜¯è¡¨è¿°è¿™ä¹ˆä¸ªé€»è¾‘è€Œå·²,å› ä¸ºRustè¯­è¨€æœ¬èº«æ²¡æœ‰å¼‚æ­¥è¿è¡Œæ—¶(æ— æ‰§è¡Œèƒ½åŠ›)<br>çœŸæ­£æ‰§è¡Œçš„è¯,å¾—å°†Futureå®ä¾‹äº¤ç»™è¿è¡Œæ—¶,å¸¦åŠ¨ç€æ‰§è¡Œé‡Œé¢çš„å­Future</p><p>æ¥çœ‹çœ‹å®ƒçš„ä½¿ç”¨:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> async_std::task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello</span></span>() &#123;  </span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;world!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_world</span></span>() &#123; </span><br><span class="line">    hello().<span class="keyword">await</span>;</span><br><span class="line">    world().<span class="keyword">await</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123; </span><br><span class="line">    <span class="keyword">let</span> fut = hello_world();</span><br><span class="line">    task::block_on(fut);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>.await</code>æ˜¯ä¸€ä¸ªæ ‡è®°ç‚¹,å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ª<code>yield point</code><br>Runtimeæ‰§è¡Œåˆ°<code>xxx.await</code>æ—¶,å…ˆä¼šæ‰§è¡Œä¸€æ¬¡<code>xxx</code></p><p>ä¸€å¼€å§‹,ä¼šè°ƒç”¨ä¸€æ¬¡pollå‡½æ•°,æ¨åŠ¨æ‰§è¡Œè¿›åº¦<br>é€šè¿‡å®ƒçš„è¿”å›å€¼,<code>Poll&lt;T&gt;æšä¸¾çš„å˜ä½“</code>,å³<code>Pending</code>æˆ–<code>Ready(T)</code><br>æ¥å†³å®š:</p><ol><li class="lvl-3"><p>è®©å…¶ä»–Taskæ¥ç®¡æ‰§è¡Œæƒ(yield)</p></li><li class="lvl-3"><p>è¯¥Futureæ‰§è¡Œå®Œæ¯•,ç»§ç»­æ‰§è¡Œå½“å‰Task</p></li></ol><p>è‹¥ä¸º<code>Ready</code>: åˆ™é€‰ <code>2</code>,ç»§ç»­å¾€ä¸‹æ‰§è¡Œ(ä¸€ä¸ªTaskå¯èƒ½æ˜¯ç”±å¤šä¸ªFutureæ‰€ç»„æˆ)<br>è‹¥ä¸º<code>Pending</code>: åˆ™é€‰ <code>1</code>,è®©å…¶ä»–ä»»åŠ¡æ¥ç®¡æ‰§è¡Œæƒ(æ¯”å¦‚IOæ“ä½œçš„é˜»å¡æœŸé—´,è®©å…¶ä»–ä»»åŠ¡æ‰§è¡Œ)</p><p>ç¨å¾®æœ‰ç‚¹æ¶‰åŠåŸç†éƒ¨åˆ†,å¯èƒ½æœ‰ç‚¹éš¾ç†è§£,æ¥ä¸ªç®€å•ç²—æš´ç†è§£ç‰ˆ:</p><p><code>.await</code>ä¼šæŒ‡æ˜<code>æ‰§è¡ŒæŸä¸ªFuture</code> è¿™ä¸€é€»è¾‘<br>å½“<code>xxx.await</code>æ‰€åœ¨çš„Taskäº¤ç»™Runtimeæ‰§è¡Œ,å¹¶æ‰§è¡Œåˆ°<code>xxx.await</code> æ—¶<br><code>xxx</code> è¿™ä¸ªFutureå®ä¾‹ä¼šæ‰§è¡Œ</p><p>è‹¥å®ƒé˜»å¡(è¿™æ„å‘³ç€è¯¥Futureæ‰€åœ¨çš„Taskä¹Ÿé˜»å¡)<br>æ‰€ä»¥è°ƒåº¦ç¨‹åºå®‰æ’å…¶ä»–Task,åœ¨è¯¥ç©ºæ¡£æœŸæ‰§è¡Œ<br>è‹¥ä¸é˜»å¡,å°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œ(å¯èƒ½è¿˜æœ‰ç¢°è§<code>.await</code>å“Ÿ), ç›´åˆ°è¯¥Taskç»“æŸ</p><hr><h1 id="bu-chong">è¡¥å……</h1><ul class="lvl-0"><li class="lvl-2"><p><code>#[async_std::main]</code><br>è¿™ç©æ„æ— æ¯”å¸¸è§,æ˜¯ä¸ªå±æ€§å®,è¦åŠ åœ¨mainå‡½æ•°å¤´ä¸Š<br>ä½¿å¾—mainå‰é¢èƒ½è¢«asyncæ‰€ä¿®é¥°<br>ç¨‹åºè¿è¡Œæ—¶,mainå‡½æ•°è¿”å›çš„Future,ä¼šè‡ªåŠ¨äº¤ç»™Runtimeå¼€å§‹è¿è¡Œ,å¦‚ä¸‹:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="meta">#[async_std::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    hello_world().<span class="keyword">await</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº:</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    async_std::task::block_on( <span class="keyword">async</span> &#123;</span><br><span class="line">        hello_world().<span class="keyword">await</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>async_std::task::spawn</code><br>å› ä¸ºè¿™ç©æ„ä¹Ÿå¾ˆå¸¸è§,æ‰€ä»¥å°±è®²ä¸€è®²:<br>å‘å…¶ä¼ å…¥Future,Runtimeä¼šå¼€å§‹è¿è¡Œå®ƒ,å¹¶è¿”å› async_std::task::JoinHandle çš„å®ä¾‹å®ƒå®ç°äº†Future,ä¸æ ‡å‡†åº“ä¸­çš„<code>JoinHandle</code>æ— æ¯”ç›¸ä¼¼<br>ä¸è¿‡é‚£ä¸ªè¿è¡ŒThread,è€Œè¿™ä¸ªè¿è¡ŒTask,<code>join</code>ç›¸åº”åœ°å˜æˆ<code>.await</code><br>æƒ³è®©è¯¥handleä»£è¡¨çš„Taskè¿è¡Œå®Œæ¯•,åº”è¯¥åœ¨è¯¥handleå‰æ”¾ä¸Š<code>.await</code>,å¦‚ä¸‹:</p></li></ul><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> async_std::task;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[async_std::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123; </span><br><span class="line">    <span class="keyword">let</span> handle = task::spawn(<span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="number">1</span> + <span class="number">1</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> two:<span class="built_in">i32</span> = handle.<span class="keyword">await</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Rust ä¸­çš„ Future/async/.await è¯´æ˜&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Async" scheme="https://jedsek.xyz/tags/Async/"/>
    
  </entry>
  
  <entry>
    <title>rust-async-p2: å¼‚æ­¥ç®€ä»‹</title>
    <link href="https://jedsek.xyz/posts/rust-async/p2"/>
    <id>https://jedsek.xyz/posts/rust-async/p2</id>
    <published>2021-09-12T04:04:09.000Z</published>
    <updated>2021-09-12T04:04:09.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å¼‚æ­¥å§</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p><h1 id="kai-pian">å¼€ç¯‡</h1><p><strong>å¼‚æ­¥ç¼–ç¨‹</strong> (Asynchronous programming)<br>æ˜¯ä¸€ç§<strong>å¹¶å‘ç¼–ç¨‹æ¨¡å‹</strong></p><p>ç‰¹ç‚¹æ˜¯é€šè¿‡å°‘é‡<code>OS_thread(ç³»ç»Ÿçº¿ç¨‹)</code><br>å³å¯è¿è¡Œå¤§é‡<code>å¹¶å‘ä»»åŠ¡</code><br>åœ¨æŸäº›åœºæ™¯ä¸‹,å¯ä»¥ç–¯ç‹‚å‹æ¦¨cpuçš„æ€§èƒ½<br><s>(å¥½å§,æœ‰ç‚¹åºŸè¯â€¦)</s></p><hr><h1 id="mo-xing-dui-bi">æ¨¡å‹å¯¹æ¯”</h1><p>ä¸ºä½•é€‰æ‹©å¼‚æ­¥,å®ƒçš„ä¼˜åŠ¿æœ‰å“ªäº›?</p><p>å¯¹äºè¿™ä¸ªé—®é¢˜,æˆ‘ä»¬å°†å¯¹æ¯”<strong>å¼‚æ­¥</strong>ä¸å…¶ä»–<strong>å¹¶å‘æ¨¡å‹</strong><br>ä»¥æ­¤æ¥å‘Šè¯‰å¤§å®¶,ä¸ºä»€ä¹ˆé€‰æ‹©å¼‚æ­¥:</p><p>1.<code>OS Thread (ç³»ç»Ÿçº¿ç¨‹)</code><br>ç”±æ“ä½œç³»ç»Ÿæä¾›çº¿ç¨‹,è¿›è¡Œå¹¶å‘,å¦‚std::thread<br>Good_1:<br>ç®€å•æ˜“ä½¿ç”¨,å»ºæ¨¡èƒ½åŠ›å¼º,è¶³å¤Ÿä¼ ç»Ÿ<br>Good_2:<br>æ“ä½œç³»ç»Ÿå°±æ˜¯è¿è¡Œæ—¶,ä¸Cè¯­è¨€äº¤äº’æ–¹ä¾¿<br>Bad_1:<br>æ•°æ®åŒæ­¥å›°éš¾,æ˜“å‘ç”Ÿæ•°æ®ç«äº‰<br>Bad_2:<br>å°å‹ä»»åŠ¡æ•°é‡å·¨å¤§æ—¶,è‹¥åˆ†åˆ«å¼€ä¸€ä¸ªçº¿ç¨‹,æ‰€éœ€å†…å­˜ä¸åˆ›å»ºçº¿ç¨‹å¼€é”€å·¨å¤§,æ€§ä»·æ¯”æä½</p><p>2.<code>Green Thread (ç»¿è‰²çº¿ç¨‹)</code><br>å®ƒå‡ ä¹ä¸ç³»ç»Ÿçº¿ç¨‹ä¸€æ ·,ä¸è¿‡<code>Runtime(è¿è¡Œæ—¶,jvm/.netå¬è¯´è¿‡å—?)</code>ä»æ“ä½œç³»ç»Ÿå˜ä¸ºäº†ç¨‹åºæœ¬èº«<br>ç»¿è‰²çº¿ç¨‹åªæ˜¯ç”±ç¨‹åºæœ¬èº«æ¨¡æ‹Ÿå‡ºæ¥çš„,ç±»ä¼¼ç³»ç»Ÿçº¿ç¨‹çš„å°å‹çº¿ç¨‹<br>Good:<br>è¿™æ„å‘³ç€,ç¨‹åºæœ¬èº«å¯¹ç»¿è‰²çº¿ç¨‹æœ‰ç»å¯¹çš„ç®¡ç†æƒ<br>æ‰€ä»¥å†…å­˜åˆ†é…ç­‰æ–¹é¢çš„ç²’åº¦æ›´ç»†,æ ¹æ®ä»»åŠ¡å¤§å°è°ƒåº¦å†…å­˜<br>å› æ­¤å †æ ˆå¤§å°,èƒ½å¤Ÿéšæ—¶é—´æ¨ç§»è€Œå¢é•¿<br>å¹¶ä¸”åˆ›å»º/é”€æ¯/åˆ‡æ¢çº¿ç¨‹çš„ä»£ä»·åˆä½åˆå¿«,è½»æ¾åˆ›å»ºæˆåƒä¸Šä¸‡ä¸ªç»¿è‰²çº¿ç¨‹,æ¥å¤„ç†ä»»åŠ¡<br>Bad_1:<br>å®ƒæ˜¯ç¨‹åºæœ¬èº«å®ç°æ¨¡æ‹Ÿå‡ºæ¥çš„çº¿ç¨‹,Runtimeè¾ƒå·¨å¤§<br>è¿è¡Œæ—¶ä¼šä¸€ç›´å­˜åœ¨,å³ä½¿ä½ ä¸ç”¨è¯¥ç‰¹æ€§,å¯¼è‡´æ‹–ç´¯å…¨å±€ç¨‹åºæ€§èƒ½<br>å¹¶ä¸”éš¾ä»¥ä¸Cåº“äº¤äº’<br>è¿™ä¹Ÿæ˜¯Ruståœ¨1.0ç‰ˆæœ¬å‰åˆ å»ç»¿è‰²çº¿ç¨‹çš„ä¸»è¦åŸå› ,è´¯å½»äº†é›¶æˆæœ¬æŠ½è±¡<br>å®ƒæ— æ³•åœ¨è¯­è¨€å±‚é¢è¢«Rustæ”¯æŒ<br>Bad_2:<br>ç»¿è‰²çº¿ç¨‹åœ¨ä¸åŒå¹³å°ä¸Š,å…¶å®ç°å¯èƒ½ä¸åŒ<br>å¯¹å¤šå¹³å°çš„æ”¯æŒ/ç»´æŠ¤/æ”¹è¿›å¾—é å®ç°è€…ä¿è¯</p><p><code>OS Thread</code>ä¸<code>Green Thread</code>ä¸Rustå…³ç³»æ¯”è¾ƒå¤§:<br>ä¸€ä¸ªæ˜¯Rustæ”¯æŒçš„ä¼ ç»Ÿå¹¶å‘,ä¸€ä¸ªæ˜¯Ruståœ¨1.0ä¹‹åä¾¿èˆå¼ƒçš„</p><hr><h1 id="yi-bu">å¼‚æ­¥</h1><p>æˆ‘ä»¬ç»ˆäºè¦ä»‹ç»å¼‚æ­¥()äº† ! ä¹Œæ‹‰ä¹Œæ‹‰ä¹Œæ‹‰ ! ! !<br><s>(æ²¡æŠŠä½ æ†‹åå§ä¼™è®¡?)</s></p><p>æˆ‘ä»¬ä»¥IOæ“ä½œä¸ºä¾‹å­,æ¯•ç«Ÿè¿™ä¹Ÿæ˜¯å¼‚æ­¥å¤§æ”¾å…‰å½©çš„åœ°æ–¹ä¹‹ä¸€<br>å‡è®¾æˆ‘ä»¬æ­£åœ¨å•çº¿ç¨‹ä¸‹,è¯»å–æ–‡ä»¶,å¹¶è¿›è¡Œä¸€ä¸ªè®¡ç®—:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">let</span> file = <span class="comment">/*  */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶, è·å–æ•°æ® </span></span><br><span class="line"><span class="keyword">let</span> data = read(file);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›è¡Œä¸€ä¸ªè®¡ç®—</span></span><br><span class="line">compute()</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹å­,æˆ‘ä»¬ä¼šè¯»å– <code>file</code> è·å– <code>data</code><br>æœŸé—´,æˆ‘ä»¬çš„ç¨‹åº,åšä¸äº†ä»»ä½•å…¶ä»–äº‹æƒ…<br>åªæœ‰ç­‰å¾…<code>IOæ“ä½œ(Input/Output, è¾“å…¥/è¾“å‡º)</code>å®Œæ¯•,æˆ‘ä»¬æ‰èƒ½è¿›è¡Œæ¥ä¸‹æ¥çš„ <code>compute</code></p><p><code>è¯»å–æ–‡ä»¶</code>,å±äº<code>IOæ“ä½œ</code><br>ä¼—æ‰€å‘¨çŸ¥,IOæ“ä½œå¾ˆè€—æ—¶,ç­‰å¾…å®ƒå®Œæˆçš„æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿</p><p>æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•åŠ å¿«é€Ÿåº¦?<br>æ²¡é”™,ç³»ç»Ÿçº¿ç¨‹yyds:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">let</span> file = <span class="comment">/*  */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºæ¯ä¸ªè¯»å–ä»»åŠ¡æ–°å»ºçº¿ç¨‹, å¹¶è·å–å¥æŸ„</span></span><br><span class="line"><span class="keyword">let</span> handle_a = thread::spawan(|| read(file) );</span><br><span class="line"><span class="keyword">let</span> handle_b = thread::spawan(|| compute() );</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨joiné˜»å¡è°ƒç”¨çº¿ç¨‹, ç¡®ä¿å¥æŸ„çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line"><span class="keyword">let</span> data = handle_a.join().unwrap();</span><br><span class="line">handle_b.join().unwrap();</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸¤ä¸ªä»»åŠ¡<code>read</code>ä¸<code>compute</code>æ˜¯ç‹¬ç«‹çš„,æ— ä¾èµ–æ€§<br>æ‰€ä»¥æˆ‘ä»¬<code>spawn</code>äº†ä¸¤ä¸ªçº¿ç¨‹<br>ç¬¬ä¸€ä¸ª: ç”¨äºè¯»å–æ–‡ä»¶,è·å–æ•°æ®ç¬¬äºŒä¸ª: ç”¨äºåœ¨è¯»å–æ–‡ä»¶çš„åŒæ—¶,æ‰§è¡Œç€ <code>compute</code><br>è™½ç„¶é€Ÿåº¦ä¸Šæ¥äº†,ä½†æ˜¯ä»£ä»·ä¹Ÿæœ‰,é‚£å°±æ˜¯é¢å¤–åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹çš„å¼€é”€<br>è€Œå¼‚æ­¥,å°±æ˜¯åªä¾é å•çº¿ç¨‹,ä¹Ÿèƒ½å¤Ÿå®Œæˆä¸Šé¢çš„æ“ä½œ</p><p>å•çº¿ç¨‹ä¸­çš„å¼‚æ­¥(ä¼ª)ä»£ç å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">let</span> file = <span class="comment">/*  */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶, è·å–æ•°æ® </span></span><br><span class="line"><span class="keyword">let</span> data = read_async(file);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›è¡Œä¸€ä¸ªè®¡ç®—</span></span><br><span class="line">compute_async()</span><br></pre></td></tr></table></figure><p>ä½ ä¼šæ³¨æ„åˆ°:<br><code>read</code> -&gt; <code>read_async</code><br><code>compute</code> -&gt; <code>compute_async</code></p><p>æˆ‘ç”¨ä¼ªä»£ç è¡¨ç¤º,è¿™ä¸¤ä¸ªæ“ä½œå˜æˆäº†å¼‚æ­¥æ“ä½œ<br>ä½ æ— éœ€å…³æ³¨è¿™æ˜¯å¦‚ä½•å˜æˆå¼‚æ­¥ç‰ˆæœ¬çš„,è¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜å¼‚æ­¥çš„æ¦‚å¿µ<br>å¦‚ä¸‹:</p><ul class="lvl-0"><li class="lvl-2"><p><code>read</code>:<br>å®ƒä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹,ç­‰å¾…è¯¥æ“ä½œå®Œæ¯•å<br>æ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œ<code>compute</code></p></li></ul><p>é˜»å¡æœŸé—´æ˜¯å‡ ä¹ä¸éœ€è¦cpuå‚ä¸è¿è¡Œçš„<br>ç¨‹åºæ­¤æ—¶å‚»ä¹ä¹åœ°ç­‰å¾…é˜»å¡ç»“æŸ<br>æ— ç–‘æ˜¯å¯¹æ€§èƒ½çš„æµªè´¹,å¯¹cpuçš„ä¸å°Šé‡</p><ul class="lvl-0"><li class="lvl-2"><p><code>read_async</code>:<br>å®ƒå¤„äºé˜»å¡æ—¶,ä¼šè¿è¡Œ<code>compute_async</code><br>çº¿ç¨‹ç”±<code>read_async</code>æ¥ç®¡å˜ä¸ºç”±<code>compute_async</code>æ¥ç®¡<br>å½“é˜»å¡æ—¶é—´ç»“æŸ,åˆ™ç¨‹åºç»§ç»­å˜ä¸ºè¿è¡Œ<code>read_async</code></p></li></ul><p><code>read_async</code>é˜»å¡æ—¶,ç¨‹åºæ˜¯ä¸ä¼šå‚»å‚»ç­‰å¾…çš„:</p><p>è‹¥æ£€æµ‹åˆ°å®ƒå¤„äºé˜»å¡,æ— æ³•å–å¾—è¿›å±•<br>åˆ™ä¼šè¿è¡Œå…¶ä»–å¼‚æ­¥ä»»åŠ¡,ç”±å…¶ä»–å¼‚æ­¥ä»»åŠ¡æ¥ç®¡çº¿ç¨‹</p><p>æ€»è€Œè¨€ä¹‹,å¼‚æ­¥æ“ä½œ,å…¶å®å°±æ˜¯:<br>è‹¥å½“å‰å¼‚æ­¥æ“ä½œå¤„äºé˜»å¡,åˆ™å¯èƒ½è¿è¡Œå…¶ä»–å¼‚æ­¥æ“ä½œ(å¦‚æœæœ‰å…¶ä»–éé˜»å¡çš„å¼‚æ­¥æ“ä½œ)<br>ä½¿å¾—cpuä¸€ç›´å¤„äºè¿ç®—,æ€§èƒ½è¢«æé™å‹æ¦¨</p><p>å¼‚æ­¥æ“ä½œ,å°±åƒæ˜¯å¯ä»¥éšæ„<code>start/stop</code>ä¸€èˆ¬<br>è°ƒåº¦ç¨‹åºèƒ½å¤Ÿå¯¹å®ƒä»¬è¿›è¡Œè°ƒåº¦,å†³å®šå½“å‰è¦è¿ç®—å“ªä¸ªæ“ä½œ<br>ç¡®ä¿ä¸ä¼šå› ä¸ºé˜»å¡è€Œå‚»å‚»ç­‰å¾…</p><p>åªéœ€å•çº¿ç¨‹,å°±å¯ä»¥åšåˆ°åŒæ—¶è¿è¡Œå¤šä¸ª <code>Task(å¼‚æ­¥ä»»åŠ¡)</code><br>å¼‚æ­¥å½“ç„¶ä¹Ÿä¸æ’æ–¥å¤šçº¿ç¨‹:<br>ä¸€ä¸ªçº¿ç¨‹å°±èƒ½å‹æ¦¨å‡ºé«˜æ€§èƒ½,å¤šä¸ªçº¿ç¨‹è¢«å‹æ¦¨å‡ºæ¥çš„æ€§èƒ½å²‚ä¸æ˜¯æ›´é«˜?</p><hr><h1 id="wei-sheng">å°¾å£°</h1><p>Q:<br>é˜»å¡æ—¶æœŸè¿˜èƒ½åŒæ—¶è¿›è¡Œå…¶ä»–æ“ä½œ? IOæ“ä½œä¸ä¼šå ç”¨cpuå—?<br>A:<br>ç°ä»£ç”µè„‘å‘å±•å‡ºäº†ä¸€äº›åˆ†æ‹…IOæ“ä½œå‹åŠ›çš„é«˜ç§‘æŠ€<br>æ‰€ä»¥cpuå¯¹IOæ“ä½œçš„å‹åŠ›è¾ƒå°/æ²¡æœ‰, IOæ—¶èƒ½è¿›è¡Œå…¶ä»–è¿ç®—<br>åªéœ€è¦æœ€åæ¥æ”¶æ•°æ®æ—¶, å‡ºä¸ªåœºå°±è¡Œäº†</p><p>æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºä¸éœ€è¦åœ¨ç­‰å¾…è¾“å…¥è¾“å‡ºæ—¶å°±é‚£æ ·ç­‰ç€<br>ç»™å®ƒä»¬æ‰¾äº‹æƒ…, è®©å®ƒä»¬é—²ä¸ä¸‹æ¥å§!</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å¼‚æ­¥å§&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Async" scheme="https://jedsek.xyz/tags/Async/"/>
    
  </entry>
  
  <entry>
    <title>rust-async-p1: ç³»åˆ—è¯´æ˜</title>
    <link href="https://jedsek.xyz/posts/rust-async/p1"/>
    <id>https://jedsek.xyz/posts/rust-async/p1</id>
    <published>2021-09-12T03:43:19.000Z</published>
    <updated>2021-09-12T03:43:19.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ å¼‚æ­¥(async) ç³»åˆ—</p></blockquote><span id="more"></span><p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p><h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1><p>æ­¤ç³»åˆ—,æˆ‘ä»¬å°†å­¦ä¹ Rustä¸­çš„ <code>å¼‚æ­¥ (Async)</code><br>å½“ç„¶ä¹Ÿä¼šä»‹ç»å¼‚æ­¥æ–¹é¢çš„ç›¸å…³æ¦‚å¿µå’¯</p><hr><h1 id="zi-liao-lai-yuan">èµ„æ–™æ¥æº</h1><ol><li class="lvl-3"><p>ä¹¦ç±</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://rust-lang.github.io/async-book/**">async-book</a></p></li><li class="lvl-2"><p><a href="https://book.async.rs/overview/async-std">async_std/tutorials</a></p></li><li class="lvl-2"><p><a href="https://tokio.rs/tokio/tutorial">tokio/tutorials</a></p></li><li class="lvl-2"><p><a href="https://cfsamson.github.io/books-futures-explained/">Futures Explained in 200 Lines of Rust</a></p></li></ul><ol start="2"><li class="lvl-3"><p>åšå®¢</p></li></ol><ul class="lvl-0"><li class="lvl-2"><p><a href="https://without.boats/blog/">Withoutboatsâ€™s blogs</a></p></li></ul><hr><h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1><p>å‘ç°é”™è¯¯çš„è¯,è¯·åŠæ—¶è·Ÿæˆ‘è”ç³»,æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p><p>æœ€å,è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ å¼‚æ­¥(async) ç³»åˆ—&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://jedsek.xyz/tags/Rust/"/>
    
    <category term="Async" scheme="https://jedsek.xyz/tags/Async/"/>
    
  </entry>
  
</feed>

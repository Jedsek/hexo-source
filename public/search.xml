<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>GNOME å…¥å‘æŒ‡å—</title>
    <url>/posts/desktop-beautify/gnome.html</url>
    <content><![CDATA[<blockquote>
<p>å…³äº GNOME çš„å…¥å‘æŒ‡å—, è®©ä½ äº†è§£, é…ç½®, ç¾åŒ–æ¡Œé¢ç¯å¢ƒ</p>
</blockquote>
<span id="more"></span>
<p><strong>æ³¨æ„:</strong><br>
æœ¬ç¯‡æ–‡ç« çš„é…ç½®çš†åœ¨æ³¨é‡ç®€æ´, é«˜æ•ˆ, ç¾è§‚<br>
æƒ³è¦å¹³é“ºå¼, ç‚«é…·æ•ˆæœ, æ›´å¤šåŠŸèƒ½çš„, è¯·è‡ªè¡Œé…ç½®, æˆ–æŸ¥çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡åšå®¢: <a href="/posts/desktop-beautify/hyprland">Hyprland å¹³é“ºå¼</a><br>
è¯·æ³¨æ„GNOMEç‰ˆæœ¬æ˜¯å¦ç›¸ç¬¦, æœ‰å°‘è®¸åœ°æ–¹æˆ–å› ç‰ˆæœ¬å·®å¼‚è€Œä¸åŒ, æˆ‘å°†å°½é‡ä¿æŒåŒæ­¥, ä½¿è¯¥æ–‡ç« æœ€æ–°<br>
ç›®å‰, è¯¥ç¯‡æ–‡ç« çš„GNOME ç‰ˆæœ¬ä¸º: <strong>42</strong></p>
<h1 id="cheng-pin-zhan-shi">æˆå“å±•ç¤º</h1>
<p>2022å¹´äº†, GNOME åˆé è°±åˆå¥½ç”¨, ä½†æœ‰äº›äººçš„ç•Œé¢ä»ç„¶åƒæ˜¯åå¹´å‰â€¦<br>
æˆ‘ä¸ªäººè®¤ä¸ºç®€æ´+ç¾è§‚æ¯”è¾ƒé‡è¦, å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹è¿›è¡ŒDIY, è¯·è‡ªå·±åŠ¨æ‰‹, ä¸°è¡£è¶³é£Ÿå§!</p>
<p><img data-src="/images/gnome/overview.png" alt="æŒ‰ä¸‹Superåçš„Overview"></p>
<hr>
<h1 id="dconf-amp-amp-gsettings">dconf &amp;&amp; gsettings</h1>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>dconf</code>:<br>
æ˜¯ä¸€å¥—åŸºäºé”®çš„é…ç½®ç³»ç»Ÿ, ååˆ†é«˜æ•ˆ, ç›¸å½“äº Windows ä¸‹çš„æ³¨å†Œè¡¨</p>
</li>
<li class="lvl-2">
<p><code>gsettings</code>:<br>
æ˜¯ GNOME-DE ä¸‹çš„é«˜çº§API, æ˜¯å‘½ä»¤è¡Œå·¥å…·/å‰ç«¯, ç”¨æ¥ç®€åŒ–å¯¹ dconf çš„æ“ä½œ</p>
</li>
</ul>
<p>ä½ å¯èƒ½åœ¨å¹´ä»½ä¹…è¿œçš„æ–‡ç« ä¸­å¬è¯´è¿‡ <code>gconf</code>, è¿™æ˜¯ä»€ä¹ˆ? ä¸ <code>dconf</code> æœ‰å•¥åŒºåˆ«?<br>
ç­”: å…¶ä½œç”¨ä¹Ÿç±»ä¼¼æ³¨å†Œè¡¨, ä½†ç°åœ¨å·²ç»åœæ­¢ä½¿ç”¨, è¢«æ•ˆç‡æ›´é«˜çš„ <code>dconf</code> æ‰€å–ä»£</p>
<p>æ¥ä¸‹æ¥çš„å¤§éƒ¨åˆ†é…ç½®, éƒ½ä¼šä½¿ç”¨ <code>gsettings</code></p>
<hr>
<h1 id="hong-mo-ban">è§¦æ‘¸æ¿</h1>
<p>è§¦æ‘¸æ¿å¯æ˜¯ç¬”è®°æœ¬å…šçš„çµé­‚å•Š, å°¤å…¶å¯¹äºæˆ‘è¿™ç§ä¸‡å¹´ä¸ç”¨é¼ æ ‡, é™¤éæ‰“CSGO <s>(ä½†CSæˆ‘ä¹Ÿèƒ½ç”¨è§¦æ‘¸æ¿ç©)</s></p>
<h2 id="pei-zhi" id="é…ç½®">é…ç½®</h2>
<p>æœ‰ä¸€äº› Linux å‘è¡Œç‰ˆçš„ GNOMEæ¯”è¾ƒè´´è¿‘ä¸Šæ¸¸, <code>è½»å‡»æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»</code> é»˜è®¤æœªå¼€å¯<br>
è¿™å¯¼è‡´è§¦æ‘¸æ¿å¾ˆéš¾ç”¨, å¾—æŒ‰ä¸‹å»æ‰èƒ½æ¨¡æ‹Ÿé¼ æ ‡çš„ç‚¹å‡»</p>
<p>ä½ æƒ³ä¸€æƒ³, ä½ æƒ³é€‰ä¸­ä¸€æ®µæ–‡å­—, å¾—é‡é‡æŒ‰ä¸‹è§¦æ‘¸æ¿, åœ¨å·¨å¤§çš„æ‘©æ“¦åŠ›ä¸‹ç§»åŠ¨æ‰‹æŒ‡â€¦<br>
è€Œä¸”, é»˜è®¤çš„è§¦æ‘¸æ¿, é€Ÿåº¦å¯èƒ½æ¯”è¾ƒæ…¢, åæ­£æˆ‘ä¸é€‚åº”, å› æ­¤éœ€è¦ä¿®æ”¹â€¦<br>
è¿˜æœ‰å°±æ˜¯, è§¦æ‘¸æ¿åœ¨æ‰“å­—çš„æ—¶å€™é»˜è®¤æ˜¯ç¦ç”¨çš„, è¿™å¯¹æœ‰æ—¶ä¼šç”¨è§¦æ‘¸æ¿æ‰“CSGOçš„æˆ‘æ¥è¯´å¾ˆæ„¤æ€’â€¦</p>
<p>ä½ å¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè°ƒæ•´:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad tap-to-click <span class="literal">true</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad speed 0.57</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad disable-while-typing <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«å¯¹åº”:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è½»å‡»æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡», é»˜è®¤ä¸ºfalse</p>
</li>
<li class="lvl-2">
<p>è°ƒæ•´è§¦æ‘¸æ¿é€Ÿåº¦, é»˜è®¤ä¸º0</p>
</li>
<li class="lvl-2">
<p>æ‰“å­—æ—¶ç¦ç”¨è§¦æ‘¸æ¿, é»˜è®¤ä¸ºtrue</p>
</li>
</ul>
<h2 id="shou-shi" id="æ‰‹åŠ¿">æ‰‹åŠ¿</h2>
<ul class="lvl-0">
<li class="lvl-2">
<p>å•æŒ‡: ç§»åŠ¨é¼ æ ‡</p>
</li>
<li class="lvl-2">
<p>åŒæŒ‡ä¸Šä¸‹: ç¿»é¡µ</p>
</li>
<li class="lvl-2">
<p>ä¸‰æŒ‡å·¦å³: åˆ‡æ¢Workspace</p>
</li>
<li class="lvl-2">
<p>ä¸‰æŒ‡ä¸Š: æ‰“å¼€Overview (ä¸å¸¸ç”¨, æŒ‰Superæ›´å¿«)</p>
</li>
<li class="lvl-2">
<p>ä¸‰æŒ‡ä¸‹: æ˜¾ç¤ºä»»åŠ¡æ  (å½“ä½ éšè—ä»»åŠ¡æ æ—¶)</p>
</li>
</ul>
<hr>
<h1 id="an-zhuang-kuo-zhan">å®‰è£…æ‰©å±•</h1>
<p>GNOME çš„æ‰©å±•(Extensions)æ˜¯å…¶é‡è¦çš„ç»„æˆ, èµ‹äºˆäº†éšæ„ç»„åˆçš„è‡ªç”±ä¸å¼ºå¤§, è¯´æ˜¯ä¸€åŠçš„çµé­‚, ä¹Ÿä¸ä¸ºè¿‡ä¹‹<br>
æˆ‘å°†å…ˆä»‹ç»å¦‚ä½•å®‰è£…/ä½¿ç”¨å®ƒä»¬, å› ä¸ºåé¢éœ€è¦ç”¨åˆ°æ‰©å±•</p>
<p>æœ‰ä¸¤ç§å®‰è£…æ–¹æ³•, ä¸€ç§ä»å‘½ä»¤è¡Œå®‰è£…, ä¸€ç§ä»æµè§ˆå™¨å®‰è£…<br>
æˆ‘æ›´å€¾å‘äºå‰è€…, å› ä¸ºä¸éœ€è¦ä¸‹è½½å¯¹åº”çš„ä¸œè¥¿, é€‚åˆå¿«é€Ÿéƒ¨ç½², ä½†ä¸¤è€…æˆ‘éƒ½ä¼šä»‹ç»</p>
<h2 id="cong-ming-ling-xing" id="ä»å‘½ä»¤è¡Œ">ä»å‘½ä»¤è¡Œ</h2>
<p><strong>æç¤º</strong><br>
è¯·ç¡®ä¿æ‹¥æœ‰ä»¥ä¸‹å‘½ä»¤: unzip, jq, æœ‰äº›å‘è¡Œç‰ˆé»˜è®¤è¿ unzip éƒ½æ²¡æœ‰â€¦<br>
ä¸‹è½½æˆåŠŸå, åˆ‡è®°è¦ logout, ç„¶åå†ç™»è¿›æ¥</p>
<p>æ¯ä¸ªGNOMEæ‰©å±•éƒ½æ‹¥æœ‰ç‹¬ä¸€æ— äºŒçš„, åä¸º <code>uuid</code> çš„æ ‡è¯†ç¬¦, æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>uuid</code>, ä¸‹è½½æ‰©å±•</p>
<p>ä½ å¯ä»¥åœ¨ <a href="https://extensions.gnome.org/">Extensions-GNOME</a> è¿™ä¸ªç½‘ç«™ä¸Š, æµè§ˆå¹¶ä¸‹è½½æ‰©å±•<br>
è¯·å°†ä»¥ .zip ç»“å°¾çš„æ‰©å±•æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹, å‡è®¾è¯¥ç›®å½•å« <code>exts_list</code></p>
<p>ä¸‹é¢æ˜¯ Bash/Fish è„šæœ¬, ä¼ å…¥è¯¥ç›®å½•çš„è·¯å¾„, è‡ªåŠ¨è¿›è¡Œå®‰è£…:</p>
<div class="tabs" id="install-extensions"><ul class="nav-tabs"><li class="tab active"><a href="#install-extensions-1">Bash</a></li><li class="tab"><a href="#install-extensions-2">Fish</a></li></ul><div class="tab-content"><div class="tab-pane active" id="install-extensions-1"><figure class="highlight bash"><figcaption><span>install-extensions.sh</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">declare</span> -a UUID_LIST</span><br><span class="line">EXTS_DIR=<span class="variable">$HOME</span>/.<span class="built_in">local</span>/share/gnome-shell/extensions</span><br><span class="line">EXTS_LIST=<span class="variable">$&#123;1&#125;</span></span><br><span class="line"><span class="function"><span class="title">str_join</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;$*&quot;</span> | sed <span class="string">&#x27;s/&quot;&quot;/&quot;,&quot;/g&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">mkdir -p <span class="variable">$EXTS_DIR</span></span><br><span class="line">chmod -R 755 <span class="variable">$HOME</span>/.<span class="built_in">local</span>/</span><br><span class="line"><span class="keyword">for</span> EXT <span class="keyword">in</span> <span class="variable">$EXTS_LIST</span>/*.zip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  UUID=$(unzip -p <span class="variable">$EXT</span> metadata.json | jq -r <span class="string">&quot;.uuid&quot;</span>)</span><br><span class="line">  mkdir -p <span class="variable">$EXTS_DIR</span>/<span class="variable">$UUID</span></span><br><span class="line">  unzip -q -o <span class="variable">$EXT</span> -d <span class="variable">$EXTS_DIR</span>/<span class="variable">$UUID</span></span><br><span class="line">  UUID_LIST+=<span class="string">&quot;\&quot;<span class="variable">$UUID</span>\&quot;&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">UUID_LIST=[$(str_join <span class="variable">$&#123;UUID_LIST[@]&#125;</span>)]</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell enabled-extensions <span class="variable">$&#123;UUID_LIST[@]&#125;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="install-extensions-2"><figure class="highlight bash"><figcaption><span>install-extensions.fish</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> exts_list <span class="variable">$argv</span>[1]</span><br><span class="line"><span class="built_in">set</span> exts_dir <span class="variable">$HOME</span>/.<span class="built_in">local</span>/share/gnome-shell/extensions/</span><br><span class="line"><span class="built_in">set</span> uuid_list</span><br><span class="line">mkdir -p <span class="variable">$exts_dir</span></span><br><span class="line"><span class="keyword">for</span> ext <span class="keyword">in</span> exts_list/*.zip</span><br><span class="line">  <span class="built_in">set</span> uuid ( unzip -p <span class="variable">$ext</span> metadata.json | jq -r <span class="string">&quot;.uuid&quot;</span> )</span><br><span class="line">  mkdir -p <span class="variable">$ext_dir</span>/<span class="variable">$uuid</span></span><br><span class="line">  unzip -q -o <span class="variable">$ext</span> -d <span class="variable">$ext_dir</span>/<span class="variable">$uuid</span></span><br><span class="line">  <span class="built_in">set</span> -a uuid_list \<span class="string">&#x27;$uuid\&#x27;</span></span><br><span class="line">end</span><br><span class="line"><span class="built_in">set</span> uuid_list [( string join <span class="string">&quot;,&quot;</span> <span class="variable">$uuid_list</span> )]</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell enabled-extensions <span class="variable">$uuid_list</span></span><br></pre></td></tr></table></figure></div></div></div>
<p>å‡è®¾ä½¿ç”¨Bash: æ‰§è¡Œ <code>sh install-extensions.sh exts_list</code> ä¸‹è½½è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ’ä»¶</p>
<p><strong>æ³¨æ„: å…ˆlogout, å†ç™»è¿›æ¥</strong></p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡dbuså®‰è£…, ä½†è·å–uuidè¿˜å¾—è§£å‹zip, ä½•ä¸ç›´æ¥åƒä¸Šé¢é‚£æ ·æ‰‹åŠ¨å®‰è£…? æ‰€ä»¥ä¸æ¨è:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dbus-send --<span class="built_in">type</span>=method_call --dest=org.gnome.Shell /org/gnome/Shell \</span><br><span class="line">  org.gnome.Shell.Extensions.InstallRemoteExtension string:<span class="string">&#x27;xxxxx_uuid&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="cong-liu-lan-qi" id="ä»æµè§ˆå™¨">ä»æµè§ˆå™¨</h2>
<p>è¯¥æ–¹æ³•å…¶å®ä¹Ÿè›®æ–¹ä¾¿çš„, ä½†ä¸é€‚åˆå¿«é€Ÿéƒ¨ç½²<br>
ä½ éœ€è¦å®‰è£…ä¸¤ä¸ªç©æ„, æ‰èƒ½ç›´æ¥ä» <a href="https://extensions.gnome.org/">Extension-GNOME</a> ä¸Šç›´æ¥ä¸‹è½½</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>chrome-gnome-shell</code>:<br>
æœ¬åœ°è½¯ä»¶, ä½ å¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨, ç›´æ¥æœè¿™ä¸ªåå­—</p>
</li>
<li class="lvl-2">
<p><code>GNOME Shell integration</code>:<br>
æµè§ˆå™¨æ’ä»¶, Chrome/Firefox çš„æµè§ˆå™¨å•†åº—éƒ½æœ‰å®ƒ<br>
Edge çš„æ’ä»¶å•†åº—é‡Œæ— , ä½†å¯ä»¥ä¸‹è½½ iGuge (è°·æ­Œè®¿é—®åŠ©æ‰‹), ç„¶åä¸‹Chromeçš„æ’ä»¶</p>
</li>
</ul>
<p>ä¸€ä¸ªåœ¨æœ¬åœ°, ä¸€ä¸ªåœ¨æµè§ˆå™¨,  å› æ­¤å¯ä»¥æ”¯æŒä½ ä» <a href="https://extensions.gnome.org/">ç½‘ç«™</a> ä¸Š ç›´æ¥å®‰è£…åˆ°æœ¬åœ°</p>
<hr>
<h1 id="cha-kan-pei-zhi-kuo-zhan">æŸ¥çœ‹/é…ç½®æ‰©å±•</h1>
<p>é€šè¿‡ <code>gnome-extensions</code> è¿™ä¸ªå‘½ä»¤, æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹/é…ç½®å½“å‰æ‰©å±•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å–å¸®åŠ©, `Command` ä¸ºå¯é€‰é¡¹</span></span><br><span class="line">gnome-extensions <span class="built_in">help</span> [Command]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰©å±•åˆ—è¡¨</span></span><br><span class="line">gnome-extensions list --user    <span class="comment"># æŸ¥çœ‹ç”¨æˆ·çº§æ‰©å±•</span></span><br><span class="line">gnome-extensions list --system  <span class="comment"># æŸ¥çœ‹ç³»ç»Ÿçº§æ‰©å±•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰©å±•çš„ä¿¡æ¯</span></span><br><span class="line">gnome-extensions info launch-new-instance@gnome-shell-extensions.gcampax.github.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨/ç¦ç”¨æŸä¸ªæ‰©å±•</span></span><br><span class="line">gnome-extensions <span class="built_in">enable</span> nothing-to-say@extensions.gnome.wouter.bolsterl.ee</span><br><span class="line">gnome-extensions <span class="built_in">disable</span> nothing-to-say@extensions.gnome.wouter.bolsterl.ee</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æŸä¸ªæ‰©å±• (æ‰“å¼€ GUI ç•Œé¢)</span></span><br><span class="line">gnome-extensions prefs nothing-to-say@extensions.gnome.wouter.bolsterl.ee</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…é€šè¿‡ <code>gsettings</code> æ¥é…ç½®æŸä¸ªæ‰©å±•, ä½†ä¸æ¨è, å› ä¸ºéº»çƒ¦:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªæ‰©å±•çš„æ‰€æœ‰é€‰é¡¹</span></span><br><span class="line">gsettings --schemadir ~/.<span class="built_in">local</span>/share/gnome-shell/extensions/nothing-to-say@extensions.gnome.wouter.bolsterl.ee/schemas/  \</span><br><span class="line">  list-recursively org.gnome.shell.extensions.nothing-to-say</span><br><span class="line">  </span><br><span class="line"><span class="comment"># å¾—åˆ°/é‡ç½®/è®¾ç½® æŸä¸ªæ‰©å±•çš„æŸé€‰é¡¹å½“å‰çš„å€¼ (æ ¹æ®ä¸Šé¢è¿™æ¡å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰é€‰é¡¹)</span></span><br><span class="line">gsettings --schemadir ~/.<span class="built_in">local</span>/share/gnome-shell/extensions/nothing-to-say@extensions.gnome.wouter.bolsterl.ee/schemas/  \</span><br><span class="line">  get    org.gnome.shell.extensions.nothing-to-say show-osd</span><br><span class="line"><span class="comment"># reset  org.gnome.shell.extensions.nothing-to-say show-osd</span></span><br><span class="line"><span class="comment"># set    org.gnome.shell.extensions.nothing-to-say show-osd</span></span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥å‚è€ƒæˆ–<a href="#jia-zai-pei-zhi"><strong>ç›´æ¥åŠ è½½</strong></a>æˆ‘åšå®¢ä¸‹çš„ <a href="/downloads/gnome/dconf.settings"><strong>dconf.settings</strong></a><br>
<strong>æ³¨æ„:</strong> å¦‚ä½•ä½ é€‰æ‹©ç›´æ¥åŠ è½½æˆ‘çš„é…ç½®, è¯·æ³¨æ„ <code>picture-uri</code> ç¬¦åˆè‡ªå·±å®é™…</p>
<hr>
<h1 id="tui-jian-de-kuo-zhan">æ¨èçš„æ‰©å±•</h1>
<p>ä»¥ä¸‹æ˜¯æˆ‘ç›®å‰æ­£åœ¨ä½¿ç”¨ä¸”æ¨èçš„æ‰©å±•</p>
<p><strong>æ³¨æ„:</strong><br>
å¦‚æœä½ æ˜¯é€šè¿‡æˆ‘çš„åšå®¢ jedsek.xyz è§‚çœ‹çš„è¯, æˆ‘é»˜è®¤éšè—äº†è¿™äº›å›¾ç‰‡<br>
ä½ å¯ä»¥å±•å¼€ä»»æ„ä¸€å¼ å›¾ç‰‡å, ç‚¹å‡»å›¾ç‰‡, åœ¨ fancybox ç§é€šè¿‡æ–¹å‘é”®åˆ‡æ¢å›¾ç‰‡ ğŸ˜ƒ</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/16/auto-move-windows/">auto-move-windows</a>:<br>
é€šè¿‡æŒ‡å®šçª—å£è§„åˆ™, ä½¿å¾—æ‰“å¼€æŸä¸ªappæ—¶, å°†å…¶è‡ªåŠ¨åˆ†é…åˆ°ç‰¹å®šå·¥ä½œåŒº (éœ€è¦æŒ‡å®šçš„.desktopæ–‡ä»¶)<br>
<strong>æ— å›¾ç‰‡</strong></p>
</li>
</ul>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/905/refresh-wifi-connections/">refresh-wifi-connections</a><br>
å½“ä½ é€šè¿‡å³ä¸Šè§’çš„èœå•é€‰æ‹© WIFI æ—¶, ä¼šå¤šå‡ºæ¥ä¸€ä¸ªåˆ·æ–°é”®</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/refresh-wifi-connections.png" alt="refresh-wifi-connections"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/1446/transparent-window-moving/">transparent-window-moving</a><br>
åœ¨å¯¹çª—å£è¿›è¡Œç§»åŠ¨/è°ƒæ•´å¤§å°æ—¶, ä½¿çª—å£å˜å¾—é€æ˜</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/transparent-window-moving.png" alt="transparent-window-moving"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3843/just-perfection/">just-perfection</a><br>
æˆ‘æœ€å–œæ¬¢çš„ä¸€ä¸ªæ‰©å±•, ç”¨äºå¯¹ç•Œé¢è¿›è¡Œå¤§é‡è‡ªå®šä¹‰ä¸ç²¾ç®€<br>
æ¯”å¦‚, å¯ä»¥éšè— Dash (æŒ‰Superååº•éƒ¨çš„ä¸€è¡Œ), æ”¹å˜é¡¶æ å…ƒç´ ç­‰</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview.png" alt="just-perfection"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3139/eye-extended/">eye-extended</a><br>
å¾ˆæœ‰è¶£çš„æ‰©å±•, å¹³æ—¶å½“ä½œå°æŒ‚ä»¶, ä½†å±æœºæ—¶æˆ–è®¸å¯ä»¥æ´¾ä¸Šç”¨åœº<br>
åœ¨é¡¶æ æ˜¾ç¤ºä¸€ä¸ªçœ¼ç›, çœ¼ç å­ä¼šä¸€ç›´æ³¨è§†ç€ä½ çš„é¼ æ ‡, ç‚¹ä¸€ä¸‹ä¼šå‡ºç°ä»¥ä½ é¼ æ ‡ä¸ºä¸­å¿ƒçš„é»„è‰²åœ†åœˆ</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/eye-extended.png" alt="eye-extended"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/1113/nothing-to-say/">nothing-to-say</a><br>
ç”¨äºåˆ‡æ–­/æ¢å¤å£°éŸ³çš„è¾“å…¥, å¯¹æˆ‘æ¥è¯´è›®æœ‰ç”¨çš„:<br>
å½“ä¸åŒå­¦æ‰“æ¸¸æˆ, æ’ä¸Šçˆ¸å¦ˆæŸ¥æˆ¿, ç«‹åˆ»æŒ‰ä¸‹ <code>Super+\</code>, é˜²æ­¢çˆ¸å¦ˆè®­æˆ‘çš„å£°éŸ³æµå…¥åŒå­¦è€³ä¸­, ç»´æŠ¤å°Šä¸¥ ğŸ˜ƒ</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/nothing-to-say.png" alt="nothing-to-say"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/5090/space-bar/">space-bar</a><br>
æ¨¡ä»¿ I3/Sway/Bspwm ç­‰çª—å£ç®¡ç†å™¨, å°†å·¦ä¸Šè§’çƒ¦äººçš„ <code>Activities</code> æ›¿æ¢ä¸º <code>Workspaces</code>, æœ‰äº›ç±»ä¼¼çš„æ‰©å±•, ä½†è¿™ä¸ªæœ€å¥½</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/space-bar.png" alt="space-bar"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4696/static-background-in-overview/">static-background-in-overview</a><br>
åœ¨æŒ‰ä¸‹ <code>Super</code> è¿›å…¥ <code>Overview</code> æ—¶, èƒŒæ™¯å›¾ç‰‡èƒ½å¤Ÿå¡«è¡¥å››è¾¹çš„ç©ºç¼º, æ¯”èµ·é»˜è®¤çš„å››å‘¨é»‘æ¡†æ¡†æ›´åŠ å¥½çœ‹</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview.png" alt="static-background-in-overview"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4788/workspace-switcher-manager/">workspace-switcher-manager</a><br>
ç¾åŒ–é€šè¿‡é”®ç›˜(æˆ‘é…æˆäº† <code>Super + 1..9</code>), åˆ‡æ¢å·¥ä½œåŒºæ—¶çš„åŠ¨ç”»æ•ˆæœ, å¾ˆèµå¾ˆå¥½çœ‹, å¯ä»¥é«˜åº¦ DIY</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/workspace-switcher-manager.png" alt="workspace-switcher-manager"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4290/disable-workspace-switch-animation-for-gnome-40/">disable-workspace-switch-animation-for-GNOME40+</a><br>
æ¶ˆé™¤é€šè¿‡é”®ç›˜åˆ‡æ¢å·¥ä½œåŒºæ—¶çš„è¿‡æ¸¡åŠ¨ç”», è·å¾—æ€¥é€Ÿåˆ‡æ¢çš„ä½“éªŒæ„Ÿ<br>
<strong>æ— å›¾ç‰‡</strong></p>
</li>
</ul>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/1319/gsconnect/">gsconnect</a><br>
GNOMEç‰ˆçš„ <code>kdeconnect</code>, ç”¨äºç”µè„‘ä¸æ‰‹æœºäº’è¿ (ä¸€ä¸ªç½‘ä¸‹), åœ¨å³ä¸Šè§’èœå•æ·»åŠ å¯¹åº”èœå•, ä»¥ä¾¿å¿«é€Ÿæ‰“å¼€<br>
æ‰‹æœºéœ€å®‰è£… <code>kdeconnect</code>, ä½ å¯ä»¥ä»æœ¬åšå®¢ä¸‹è½½ apk è¿›è¡Œå®‰è£…: <a href="/downloads/gnome/kdeconnect.apk">kdeconnect</a></p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/gsconnect.png" alt="gsconnect"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3193/blur-my-shell/">blur-my-shell</a><br>
ç”¨äºè®©é¢æ¿, é¡¶æ , Overview, é”å±, gnomeè‡ªå¸¦çš„æˆªå±, ç”šè‡³ç‰¹å®šçš„app, éƒ½èƒ½è¢«æ¯›ç»ç’ƒåŒ–, å¾ˆå¼ºå¤§çš„æ‰©å±•</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview.png" alt="blur-my-shell"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3488/big-avatar/">big-avatar</a><br>
è®©å³ä¸Šè§’èœå•å‡ºç°ä½ çš„å¤´åƒ, ç‚¹å‡»ä¹‹åè§¦å‘è‡ªå®šä¹‰çš„å‘½ä»¤, ä½†è¿™åŠŸèƒ½ä¸å¸¸ç”¨, æå‡é€¼æ ¼è€Œå·²</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/big-avatar.png" alt="big-avatar"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4530/cpudots/">cpudots</a><br>
ç›‘è§†ä½ å½“å‰çš„CPUé¢‘ç‡, ä»¥ç™¾åˆ†æ•°çš„å½¢å¼å‘ˆç°åœ¨é¡¶æ </p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/right-corner.png" alt="cpudots"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4817/colorful-battery-indicator/">colorful-battery-indicator</a><br>
è®©å³ä¸Šè§’çš„ç”µæ± å˜æˆå½©è‰², æ ¹æ®ç”µé‡, åˆ†åˆ«å‘ˆç°ç»¿è‰², é»„è‰², é»„è‰², ç¾è§‚ä¸”æç¤ºä½œç”¨å¼º</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/right-corner.png" alt="colorful-battery-indicator"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4158/gnome-40-ui-improvements/">gnome40-ui-improvements</a><br>
æŒ‰ä¸‹ <code>Super</code>, è¿›å…¥ <code>Overview</code> å, åœ¨ä¸­ä¸Šæ–¹æ˜¾ç¤ºå·¥ä½œåŒºçš„å†…å®¹</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/gnome40-ui-improvements.png" alt="gnome40-ui-improvements"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3956/gnome-fuzzy-app-search/">gnome-fuzzy-app-search</a><br>
å‡ºäºæŸäº›ç›®çš„, é»˜è®¤çš„ <code>GNOME</code> åœ¨ <code>Overview</code> ä¸­ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥æ‰¾, å¯ä»¥é€šè¿‡è¯¥æ‰©å±•ä¿®æ”¹</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/gnome-fuzzy-app-search.png" alt="gnome-fuzzy-app-search"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4691/pip-on-top/">pip-on-top</a><br>
å½“ä½ é€šè¿‡æµè§ˆå™¨ä¸­çš„ç”»ä¸­ç”»æ¨¡å¼, è§‚çœ‹è§†é¢‘æ—¶, è®©çª—å£ä¸€ç›´ä¿æŒåœ¨æœ€é¡¶éƒ¨, å³ä½¿ç„¦ç‚¹åœ¨åˆ«çš„çª—å£<br>
<strong>æ— å›¾ç‰‡</strong></p>
</li>
</ul>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/4792/frequency-boost-switch/">frequency-boost-switch</a><br>
åœ¨å³ä¸Šè§’èœå•ä¸­çš„ <code>ç”µæ± ç­–ç•¥</code> ä¸­æ·»åŠ ä¸€ä¸ª <code>Checkox</code>, ç”¨äºåˆ‡æ¢ <code>æ˜¯å¦å…è®¸è¶…é¢‘</code></p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/frequency-boost-switch.png" alt="frequency-boost-switch"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/1702/overview-navigation/">overview-navigation</a><br>
å½“æŒ‰ä¸‹ <code>Super</code> è¿›å…¥ <code>Overview</code> å, å¯ä»¥æŒ‰ä¸‹ <code>ç©ºæ ¼é”®</code>, çª—å£ä¸Šä¼šå‡ºç°å­—æ¯<br>
è¾“å…¥å°å†™å­—æ¯å°±åˆ‡æ¢åˆ°å¯¹åº”çª—å£, æŒ‰ä¸‹ <code>Shift</code> ä¼šä½¿å­—æ¯é¢œè‰²å˜çº¢, æ­¤æ—¶è¾“å…¥å­—æ¯ä¼šå…³é—­å¯¹åº”çª—å£</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview-navigation.png" alt="overview-navigation"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3759/cleaner-overview/">cleaner-overview</a><br>
è¿›å…¥ <code>Overview</code> æ—¶, å°†çª—å£æ’åˆ—æ•´é½, ç®€å•å®ç”¨</p>
</li>
</ul>
<details>
<summary><span class="pre-summary">&nbsp;</span><strong>ç‚¹å‡»å±•å¼€/éšè—å›¾ç‰‡</strong></summary><p><img data-src="/images/gnome/overview-navigation.png" alt="cleaner-overview"></p>
</details>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/19/user-themes/">user-theme</a><br>
ä»ç”¨æˆ·ç›®å½•åŠ è½½å¯¹åº”çš„ä¸»é¢˜ (ä¹‹åçš„æ¢ä¸»é¢˜æ•™ç¨‹ä¸­ä¼šè®²åˆ°)<br>
æ³¨æ„: è¿˜éœ€è¦ä½¿ç”¨ <code>gnome-extensions prefs user-theme@gnome-shell-extensions.gcampax.github.com</code> æŒ‡å®šä¸»é¢˜<br>
<strong>æ— å›¾ç‰‡</strong></p>
</li>
</ul>
<br>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://extensions.gnome.org/extension/3414/user-stylesheet-font/">user-syle-sheet</a><br>
è¯»å– <code>~/.local/share/gnome-shell/gnome-shell.css</code> ç›´æ¥ä¿®æ”¹ GNOME çš„é»˜è®¤CSS, ååˆ†é€†å¤©, é€‚åˆé‡åº¦ DIY æ‚£è€…<br>
<strong>æ— å›¾ç‰‡</strong></p>
</li>
</ul>
<hr>
<h1 id="mei-hua">ç¾åŒ–</h1>
<p>ä»¥ä¸‹ç¾åŒ–å·¥ä½œæ¶‰åŠæš—æ¨¡å¼, èƒŒæ™¯, å¤´åƒ, ä¸»é¢˜, å­—ä½“, Dashç­‰<br>
è¿˜æœ‰å¾ˆå¤šæ‰©å±•æœ‰å¸®åŠ©, ä¸Šé¢ <a href="#tui-jian-de-kuo-zhan">æ¨èçš„æ‰©å±•</a> é‡Œæœ‰æåˆ°, æ¯”å¦‚é‚£ä¸ªæ›´æ”¹cssçš„, è¿™é‡Œä¸è¯´äº†</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¯åŠ¨æš—æ¨¡å¼:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.interface color-scheme <span class="string">&quot;prefer-dark&quot;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>èƒŒæ™¯å£çº¸: æš—æ¨¡å¼ä¸‹çš„èƒŒæ™¯ä¸æ™®é€šæ¨¡å¼å¯ä»¥ä¸ä¸€æ ·, å› æ­¤ä¹Ÿè¦æ³¨æ„è®¾ç½®ä¸‹</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.background picture-uri <span class="string">&#x27;file:///usr/share/backgrounds/aaa.png&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.background picture-uri-dark <span class="string">&#x27;file:///usr/share/backgrounds/aaa.png&#x27;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¤´åƒ: å‡è®¾ç”¨æˆ·åæ˜¯ <code>Xyz</code>, åˆ™éœ€è¦å°†å›¾ç‰‡å‘½åä¸º <code>Xyz</code>, éšåæ”¾åˆ° <code>/var/lib/AccountsService/icons/</code> ä¸‹</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mv ./Xyz /var/lib/AccountsService/icons/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–å°†å›¾ç‰‡å‘½åä¸º.face, æ”¾åˆ°å®¶ç›®å½•</span></span><br><span class="line"><span class="comment"># mv ./Xyz ~/.face  </span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>ä¸»é¢˜: å•ç”¨æˆ·çš„æ”¾ <code>~/.themes/</code> , å¤šç”¨æˆ·çš„æ”¾ <code>/usr/share/themes/</code>, å¯å‰å¾€ <a href="https://www.gnome-look.org/">gnome-look</a> æŒ‘é€‰ä¸»é¢˜</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»¥ Nordic ä¸ºä¾‹å­</span></span><br><span class="line">mkdir ~/.themes/ &amp;&amp; <span class="built_in">cd</span> ~/.themes/</span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/mirror_jedsek/Nordic.git</span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.interface gtk-theme <span class="string">&#x27;Nordic&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.preferences theme <span class="string">&#x27;Nordic&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `user-theme` è¿™ä¸ªæ‰©å±•è¿›è¡Œè®¾ç½®:  </span></span><br><span class="line">mkdir ~/.themes/ &amp;&amp; <span class="built_in">cd</span> ~/.themes/</span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/mirror_jedsek/Nordic.gi</span><br><span class="line">gnome-extensions prefs user-theme@gnome-shell-extensions.gcampax.github.com</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>å­—ä½“: å°†é¡¶æ å­—ä½“æ¢æˆ <code>Fira Code</code>, é¡ºä¾¿è°ƒæ•´ä¸‹å¤§å°</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.interface font-name <span class="string">&#x27;Fira Code 11.8&#x27;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>éšè— <code>Dash</code> æ : å¯¹æˆ‘ä¸ªäººæ¥è®², Dash æ¯«æ— ç”¨å¤„è¿˜å åœ°æ–¹, å¿«æ·é”®+Overviewçš„æœç´¢, å¯ä»¥åº”ä»˜ä¸€åˆ‡å·¥ä½œäº†</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell favorite-apps <span class="string">&quot;[]&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„:</strong><br>
ä»¥ä¸Šå‘½ä»¤ä»…ä»…ç§»é™¤ Dash ä¸­çš„app, ä½†ä»ç„¶ä¼šç•™ä¸‹ä¸€ä¸ªç©ºçš„Dashæ , å½»åº•éšè—, è¯·ä½¿ç”¨ <code>Just-perfection</code> æ‰©å±•<br>
æ­¤æ‰©å±•å¾—åˆ°å®˜æ–¹æ”¯æŒ, å¯ä»¥å°†æ¡Œé¢ <code>åŒ–ç®€</code>, åŒ…æ‹¬Dash<br>
å¦‚æœä½ åªæ˜¯ä½¿ç”¨æ‰©å±•, å°† Dash éšè—, æœªç½®ç©ºåˆ—è¡¨, ç›¸å…³å¿«æ·é”®ä»ç„¶ç”Ÿæ•ˆ, éœ€è¢«ç¦ç”¨è€Œå½»åº•æ¶ˆé™¤Dash, è¯·çœ‹ä¸‹é¢çš„<a href="#jin-yong-kuai-jie-jian">ç¦ç”¨å¿«æ·é”®</a></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å»æ‰å·¦ä¸Šè§’çš„ <code>Activities</code>: å¯å°†å…¶æ¢æˆ I3/Sway å¼, æ˜¾ç¤ºå·¥ä½œåŒºåç§° (è¯·å®‰è£…æ‰©å±•: <code>space-bar</code> æˆ– <code>workspace-bar</code>)</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰å·¥ä½œåŒºçš„åç§°, ä¸ç„¶å°±æ˜¯é»˜è®¤çš„æ•°å­—</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.preferences workspace-names <span class="string">&quot;[&#x27;Browser&#x27;, &#x27;Terminal&#x27;, &#x27;Game&#x27;, &#x27;Box&#x27;, &#x27;Other&#x27;]&quot;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>éšè—é¡¶æ : å®‰è£… <code>just-perfection</code> &amp;&amp; <code>blur-my-shell</code>, é…ç½®åå°±æ˜¯æœ¬æ–‡ <a href="#cheng-pin-zhan-shi">æˆå“å±•ç¤º</a> ä¸­çš„äº†, å¤„äº <code>Overview</code> ä¸­æ‰æ˜¾ç¤ºé¡¶æ </p>
</li>
</ul>
<hr>
<h1 id="kuai-jie-jian">å¿«æ·é”®</h1>
<p>è¿™ä¹Ÿæ˜¯ä¸ªå¾ˆå½±å“ä½“éªŒçš„åœ°æ–¹, å¦‚æœä½ å¯¹è‡ªå¸¦çš„å¿«æ·é”®ä¸æ»¡æ„, å®Œå…¨å¯ä»¥è‡ªå·±æ›´æ”¹</p>
<p>æˆ‘ä¸ªäººå°±ä¸å–œæ¬¢ <code>Alt+Fnæ•°å­—</code>, å› ä¸ºå¤ªè¿œäº†, è€Œä¸”è®°ä¸æ¸…, å¹²è„†æ¢äº›ç®€å•æ˜“è®°çš„, åƒ <code>I3/Sway</code> é‚£æ ·<br>
å½“ç„¶, ä½ è¿˜å¯ä»¥ç¦ç”¨ä¸€äº›å¿«æ·é”®, åšåˆ°ä¸€äº›äº‹æƒ…, æ¯”å¦‚æ¶ˆé™¤ Dash</p>
<p><strong>æ³¨æ„:</strong><br>
å¿«æ·é”®ä¹‹é—´æœ‰å†²çªçš„è¯, å¯èƒ½æ— æ³•ç”Ÿæ•ˆ, è¯·é€šè¿‡ <code>gnome-control-center keyboard</code> æŸ¥çœ‹å¿«æ·é”®å†²çª</p>
<h2 id="cha-zhao-kuai-jie-jian" id="æŸ¥æ‰¾å¿«æ·é”®">æŸ¥æ‰¾å¿«æ·é”®</h2>
<p>é¦–å…ˆ, æˆ‘ä»¬å¾—æ˜ç™½å¦‚ä½•æŸ¥æ‰¾å¯¹åº”çš„å¿«æ·é”®</p>
<p>ä¸‹é¢çš„å‘½ä»¤ä¼šåˆ—å‡ºæå¤§éƒ¨åˆ†çš„å¿«æ·é”®:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings list-recursively | grep -E <span class="string">&quot;Super|Alt|Ctrl|Shift|F[0-9]|Page|Up|Down|Right|Left&quot;</span> | cat</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥åœ¨åé¢é€šè¿‡ pipeline, è¿½åŠ ä¸€ä¸ª grep, æœç´¢ theme, font, workspace, switch, move ç­‰è¯è¯­<br>
å¦‚æœå®åœ¨æ‰¾ä¸åˆ°, ä¸€ç‚¹ç‚¹çœ‹è¿‡å»ä¹Ÿè¡Œ ğŸ˜ƒ</p>
<h2 id="jin-yong-kuai-jie-jian" id="ç¦ç”¨å¿«æ·é”®">ç¦ç”¨å¿«æ·é”®</h2>
<p>æŸå‘½ä»¤çš„å¿«æ·é”®, ä¸€èˆ¬å¯ä»¥æœ‰å¤šä¸ª, å³æŸå‘½ä»¤çš„å¿«æ·é”®æ˜¯ä¸€ä¸ªæ•°ç»„<br>
æƒ³è¦ç¦ç”¨è¯¥å¿«æ·é”®, å°†å¯¹åº”çš„æ•°ç»„è®¾ç½®ä¸ºç©ºå°±è¡Œäº†</p>
<p>ä¸¾ä¸ªä¾‹å­, ç¦ç”¨Dashçš„å¿«æ·é”® (è§ä¸Šæ–‡çš„ç½®ç©º <code>favorite-apps</code>):</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Default: Super+&quot;1..9&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 9)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    gsettings <span class="built_in">set</span> org.gnome.shell.keybindings switch-to-application-<span class="variable">$i</span> <span class="string">&quot;[]&quot;</span>  </span><br><span class="line"><span class="keyword">done</span>    </span><br></pre></td></tr></table></figure>
<p>ç¦ç”¨å¿«æ·é”®è¿˜å¯ä»¥è®©ä½ é¿å…å†²çª, æ¯”å¦‚:<br>
æŸä¸ªæ“ä½œç»‘å®šäº†å¿«æ·é”®A, å¦ä¸€ä¸ªæ“ä½œä¹Ÿç»‘å®šäº†å¿«æ·é”®A, å¯èƒ½é”®Aå°±å¤±æ•ˆäº†, æˆ‘é‡åˆ°è¿‡å¥½å‡ æ¬¡<br>
è¿™æ—¶å°±è¦å€ŸåŠ© GUI çš„åŠ›é‡äº†: è¾“å…¥ <code>gnome-control-center keyboard</code>, ç„¶åè¿›å…¥è‡ªå®šä¹‰é‚£æ , ä¼šæ˜¾ç¤ºå†²çªçš„é”®</p>
<p>ä¸¾ä¸ªä¾‹å­, æˆ‘æƒ³ä¿®æ”¹ <code>Super+Esc</code> å˜æˆé”å±, æˆ‘å°±è¦è¿™æ ·åš:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.settings-daemon.plugins.media-keys screensaver <span class="string">&quot;[&#x27;&lt;Super&gt;Escape&#x27;]&quot;</span> <span class="comment">#Default: Sup+L</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.mutter.wayland.keybindings restore-shortcuts <span class="string">&quot;[]&quot;</span> <span class="comment"># Default: Sup+Esc</span></span><br></pre></td></tr></table></figure>
<h2 id="xiu-gai-kuai-jie-jian" id="ä¿®æ”¹å¿«æ·é”®">ä¿®æ”¹å¿«æ·é”®</h2>
<p>ä¿®æ”¹, ä¹Ÿå°±æ˜¯è¦†å†™é»˜è®¤çš„å¿«æ·é”®, ä¸ä¸‹æ–‡è¦è®²çš„ <a href="#tian-jia-kuai-jie-jian">æ·»åŠ å¿«æ·é”®</a> ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µ<br>
å•çº¯çš„æ”¹æ”¹æ”¹è€Œå·², ä¸‹é¢æ˜¯æˆ‘ä¸ªäººä¿®æ”¹çš„ä¸€å¥—å¿«æ·é”®, ä¾›å¤§å®¶å‚è€ƒ</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Vim å¼çš„æ¡ˆä»¶, æ”¹å˜çª—å£å¸ƒå±€, æ›¿ä»£åŸæœ‰çš„ <code>Super+æ–¹å‘é”®</code>:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¶å®è¿˜æœ‰æ›´ä¸§å¿ƒç—…ç‹‚çš„, å¯ä»¥ç»‘å®šå¿«æ·é”®, å°†çª—å£æ”¾å·¦ä¸Šè§’, å³ä¸Šè§’, ä¸­é—´å·¦è¾¹, ä¸­é—´å³è¾¹çš„......</span></span><br><span class="line"></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.mutter.keybindings      toggle-tiled-left  <span class="string">&quot;[&#x27;&lt;Super&gt;h&#x27;]&quot;</span> <span class="comment"># æ”¾å·¦è¾¹</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings  maximize           <span class="string">&quot;[&#x27;&lt;Super&gt;j&#x27;]&quot;</span> <span class="comment"># æœ€å¤§åŒ–</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings  unmaximize         <span class="string">&quot;[&#x27;&lt;Super&gt;k&#x27;]&quot;</span> <span class="comment"># æœ€å°åŒ–</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.mutter.keybindings      toggle-tiled-right <span class="string">&quot;[&#x27;&lt;Super&gt;l&#x27;]&quot;</span> <span class="comment"># æ”¾å³è¾¹</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äº†, å¦‚æœä½ è¿½æ±‚å¹³é“ºå¼çš„è¯, æ‰©å±•å¯ä»¥æ»¡è¶³ä¸€éƒ¨åˆ†è¦æ±‚, ä½†è‚¯å®šæ¯”ä¸ä¸Šä¸“ä¸šçš„çª—ç®¡â€¦</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>move, resize, kill ä¸€ä¸ªçª—å£:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Move</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings begin-move   <span class="string">&quot;[&#x27;&lt;Super&gt;x&#x27;]&quot;</span>        <span class="comment">#Default: Alt+F7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Resize</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings begin-resize <span class="string">&quot;[&#x27;&lt;Super&gt;r&#x27;]&quot;</span>        <span class="comment">#Default: Alt+F8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kill</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings close        <span class="string">&quot;[&#x27;&lt;Super&gt;&lt;Shift&gt;q&#x27;]&quot;</span> <span class="comment">#Default: Alt+F4</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>toggle-max, max, min, toggle-fullscreen, show-desktop:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Toggle max</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings toggle-maximized  <span class="string">&quot;[&#x27;&lt;Super&gt;m&#x27;]&quot;</span>     <span class="comment">#Default: Alt+F10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Max/Min</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings maximize          <span class="string">&quot;[&#x27;&lt;Super&gt;j&#x27;]&quot;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings unmaximize        <span class="string">&quot;[&#x27;&lt;Super&gt;k&#x27;]&quot;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings minimize          <span class="string">&quot;[&#x27;&lt;Super&gt;comma&#x27;]&quot;</span> <span class="comment">#Default: Super+H</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Toggle fullscreen</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings toggle-fullscreen <span class="string">&quot;[&#x27;&lt;Super&gt;f&#x27;]&quot;</span>     <span class="comment">#Default: None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Show desktop</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings show-desktop      <span class="string">&quot;[&#x27;&lt;Super&gt;d&#x27;]&quot;</span>     <span class="comment">#Default: None</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>è¿˜æœ‰å¥—å¾ˆé‡è¦çš„å¿«æ·é”®, å°±æ˜¯åˆ‡æ¢å·¥ä½œåŒºäº†, æ­é…æ¶ˆé™¤è¿‡æ¸¡åŠ¨ç”»/å¢åŠ ç‰¹æ•ˆçš„æ‰©å±•, æµç•…æ„ŸMax:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 9)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings switch-to-workspace-<span class="variable">$i</span> <span class="string">&quot;[&#x27;&lt;Super&gt;<span class="variable">$i</span>&#x27;]&quot;</span></span><br><span class="line">  gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings move-to-workspace-<span class="variable">$i</span>   <span class="string">&quot;[&#x27;&lt;Super&gt;&lt;Shift&gt;<span class="variable">$i</span>&#x27;]&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings switch-to-workspace-10   <span class="string">&quot;[&#x27;&lt;Super&gt;0&#x27;]&quot;</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings move-to-workspace-10     <span class="string">&quot;[&#x27;&lt;Super&gt;&lt;Shift&gt;0&#x27;]&quot;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>å†æ¯”å¦‚, è¦†å†™ <code>run-dialog</code> çš„å¿«æ·é”® (é»˜è®¤æ˜¯æŒ‰Alt-F2, ä½†å¤ªè¿œäº†â€¦):</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.wm.keybindings panel-run-dialog <span class="string">&quot;[&#x27;&lt;Super&gt;c&#x27;]&quot;</span> <span class="comment">#Default: Alt+F2</span></span><br></pre></td></tr></table></figure>
<h2 id="tian-jia-kuai-jie-jian" id="æ·»åŠ å¿«æ·é”®">æ·»åŠ å¿«æ·é”®</h2>
<p>æ­¤å¤„æŒ‡çš„æ˜¯çœŸæ­£çš„, æ·»åŠ è‡ªå·±çš„å¿«æ·é”®. ä¸æ˜¯ç®€å•çš„è¦†å†™<br>
æ¯”å¦‚ <code>Super+Return</code> æ‰“å¼€ä¸€ä¸ªç»ˆç«¯, <code>Super+B</code> æ‰“å¼€æµè§ˆå™¨, <code>Super+E</code> æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨â€¦</p>
<p>åºŸè¯ä¸å¤šè¯´, ä½ æŒ‰ä¸‹é¢ç…§çŒ«ç”»è™, å°±é˜”ä»¥äº†:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gp0=<span class="string">&quot;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings&quot;</span></span><br><span class="line">gp1=<span class="string">&quot;org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:\</span></span><br><span class="line"><span class="string">/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom Keys</span></span><br><span class="line"><span class="comment"># æ³¨æ„!!!!!!!</span></span><br><span class="line"><span class="comment"># ä¸è¦åœ¨æœ€åæ·»åŠ é€—å·</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.settings-daemon.plugins.media-keys custom-keybindings <span class="string">&quot;[     \</span></span><br><span class="line"><span class="string">    &#x27;<span class="variable">$gp0</span>/custom0/&#x27;, &#x27;<span class="variable">$gp0</span>/custom1/&#x27;, &#x27;<span class="variable">$gp0</span>/custom2/&#x27;, &#x27;<span class="variable">$gp0</span>/custom3/&#x27;               \</span></span><br><span class="line"><span class="string">]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Terminal</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom0/ name     <span class="string">&#x27;Terminal&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom0/ <span class="built_in">command</span>  <span class="string">&#x27;alacritty&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom0/ binding  <span class="string">&#x27;&lt;Super&gt;Return&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Files</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom1/ name     <span class="string">&#x27;Files&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom1/ <span class="built_in">command</span>  <span class="string">&#x27;nautilus&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom1/ binding  <span class="string">&#x27;&lt;Super&gt;e&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Browser</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom2/ name     <span class="string">&#x27;Browser&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom2/ <span class="built_in">command</span>  <span class="string">&#x27;microsoft-edge-beta&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom2/ binding  <span class="string">&#x27;&lt;Super&gt;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Fcitx5 Reload</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom3/ name     <span class="string">&#x27;Fcitx5_Reload&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom3/ <span class="built_in">command</span>  <span class="string">&#x27;fcitx5 -r&#x27;</span></span><br><span class="line">gsettings <span class="built_in">set</span> <span class="variable">$gp1</span>/custom3/ binding  <span class="string">&#x27;&lt;Alt&gt;space&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ç›¸ä¿¡ä½ ä¸ä¼šå°†æ—¶é—´æµªè´¹åœ¨æ‰åœ¨å‘é‡Œé¢äº†<br>
ä¸Šé¢çš„ä¸€åˆ‡å·²ç»éå¸¸éå¸¸å…¨äº†</p>
<hr>
<h1 id="jia-zai-pei-zhi">åŠ è½½é…ç½®</h1>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ dconf è¿™ä¸ªå·¥å…·, å¯¼å…¥æˆ–å¯¼å‡ºè®°è½½ç€ GNOME æ•°æ®çš„é…ç½®æ–‡ä»¶<br>
ä½ å¯ä»¥å¯¼å‡ºè®°è½½å½“å‰DEçš„é…ç½®æ–‡ä»¶, ç„¶åå¯¼å‡ºåˆ°å¦ä¸€å°æœºå™¨ä¸Š<br>
è¿™æ„å‘³ç€, å½“ä½ é‡è£…ç³»ç»Ÿæ—¶, æŒ‰ä¸‹é¢çš„æ–¹æ³•èƒ½å¿«é€Ÿæ¢å¤åˆ°å…ˆå‰çš„DE</p>
<p>ä½ ä¹Ÿå¯ä»¥å‚è€ƒæˆ–ç›´æ¥åŠ è½½æˆ‘åšå®¢ä¸‹çš„ <a href="/downloads/gnome/dconf.settings"><strong>dconf.settings</strong></a></p>
<h2 id="dui-yu-fei-nixos" id="å¯¹äºéNixos">å¯¹äºéNixos</h2>
<p>å¯¹äºæ™®é€šçš„Linuxå‘è¡Œç‰ˆ, ç›´æ¥æŒ‰ä¸‹é¢çš„æ–¹å¼</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¯¼å‡ºå½“å‰çš„dconfæ•°æ®åˆ°æŸä¸ªæ–‡ä»¶:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dconf dump / &gt; dconf.settings</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>åŠ è½½/å¯¼å…¥æŸä¸ªdconfæ–‡ä»¶åˆ°å½“å‰ç³»ç»Ÿ:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat dconf.settings | dconf load -f /</span><br></pre></td></tr></table></figure>
<p>å¯¹äºèƒŒæ™¯ä¸å¤´åƒ, ä½ å¯ä»¥å†™ä¸€æ®µè„šæœ¬, å°†å…¶å¤åˆ¶åˆ°ç›¸åº”ä½ç½®, ç„¶åå†æ·»åŠ ä¸Šé¢çš„ä»£ç åŠ è½½é…ç½®<br>
åŒæ—¶ç¡®è®¤ <code>dconf.settings</code> ä¸­çš„ <code>picture-uri</code> / <code>picture-uri-dark</code> æŒ‡å‘å¯¹åº”æ–‡ä»¶</p>
<h2 id="dui-yu-nixos" id="å¯¹äºNixos">å¯¹äºNixos</h2>
<p>å¦‚æœä½ ä½¿ç”¨ Nixos, è¯·å…ˆç¡®ä¿å·²ç»å®‰è£…äº† <a href="https://github.com/nix-community/home-manager">HomeManager</a><br>
HomeManager æ˜¯ Nixos ä¸­ç”¨æ¥ç®¡ç†ç”¨æˆ·é…ç½®, æ”¯æŒå›æ»šçš„å·¥å…·</p>
<p>è™½ç„¶ä¹Ÿèƒ½æŒ‰ä¸Šé¢çš„æ–¹æ³•é…ç½® Nixos çš„ GNOME, ä½†è¿˜æ˜¯æ¨èä½¿ç”¨ HomeManager, åŸå› ç•¥è¿‡, è‡ªçœ‹æ–‡æ¡£<br>
è¯·å…ˆä¸‹è½½ <code>dconf2nix</code>, è¿™æ˜¯ä¸€ä¸ªå°† dconfæ–‡ä»¶, è½¬æ¢ä¸º nix è¡¨è¾¾å¼çš„å·¥å…·<br>
éšå, åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å†…å®¹, å¾—åˆ° <code>dconf.nix</code> :</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dconf dump / &gt; dconf.settings</span><br><span class="line">dconf2nix -i dconf.settings -o dconf.nix</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½ çš„ ~/.config/nixpkgs ä¸­, ä¿æŒè¿™æ ·çš„ç›®å½•ç»“æ„ (å½“ç„¶äº†, å¯ä»¥éšä½ æƒ³æ³•):</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">nixpkgs/</span><br><span class="line">â”œâ”€â”€ gnome</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ <span class="selector-class">.background</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ <span class="selector-class">.face</span></span><br><span class="line">â”‚Â Â  â””â”€â”€ dconf<span class="selector-class">.nix</span></span><br><span class="line">â””â”€â”€ home.nix</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>dconf.nix</code> å°±æ˜¯åˆšåˆšè½¬æ¢å¾—åˆ°çš„nixè¡¨è¾¾å¼, åœ¨ <code>home.nix</code> ä¸­å¯¼å…¥å®ƒ:</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="attr">imports</span> = [</span><br><span class="line">  ./gnome/dconf.nix</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>ä»‹äº HomeManager çš„æƒé™é—®é¢˜, å¿…é¡»å°†èƒŒæ™¯å›¾ç‰‡/äººç‰©å¤´åƒ, ä¿æŒåœ¨ <code>$HOME</code> ä¸‹<br>
è¿™é‡Œå°†ä¸¤ä¸ªå›¾ç‰‡æ”¾åœ¨äº† <code>~/.config/nixpkgs/gnome/</code> ä¸‹, å› æ­¤è¦ä¿®æ”¹ä¸‹ç›¸åº”æ–‡ä»¶</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¯¹äºèƒŒæ™¯å›¾åƒ, ä¿®æ”¹ <code>dconf.nix</code> ä¸­çš„ <code>picture-uri</code>:</p>
</li>
</ul>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;org/gnome/desktop/background&quot;</span> =</span><br><span class="line"><span class="keyword">let</span> <span class="attr">picture</span> = ../.background.png; <span class="keyword">in</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">picture-uri</span> = <span class="string">&quot;file://<span class="subst">$&#123;picture&#125;</span>&quot;</span>;</span><br><span class="line">  <span class="attr">picture-uri-dark</span> = <span class="string">&quot;file://<span class="subst">$&#123;picture&#125;</span>&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¯¹äºäººç‰©å¤´åƒ, åœ¨ <code>home.nix</code> æ·»åŠ ä»¥ä¸‹å†…å®¹:</p>
</li>
</ul>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">home.file.<span class="string">&quot;.face&quot;</span>.<span class="attr">source</span> = ./.face;</span><br></pre></td></tr></table></figure>
<p>å¤§åŠŸå‘Šæˆ!  æˆ‘ç›¸ä¿¡è¿™æ˜¯æœ€æœ€æœ€æœ€æœ€å…¨çš„ä¸€ä»½ GNOME å…¥å‘æŒ‡å—äº†</p>
]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>Waylnad</tag>
        <tag>Desktop</tag>
        <tag>GNOME</tag>
      </tags>
  </entry>
  <entry>
    <title>Hyprland å¹³é“ºå¼</title>
    <url>/posts/desktop-beautify/hyprland.html</url>
    <content><![CDATA[<blockquote>
<p>Wayland/Linux ä¸‹çš„ç‚«é…·çª—ç®¡/æ··åˆå™¨: Hyprland, æ‹¥æœ‰ä¸°å¯Œçš„ç‰¹æ€§é›†, é€‚åˆè¿½æ±‚é«˜åº¦è‡ªç”±ä¸æè‡´æ€§èƒ½çš„ç”¨æˆ·</p>
</blockquote>
<span id="more"></span>
]]></content>
      <tags>
        <tag>Linux</tag>
        <tag>Hyprland</tag>
        <tag>Waylnad</tag>
        <tag>Desktop</tag>
      </tags>
  </entry>
  <entry>
    <title>clap-rs ç®€ä»‹</title>
    <url>/posts/rust-clap/intro.html</url>
    <content><![CDATA[<blockquote>
<p>äº†è§£å‘½ä»¤è¡Œ, ç„¶åç”¨ clap-rs å†™ä¸ªç±»ä¼¼ GNU/wc å‘½ä»¤çš„ rwc å§, å¢åŠ äº†è¿›åº¦æ¡, è¡¨æ ¼è¾“å‡º, å¹¶è¡ŒåŒ–ç­‰åŠŸèƒ½</p>
</blockquote>
<span id="more"></span>
<p>å‰ç½®çŸ¥è¯†: RuståŸºç¡€<br>
å®Œæ•´ä»£ç : <a href="https://github.com/Jedsek/rust-wc">github/jedsek/rust-wc</a></p>
<p><strong>æ³¨æ„</strong><br>
æœ¬é¡¹ç›®åŸºäºå½“å‰æœ€æ–°ç‰ˆæœ¬çš„ clap, ä¹Ÿå°±æ˜¯ version 4<br>
æœ¬é¡¹ç›®ä½¿ç”¨ clap ä¸­çš„ derive ç‰¹æ€§, è€Œé builder ç‰¹æ€§ (å…¶å®å·®ä¸å¤š)</p>
<p>æ¨èè¯»è€…åˆ«ç›´æ¥è·Ÿç€æ•²ä»£ç , å…ˆæ•´ä½“çœ‹ä¸€é, æ˜ç™½å¤§è‡´æ€è·¯åå†åŠ¨æ‰‹<br>
å®˜æ–¹æ•™ç¨‹: <a href="https://docs.rs/clap/latest/clap/_derive/_tutorial/index.html">derive tutorial</a><br>
å®˜æ–¹èµ„æ–™: <a href="https://docs.rs/clap/latest/clap/_derive/index.html">derive reference</a></p>
<h1 id="cheng-pin-zhan-shi">æˆå“å±•ç¤º</h1>
<p>ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤, ä» <a href="https://crates.io">crates.io</a> ä¸Šä¸‹è½½è¯¥æˆå“, å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°æ˜¯ <code>rwc</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo install rust-wc</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <a href="https://asciinema.org/">asciinema</a> å½•åˆ¶çš„å±•ç¤º:</p>
<script id="asciicast-534647" src="https://asciinema.org/a/534647.js" async></script>
<hr>
<h1 id="ji-chu-gai-nian">åŸºç¡€æ¦‚å¿µ</h1>
<p>CLI, æ˜¯ <code>command-line interface</code> çš„ç®€ç§°, æ„æ€æ˜¯å‘½ä»¤è¡Œç•Œé¢, å’Œ GUI/TUI æ˜¯ä¸€ä¸ªé“ç†<br>
å¦‚åœ¨Linuxä¸‹å¸¸è§çš„ <code>ls/cp/mv</code> ç­‰å‘½ä»¤, ä½ ä¼ å…¥å‚æ•°, å®ƒå°±ä¼šåšäº›äº‹æƒ…, å¹¶å¯èƒ½ä¼šæ‰“å°ç›¸åº”è¾“å‡º</p>
<p>GNU é¡¹ç›®æä¾›äº†éå¸¸å¤šçš„å¼€æºå‘½ä»¤, å¦‚ <code>wc</code>, å®ƒå¯ä»¥ç»Ÿè®¡æ–‡ä»¶çš„ bytes/char/line çš„æ•°é‡<br>
æˆ‘ä»¬å°†ä¼šä½¿ç”¨ Rust è¯­è¨€, æ­é…ä¸€ä¸ªå« clap çš„åº“, å†™ä¸€ä¸ªå‡çº§ç‰ˆçš„ <code>wc</code></p>
<p><strong>æ³¨æ„:</strong><br>
cli å¯ä»¥ä»£è¡¨æŠ½è±¡çš„ç•Œé¢, ä¹Ÿå¯ä»¥æŒ‡ä»£å…·ä½“çš„æŸä¸ªç¨‹åº<br>
åæ–‡ä¸­çš„cli, ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æŒ‡ä»£æŸä¸ªå…·ä½“çš„å‘½ä»¤è¡Œç¨‹åº, æ¯”å¦‚ ls/cp ç­‰</p>
<p>å†å†™ä¹‹å‰, æˆ‘ä»¬è¿˜åº”äº†è§£äº›åŸºæœ¬æ¦‚å¿µ <s>(ç›´æ¥è·³è¿‡æ„Ÿè§‰ä¹Ÿæœ¨å¾—é—®é¢˜??)</s>:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>å‚æ•°(Arguments)</code>:<br>
ä¼ ç»™å‘½ä»¤çš„å‚æ•°, æ¯”å¦‚ä¸€ä¸ªè·¯å¾„ <s>(å˜¶, æ„Ÿè§‰åœ¨è¯´åºŸè¯)</s></p>
</li>
<li class="lvl-2">
<p><code>é€‰é¡¹(Options)</code>:<br>
é€šå¸¸ä»¥å•/åŒæ¨ªæ å¼€å¤´, ä¸åŒçš„optionsè¡¨ç¤ºä¸åŒçš„è¡Œä¸º<br>
æ¯”å¦‚ <code>ls ./*</code>, è¡¨ç¤ºä»¥é»˜è®¤è¡Œä¸ºä¸‹è¿›è¡Œè¾“å‡º, <code>ls -l ./*</code> ä»¥é•¿åˆ—è¡¨å½¢å¼è¾“å‡º, <code>ls -a ./*</code> è¾“å‡ºæ‰€æœ‰éšè—æ–‡ä»¶<br>
å•æ¨ªæ å¼€å¤´çš„åªæœ‰ä¸€ä¸ªå­—æ¯, åŒæ¨ªæ å¼€å¤´çš„å¯ä»¥æœ‰å¾ˆå¤šå­—æ¯, å¦‚ <code>ls -i</code> ä¸ <code>ls --inode</code></p>
</li>
<li class="lvl-2">
<p><code>å­å‘½ä»¤(Subcommands)</code>:<br>
ä¸€ä¸ªå‘½ä»¤çš„å­å‘½ä»¤, é€šå¸¸æƒ…å†µä¸‹éœ€è¦ä¸åŒçš„ args, æœ‰ä¸åŒçš„ options<br>
æ¯”å¦‚ <code>cargo build</code> ä¸ <code>cargo publish</code>, éƒ½æ˜¯ <code>cargo</code> çš„å­å‘½ä»¤</p>
</li>
<li class="lvl-2">
<p><code>åŒæ¨ªæ (--)</code>:<br>
åœ¨å‘½ä»¤åé¢çš„æŸå¤„ä½ç½®, åŠ ä¸Š <code>--</code>, å¯ä»¥å°† <code>--</code> åé¢çš„å†…å®¹å½“ä½œ argument ä¼ å…¥, è€Œé options<br>
ä¸¾ä¸ªä¾‹å­, æˆ‘æœ‰ä¸ªæ–‡ä»¶, å«åš <code>--asd</code>, æˆ‘æƒ³ä½¿ç”¨ <code>cat --asd</code> æ¥è¾“å‡ºé‡Œé¢çš„å†…å®¹<br>
å¦‚æœä½ ç›´æ¥è¿™æ ·ä¼ å‚, å› ä¸ºæ–‡ä»¶åä»¥æ¨ªæ å¼€å¤´, å°†ä¼šè¢«å‘½ä»¤è§†ä½œ options, è€Œ cat æœ¬èº«æ²¡ <code>--asd</code> è¿™ä¸ªoption, æ•…å¤±è´¥<br>
åœ¨æ¯”å¦‚æœ‰ä¸ªæ–‡ä»¶å« <code>--help</code>, ä½¿ç”¨ <code>cat --help</code> å°†ä¼šæ‰“å°å…¶ help ä¿¡æ¯<br>
æ­¤æ—¶, ä½ åº”è¯¥ä½¿ç”¨ <code>cat -- --asd</code>, å°† <code>--asd</code> è§†ä½œå‚æ•°ä¼ å…¥</p>
</li>
<li class="lvl-2">
<p><code>çŸ­/é•¿å¸®åŠ©(short/long help)</code>:<br>
æœ‰äº›å‘½ä»¤, <code>-h</code> ä¸ <code>--help</code> åˆ†åˆ«å¯¹åº”çŸ­å¸®åŠ©ä¸é•¿å¸®åŠ©, åè€…æ¯”å‰è€…ä¼šæ˜¾ç¤ºæ›´å¤šæç¤ºä¿¡æ¯</p>
</li>
</ul>
<hr>
<h1 id="chu-shi-pei-zhi">åˆå§‹é…ç½®</h1>
<p>ä»¥ä¸‹æ˜¯å±‚æ¬¡ç»“æ„, ä¹‹åè¦ç”Ÿæˆè‡ªåŠ¨è¡¥å…¨æ–‡ä»¶æ—¶, è¿˜ä¼šå†å¢åŠ ä¸€äº›æ–‡ä»¶<br>
è¯·è‡ªè¡Œåˆ›å»ºå¥½ç›®å½•:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">./rust-wc</span><br><span class="line">â”œâ”€â”€ Cargo.lock</span><br><span class="line">â”œâ”€â”€ Cargo.toml</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">   â”œâ”€â”€ wc_result.rs   <span class="meta"># è®¡ç®—å¹¶å­˜å‚¨ç»“æœ</span></span><br><span class="line">   â”œâ”€â”€ <span class="keyword">cli</span>.rs         <span class="meta"># å‘½ä»¤è¡Œçš„å®šä¹‰</span></span><br><span class="line">   â”œâ”€â”€ files.rs       <span class="meta"># è¯»å–æ–‡ä»¶</span></span><br><span class="line">   â”œâ”€â”€ lib.rs         <span class="meta"># å£°æ˜æ¨¡å—, ç±»å‹åˆ«å</span></span><br><span class="line">   â””â”€â”€ main.rs</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå«åš <code>rust-wc</code> çš„é¡¹ç›®, ç„¶ååœ¨ <code>Cargo.toml</code> ä¸­æ·»åŠ  clap å§:</p>
<figure class="highlight toml"><figcaption><span>Cargo.toml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŒ…åä¸º `rust-wc` (å› ä¸ºæˆ‘å‘å¸ƒåˆ° crates.io çš„æ—¶å€™, `rwc` å·²ç»è¢«å äº†å‘œå‘œå‘œå‘œå‘œ)</span></span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;rust-wc&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;jedsek &lt;jedsek@qq.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.0.1&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;A GNU/wc implementation written in rust, which is faster when reading a large of big files&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—, æ­¤å¤„æ˜¯ `rwc`, è™½ç„¶åŒ…åæ˜¯ `rust-wc`, ä½†å‘½ä»¤æ˜¯ `rwc`</span></span><br><span class="line"><span class="section">[[bin]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;rwc&quot;</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/main.rs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šä¾èµ–</span></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">clap</span> = &#123;version = <span class="string">&quot;4.0.8&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>]&#125;      <span class="comment"># è§£æå‚æ•°</span></span><br><span class="line"><span class="attr">unicode-width</span> = <span class="string">&quot;0.1.10&quot;</span>                               <span class="comment"># è®¡ç®— Unicode å­—ç¬¦å®½åº¦</span></span><br><span class="line"><span class="attr">indicatif</span> = <span class="string">&quot;0.17.1&quot;</span>                                   <span class="comment"># è¿›åº¦æ¡</span></span><br><span class="line"><span class="attr">prettytable-rs</span> = <span class="string">&quot;0.9.0&quot;</span>                               <span class="comment"># æ‰“å°è¡¨æ ¼</span></span><br><span class="line"><span class="attr">rayon</span> = <span class="string">&quot;1.5.3&quot;</span>                                        <span class="comment"># å¹¶è¡ŒåŒ–</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <a href="http://lib.rs">lib.rs</a> çš„å†…å®¹:</p>
<figure class="highlight rust"><figcaption><span>src/lib.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"> <span class="keyword">use</span> std::&#123;collections::HashMap, path::PathBuf&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> cli;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> files;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> wc_result;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">Result</span></span>&lt;T&gt; = std::result::<span class="built_in">Result</span>&lt;T, <span class="built_in">Box</span>&lt;<span class="keyword">dyn</span> std::error::Error&gt;&gt;;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">Counts</span></span> = <span class="built_in">Vec</span>&lt;<span class="built_in">usize</span>&gt;;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">PathWithContent</span></span> = HashMap&lt;PathBuf, <span class="built_in">String</span>&gt;;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="ming-ling-ding-yi">å‘½ä»¤å®šä¹‰</h1>
<p><strong>æ³¨æ„:</strong><br>
clap-v3 æ—¶, èè¿›äº†å¦ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å‘½ä»¤è¡Œç¼–å†™åº“: structopt<br>
å› æ­¤ä»¥åçœ‹è§ structopt ä¸ clap, ç›´æ¥ç”¨ clap å°±å®Œäº‹äº†, å‰è€…ä¹Ÿå‘è¿‡é€šçŸ¥, è®©åˆ«äººç›´æ¥ç”¨ clap<br>
è¿™ç»™ clap å¸¦æ¥çš„å·¨å¤§å˜åŒ–, å°±æ˜¯å‡ºç°äº†deriveå®, ä»¥ä¸€ç§éå¸¸ä¾¿åˆ©çš„å£°æ˜å¼å†™æ³•, å¸®ä½ ç”Ÿæˆä¸è§£æä»£ç </p>
<p>è®©æˆ‘ä»¬æ¥æƒ³è±¡ä¸‹è¿™ä¸ªå‘½ä»¤:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°</p>
</li>
<li class="lvl-2">
<p>å‚æ•°å¿…é¡»æ˜¯å­˜åœ¨çš„è·¯å¾„, æˆ–è€…æ˜¯ -, è¡¨ç¤ºä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹</p>
</li>
<li class="lvl-2">
<p>æ ¹æ®å¯ç”¨çš„ flag æ¥å†³å®šè®¡ç®—å¹¶æ‰“å°å“ªäº›ä¸œè¥¿</p>
</li>
</ul>
<p>å¤šäºäº† derive å®, æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰å®ƒ, ä¸‹é¢æ˜¯ <code>src/cli.rs</code> çš„å®Œæ•´ä»£ç :</p>
<figure class="highlight rust"><figcaption><span>src/cli.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> clap::&#123;ArgGroup, Parser, Subcommand&#125;;</span><br><span class="line"><span class="keyword">use</span> std::path::PathBuf;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Parser)]</span>  <span class="comment">// è¿™é‡Œçš„ derive(Parser) è¡¨ç¤ºä¸‹é¢è¿™ä¸€å¨éƒ½ä¼šè¢« `å®çš„é»‘é­”æ³•` æ‰€æ´—ç¤¼ </span></span><br><span class="line"><span class="meta">#[command(</span></span><br><span class="line"><span class="meta">    author, version, about,</span></span><br><span class="line"><span class="meta">    group(ArgGroup::new(<span class="meta-string">&quot;options&quot;</span>).multiple(true).required(true).args(&amp;[ <span class="meta-string">&quot;bytes&quot;</span>, <span class="meta-string">&quot;chars&quot;</span>, <span class="meta-string">&quot;words&quot;</span>, <span class="meta-string">&quot;lines&quot;</span>, <span class="meta-string">&quot;longest_line&quot;</span>]</span>)),</span><br><span class="line">    subcommand_negates_reqs = <span class="literal">true</span>,</span><br><span class="line">)]</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Cli</span></span> &#123;</span><br><span class="line">    <span class="comment">/// The path(s) you should provide</span></span><br><span class="line">    <span class="meta">#[arg(value_parser = check_path, value_name = <span class="meta-string">&quot;PATH&quot;</span>, required = true)]</span></span><br><span class="line">    <span class="keyword">pub</span> paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Print the byte counts</span></span><br><span class="line">    <span class="meta">#[arg(short, long)]</span></span><br><span class="line">    <span class="keyword">pub</span> bytes: <span class="built_in">bool</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Print the character counts</span></span><br><span class="line">    <span class="meta">#[arg(short, long)]</span></span><br><span class="line">    <span class="keyword">pub</span> chars: <span class="built_in">bool</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Print the word counts</span></span><br><span class="line">    <span class="meta">#[arg(short, long)]</span></span><br><span class="line">    <span class="keyword">pub</span> words: <span class="built_in">bool</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Print the line counts</span></span><br><span class="line">    <span class="meta">#[arg(short, long)]</span></span><br><span class="line">    <span class="keyword">pub</span> lines: <span class="built_in">bool</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Print the maximum line width (Unicode)</span></span><br><span class="line">    <span class="meta">#[arg(short = &#x27;L&#x27;, long)]</span></span><br><span class="line">    <span class="keyword">pub</span> longest_line: <span class="built_in">bool</span>,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[command(subcommand)]</span></span><br><span class="line">    <span class="keyword">pub</span> sub_commands: <span class="built_in">Option</span>&lt;SubCommands&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Subcommand)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">SubCommands</span></span> &#123;</span><br><span class="line">    <span class="comment">/// Enabled all available options</span></span><br><span class="line">    All &#123;</span><br><span class="line">        <span class="comment">/// The path(s) you should provide</span></span><br><span class="line">        <span class="meta">#[arg(value_parser = check_path, value_name = <span class="meta-string">&quot;PATH&quot;</span>, required = true)]</span></span><br><span class="line">        paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰äº†ä¸€ä¸ªè§£æå™¨, æ£€æµ‹è·¯å¾„æ˜¯å¦å­˜åœ¨, æˆ–è€…æ˜¯å¦ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">check_path</span></span>(filename: &amp;<span class="built_in">str</span>) -&gt; <span class="built_in">Result</span>&lt;PathBuf, <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> path = PathBuf::from(filename);</span><br><span class="line">    <span class="keyword">if</span> filename == <span class="string">&quot;-&quot;</span> || path.exists() &#123;</span><br><span class="line">        <span class="literal">Ok</span>(path)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">Err</span>(<span class="built_in">format!</span>(<span class="string">&quot;No such path: `&#123;&#125;`&quot;</span>, path.display()))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Cli &#123;</span><br><span class="line">    <span class="comment">// å¼€å¯æ‰€æœ‰çš„ options</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">enable_all_options</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.bytes = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">self</span>.chars = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">self</span>.words = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">self</span>.lines = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">self</span>.longest_line = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// è¿”å›å¯ç”¨çš„options, ç±»å‹æ˜¯ Vec&lt;&amp;str&gt;, æ–¹ä¾¿åé¢æ‰“å°è¡¨æ ¼æ—¶, ä½œä¸ºè¡¨æ ¼çš„æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">get_enabled_options</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">Vec</span>&lt;&amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> enabled_options = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.bytes.then(|| enabled_options.push(<span class="string">&quot;Bytes&quot;</span>));</span><br><span class="line">        <span class="keyword">self</span>.chars.then(|| enabled_options.push(<span class="string">&quot;Chars&quot;</span>));</span><br><span class="line">        <span class="keyword">self</span>.words.then(|| enabled_options.push(<span class="string">&quot;Words&quot;</span>));</span><br><span class="line">        <span class="keyword">self</span>.lines.then(|| enabled_options.push(<span class="string">&quot;Lines&quot;</span>));</span><br><span class="line">        <span class="keyword">self</span>.longest_line.then(|| enabled_options.push(<span class="string">&quot;Maximum line width (Unicode)&quot;</span>));</span><br><span class="line"></span><br><span class="line">        enabled_options</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„ä»£ç è¡¨ç¤º, æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>Cli</code> ç»“æ„ä½“, è¡¨ç¤ºå¯¹è¾“å…¥å‚æ•°çš„å»ºæ¨¡<br>
å¾—ç›Šäºå®çš„é»‘é­”æ³•, clap å°†ç”Ÿæˆä¸€äº›ä»£ç , ä½¿æˆ‘ä»¬ä¸ç”¨å†è€—è´¹è„‘åŠ›, è€ƒè™‘å¦‚ä½•å¤„ç†è¾“å…¥å‚æ•°, å¹¶å°†å…¶è§£æä¸ºå¯¹åº”ç±»å‹<br>
ä¹Ÿä¸ç”¨å†è€ƒè™‘è§£æå¤±è´¥æ—¶, åº”è¯¥å¦‚ä½•ç¼–å†™ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º</p>
<p>clap ä»¥åŠä¸ºæˆ‘ä»¬åšå¥½äº†ä¸€åˆ‡ ğŸ˜ƒ</p>
<p>æˆ‘ä»¬èƒ½è°ƒç”¨ clap ä¸ºæˆ‘ä»¬å®ç°çš„ Parser (trait) ä¸­çš„ parse æ–¹æ³•, è§£æå‚æ•°å¹¶è¿›è¡Œè½¬æ¢:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> clap::Parser;</span><br><span class="line"><span class="keyword">use</span> rust_wc::&#123;cli::Cli, <span class="built_in">Result</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; <span class="built_in">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> cli = Cli::parse();</span><br><span class="line">    <span class="literal">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="wen-dang-zhu-shi-yu-bang-zhu" id="æ–‡æ¡£æ³¨é‡Šä¸å¸®åŠ©">æ–‡æ¡£æ³¨é‡Šä¸å¸®åŠ©</h2>
<p>ç­‰ä¸‹å†è§£é‡Š, ç°åœ¨å…ˆè®©æˆ‘ä»¬çœ‹çœ‹æ•ˆæœ, æŸ¥çœ‹ä¸‹ help å§:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">cargo run -- -h</span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">A GNU/wc clone written in rust, which <span class="keyword">is</span> super faster when reading <span class="keyword">a</span> large of big <span class="keyword">files</span></span><br><span class="line"></span><br><span class="line">Usage: rwc &lt;--bytes|--chars|--words|--lines|--longest-<span class="built_in">line</span>&gt; <span class="symbol">&lt;PATH&gt;</span>...</span><br><span class="line">       rwc [PATH]... <span class="symbol">&lt;COMMAND&gt;</span></span><br><span class="line"></span><br><span class="line">Command<span class="variable">s:</span></span><br><span class="line">  <span class="keyword">all</span>   Enabled <span class="keyword">all</span> available <span class="keyword">options</span></span><br><span class="line">  <span class="keyword">help</span>  <span class="keyword">Print</span> this message <span class="built_in">or</span> the <span class="keyword">help</span> of the given subcommand(s)</span><br><span class="line"></span><br><span class="line">Argument<span class="variable">s:</span></span><br><span class="line">  <span class="symbol">&lt;PATH&gt;</span>...  The path(s) you should provide</span><br><span class="line"></span><br><span class="line">Option<span class="variable">s:</span></span><br><span class="line">  -<span class="keyword">b</span>, --bytes         <span class="keyword">Print</span> the byte counts</span><br><span class="line">  -<span class="keyword">c</span>, --chars         <span class="keyword">Print</span> the character counts</span><br><span class="line">  -<span class="keyword">w</span>, --words         <span class="keyword">Print</span> the word counts</span><br><span class="line">  -<span class="keyword">l</span>, --lines         <span class="keyword">Print</span> the <span class="built_in">line</span> counts</span><br><span class="line">  -L, --longest-<span class="built_in">line</span>  <span class="keyword">Print</span> the maximum <span class="built_in">line</span> width (Unicode)</span><br><span class="line">  -h, --<span class="keyword">help</span>          <span class="keyword">Print</span> <span class="keyword">help</span> information</span><br><span class="line">  -V, --<span class="keyword">version</span>       <span class="keyword">Print</span> <span class="keyword">version</span> information</span><br></pre></td></tr></table></figure>
<p>å“‡å“¦! è‹¥ä½ ç”¨è¿™æ®µæ–‡å­—, å¯¹æ¯”ä¸‹å‰é¢çš„ <code>src/cli.rs</code>, ä¼šå‘ç°å…ˆå‰çš„æ–‡æ¡£æ³¨é‡Š, åœ¨å£°æ˜å®çš„å¨åŠ›ä¸‹, å˜æˆäº† help ä¿¡æ¯<br>
æ²¡é”™! clap èƒ½è‡ªåŠ¨å¸®ä½ åšå¾ˆå¤šäº‹æƒ…, åŒ…æ‹¬ä½†ä¸é™äºé€šè¿‡æ–‡æœ¬æ³¨é‡Šæ¥ç”Ÿæˆ help ä¿¡æ¯</p>
<p>å¦‚æœä½ ä¸æƒ³è¦ <code>about</code> ä¿¡æ¯ç›´æ¥ç…§æ¬ <code>Cargo.toml</code> é‡Œçš„ <code>description</code> æ€ä¹ˆåŠ? æ²¡äº‹, ç›´æ¥è¦†å†™å°±è¡Œ, è¦†å†™çš„ä¼˜å…ˆçº§æ›´é«˜:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="meta">#[derive(Parser)]</span></span><br><span class="line"><span class="meta">#[command(</span></span><br><span class="line"><span class="meta">    about = <span class="meta-string">&quot;...&quot;</span>,</span></span><br><span class="line"><span class="meta">// ......</span></span><br><span class="line"><span class="meta">// ......</span></span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”, åƒ author/version/about ç­‰ä¿¡æ¯, æ˜¯é€šè¿‡è¯»å– <code>Cargo.toml</code> æ¥è·å–çš„, ä½†åœ¨ v4 ç‰ˆæœ¬, clap é»˜è®¤ä¸æ˜¾ç¤º, ä»¥ä¿æŒç®€æ´<br>
ä½ å¯ä»¥æŸ¥çœ‹ <a href="https://docs.rs/clap/latest/clap/builder/struct.Command.html#method.help_template">help_template</a> çŸ¥æ™“å¦‚ä½•æ˜¾ç¤º, ä¾‹å­å¯èƒ½æ˜¯ <code>builderå½¢å¼</code>, ä¹Ÿå°±æ˜¯éå£°æ˜å¼, ä½†åˆ«æ…Œå¼ :</p>
<p>ä½ å¯ä»¥åƒè¿™æ ·å°† builderå½¢å¼ çš„ä»£ç è½¬åŒ–ä¸º deriveå½¢å¼:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">Command::new(<span class="string">&quot;myprog&quot;</span>)</span><br><span class="line">    .help_template(<span class="string">&quot;&#123;bin&#125; (&#123;version&#125;) - &#123;usage&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Parser)]</span></span><br><span class="line"><span class="meta">#[command(</span></span><br><span class="line"><span class="meta">    help_template = <span class="meta-string">&quot;&#123;bin&#125; (&#123;version&#125;) - &#123;usage&#125;&quot;</span>,</span></span><br><span class="line"><span class="meta">// ......</span></span><br><span class="line"><span class="meta">// ......</span></span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Š, å®çš„é»‘é­”æ³•, å°±æ˜¯å°†è¿™äº›å£°æ˜å¼ä»£ç , åœ¨ç¼–è¯‘æœŸè½¬åŒ–ä¸º builder ä»£ç </p>
<h2 id="xuan-xiang-yu-can-shu-de-sheng-cheng" id="é€‰é¡¹ä¸å‚æ•°çš„ç”Ÿæˆ">é€‰é¡¹ä¸å‚æ•°çš„ç”Ÿæˆ</h2>
<p>clap èƒ½éå¸¸æ–¹ä¾¿åœ°ä»¥å£°æ˜çš„æ–¹å¼, å®šä¹‰é€‰é¡¹/å‚æ•°</p>
<h3 id="xuan-xiang" id="é€‰é¡¹">é€‰é¡¹</h3>
<p>å¯¹äºä¸€ä¸ªoption, æ¯”å¦‚ <code>-b/--bytes</code>, ä½ åªéœ€è¦è¿™æ ·å†™:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Print the byte counts</span></span><br><span class="line"><span class="meta">#[arg(short, long)]</span></span><br><span class="line"><span class="keyword">pub</span> bytes: <span class="built_in">bool</span>,</span><br></pre></td></tr></table></figure>
<p>å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆ:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ–‡æ¡£æ³¨é‡Š: help ä¸­å¯¹è¯¥å‘½ä»¤çš„è§£é‡Š</p>
</li>
<li class="lvl-2">
<p><code>#[arg(short, long)]</code>: è¯¥ option å…·æœ‰çŸ­/é•¿æ¨ªæ çš„å½¢å¼</p>
</li>
<li class="lvl-2">
<p>ç±»å‹ä¸ºbool: ä¼ å…¥æ—¶é»˜è®¤çš„è¡Œä¸ºæ˜¯å°†å…¶è®¾ç½®ä¸º true</p>
</li>
</ul>
<p>å¦‚ help ä¸­æ‰€ç¤º, ä¼šç”Ÿæˆå¦‚ä¸‹å†…å®¹:</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Options</span>:</span><br><span class="line">  -b, --bytes         <span class="keyword">Print</span> the <span class="keyword">byte</span> counts</span><br></pre></td></tr></table></figure>
<p>å½“ä½ ä¼ å…¥è¯¥å‚æ•°æ—¶, <code>Cli</code> å®ä¾‹ä¸­çš„ <code>bytes</code> å±æ€§å°†è¢«è®¾ç½®ä¸º true<br>
ä½ ä¹Ÿå¯ä»¥è‡ªè¡ŒæŒ‡å®š short/long çš„åç§°, ä¸æŒ‡å®šæ—¶, shortå–é¦–å­—æ¯, longå–å…¨éƒ¨</p>
<p>æ¯”å¦‚ <code>-l/--lines</code> ä¸ <code>-L/--longest-line</code>, ä¸æŒ‡å®šæ—¶éƒ½æ˜¯ <code>-l</code>, ç¼–è¯‘ä¼šæŠ¥é”™, éœ€è¦è‡ªå·±æŒ‡å®š:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Print the maximum line width (Unicode)</span></span><br><span class="line"><span class="meta">#[arg(short = &#x27;L&#x27;, long)]</span></span><br><span class="line"><span class="keyword">pub</span> longest_line: <span class="built_in">bool</span>,</span><br></pre></td></tr></table></figure>
<h3 id="can-shu" id="å‚æ•°">å‚æ•°</h3>
<p>å½“ä½ æ²¡æœ‰æ·»åŠ  <code>short</code> æˆ– <code>long</code> æ—¶, è‡ªç„¶å°±ä»£è¡¨è¿™æ˜¯ä¸ª argument</p>
<p>åœ¨è¿™é‡Œ, æˆ‘ä»¬å”¯ä¸€éœ€è¦çš„å‚æ•°, æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè·¯å¾„, å› æ­¤æˆ‘ä»¬ä½¿ç”¨ Vec<PathBuf> æ¥è¡¨ç¤ºå®ƒ, clap ä¼šè‡ªåŠ¨å°†å‚æ•°è§£æä¸ºè·¯å¾„<br>
ä¸ºäº†é†’ç›®, æˆ‘ä»¬å°†å…¶æ˜¾ç¤ºåœ¨ help ä¸­çš„åå­—, æ”¹ä¸ºå¤§å†™çš„ <code>PATH</code>, åŒæ—¶æŒ‡å®šè¯¥å‚æ•°å¿…é€‰, é˜²æ­¢è·¯å¾„æ•°ä¸º0:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// The path(s) you should provide</span></span><br><span class="line"><span class="meta">#[arg(value_name = <span class="meta-string">&quot;PATH&quot;</span>, required = true)]</span></span><br><span class="line"><span class="keyword">pub</span> paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;,</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä¸è¾“å…¥å‚æ•°, å‘½ä»¤è¡Œå°±ä¼šä¼˜é›…åœ°æ˜¾ç¤ºé”™è¯¯, å‹å–„åœ°æ¥æé†’ä½ :</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo run -- -b</span><br></pre></td></tr></table></figure>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">error: </span>The following required arguments were not provided:</span><br><span class="line">  &lt;PATH&gt;...</span><br><span class="line"></span><br><span class="line">Usage: rwc &lt;--bytes|--chars|--words|--lines|--longest-line&gt; &lt;PATH&gt;...</span><br><span class="line"></span><br><span class="line">For more information try &#x27;--help&#x27;</span><br></pre></td></tr></table></figure>
<p>ä½†æ­¤æ—¶, å…¶å®è¿˜æœ‰ä¸€ä¸ªé—®é¢˜: å‚æ•°è™½ç„¶è¢«è½¬åŒ–ä¸º PathBuf, ä½†ä¸å­˜åœ¨çš„è·¯å¾„ä¹Ÿæ˜¯è·¯å¾„å•Š! æ­¤æ—¶å°±åº”è¯¥æŠ¥é”™æ‰è¡Œ<br>
æ²¡é”™, clap åªæ˜¯è´Ÿè´£å¸®æˆ‘ä»¬ç”Ÿæˆ <code>è¿›è¡Œè½¬æ¢çš„ä»£ç </code><br>
ä½†éªŒè¯å­˜åœ¨æ€§ç­‰å·¥ä½œ, åº”è¯¥è‡ªå·±æ¥å®Œæˆ, æ¯•ç«Ÿ clap åˆä¸çŸ¥é“è¿™ä¸ªå‚æ•°ä¼šè¢«æ‹¿å»å¹²å•¥ ğŸ˜ƒ</p>
<p>å› æ­¤, æˆ‘ä»¬æ¥å­¦å­¦å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰çš„å‚æ•°è§£æå™¨å§</p>
<h2 id="zi-ding-yi-can-shu-jie-xi-qi" id="è‡ªå®šä¹‰å‚æ•°è§£æå™¨">è‡ªå®šä¹‰å‚æ•°è§£æå™¨</h2>
<p>æœ‰äº›ç–‘é—®æˆ–è®¸ä¼šè¦ç»•åœ¨ä½ çš„å¿ƒå¤´:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>clap æ˜¯æ€ä¹ˆè¿›è¡Œè§£æçš„?</p>
</li>
<li class="lvl-2">
<p>clap èƒ½å¦å°†ä¼ å…¥çš„å‚æ•°, è§£æä¸ºè‡ªå®šä¹‰çš„ç±»å‹å‘¢?</p>
</li>
<li class="lvl-2">
<p>æˆ‘ä»¬èƒ½å¦åœ¨ç”¨æˆ·ç©¿å‚æ—¶, æ£€æŸ¥å‚æ•°æ˜¯å¦åˆæ³•, éæ³•çš„ç›´æ¥æŠ¥é”™, æ¥æé†’ç”¨æˆ·å‘¢?</p>
</li>
</ul>
<p>å®é™…ä¸Š, ä½ éœ€è¦é€šè¿‡å‘åä¸º value_parser çš„å‡½æ•°, ä¼ å…¥ä¸€ä¸ªè§£æå™¨, é€šè¿‡è°ƒç”¨è¯¥è§£æå™¨æ¥å¯¹å‚æ•°è¿›è¡Œè§£æä¸éªŒè¯<br>
æ¯”å¦‚, å¦‚æœæˆ‘ä»¬æƒ³éªŒè¯ä¼ å…¥çš„è·¯å¾„æ˜¯å¦åˆæ³•, å¯ä»¥è¿™æ ·å†™:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line">    <span class="comment">/// The path(s) you should provide</span></span><br><span class="line">    <span class="meta">#[arg(value_parser = check_path, value_name = <span class="meta-string">&quot;PATH&quot;</span>, required = true)]</span></span><br><span class="line">    <span class="keyword">pub</span> paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;,</span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">check_path</span></span>(filename: &amp;<span class="built_in">str</span>) -&gt; <span class="built_in">Result</span>&lt;PathBuf, <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> path = PathBuf::from(filename);</span><br><span class="line">    <span class="keyword">if</span> filename == <span class="string">&quot;-&quot;</span> || path.exists() &#123;</span><br><span class="line">        <span class="literal">Ok</span>(path)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">Err</span>(<span class="built_in">format!</span>(<span class="string">&quot;No such path: `&#123;&#125;`&quot;</span>, path.display()))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Good, ç°åœ¨å½“ä½ ä¼ å…¥è·¯å¾„æ—¶, ç¨‹åºä¼šå¯¹è·¯å¾„è¿›è¡ŒéªŒè¯, è‹¥è·¯å¾„ä¸å­˜åœ¨, é‚£å°±è¿”å›ä¸€ä¸ªé”™è¯¯<br>
è¯¥é”™è¯¯ä¼šåœ¨ç”¨æˆ·ä¼ å…¥éæ³•è·¯å¾„æ—¶, ä½œä¸ºæŠ¥é”™ä¿¡æ¯å‡ºç°:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo run -- -b asdxxx</span><br></pre></td></tr></table></figure>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">error: </span>Invalid value &quot;asd&quot; for &#x27;&lt;PATH&gt;...&#x27;: No such path: `asdxxx`</span><br><span class="line"></span><br><span class="line">For more information try &#x27;--help&#x27;</span><br></pre></td></tr></table></figure>
<p>äºæ­¤åŒæ—¶, clap å·²ç»ä¸ºéå¸¸å¤šçš„åŸºæœ¬ç±»å‹, å¸¸ç”¨ç±»å‹, åµŒå¥—åŸºæœ¬ç±»å‹, åµŒå¥—å¸¸ç”¨ç±»å‹å®ç°äº†éå¸¸å¤šçš„ parser<br>
å¾—ç›Šäºæ­¤, ä½ å¯ä»¥ä¸ºä»»ä½•ç±»å‹å®šä¹‰å¯¹åº”çš„ parser</p>
<h2 id="can-shu-guan-xi" id="å‚æ•°å…³ç³»">å‚æ•°å…³ç³»</h2>
<p>æœ‰æ—¶å€™, æˆ‘ä»¬å¯èƒ½ä¼šé¢ä¸´è¿™æ ·æˆ–é‚£æ ·çš„é—®é¢˜:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å½“å¯ç”¨è¿™ä¸ª option æ—¶, å¦å¤–ä¸€ä¸ªä¸å…¶å†²çªçš„ option ä¸åº”è¯¥è¢«å¯ç”¨</p>
</li>
<li class="lvl-2">
<p>ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„ option(s) å¿…é¡»è¢«å¯ç”¨</p>
</li>
<li class="lvl-2">
<p>å¤šä¸ªæŒ‡å®šçš„ options å¯ä»¥åŒæ—¶è¢«å¯ç”¨</p>
</li>
</ul>
<p>å¦‚ä½•å®ç°è¿™äº›å…³ç³»? ä½ å¯èƒ½ä¼šæƒ³è‡ªå·±æ‰‹å†™, ä½†æ—¶é—´ä¸åº”è¯¥æµªè´¹åœ¨è¿™äº›äº‹æƒ…ä¸Š, åœ¨ clap ä¸­, æœ‰ç€å¯¹åº”æœºåˆ¶æ¥å¤„ç†è¿™äº›äº‹æƒ…<br>
å®ƒå«åš <code>å‚æ•°å…³ç³»(Argument Relations)</code>, å½“å‚æ•°ä¸ç¬¦åˆå¯¹åº”å…³ç³»æ—¶, ä¼šå‡ºç°å‹å–„çš„æŠ¥é”™ä¿¡æ¯, æç¤ºç”¨æˆ·åº”è¯¥å¦‚ä½•ä¿®æ”¹<br>
å› æ­¤, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Arg/ArgGroup (å‚æ•°ä¸å‚æ•°ç»„) æ¥å£°æ˜è¿™äº›å…³ç³»</p>
<p>å®é™…ä¸Š, ä½ å…ˆå‰åœ¨ <code>paths</code> å¤´ä¸Šå†™çš„ <code>required = true</code>, å°±æ˜¯ä¸€ç§å‚æ•°å…³ç³»</p>
<p>ä»¥æˆ‘ä»¬çš„ <code>rwc</code> ä¸¾ä¸ªä¾‹å­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>-b/-c/-w/-l/-L</code> èƒ½åŒæ—¶å‡ºç°, å³æ”¯æŒç±»ä¼¼ <code>-b -c -w</code> æˆ– <code>-bcw</code> çš„å½¢å¼</p>
</li>
<li class="lvl-2">
<p><code>-b/-c/-w/-l/-L</code> è‡³å°‘å‡ºç°å…¶ä¸­ä¸€ä¸ª, é˜²æ­¢åªä¼ è·¯å¾„ä¸ä¼  option</p>
</li>
</ul>
<p>ä»»ä½•ä¸€ä¸ª Arg ç±»å‹ (è¢« #[arg] æ‰€ä¿®é¥°çš„), æˆ–è€… ArgGroup, éƒ½èƒ½å¤Ÿå£°æ˜è¿™ç§å‚æ•°é—´çš„å…³ç³»<br>
æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ª ArgGroup çš„å®ä¾‹, ç„¶åæŠŠå…ˆå‰çš„ä¸€å¨ <code>-b/-c/-w/-l/-L</code> éƒ½æ”¾å…¥å…¶ä¸­:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="meta">#[derive(Parser)]</span></span><br><span class="line"><span class="meta">#[command(</span></span><br><span class="line"><span class="meta">    author, version, about,</span></span><br><span class="line"><span class="meta">    group(ArgGroup::new(<span class="meta-string">&quot;options&quot;</span>).multiple(true).required(true).args(&amp;[ <span class="meta-string">&quot;bytes&quot;</span>, <span class="meta-string">&quot;chars&quot;</span>, <span class="meta-string">&quot;words&quot;</span>, <span class="meta-string">&quot;lines&quot;</span>, <span class="meta-string">&quot;longest_line&quot;</span>]</span>)),</span><br><span class="line">)]</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Cli</span></span> &#123;</span><br><span class="line">    <span class="comment">/// The path(s) you should provide</span></span><br><span class="line">    <span class="meta">#[arg(value_parser = check_path, value_name = <span class="meta-string">&quot;PATH&quot;</span>, required = true)]</span></span><br><span class="line">    <span class="keyword">pub</span> paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;,</span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// ......</span></span><br></pre></td></tr></table></figure>
<p><code>multiple(true)</code> è¡¨ç¤ºå¯ä»¥åŒæ—¶å‡ºç°å‚æ•°ç»„çš„æˆå‘˜, <code>required(true)</code> è¡¨ç¤ºè‡³å°‘ä¼ å…¥è¯¥å‚æ•°ç»„ä¸­çš„å…¶ä¸­ä¸€ä¸ªæˆå‘˜</p>
<h2 id="zi-ming-ling" id="å­å‘½ä»¤">å­å‘½ä»¤</h2>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ª subcommand, ç”¨æ¥å¯ç”¨æ‰€æœ‰çš„ options, å®ƒä¹Ÿè¦æ¥å—ä¸€ä¸ªè·¯å¾„ä½œä¸ºå‚æ•°</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Cli</span></span> &#123;</span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line">    <span class="meta">#[command(subcommand)]</span></span><br><span class="line">    <span class="keyword">pub</span> sub_commands: <span class="built_in">Option</span>&lt;SubCommands&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Subcommand)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">SubCommands</span></span> &#123;</span><br><span class="line">    <span class="comment">/// Enabled all available options</span></span><br><span class="line">    All &#123;</span><br><span class="line">        <span class="comment">/// The path(s) you should provide</span></span><br><span class="line">        <span class="meta">#[arg(value_parser = check_path, value_name = <span class="meta-string">&quot;PATH&quot;</span>, required = true)]</span></span><br><span class="line">        paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥ä¼šæƒ³, èƒ½ä¸èƒ½è®©å­å‘½ä»¤å¤ç”¨ <code>Cli</code> ä¸­å®šä¹‰çš„ <code>paths</code>, å‡å°‘é‡å¤ä»£ç å‘¢?<br>
å½“ç„¶å¯ä»¥, è¯·åœ¨ <code>Cli</code> çš„æˆå‘˜ <code>paths</code>, å¤´ä¸Šçš„<code>#[arg]</code> ä¸­æ·»åŠ  <code>global = true</code>, è¡¨ç¤ºè¯¥å‚æ•°æ˜¯å…¨å±€æ€§çš„, ç›¸å½“äºå­å‘½ä»¤ä¸­ä¹Ÿæ·»åŠ äº†è¿™ä¹ˆä¸ªå‚æ•°</p>
<p>ä½†éå¸¸é—æ†¾, å½“è®¾ç½® <code>global = true</code> å, å°±æ— æ³•è®¾ç½® <code>required = true</code> äº†, å› æ­¤æˆ‘ä»¬è¿˜æ˜¯å¾—å®šä¹‰ä¸€ä»½ç›¸åŒçš„å‚æ•°, è¯¦è§ <a href="https://github.com/clap-rs/clap/issues/1546">ç›¸å…³issue</a></p>
<p><strong>æ³¨æ„:</strong><br>
è¿™é‡Œå…¶å®å¯ä»¥é€‰æ‹©ä¸å®šä¹‰ subcommand, å½“æ²¡æœ‰ä¼ å…¥ options æ—¶é»˜è®¤å¼€å¯æ‰€æœ‰ options, æ¥ç®€åŒ–ç”¨æˆ·è¾“å…¥<br>
ä½†æœ¬æ–‡è¿˜æ˜¯å®šä¹‰äº† subcommand ä»¥ä¾¿è¯»è€…äº†è§£, èµ·æ¼”ç¤ºä½œç”¨</p>
<hr>
<h1 id="luo-ji-shi-xian">é€»è¾‘å®ç°</h1>
<p>æ ¹æ®:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">â”œâ”€â”€ wc_result.rs   <span class="meta"># è®¡ç®—å¹¶å­˜å‚¨ç»“æœ</span></span><br><span class="line">â”œâ”€â”€ <span class="keyword">cli</span>.rs         <span class="meta"># å‘½ä»¤è¡Œçš„å®šä¹‰</span></span><br><span class="line">â”œâ”€â”€ files.rs       <span class="meta"># è¯»å–æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å·²ç»å®Œæˆäº†å¯¹å‘½ä»¤è¡Œçš„å®šä¹‰, æ¥ä¸‹æ¥è¦åšçš„, å°±æ˜¯æ ¹æ® Cli çš„å†…å®¹æ¥å®ç°é€»è¾‘äº†<br>
ä¸ºäº†é¿å…ä½ å›åˆ°å‰é¢çœ‹ <code>lib.rs</code> çš„å†…å®¹, ä¸‹é¢å†è´´ä¸€é:</p>
<figure class="highlight rust"><figcaption><span>src/lib.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;collections::HashMap, path::PathBuf&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> cli;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> files;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> wc_result;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">Result</span></span>&lt;T&gt; = std::result::<span class="built_in">Result</span>&lt;T, <span class="built_in">Box</span>&lt;<span class="keyword">dyn</span> std::error::Error&gt;&gt;;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">Counts</span></span> = <span class="built_in">Vec</span>&lt;<span class="built_in">usize</span>&gt;;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">PathWithContent</span></span> = HashMap&lt;PathBuf, <span class="built_in">String</span>&gt;;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯å¯¹åº”æ¨¡å—çš„é€»è¾‘å®ç°, åœ¨æˆ‘çš„åšå®¢ä¸­æ˜¯ä»¥tabçš„å½¢å¼å‘ˆç°, æ¯”è¾ƒæ¸…æ™°, å…¶ä»–å¹³å°æœªçŸ¥:</p>
<div class="tabs" id="é€»è¾‘å®ç°ä»£ç "><ul class="nav-tabs"><li class="tab active"><a href="#é€»è¾‘å®ç°ä»£ç -1">è¯»å–æ–‡ä»¶</a></li><li class="tab"><a href="#é€»è¾‘å®ç°ä»£ç -2">è¿›è¡Œè®¡ç®—</a></li></ul><div class="tab-content"><div class="tab-pane active" id="é€»è¾‘å®ç°ä»£ç -1"><figure class="highlight rust"><figcaption><span>src/files.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¾èµ–</span></span><br><span class="line"><span class="comment">// æˆ‘å†™çš„æ—¶å€™é‡è§æ²¡æœ‰å¯¼å…¥çš„, ä¹Ÿæ˜¯ç›´æ¥ç”¨ lsp æ¥è‡ªåŠ¨å¯¼å…¥, ç›´æ¥ä¸åé¢çš„ä»£ç å¯¹ç…§çœ‹ä¼šæ¯”è¾ƒå¥½</span></span><br><span class="line"><span class="keyword">use</span> crate::&#123;PathWithContent, <span class="built_in">Result</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> indicatif::&#123;MultiProgress, ProgressBar, ProgressStyle&#125;;</span><br><span class="line"><span class="keyword">use</span> rayon::prelude::*;</span><br><span class="line"><span class="keyword">use</span> std::ffi::OsStr;</span><br><span class="line"><span class="keyword">use</span> std::process;</span><br><span class="line"><span class="keyword">use</span> std::sync::atomic::&#123;AtomicUsize, Ordering&#125;;</span><br><span class="line"><span class="keyword">use</span> std::&#123;</span><br><span class="line">    fs::File,</span><br><span class="line">    io::&#123;BufReader, Read&#125;,</span><br><span class="line">    path::PathBuf,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// `INPUTTED_FILE_NUMBER` è¡¨ç¤º INPUT çš„ç¼–å·, æ˜¯æœ¬æ–‡å¼€ç¯‡çš„ asciinema å±•ç¤ºä¸­çš„æ•ˆæœ</span></span><br><span class="line"><span class="comment">// `BUFFER_SIZR` è¡¨ç¤ºæ¯æ¬¡è¯»å–æ–‡ä»¶æ—¶ç¼“å†²åŒºçš„å¤§å° (å®ç°è¿›åº¦æ¡)</span></span><br><span class="line"><span class="keyword">static</span> INPUTTED_FILE_NUMBER: AtomicUsize = AtomicUsize::new(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> BUFFER_SIZR: <span class="built_in">usize</span> = <span class="number">16</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ trait æ¥æ‰©å±•æ ‡å‡†åº“ä¸­çš„ PathBuf ç±»å‹, æœ‰ä¸¤ä¸ªå‡½æ•°, ä¸€ä¸ªæ£€æµ‹æ˜¯å¦æ˜¯ä»¥ç‚¹å¼€å¤´çš„, ä¸€ä¸ªåŠ ä¸Šç‚¹å‰ç¼€</span></span><br><span class="line"><span class="comment">// æ¯”å¦‚, å½“ä½ ä¼ å…¥ `./build.rs` ä¸ `build.rs`, å‰è€…è¾“å‡ºæ—¶æœ‰ç‚¹å‰ç¼€, åè€…æ²¡æœ‰, å› æ­¤ç»Ÿä¸€ä¸‹</span></span><br><span class="line"><span class="comment">// å¹¶ä¸”å½“æ˜¯ä» stdin è¯»å–çš„æ—¶å€™, å°±æ˜¾ç¤ºæ— ç‚¹å‰ç¼€çš„ `Input/0` ä¼šæ›´æ¸…æ™°</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">PathExt</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">without_dotted_prefix</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">bool</span>;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">add_dotted_prefix</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> PathExt <span class="keyword">for</span> PathBuf &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">without_dotted_prefix</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.is_relative() &amp;&amp; !<span class="keyword">self</span>.starts_with(<span class="string">&quot;../&quot;</span>) &amp;&amp; !<span class="keyword">self</span>.starts_with(<span class="string">&quot;./&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">add_dotted_prefix</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        *<span class="keyword">self</span> = PathBuf::from_iter([OsStr::new(<span class="string">&quot;./&quot;</span>), <span class="keyword">self</span>.as_os_str()]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶çš„å‡½æ•°, è¢«æš´éœ²ç»™å…¶ä»–æ¨¡å—, å‚æ•°æ˜¯ä¸€ä¸ªè·¯å¾„æ•°ç»„</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">read_files</span></span>(paths: <span class="built_in">Vec</span>&lt;PathBuf&gt;) -&gt; <span class="built_in">Result</span>&lt;PathWithContent&gt; &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Reading files / Getting content from stdin:&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶å®è¿™é‡Œçš„ filter ä¸å¤ªå¥½, è¿˜å¯ä»¥åˆ¤æ–­ç›®å½•ä¸é€’å½’è¯»å–, ä½†æš‚æ—¶å°±è¿™æ ·å§</span></span><br><span class="line">    <span class="keyword">let</span> result = paths</span><br><span class="line">        .into_par_iter()</span><br><span class="line">        .filter(|path| path.is_file() || path.as_os_str() == <span class="string">&quot;-&quot;</span>)</span><br><span class="line">        .map(|<span class="keyword">mut</span> path| &#123;</span><br><span class="line">            <span class="keyword">let</span> should_read_from_input = path.as_os_str() == <span class="string">&quot;-&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> content = get_content(&amp;path, should_read_from_input);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> path.without_dotted_prefix() &#123;</span><br><span class="line">                path.add_dotted_prefix();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> should_read_from_input &#123;</span><br><span class="line">                <span class="keyword">let</span> inputted_file_number = INPUTTED_FILE_NUMBER.fetch_add(<span class="number">1</span>, Ordering::SeqCst);</span><br><span class="line">                path = PathBuf::from(<span class="built_in">format!</span>(<span class="string">&quot;Input/&#123;&#125;&quot;</span>, inputted_file_number));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> content = content.unwrap_or_else(|err| &#123;</span><br><span class="line">                eprintln!(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, path.display(), err);</span><br><span class="line">                process::exit(<span class="number">1</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            (path, content)</span><br><span class="line">        &#125;)</span><br><span class="line">        .collect();</span><br><span class="line">    <span class="literal">Ok</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// helper å‡½æ•°, é’ˆå¯¹å•ä¸ªè·¯å¾„</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">get_content</span></span>(path: &amp;PathBuf, should_read_from_input: <span class="built_in">bool</span>) -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> should_read_from_input &#123;</span><br><span class="line">        read_from_stdin()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> bars = MultiProgress::new();</span><br><span class="line">        <span class="keyword">let</span> style =</span><br><span class="line">            ProgressStyle::with_template(<span class="string">&quot;[&#123;elapsed&#125;][&#123;percent&#125;%] &#123;bar:45.cyan/blue&#125; &#123;bytes&#125; &#123;wide_msg&#125;&quot;</span>)?</span><br><span class="line">                .progress_chars(<span class="string">&quot;&gt;-&quot;</span>);</span><br><span class="line">        read_file_with_progress(path, style, bars)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–å¯¹åº”è·¯å¾„çš„æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_file_with_progress</span></span>(path: &amp;PathBuf, style: ProgressStyle, bars: MultiProgress) -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> content = <span class="built_in">String</span>::new();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> file = File::open(path)?;</span><br><span class="line">    <span class="keyword">let</span> size = file.metadata()?.len();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> bar = ProgressBar::new(size).with_message(<span class="built_in">format!</span> &#123;<span class="string">&quot;Reading &#123;&#125;&quot;</span>, path.display()&#125;).with_style(style);</span><br><span class="line">    <span class="keyword">let</span> bar = bars.add(bar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> bufreader = BufReader::new(file);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> buf = [<span class="number">0</span>; BUFFER_SIZR];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="literal">Ok</span>(n) = bufreader.read(&amp;<span class="keyword">mut</span> buf) &#123;</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bar.inc(n <span class="keyword">as</span> <span class="built_in">u64</span>);</span><br><span class="line">        content += &amp;<span class="built_in">String</span>::from_utf8_lossy(&amp;buf[..n]);</span><br><span class="line">    &#125;</span><br><span class="line">    bar.finish_with_message(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="literal">Ok</span>(content)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä» stdin ä¸­è¯»å–, ä½œä¸ºä¸´æ—¶æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_from_stdin</span></span>() -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> content = <span class="built_in">vec!</span>[];</span><br><span class="line">    std::io::stdin().read_to_end(&amp;<span class="keyword">mut</span> content)?;</span><br><span class="line">    <span class="literal">Ok</span>(<span class="built_in">String</span>::from_utf8(content)?)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="é€»è¾‘å®ç°ä»£ç -2"><figure class="highlight rust"><figcaption><span>src/wc_result.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¾èµ–</span></span><br><span class="line"><span class="keyword">use</span> crate::&#123;</span><br><span class="line">    cli::&#123;Cli, SubCommands&#125;,</span><br><span class="line">    files::read_files,</span><br><span class="line">    Counts, <span class="built_in">Result</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> prettytable::&#123;cell, format::consts::FORMAT_BOX_CHARS, Row, Table&#125;;</span><br><span class="line"><span class="keyword">use</span> rayon::prelude::*;</span><br><span class="line"><span class="keyword">use</span> std::&#123;collections::HashMap, path::PathBuf, <span class="built_in">str</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜æ”¾è¢«å¯ç”¨çš„ options, ä¸é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">WcResult</span></span> &#123;</span><br><span class="line">    enabled_options: <span class="built_in">Vec</span>&lt;&amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span>&gt;,</span><br><span class="line">    paths_with_counts: HashMap&lt;PathBuf, Counts&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(<span class="keyword">mut</span> cli: Cli) -&gt; <span class="built_in">Result</span>&lt;WcResult&gt; &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Please waiting...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®å­å‘½ä»¤è¿›è¡Œç›¸åº”æ“ä½œ</span></span><br><span class="line">    <span class="keyword">match</span> cli.sub_commands &#123;</span><br><span class="line">        <span class="literal">Some</span>(SubCommands::All &#123; <span class="keyword">ref</span> paths &#125;) =&gt; &#123;</span><br><span class="line">            cli.paths = paths.clone();</span><br><span class="line">            cli.enable_all_options();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="literal">None</span> =&gt; cli.enable_all_options(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›è¡Œè®¡ç®—</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Calculating...&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> wc_result = WcResult &#123;</span><br><span class="line">        enabled_options: cli.get_enabled_options(),</span><br><span class="line">        paths_with_counts: &#123;</span><br><span class="line">            <span class="keyword">let</span> contents = read_files(cli.paths.clone())?;</span><br><span class="line">            contents.into_par_iter().map(|(path, content)| (path, calculate_counts(&amp;cli, content))).collect()</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="literal">Ok</span>(wc_result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> WcResult &#123;</span><br><span class="line">    <span class="comment">// å°†ä¿å­˜çš„ä¿¡æ¯è½¬åŒ–ä¸ºç¾åŒ–åçš„è¡¨æ ¼</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">to_pretty_table</span></span>(<span class="keyword">self</span>) -&gt; Table &#123;</span><br><span class="line">        <span class="keyword">let</span> titles = &#123;</span><br><span class="line">            <span class="keyword">let</span> enabled_options = <span class="keyword">self</span>.enabled_options;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> titles = Row::new(enabled_options.into_iter().map(|x| cell!(Fybi -&gt; x)).collect());</span><br><span class="line">            titles.insert_cell(<span class="number">0</span>, cell!(Fybi -&gt; <span class="string">&quot;Path&quot;</span>));</span><br><span class="line">            titles</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> table = Table::new();</span><br><span class="line">        table.set_titles(titles);</span><br><span class="line">        table.set_format(*FORMAT_BOX_CHARS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (path, counts) <span class="keyword">in</span> <span class="keyword">self</span>.paths_with_counts &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut</span> row = Row::new(counts.into_iter().map(|x| cell!(x)).collect());</span><br><span class="line">            <span class="keyword">let</span> path_cell = <span class="keyword">if</span> path.starts_with(<span class="string">&quot;Input&quot;</span>) &#123;</span><br><span class="line">                cell!(Fbb -&gt; path.display())</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cell!(Fmb -&gt; path.display())</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            row.insert_cell(<span class="number">0</span>, path_cell);</span><br><span class="line">            table.add_row(row);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        table</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å¤ªæ‡‚ rayon, æš‚æ—¶è¿™æ ·ç³Šä¸Šå»äº†</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calculate_counts</span></span>(cli: &amp;Cli, content: <span class="built_in">String</span>) -&gt; Counts &#123;</span><br><span class="line">    <span class="keyword">let</span> v: <span class="built_in">Vec</span>&lt;<span class="built_in">Option</span>&lt;<span class="built_in">usize</span>&gt;&gt; = <span class="built_in">vec!</span>[<span class="literal">None</span>; <span class="number">5</span>];</span><br><span class="line">    v.into_par_iter()</span><br><span class="line">        .enumerate()</span><br><span class="line">        .map(|(idx, _)| <span class="keyword">match</span> idx &#123;</span><br><span class="line">            <span class="number">0</span> =&gt; cli.bytes.then_some(content.len()),</span><br><span class="line">            <span class="number">1</span> =&gt; cli.chars.then_some(content.chars().count()),</span><br><span class="line">            <span class="number">2</span> =&gt; cli.words.then_some(content.split_whitespace().count()),</span><br><span class="line">            <span class="number">3</span> =&gt; cli.lines.then_some(content.lines().count()),</span><br><span class="line">            <span class="number">4</span> =&gt; cli</span><br><span class="line">                .longest_line</span><br><span class="line">                .then_some(content.lines().map(unicode_width::UnicodeWidthStr::width).max().unwrap_or(<span class="number">0</span>)),</span><br><span class="line">            _ =&gt; <span class="literal">None</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        .flatten()</span><br><span class="line">        .collect()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<p>ç„¶åå°±æ˜¯ main å‡½æ•°:</p>
<figure class="highlight rust"><figcaption><span>src/main.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> clap::Parser;</span><br><span class="line"><span class="keyword">use</span> rust_wc::&#123;cli::Cli, wc_result, <span class="built_in">Result</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; <span class="built_in">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> cli = Cli::parse();</span><br><span class="line">    <span class="keyword">let</span> pretty_table = wc_result::get(cli)?.to_pretty_table();</span><br><span class="line">    pretty_table.printstd();</span><br><span class="line">    <span class="literal">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°±é…±, ç»“æŸå•¦! å¸Œæœ›æœ¬æ–‡èƒ½å¸®åˆ°ä½  ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Clap</tag>
        <tag>CLI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gstreamer-p1~&gt; ç³»åˆ—è¯´æ˜</title>
    <url>/posts/rust-gstreamer/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æ¬¢è¿å¤§å®¶æ¥åˆ° gstreamer çš„ç³»åˆ—, å­¦ä¹ å¦‚ä½•å¤„ç†éŸ³è§†é¢‘</p>
</blockquote>
<span id="more"></span>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GStreamer</tag>
        <tag>Video</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gstreamer-p2~&gt; ç®¡é“çš„åŸºç¡€æ¦‚å¿µ</title>
    <url>/posts/rust-gstreamer/p2.html</url>
    <content><![CDATA[<blockquote>
<p>é€šè¿‡ä¸€ä¸ªå…¥é—¨çº§ä¾‹å­, è®²è¿° gstreamer ä¸­ç®¡é“çš„åŸºç¡€æ¦‚å¿µ</p>
</blockquote>
<span id="more"></span>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GStreamer</tag>
        <tag>Video</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gstreamer-p3~&gt; ç®¡é“çš„åŠ¨æ€æ„å»º</title>
    <url>/posts/rust-gstreamer/p3.html</url>
    <content><![CDATA[<blockquote>
<p>å­¦ä¹ å¦‚ä½•åŠ¨æ€åœ°æ„å»ºç®¡é“</p>
</blockquote>
<span id="more"></span>]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GStreamer</tag>
        <tag>Video</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gstreamer-p4~&gt; æ—¶é—´ç®¡ç†</title>
    <url>/posts/rust-gstreamer/p4.html</url>
    <content><![CDATA[<blockquote>
<p>å­¦ä¹  gstreamer ä¸­çš„æ—¶é—´ç®¡ç†, æ‰§è¡Œå¿«è¿›/åé€€ç­‰æ“ä½œ</p>
</blockquote>
<span id="more"></span>]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GStreamer</tag>
        <tag>Video</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gstreamer-p5~&gt; ä¸GUIé›†æˆ</title>
    <url>/posts/rust-gstreamer/p5.html</url>
    <content><![CDATA[<blockquote>
<p>é€šè¿‡ä¸ GUI é›†æˆ, æ¥åˆ¶ä½œä¸€ä¸ªç®€æ˜“çš„éŸ³ä¹æ’­æ”¾å™¨</p>
</blockquote>
<span id="more"></span>]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GStreamer</tag>
        <tag>Video</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-decl-macro-p1~&gt; ç³»åˆ—è¯´æ˜</title>
    <url>/posts/rust-decl-macro/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ å£°æ˜å®(declarative-macro) ç³»åˆ—</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p>
</li>
<li class="lvl-2">
<p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p>
</li>
</ul>
<h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1>
<p>æ­¤ç³»åˆ—,æˆ‘ä»¬å°†å­¦ä¹ Rustä¸­çš„ <code>å£°æ˜å®</code><br>
è¯·æ³¨æ„, æ˜¯å£°æ˜å®, è¿‡ç¨‹å®æ—¥åå†è¯´</p>
<hr>
<h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1>
<ol>
<li class="lvl-3">
<p>ä¹¦ç±</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://zjp-cn.github.io/tlborm/">å®å°å†Œ</a></p>
</li>
<li class="lvl-2">
<p><a href="https://rustcc.gitbooks.io/rustprimer/content/macro/macro.html">RustPrimer</a></p>
</li>
<li class="lvl-2">
<p><a href="https://kaisery.github.io/trpl-zh-cn/ch19-06-macros.html">TRPL</a></p>
</li>
</ul>
<ol start="2">
<li class="lvl-3">
<p>æ–‡ç« </p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://zhuanlan.zhihu.com/p/353421021">ã€è¯‘ã€‘Rustå®: æ•™ç¨‹ä¸ç¤ºä¾‹ (ä¸€)</a></p>
</li>
<li class="lvl-2">
<p><a href="https://zhuanlan.zhihu.com/p/356427780">ã€è¯‘ã€‘Rustå®: æ•™ç¨‹ä¸ç¤ºä¾‹ (äºŒ)</a></p>
</li>
</ul>
<hr>
<h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1>
<p>å‘ç°é”™è¯¯çš„è¯, è¯·åŠæ—¶è·Ÿæˆ‘è”ç³», æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>
ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p>
<p>æœ€å, è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Macro</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-decl-macro-p2~&gt; ä»printlnå¼€å§‹</title>
    <url>/posts/rust-decl-macro/p2.html</url>
    <content><![CDATA[<blockquote>
<p>æˆ‘ä»¬ä»ç†Ÿæ‚‰çš„ println! å¼€å§‹, äº†è§£ä¸‹å£°æ˜å®çš„å¤§è‡´ç»“æ„å§</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨:</p>
<ul class="lvl-0">
<li class="lvl-2"><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></li>
<li class="lvl-2"><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></li>
</ul>
<h1 id="kai-pian">å¼€ç¯‡</h1>
<p>å¤§å®¶åº”è¯¥éƒ½ç”¨è¿‡ä¸€ä¸ªå®, å®ƒå°±æ˜¯ <code>println!</code>:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> s = <span class="string">&quot;Rush B!!!!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">    <span class="built_in">println!</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ä½ åˆšåˆšæ¥è§¦å®ƒçš„æ—¶å€™, å¯èƒ½ä¼šæ„Ÿåˆ°äº›è®¸ç–‘æƒ‘, ä¸ºä»€ä¹ˆåé¢è¦è·Ÿä¸ªæ„Ÿå¹å·? ä¸ºä»€ä¹ˆæ‹¬å·é‡Œé¢çš„å‚æ•°å¯ä»¥ä¸ä¸€æ ·?</p>
<p>äº²çˆ±çš„ TRPl åœ¨æ•™ä½ å†™ <a href="https://kaisery.github.io/trpl-zh-cn/ch01-02-hello-world.html#%E5%88%86%E6%9E%90%E8%BF%99%E4%B8%AA-rust-%E7%A8%8B%E5%BA%8F">Hello World!</a> æ—¶å‘Šè¯‰è¿‡ä½ : åå­—ååŠ ä¸ªæ„Ÿå¹å·,å°±æ˜¯ä¸ª<code>å®(macro)</code><br>
å¯ macro åˆ°åº•æ˜¯å•¥? <s>(ç®—äº†ç®—äº†,åæ­£åªè¦ä¼šç”¨å°±è¡Œäº†,äºæ˜¯ä½ ç‚¹å‡»äº†è¯¥ç½‘é¡µçš„å‰å‰)</s></p>
<hr>
<h1 id="cha-kan-ding-yi">æŸ¥çœ‹å®šä¹‰</h1>
<p>è®©æˆ‘ä»¬æŒ‰ä½Ctrl,é¼ æ ‡å·¦é”®ç‚¹å‡»println (ä»¥VSCode ä¸ºä¾‹):</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    () =&gt; ($crate::<span class="built_in">print!</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class="line">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½ å¯èƒ½ä¼šçœ‹åˆ°, åœ¨ println! çš„ä¸Šé¢</span></span><br><span class="line"><span class="comment">// æœ‰ç€ç±»ä¼¼ä¸‹é¢çš„ç©æ„:  </span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// #[macro_export]</span></span><br><span class="line"><span class="comment">// #[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]</span></span><br><span class="line"><span class="comment">// #[allow_internal_unstable(print_internals, format_args_nl)]</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// è¿™äº›ä¹Ÿå±äºå®, ä¸è¿‡æ˜¯ `è¿‡ç¨‹å®`</span></span><br><span class="line"><span class="comment">// è€Œè¯¥ç³»åˆ—è¦è®²çš„æ˜¯ `å£°æ˜å®`, å› æ­¤ç•¥è¿‡</span></span><br></pre></td></tr></table></figure>
<p>ä½ æ‚²å‚¬åœ°å‘ç°, æ ¹æœ¬çœ‹ä¸æ‡‚è¿™å †é¬¼ç”»ç¬¦â€¦ ä½†æ²¡äº‹, åˆ°åé¢å‡ èŠ‚ä½ è‚¯å®šå°±æ‡‚, ç°åœ¨åªéœ€æ˜ç™½çš„æ˜¯å¤§è‡´ç»“æ„:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æˆ‘ä»¬å°†<code>macro_rules!</code>æ”¾åœ¨<code>println</code>å‰é¢,è¯´æ˜åè€…æ˜¯ä¸ªå® (<code>macro_rules!</code>å½“ä½œç‰¹å®šè¯­æ³•å³å¯)</p>
</li>
<li class="lvl-2">
<p>ä¹‹åç”¨èŠ±æ‹¬å·åŒ…èµ·æ¥,é‡Œé¢æ˜¯è¯¥å®çš„å…·ä½“å®šä¹‰</p>
</li>
</ul>
<p>é—®é¢˜æ¥äº†, é‚£å¯¹èŠ±æ‹¬å·å†…, ä¹Ÿå°±æ˜¯å…·ä½“å®šä¹‰é‡Œ, åˆ°åº•å¹²ç€æ€ä¹ˆçš„äº‹?<br>
è¯·å®¹è®¸æˆ‘æ¥å¸®ä½ ç²—æš´åœ°ç±»æ¯”ä¸€ä¸‹<code>matchè¡¨è¾¾å¼ &amp;&amp; macro</code>:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// match</span></span><br><span class="line"><span class="keyword">match</span> num &#123;</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="string">&quot;1&quot;</span>.repeat(<span class="number">10</span>),</span><br><span class="line">    <span class="number">2</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;2&quot;</span>.repeat(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    _ =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Fuck you! I just want the  numer 1 or 2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// macro</span></span><br><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    () =&gt; ($crate::<span class="built_in">print!</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class="line">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>macroæœ‰ç‚¹åƒæ˜¯match,èƒ½æ ¹æ®ä¸åŒå‚æ•°,å±•å¼€ä¸åŒçš„ä»£ç , åœ¨macroæœ€å¤–å±‚çš„èŠ±æ‹¬å·ä¸­,æœ‰è®¸å¤šåŒ¹é…åˆ†æ”¯, æƒ³matchä¸€æ ·:</p>
<p>match:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>matchè¡¨è¾¾å¼,ç§°å‘¼æ¯ä¸ªåŒ¹é…åˆ†æ”¯ä¸º<code>arm</code></p>
</li>
<li class="lvl-2">
<p>é€—å·åˆ†å‰²å®ƒä»¬å½¼æ­¤,æˆ–è€…ä¸ç”¨é€—å·è€Œç”¨èŠ±æ‹¬å·åŒ…è£¹æ¥åˆ†å‰²</p>
</li>
<li class="lvl-2">
<p>æœ€åä¸€ä¸ªarmå¯çœç•¥é€—å·</p>
</li>
</ul>
<p>macro:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>macro,åˆ™ç§°å‘¼æ¯ä¸ªåŒ¹é…åˆ†æ”¯ä¸º<code>rule</code>(æ˜ç™½ä¸ºä»€ä¹ˆä½¿ç”¨<code>macro_rules!</code>åˆ›å»ºå®äº†å—)</p>
</li>
<li class="lvl-2">
<p>å¿…é¡»ä½¿ç”¨èŠ±æ‹¬å·åŒ…è£¹,ä½¿ç”¨åˆ†å·åˆ†éš”å½¼æ­¤</p>
</li>
<li class="lvl-2">
<p>æœ€åä¸€ä¸ªruleå¯çœç•¥åˆ†å·</p>
</li>
</ul>
<p>ä½ å¹¶ä¸éœ€ææ¸…æ‰€æœ‰ç»†èŠ‚,ç°åœ¨å…ˆä¸ç”¨è¯•å›¾è®°å¿†å…·ä½“è¯­æ³•,æœ‰å°è±¡å³å¯<br>
ç°åœ¨å†æ¥çœ‹çœ‹ <code>println</code>,æ˜¯ä¸æ˜¯ç¨å¾®æœ‰ç‚¹æ„Ÿè§‰äº†(çœ‹ä¸æ‡‚çš„åœ°æ–¹ä¾ç„¶ç›´æ¥è·³å³å¯):</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰éƒ¨åˆ†</span></span><br><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    <span class="comment">// ç©ºå‚æ—¶, åªè¾“å‡ºæ¢è¡Œç¬¦</span></span><br><span class="line">    () =&gt; ($crate::<span class="built_in">print!</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">    <span class="comment">// æœ‰å‚æ—¶, è¾“å‡ºå‚æ•°, å¹¶æ¢è¡Œ</span></span><br><span class="line">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class="line">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line"><span class="built_in">println!</span>();</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="zong-jie">æ€»ç»“</h1>
<ol>
<li class="lvl-3">
<p>åˆ›å»ºä¸€ä¸ªå‡è®¾å«xxxçš„macro,èŠ±æ‹¬å·åŒ…è£¹å…·ä½“å®šä¹‰:</p>
</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> xxx &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li class="lvl-3">
<p>ç„¶ååˆ›å»ºä¸¤ä¸ªåŒ¹é…åˆ†æ”¯:<br>
(åŒ¹é…ç©ºå‚ =&gt; ä¸åšä»»ä½•äº‹)<br>
(åŒ¹é…123 =&gt; æ‰“å°123)</p>
</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> xxx &#123;</span><br><span class="line">    () =&gt; &#123;&#125;;</span><br><span class="line">    (<span class="number">123</span>) =&gt; &#123;<span class="built_in">println!</span>(<span class="string">&quot;123&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li class="lvl-3">
<p>è°ƒç”¨æ—¶, è¦åšåˆ°: å®å+æ„Ÿå¹å·+ä¼ å‚:<br>
(ä¼ å…¥çš„å‚æ•°,è‹¥ä¸ä»»ä½•ruleéƒ½ä¸åŒ¹é…,åˆ™æŠ¥é”™)</p>
</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> xxx &#123;</span><br><span class="line">    () =&gt; &#123;&#125;;</span><br><span class="line">    (<span class="number">123</span>) =&gt; &#123;<span class="built_in">println!</span>(<span class="string">&quot;123&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    xxx!();      <span class="comment">// Nothing</span></span><br><span class="line">    xxx!(<span class="number">123</span>);   <span class="comment">// println!(&quot;123&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ¬èŠ‚åªæ˜¯ä¸ºäº†ç•™ä¸ªå¤§è‡´å°è±¡, å»ºç«‹ä¸€ä¸ªæ•´ä½“ç»“æ„çš„è®¤çŸ¥, ç›¸ä¿¡ä½ è‚¯å®šè¿˜æœ‰ä¸€äº›ç–‘æƒ‘, åé¢ä¼šæ¯”è¾ƒç³»ç»Ÿåœ°è®²è§£<br>
å’±ä»¬ä¸‹æœŸè§</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Macro</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-decl-macro-p3~&gt; å£°æ˜ä¸ä½¿ç”¨</title>
    <url>/posts/rust-decl-macro/p3.html</url>
    <content><![CDATA[<blockquote>
<p>æ­£å¼ç³»ç»Ÿçš„å…³äº macro çš„ å£°æ˜ä¸ä½¿ç”¨</p>
</blockquote>
<span id="more"></span>  
<p>åŒç³»åˆ—ä¼ é€é—¨:</p>
<ul class="lvl-0">
<li class="lvl-2"><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></li>
<li class="lvl-2"><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></li>
</ul>
<h1 id="kuang-jia-jian-li">æ¡†æ¶å»ºç«‹</h1>
<p>å‰ä¸€èŠ‚,æˆ‘ä»¬å¤§æ¦‚æ¸…æ¥šäº†macroçš„ç»“æ„, ç°åœ¨è®©æˆ‘ä»¬å†æ¥ç®€å•å¤ä¹ ä¸€é:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>macro_rules!(è¿™æ˜¯ç‰¹ç‚¹è¯­æ³•)</code>æ¥åˆ›å»ºä¸€ä¸ªmacro</p>
</li>
<li class="lvl-2">
<p><code>rule(s)(åŒ¹é…åˆ†æ”¯,ä»¥ &quot;å‚æ•°=&gt;å±•å¼€ä»£ç &quot; çš„å½¢å¼)</code>æ”¾åœ¨æœ€å¤–å±‚çš„èŠ±æ‹¬å·å†…</p>
</li>
<li class="lvl-2">
<p>è°ƒç”¨å®æ—¶,å®å+æ„Ÿå¹å·+æ‹¬å·å†…ä¼ å‚,æ¯”å¦‚: <code>println!(some_str)</code></p>
</li>
</ul>
<p>ç°åœ¨ç¨å¾®æ·±å…¥ä¸€ç‚¹:<br>
ä¸€ä¸ª <code>rule</code> å¯ä»¥è¢«è¿™æ ·æŠ½è±¡åœ°è¡¨ç¤º: (matcher)=&gt;(transcriber), å®ƒç”±ä¸‰ä¸ªé‡è¦çš„éƒ¨åˆ†ç»„æˆ:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>matcher (åŒ¹é…å™¨)</code>: ç”¨æ¥åŒ¹é…ä¼ å…¥çš„å‚æ•°</p>
</li>
<li class="lvl-2">
<p><code>metavariable/literal (å…ƒå˜é‡/å­—é¢é‡)</code>: ç»‘å®šä¼ å…¥çš„ä»£ç ç‰‡æ®µ,å‡ºç°äº <code>matcher</code></p>
</li>
<li class="lvl-2">
<p><code>transcriber (è½¬å½•å™¨)</code>: ç”¨æ¥åœ¨å®åŒ¹é…æˆåŠŸå,è¿›è¡Œä»£ç æ›¿æ¢</p>
</li>
</ul>
<p>ä»¥<code>println!</code>ä¸ºä¾‹å­,æˆ‘ä»¬å‘å…¶ä¼ å…¥äº†ä¸€äº›å‚æ•°,å®ƒç»™æˆ‘ä»¬æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸Š<br>
å› ä¸ºåŸæœ¬çš„<code>println!</code>æ¶‰åŠåˆ°<code>å«ç”Ÿæ€§</code>,<code>é‡å¤è¯­æ³•</code>,<code>è·¯å¾„ä½œç”¨åŸŸ</code>ç­‰,ä¸é€‚åˆæ–°é¸Ÿé˜…è¯»,æ‰€ä»¥æˆ‘æŠ½è±¡äº†å®ƒ:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> println &#123;</span><br><span class="line">    (<span class="comment">/* ç©ºå‚åŒ¹é… */</span>) =&gt; (<span class="comment">/* `æ¢è¡Œ` çš„ä»£ç  */</span>);</span><br><span class="line">    (<span class="comment">/* æœ‰å‚åŒ¹é… */</span>) =&gt; (<span class="comment">/* `æ‰“å°å‚æ•° + æ¢è¡Œ` çš„ä»£ç  */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>println</code>ç”±ä¸¤ä¸ª<code>rule</code>ç»„æˆ,æ¯ä¸ªçš„å½¢å¼éƒ½æ˜¯: <code>matcher=&gt;transcriber</code>, ä»ä¸Šå¾€ä¸‹,æ¯ä¸ªruleçš„<code>matcher</code>ä¼šä¸ä¼ å…¥å‚æ•°å°è¯•åŒ¹é…, åŒ¹é…æ—¶æ‹¬å·å…·æœ‰å¤šæ ·æ€§<br>
ä¸‹é¢æ˜¯å…·ä½“é˜è¿°:</p>
<p>åŒ¹é…è§„åˆ™:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åŒ¹é…åˆ°: å°±æ›¿æ¢ä¸º<code>transcriber</code>é‡Œé¢çš„ä»£ç </p>
</li>
<li class="lvl-2">
<p>åŒ¹é…ä¸åˆ°: æ‰€æœ‰<code>matcher</code>éƒ½æ— æ³•ä¸<code>ä¼ å…¥å‚æ•°</code>è¿›è¡ŒåŒ¹é…,åˆ™ç¼–è¯‘æŠ¥é”™</p>
</li>
</ul>
<p>æ‹¬å·å¤šæ ·æ€§:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ¦‚å¿µ: <code>matcher</code>ä¸<code>transcriber</code>çš„æ‹¬å·,å¯ä»¥æ˜¯(),[],{}ä¸‰ç§ä¹‹ä¸€</p>
</li>
<li class="lvl-2">
<p>å®šä¹‰æ—¶: æ¯”å¦‚, ruleå¯å†™æˆ <code>[pattern]=&gt;&#123;expansion&#125;</code></p>
</li>
<li class="lvl-2">
<p>è°ƒç”¨æ—¶: ä¸€æ ·éµä»è¯¥è§„åˆ™, æ¯”å¦‚ <code>vec![0, 1,2,3]</code> ä¸ <code>pritnln!(&quot;xx&quot;)</code></p>
</li>
</ul>
<p>è€Œ<code>metavariable/literal</code>åˆ™å‡ºç°åœ¨<code>matcher</code>ä¸­,ç”¨äºåŒ¹é…å¹¶æ•è·ä»£ç ç‰‡æ®µ<br>
åœ¨å¯¹åº”çš„<code>transcriber</code>ä¸­,åˆ™å¯ä»¥æ“æ§è¿™äº›<code>å…ƒå€¼</code>,å³æ“æ§æ•è·åˆ°çš„ä»£ç ç‰‡æ®µ</p>
<p>ç¨å¾®æœ‰ç‚¹è’™? æˆ‘ä¹Ÿæ²¡è®©ä½ èƒŒå“Ÿ, å¤šçœ‹å¤šç”¨å°±ä¼šäº†</p>
<hr>
<h1 id="liang-chong-hong-can-shu">ä¸¤ç§å®å‚æ•°</h1>
<p>æ˜¯æ—¶å€™å¼•å…¥ä¸€äº›æ–°çš„ä¸œè¥¿äº†, é¡ºä¾¿åŠ æ·±ä¸‹ä½ çš„å°è±¡</p>
<h2 id="yuan-bian-liang" id="å…ƒå˜é‡">å…ƒå˜é‡</h2>
<p>å…ƒå˜é‡, å³Metavariable, è®©æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> my_macro &#123;</span><br><span class="line">    ($a: expr) =&gt; &#123;</span><br><span class="line">        $a</span><br><span class="line">    &#125;;</span><br><span class="line">    ($a: expr, $b: expr) =&gt; &#123;</span><br><span class="line">        $a + $b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    my_macro!(<span class="number">1</span>);</span><br><span class="line">    my_macro!(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å®å…¨éƒ¨å±•å¼€å, å¯ä»¥ç†è§£ä¸ºä¸‹é¢: </span></span><br><span class="line"><span class="comment">fn main() &#123;</span></span><br><span class="line"><span class="comment">    1;</span></span><br><span class="line"><span class="comment">    1 + 2;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šæ³¨æ„åˆ°,æ¯ä¸ªruleä¹‹é—´çš„å‚æ•°, å…¶å£°æ˜éƒ½æœ‰ç‚¹å¥‡æ€ª:<br>
æ¯”å¦‚: <code>$a:expr</code> -&gt; <code>$+å‚æ•°æ ‡è¯†ç¬¦+ç±»å‹</code></p>
<p><code>$</code> è¿™ä¸ªå‰ç¼€æ˜¯å¹²å˜›çš„?<br>
è¿™æ˜¾å¼è¯´æ˜, å®ƒæ˜¯ <code>metavariable</code>, å¯ä»¥åŒ¹é…å¹¶æ•è·ä»£ç ç‰‡æ®µ, è¿™é‡Œä¼šæ•è·è¡¨è¾¾å¼<br>
è‡³äºä¸ºä½•è¦ç‰¹æ„åŠ $å‰ç¼€æ¥è¯´æ˜, åƒå‡½æ•°å‚æ•°é‚£æ ·ç›´æ¥ç”¨ä¸è¡Œå—? ä¸‹é¢å°±è¦è®²åˆ°å•¦, åˆ«ç€æ€¥~</p>
<p>å…ˆçœ‹çœ‹ <code>expr</code> ç±»å‹, å…¶å…¨ç§°ä¸º <code>expression(è¡¨è¾¾å¼)</code><br>
ç¬¬ä¸€æ¬¡å®è°ƒç”¨æ—¶, ä¼ å…¥äº† <code>1(ä¸€ä¸ªå­—é¢é‡)</code>, è¿™å½“ç„¶æ˜¯ä¸ªexpr, ä¸ç¬¬ä¸€ä¸ªruleæˆåŠŸåŒ¹é…<br>
è¿™æ—¶, <code>my_macro!(1)</code> è¿™ä¸ªéƒ¨åˆ†, å°±ä¼šè¢«æ›¿æ¢ä¸ºç›¸åº”çš„å±•å¼€ä»£ç `<br>
(matcher(åŒ¹é…å™¨),metavariable(å…ƒå˜é‡),transcriber(è½¬å½•å™¨)éƒ½ç”¨åˆ°äº†å‘¢)<br>
ç®€å•æ¥è®², macroçš„æœ¬è´¨, å°±æ˜¯åŒ¹é…æ•è·ä¼ å…¥å‚æ•°, å°†è°ƒç”¨éƒ¨åˆ†æ›¿æ¢/å±•å¼€ä¸ºç›¸åº”ä»£ç <br>
macroå°±åƒä¸ªcode generator: ä¸€æ®µç”¨æ¥ç”Ÿæˆcodeçš„code<br>
æ³¨æ„:<br>
macroå®é™…ä¸Š, æ˜¯å°†ä¼ å…¥éƒ¨åˆ†è§£æä¸ºä¸€ä¸ªASTèŠ‚ç‚¹, ç„¶åå°†è°ƒç”¨éƒ¨åˆ†, æ›¿æ¢ä¸ºä¸€ä¸ªæ–°çš„ASTèŠ‚ç‚¹<br>
åœ¨æœ¬èŠ‚ä¸‹é¢ä¼šæ›´è¯¦ç»†åœ°è®²è®²</p>
<h2 id="yuan-zi-mian-liang" id="å…ƒå­—é¢é‡">å…ƒå­—é¢é‡</h2>
<p>å…ƒå­—é¢é‡, å³Metaliteral<br>
ä¸ºäº†åŠ æ·±å°è±¡ä¸å¼•å‡º <code>metaliteral</code> , æˆ‘ä»¬æ¥ç©ä¸ªå¯¹åº”æ¸¸æˆ:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">($a: expr) =&gt; &#123;$a&#125;;                     <span class="comment">// the first rule</span></span><br><span class="line">  |             |  </span><br><span class="line">  |         	|</span><br><span class="line">( <span class="number">1</span>      )      <span class="number">1</span>                       <span class="comment">// pass &amp;&amp; expand </span></span><br><span class="line">($a: expr, $b: expr) =&gt; &#123; $a + $b&#125;;    <span class="comment">// the second rule</span></span><br><span class="line">  |      |  |              |    |</span><br><span class="line">  |      |  |              |    |</span><br><span class="line">( <span class="number">1</span>      ,  <span class="number">2</span>      ) =&gt;    <span class="number">1</span> +  <span class="number">2</span>      <span class="comment">// pass &amp;&amp; expand</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä½¿ç”¨ <code>|</code> æ¥è”ç³» <code>å½¢å‚ -- å®å‚</code><br>
ä½ ä¼šæƒŠè®¶çš„å‘ç°, ä¼ å‚æ—¶çš„å¯¹åº”å…³ç³»ä»¬, é™¤äº† <code>$a -- 1</code> ä¸ <code>$b -- 2</code>, è¿˜æœ‰ä¸ª <code>, -- ,</code></p>
<p>å¯¹äºç¬¬äºŒä¸ªrule, å®ƒçš„å®šä¹‰ä¸­, åˆ†å‰²ä¸¤ä¸ªexprçš„é€—å·æœ¬èº«, ä¹Ÿæ˜¯å½¢å‚<br>
è¿™ç§å›ºå®šçš„å‚æ•°, å¦‚åŒtokenä¸­çš„å­—é¢é‡ä¸€æ ·<br>
æˆ‘å§‘ä¸”ç§°å®ƒä¸º <code>Literal Token(å­—é¢é‡æ ‡è®°)</code>, æˆ–è€… <code>Metaliteral (å…ƒå­—é¢é‡)</code><br>
(å› ä¸ºæˆ‘ä¹Ÿä¸çŸ¥é“æœ‰ä»€ä¹ˆå¯¹åº”æœ¯è¯­, æ‰€ä»¥ç”¨äº† â€œå§‘ä¸”â€, çŸ¥é“çš„éº»çƒ¦å‘Šè¯‰æˆ‘)</p>
<p>å‡è‹¥ rule ä¸­çš„å‚æ•°æ²¡æœ‰ $å‰ç¼€ è¿›è¡ŒåŒºåˆ†:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> fuck &#123;</span><br><span class="line">    (a:expr) =&gt; &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    fuck!(<span class="number">1</span>);       <span class="comment">// No</span></span><br><span class="line">    fuck!(a:expr);  <span class="comment">// Yes ~~(Oh~)~~</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå®šä¹‰ä¸­çš„ â€œa:exprâ€(å®ƒæ˜¯ <code>MetaLiteral</code>), ä¼ å…¥å›ºå®šå½¢å¼çš„ â€œa:exprâ€ æ—¶æ‰å¯å‘ç”ŸåŒ¹é…<br>
å› æ­¤, åˆ‡è®°ä½å½“ä½ æƒ³ç»‘å®šä¸€æ®µä»£ç ç‰‡æ®µ, åœ¨å‚æ•°åå‰, å¿…é¡»åŠ ä¸Š$è¿›è¡Œä¿®é¥°</p>
<h2 id="li-zi" id="ä¾‹å­">ä¾‹å­</h2>
<p>å‡è®¾æœ‰è¿™ä¹ˆä¸ªå® <code>map!</code>(è”æƒ³ä¸€ä¸‹<code>vec!</code>)<br>
å®ƒèƒ½æ ¹æ® <code>=&gt;</code> åˆ¤æ–­å‡º <code>Key/Value</code>, ç„¶åç”Ÿæˆä¸€ä¸ª <code>HashMap</code><br>
å¦‚ä¸‹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> m = map![</span><br><span class="line">        <span class="string">&quot;å‰è‰¯å‰å½±&quot;</span> =&gt; <span class="number">33</span>,</span><br><span class="line">        <span class="string">&quot;ç©ºæ¡æ‰¿å¤ªéƒ&quot;</span> =&gt; <span class="number">41</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">// `m` çš„ç±»å‹ä¸º: std::collections::HashMap&lt;&amp;str, i32&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªè¿™æ ·çš„å®å§!<br>
ä¸è¿‡æˆ‘ä»¬è¿˜æœªå­¦ä¹  <code>é‡å¤è¯­æ³•</code>, æ— æ³•å†™å‡ºæ¥æ”¶å¯å˜å‚æ•°çš„ <code>map!</code>, æ‰€ä»¥ç°åœ¨åªè®¨è®ºç®€é™‹ç‰ˆ:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> map &#123;</span><br><span class="line">    ($key:expr =&gt; $val:expr) =&gt; &#123;&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> m = std::collections::HashMap::&lt;_,_&gt;::new();</span><br><span class="line">        m.insert($key, $val);</span><br><span class="line">        m</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> m = map!(<span class="string">&quot;æ™®é€šä¸Šç­æ—&quot;</span> =&gt; <span class="number">33</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å±•å¼€å, å¯ä»¥çœ‹ä½œæ˜¯:</span></span><br><span class="line"><span class="comment">fn main() &#123;</span></span><br><span class="line"><span class="comment">    let m = &#123;</span></span><br><span class="line"><span class="comment">        let mut m = std::collections::HashMap::&lt;_,_&gt;::new();</span></span><br><span class="line"><span class="comment">        m.insert(&quot;æ™®é€šä¸Šç­æ—&quot;, 33);</span></span><br><span class="line"><span class="comment">        m</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    println!(&quot;&#123;:?&#125;&quot;,m);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯ä¸€ä¸ªç®€é™‹çš„DSL, ä½ å®šä¹‰äº†åˆ›å»ºHashMapçš„æ–°è¯­æ³•: <code>Key=&gt;Value</code><br>
æ¥çœ‹çœ‹ä¸¤ç§å®å‚æ•°åœ¨å®ä¸­, å‘æŒ¥ç€æ€æ ·çš„ä½œç”¨:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>Metavariable</code>:<br>
å°†æ•è·çš„ä¼ å…¥çš„ä»£ç ç‰‡æ®µç»‘å®šåˆ°è‡ªèº«, å¹¶åœ¨ <code>Transcriber</code> ä¸­è¢«ä½¿ç”¨, æœ€åå±•å¼€ä¸ºæ–°ä»£ç </p>
</li>
<li class="lvl-2">
<p><code>Metaliteral </code>:<br>
é™å®šäº†åŒ¹é…, ä¼ å…¥çš„ä»£ç ç‰‡æ®µ, å¿…é¡»ä»¥ =&gt; åˆ†å‰², æ‰èƒ½æˆåŠŸåŒ¹é…è‹¥æ”¹æˆ <code>map!(&quot;æ™®é€šä¸Šç­æ—&quot;, 33)</code>, åˆ™æ¯ä¸ªruleçš„ <code>Matcher</code> éƒ½æ— æ³•åŒ¹é…ä¸Š<br>
(è¿™é‡Œåªæœ‰ä¸€ä¸ªrule, ç©ºåŒ¹é…çš„æ‡’å¾—æ”¾é‡Œé¢äº†)</p>
</li>
</ul>
<p>å…¶å®è¯´äº†è¿™ä¹ˆå¤š, ç®€å•è®²å°±æ˜¯ä¸€ä¸ªå¯¹åº”æ¸¸æˆ, å¯¹åº”ä¸Šçš„è¯, å°±ä¼šæ›¿æ¢ä¸ºä¸€äº›ä»£ç <br>
è€ƒè™‘çš„äº‹: åŒ¹é…çš„è¯­æ³•ç¾ä¸ç¾è§‚, ç®€ä¸ç®€å•, ç„¶åå°†å¤æ‚çš„ä»£ç éšè—, å°±è¿™æ ·è€Œå·²<br>
ä¹‹åä¼šè€ƒè™‘è®²å‡ ä¸ªå°ä¾‹å­: æ¯”å¦‚æˆ‘åœ¨Bç«™ä¸Šå·²ç»å½•è¿‡çš„é€’æ¨åºåˆ—ç”Ÿæˆå™¨æ•™ç¨‹, æºè‡ªå®å°å†Œ<br>
(åšå®¢çš„è¯, æˆ‘å‘¨å…­æ”¾å­¦å›æ¥æ…¢æ…¢æ›´å§â€¦)<br>
<s>(æ½œå°è¯æ˜¯éšæ—¶ä¼šé¸½å­)</s></p>
<hr>
<h1 id="ben-zhi">æœ¬è´¨</h1>
<p>macroçš„æœ¬è´¨, æ˜¯ç”Ÿæˆä¸€ä¸ªASTèŠ‚ç‚¹, å¯ä»¥é…å¥—çœ‹çœ‹æˆ‘åœ¨Bç«™ä¸Šå®è§†é¢‘, è§†é¢‘è®²å¾—å¾ˆæµ…, å®¹æ˜“ç†è§£</p>
<p>å‡è‹¥ç”±ä½ æ¥è®¾è®¡ä¸€ä¸ªRustç¼–è¯‘å™¨:</p>
<p>é¦–å…ˆ, ä¸åŒçš„äººå†™ä»£ç çš„é£æ ¼ä¸åŒ, é‚£ä¹ˆä½ å¦‚ä½•åˆ†æä¸åŒæºç , å¹¶ç”Ÿæˆç›®æ ‡ç ?<br>
è‹¥æˆ‘ä»¬å°†æ¯éæ‰«æå¹¶åšç‚¹äº‹æƒ…çš„è¿‡ç¨‹, ç§°ä¸º<code>pass</code>, passä¸€æ¬¡å°±ç”Ÿæˆäº†, å¯¹äºå¾ˆå¤§çš„æºç æ¥è¯´, è¿™ä¸ç°å®å§<br>
é‚£æˆ‘ä»¬å°±passå¤šæ¬¡, å°† <code>ä»æºç ç¼–è¯‘ä¸ºç›®æ ‡ç </code> è¿™ä¸ªå¤§é—®é¢˜, åˆ†è§£ä¸ºä¸€å¤§å †å°é—®é¢˜, æ¯ä¸€æ¬¡passéƒ½è§£å†³ä¸€ä¸ªå°é—®é¢˜, é‚£ä¸å°±Okäº†å—</p>
<p>è¿™ç§ <code>ä¸­é—´è¡¨ç¤º</code>, å°±ç§°ä¸º <code>IR (Intermediate Representation )</code></p>
<p>æˆ‘ä»¬å¯ä»¥å…ˆæŠŠæºç æŠ½è±¡ä¸ºAST(æŠ½è±¡è¯­æ³•æ ‘, Abstract Syntax Tree), é‚£æ˜¯ä¸€ç§ä»£ç è¢«æŠ½è±¡åçš„æ ‘çŠ¶ç»“æ„, æ¯”å¦‚æˆ‘ä»¬ç”¨Rustçš„enumè¡¨ç¤ºä¸€ä¸‹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯¥æšä¸¾: ä¸€ä¸ªASTèŠ‚ç‚¹å¯ä»¥æ˜¯Intè¡¨è¾¾å¼æˆ–äºŒå…ƒè¿ç®—è¡¨è¾¾å¼  </span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ASTNode</span></span> &#123;</span><br><span class="line">    Int(<span class="built_in">i32</span>), </span><br><span class="line">    BinaryExpr &#123;</span><br><span class="line">        op: Op,</span><br><span class="line">        lhs: <span class="built_in">Box</span>&lt;ASTNode&gt;,</span><br><span class="line">        rhs: <span class="built_in">Box</span>&lt;ASTNode&gt;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// äºŒå…ƒè¿ç®—çš„ç¬¦å·: è¿™é‡ŒåªæŠ½è±¡äº†åŠ æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Op</span></span> &#123;</span><br><span class="line">    Plus, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ åªéœ€æ˜ç™½ASTæ˜¯å¯¹æºç å°è£…çš„ä¸€å±‚æŠ½è±¡äº§ç‰©å°±å¯ä»¥äº†</p>
<p>å¯¹äºå¾ˆå°‘çš„æºç , å·²ç»å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºç›®æ ‡ç äº†, æ¯•ç«Ÿè¿™æ—¶å€™ASTä¹Ÿå°, ä½†æ˜¯, å¦‚æœæºç å¾ˆå¤§å‘¢? ASTå·²ç»å¾ˆå¤æ‚äº†<br>
é‚£å°±å†æŠ½è±¡ä¸€å±‚å§, å‘ç›®æ ‡è¯­è¨€é€æ¸é æ‹¢, æ¯”å¦‚å‘æ±‡ç¼–é æ‹¢, æé«˜æ€§èƒ½</p>
<p>åŸºäºAST, æˆ‘ä»¬å¯ä»¥å†æ¥ä¸€äº›<code>IR</code>, å±‚å±‚é€’è¿›, ä»¥è¾¾ç›®çš„, æ³¨æ„, æ˜¯ä¸€äº›,è€Œéä¸€ä¸ª, å› ä¸ºä¸€æ¬¡å¯èƒ½è¿˜æ˜¯ä¸å¤Ÿå˜›<br>
<code>AST</code>å¾ˆé‡è¦, æ˜¯ç”Ÿæˆç›®æ ‡ç çš„å…³é”®, æ˜¯ä»£ç çš„éª¨æ¶, è€Œå¦å¤–çš„IR, ä¹Ÿæ˜¯æœ‰å¿…è¦çš„, è¿™ä¹Ÿå¢å¼ºäº†å¯ç»´æŠ¤æ€§, ç¼–è¯‘å™¨åœ¨ASTçš„åŸºç¡€ä¸Š, æœ€ç»ˆç”Ÿæˆäº†ç›®æ ‡ç </p>
<p>Q: ç”ŸæˆASTéœ€è¦ç‚¹å•¥? æˆ–è€…è¯´, å®ƒç”±ä»€ä¹ˆç»„æˆ?<br>
A: ç”± expr(è¡¨è¾¾å¼), stmt(è¯­å¥), ;(æ ‡ç‚¹ç¬¦å·) ç­‰ç»„æˆ, è¿™äº›éƒ½å«åš <code>token</code></p>
<p>åœ¨è¿™äº›å°ç©æ„çš„åŸºç¡€ä¸Š, ç»„æˆä¸€ä¸ªæ›´åŠ åºå¤§å¤æ‚çš„æ•´ä½“ç»“æ„, å®ƒå°†tokenä»¬è”ç³»èµ·æ¥, è¡¨è¾¾äº†ä»£ç çš„éª¨æ¶<br>
è¿™ä¸ªåºç„¶å¤§ç‰©ä¾¿æ˜¯ AST äº†</p>
<hr>
<h1 id="hui-dao-macro">å›åˆ°Macro</h1>
<h2 id="token-lei-xing-biao" id="Tokenç±»å‹è¡¨">Tokenç±»å‹è¡¨</h2>
<p>ç”ŸæˆASTéœ€è¦TokenååŠ©, macro ä¸­, å…¶å‚æ•°çš„ç±»å‹, ä¾¿æ˜¯tokenç±»å‹</p>
<p>macroè¦æ“æ§ä¼ å…¥çš„token (æˆ–ASTèŠ‚ç‚¹, ç­‰ä¼šè®²), æˆ‘ä»¬æ€»å¾—çŸ¥é“tokenç±»å‹å§, ä¸ç„¶æ€çŸ¥å¦‚ä½•æ“æ§?<br>
åªæœ‰è§„å®šå®å‚æ•°çš„ç±»å‹, æ‰èƒ½ä¿è¯macroè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®çš„ (è¿™é‡ŒæŒ‡ <code>Metavariable</code>)</p>
<p>æ‰€ä»¥, è¾›è‹¦ä½ å°†ä¸‹é¢çš„è®°ä¸€ä¸‹, ç¨å¾®è®°ä¸‹, æœ‰å°è±¡å³å¯, å¤šç”¨å‡ ä¸‹ä¿è¯ä½ ç†Ÿæ‚‰å¾—ä¸è¡Œ:</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å¯¹åº”</th>
</tr>
</thead>
<tbody>
<tr>
<td>ident</td>
<td>æ ‡è¯†ç¬¦, å¦‚å‡½æ•°å, å˜é‡å, å…³é”®å­—</td>
</tr>
<tr>
<td>expr</td>
<td>expression, è¡¨è¾¾å¼,å¦‚<code>x</code>ä¸<code>1_i32</code></td>
</tr>
<tr>
<td>literal</td>
<td>literal expression, å³å­—é¢é‡è¡¨è¾¾å¼, æ˜¯exprçš„å­é›†</td>
</tr>
<tr>
<td>pat</td>
<td>pattern, æ¯”å¦‚åœ¨matchè¡¨è¾¾å¼ä¸‹çš„ (pattern) =&gt; todo!()</td>
</tr>
<tr>
<td>path</td>
<td>è·¯å¾„, æ³¨æ„è¿™é‡Œä¸æŒ‡æ–‡ä»¶è·¯å¾„, è€Œæ˜¯ç±»ä¼¼ std::io::stdin çš„</td>
</tr>
<tr>
<td>ty</td>
<td>type, å¦‚ i32, u32, String, Option<T>ç­‰</td>
</tr>
<tr>
<td>tt</td>
<td>token tree, ä¹‹åæˆ‘ä¼šå•ç‹¬å†è®²è§£ä¸‹å®ƒçš„</td>
</tr>
<tr>
<td>meta</td>
<td>å…ƒæ¡ç›®/é¡¹, æ¯”å¦‚ <code>#[allow(unsued)]</code>, <code>meta</code> å°±å¯¹åº” <code>allow(unuse)</code></td>
</tr>
<tr>
<td>vis</td>
<td>visibility, å¯è§æ€§, æ¯”å¦‚pub, pub(crate)ç­‰, ä¹Ÿå¯èƒ½ä¸ºç©º</td>
</tr>
<tr>
<td>lifetime</td>
<td>ç”Ÿå‘½å‘¨æœŸ</td>
</tr>
<tr>
<td>item</td>
<td>æ¡ç›®/é¡¹, ä¾‹å¦‚å‡½æ•°å®šä¹‰</td>
</tr>
<tr>
<td>block</td>
<td>ä»£ç å—</td>
</tr>
<tr>
<td>stmt</td>
<td>statemen, è¯­å¥</td>
</tr>
</tbody>
</table>
<h2 id="tt" id="TT">TT</h2>
<p>è¿™é‡Œæœ‰ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ <code>tt (Token Tree)</code><br>
ä»å­—é¢ä¸Šçš„æ„æ€æ¥è®², å°±æ˜¯ç”±Tokenç»„æˆçš„æ ‘(æ•°æ®ç»“æ„ä¸Šçš„æ ‘)å‘—~~(åºŸè¯)~~</p>
<p><code>tt</code>,å¯ä»¥æ•è·<code>Single Token</code>,æˆ–ç”±(),[],{}åŠæ‹¬å·åŒ…è£¹èµ·æ¥çš„ä¸œè¥¿<br>
ä½œä¸º Token Tree çš„æ ¹èŠ‚ç‚¹, å…ˆè®©æˆ‘ä»¬æ¥ç‚¹ä¾‹å­:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> aa &#123;</span><br><span class="line">    ($a:tt) =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="built_in">stringify!</span>($a));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// Single Token</span></span><br><span class="line">    aa!(<span class="number">123</span>);          <span class="comment">// Yes: 123</span></span><br><span class="line">    aa!(FuckYou);      <span class="comment">// Yes: FuckYou</span></span><br><span class="line">    <span class="comment">// aa!(Fuck You);     // No</span></span><br><span class="line">    <span class="comment">// aa!(123 + 11);     // No</span></span><br><span class="line">    <span class="comment">// (), [], &#123;&#125;</span></span><br><span class="line">    aa!([<span class="number">123</span>]);        <span class="comment">// Yes: [123]</span></span><br><span class="line">    aa!(&#123;<span class="number">123</span> + <span class="number">123</span>&#125;);  <span class="comment">// Yes: &#123; 123 + 123 &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç , å±•ç¤ºäº† <code>tt</code> å¯ä»¥åŒ¹é…æ•è·å“ªäº›ä¸œè¥¿<br>
è¯·çœ‹ä»¥ä¸‹å†…å®¹, ä»¥ç†è§£å®ƒ, æˆ‘ä»¬ä»¥<code>&lt;&lt;xxx&gt;&gt;</code>, æ¥è¡¨ç¤º <code>xxx</code> æ˜¯ä¸€é¢— <code>Token Tree</code></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½ çš„çœ¼ä¸­:</span></span><br><span class="line"><span class="number">1</span> + <span class="number">2</span> + (<span class="number">3</span> + <span class="number">4</span>)</span><br><span class="line"><span class="comment">// ttçš„çœ¼ä¸­:</span></span><br><span class="line">&lt;&lt;<span class="number">1</span>&gt;&gt; &lt;&lt;+&gt;&gt; &lt;&lt;<span class="number">2</span>&gt;&gt; &lt;&lt;+&gt;&gt; &lt;&lt;( )&gt;&gt;</span><br><span class="line">                           |</span><br><span class="line">                           |</span><br><span class="line">                   &lt;&lt;<span class="number">3</span>&gt;&gt; &lt;&lt;+&gt;&gt; &lt;&lt;<span class="number">4</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç çš„Token Treeå…±æœ‰5ä¸ª:</p>
<ol>
<li class="lvl-3">
<p>&lt;&lt;1&gt;&gt;</p>
</li>
<li class="lvl-3">
<p>&lt;&lt;+&gt;&gt;</p>
</li>
<li class="lvl-3">
<p>&lt;&lt;2&gt;&gt;</p>
</li>
<li class="lvl-3">
<p>&lt;&lt;+&gt;&gt;</p>
</li>
<li class="lvl-3">
<p>&lt;&lt;(3 + 4)&gt;&gt;</p>
</li>
</ol>
<p>å¯¹äºå‰é¢4ä¸ª, éƒ½æ˜¯Single Token, ä¹Ÿå°±æ˜¯åªæœ‰æ ¹èŠ‚ç‚¹è‡ªå·±çš„Tree<br>
å¯¹äºç¬¬5ä¸ª, å› ä¸ºæœ‰()åŒ…è£¹, &lt;&lt;(â€¦)&gt;&gt; ä½œä¸ºæ ¹èŠ‚ç‚¹, å®ƒè¿˜æœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹(è¿™é‡Œæ­£å¥½åŒå±‚)</p>
<p>æœ‰æ²¡æœ‰å¯¹ <code>Tokenåé¢è·Ÿç€Tree</code> æ›´åŠ ç†è§£?</p>
<h2 id="ast-jie-dian" id="ASTèŠ‚ç‚¹">ASTèŠ‚ç‚¹</h2>
<p>macro ä¼šå°†ä¼ å…¥çš„token, è§£æä¸ºå¯¹åº”ç±»å‹çš„ASTèŠ‚ç‚¹(é™¤äº†å°‘é‡tokenç±»å‹, ç­‰ä¸‹ä¼šè®²)<br>
æ¯”å¦‚ <code>map!</code> ä¸­, <code>$key:value</code> ä¸ <code>$val:expr</code>, éƒ½ä¼šè¢«è§£æä¸ºexprç±»å‹çš„ASTèŠ‚ç‚¹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> map &#123;</span><br><span class="line">    ($key:expr =&gt; $val:expr) =&gt; &#123;&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> m = std::collections::HashMap::&lt;_,_&gt;::new();</span><br><span class="line">        m.insert($key, $val);</span><br><span class="line">        m</span><br><span class="line">    &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> m = map!(<span class="string">&quot;æ™®é€šä¸Šç­æ—&quot;</span> =&gt; <span class="number">33</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å±•å¼€å, å¯ä»¥çœ‹ä½œæ˜¯:</span></span><br><span class="line"><span class="comment">fn main() &#123;</span></span><br><span class="line"><span class="comment">    let m = &#123;</span></span><br><span class="line"><span class="comment">        let mut m = std::collections::HashMap::&lt;_,_&gt;::new();</span></span><br><span class="line"><span class="comment">        m.insert(&quot;æ™®é€šä¸Šç­æ—&quot;, 33);</span></span><br><span class="line"><span class="comment">        m</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    println!(&quot;&#123;:?&#125;&quot;,m);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ macro , ç«™åœ¨äº†æ›´æŠ½è±¡çš„è§†è§’ä¸Š<br>
æ“æ§ä¼ å…¥çš„token(æˆ–è§£ætokenåå½¢æˆçš„ASTèŠ‚ç‚¹), ç»„æˆæ–°ASTèŠ‚ç‚¹(ç”Ÿæˆæ–°ä»£ç )<br>
è¿™å¯ä»¥å¤§é‡ç®€åŒ–æ‰‹å†™é‡, å¦‚stdä¸­å‘å®ä¼ å…¥ç‰¹å®šç±»å‹, è‡ªåŠ¨ç”Ÿæˆä¸ºå®ƒä»¬å®ç°traitçš„ä»£ç </p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯, å®å°†ä¼ å…¥å‚æ•°ç»™ASTèŠ‚ç‚¹åŒ–æ—¶, æœ‰æ—¶æ„å‘³ç€ä¼šäº§ç”Ÿä¸æœŸæœ›çš„ç»“æœ, æˆ‘ç›´æ¥ç”¨ <a href="https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/mbe-min-captures-and-expansion-redux.md">å®å°å†Œ</a> ä¸Šé¢çš„ä»£ç äº†:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> capture_then_match_tokens &#123;</span><br><span class="line">    ($e:expr) =&gt; &#123;match_tokens!($e)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">macro_rules!</span> match_tokens &#123;</span><br><span class="line">    ($a:tt + $b:tt) =&gt; &#123;<span class="string">&quot;got an addition&quot;</span>&#125;;</span><br><span class="line">    (($i:ident)) =&gt; &#123;<span class="string">&quot;got an identifier&quot;</span>&#125;;</span><br><span class="line">    ($($other:tt)*) =&gt; &#123;<span class="string">&quot;got something else&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;\n&#123;&#125;\n&#123;&#125;\n&quot;</span>,</span><br><span class="line">        match_tokens!((caravan)),</span><br><span class="line">        match_tokens!(<span class="number">3</span> + <span class="number">6</span>),</span><br><span class="line">        match_tokens!(<span class="number">5</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;\n&#123;&#125;\n&#123;&#125;&quot;</span>,</span><br><span class="line">        capture_then_match_tokens!((caravan)),</span><br><span class="line">        capture_then_match_tokens!(<span class="number">3</span> + <span class="number">6</span>),</span><br><span class="line">        capture_then_match_tokens!(<span class="number">5</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœä¼šæ˜¯:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">got an identifier</span><br><span class="line">got an addition</span><br><span class="line">got something <span class="keyword">else</span></span><br><span class="line">got something <span class="keyword">else</span></span><br><span class="line">got something <span class="keyword">else</span></span><br><span class="line">got something <span class="keyword">else</span></span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚è¿™é‡Œ, <code>match_tokens</code> æ•è·token, ç„¶åå°†å‚æ•°è§£æä¸ºä¸€ä¸ªexprç±»å‹çš„ASTèŠ‚ç‚¹, å®ƒä¸å†æ˜¯token, è€Œæ˜¯ä¸ªASTèŠ‚ç‚¹äº†!</p>
<p>æ¯”å¦‚ <code>5 + 7</code>, åŸæœ¬æ˜¯å¯ä»¥ä¸ <code>$a:tt + $b:tt</code> ç›¸åŒ¹é…, ä¹Ÿå¯ä»¥ä¸ <code>$a: expr</code> åŒ¹é…<br>
ä½†ç»äºŒæ¬¡ä¼ å…¥å(å‘ <code>capture_then_match_tokens</code>ä¼ å…¥çš„å‚æ•°åˆä¼ ç»™ <code>match_tokens</code>)<br>
<code>5 + 7</code> å˜æˆASTè¡¨è¾¾å¼èŠ‚ç‚¹, åªèƒ½ä¸ <code>$a: expr</code>, è€Œä¸èƒ½ä¸ <code>$a:tt + $b:tt</code> åŒ¹é…</p>
<p>åªæœ‰ <code>tt</code>, <code>ident</code>, <code>lifetime</code> èƒ½å…é­ ASTèŠ‚ç‚¹åŒ–, å¯ä»¥å¥½å¥½ç†è§£ä¸‹è¿™å—</p>
<p>æ€»ç»“:<br>
å®å°†ä¸€äº›æ•è·çš„tokenç»™ASTèŠ‚ç‚¹åŒ–, éšååˆå±•å¼€ä¸ºä¸€ä¸ªæ–°ASTèŠ‚ç‚¹<br>
è¿™ä¸ªæ–°çš„ASTèŠ‚ç‚¹, ä¼šç”¨æ¥æ›¿æ¢å®è°ƒç”¨éƒ¨åˆ†çš„ASTèŠ‚ç‚¹, å› æ­¤ä½ å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹è°ƒç”¨å® (åªè¦å®å±•å¼€çš„ASTèŠ‚ç‚¹æ­£ç¡®å³å¯ ğŸ˜„)</p>
<p>å®å±•å¼€çš„ç»“æœæ˜¯ä¸ªæŸç±»å‹çš„ASTèŠ‚ç‚¹, è¿™ç›¸æ¯”äºCè¯­è¨€çš„ <code>#define</code> å®, æœ‰ä»€ä¹ˆå¥½å¤„?<br>
æœ€ç›´æ¥çš„å¥½å¤„, å¦‚ä¸‹ <s>(ç›¸å½“äºè‡ªåŠ¨ç»™ä½ åŠ ä¸Šäº†æ‹¬å·)</s>:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Cè¯­è¨€: ç®€å•çš„æ–‡æœ¬æ›¿æ¢</span></span><br><span class="line">#define SUM(a,b) a+b</span><br><span class="line">int main(void) &#123;</span><br><span class="line">    SUM(<span class="number">2</span>, <span class="number">2</span>);     <span class="comment">// 2 * 2</span></span><br><span class="line">    <span class="number">5</span> * SUM(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// 5 * 2 + 2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Rustè¯­è¨€: æ ¹æ®ä¸Šä¸‹æ–‡æ¨æµ‹å®è°ƒç”¨çš„ASTèŠ‚ç‚¹åº”è¢«å±•å¼€ä¸ºexprç±»å‹çš„ASTèŠ‚ç‚¹</span></span><br><span class="line"><span class="built_in">macro_rules!</span> sum &#123;</span><br><span class="line">    ($a:expr,$b:expr) =&gt; &#123;$a + $b&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    sum!(<span class="number">2</span>,<span class="number">2</span>);     <span class="comment">// 2 + 2</span></span><br><span class="line">    <span class="number">5</span> * sum!(<span class="number">2</span>,<span class="number">2</span>); <span class="comment">// 5 * (2 + 2)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pi-pei-zhu-yi-dian" id="åŒ¹é…æ³¨æ„ç‚¹">åŒ¹é…æ³¨æ„ç‚¹</h2>
<p>åœ¨ä¼ å‚æ—¶æœ‰ä¸¤ä¸ªåœ°æ–¹è¦æ³¨æ„, ä¸€æ˜¯ä¸ªå¾ˆå¸¸è§çš„è¯¯è§£, äºŒæ˜¯äº›ä¸ºäº†ä»¥åå®çš„å‘å±•è€Œæœ‰çš„é™åˆ¶, æœ‰æ—¶é—´çš„ä¹Ÿå¯ä»¥å»çœ‹çœ‹ <a href="https://www.bookstack.cn/read/DaseinPhaos-tlborm-chinese/mbe-min-captures-and-expansion-redux.md">å®å°å†Œ</a></p>
<h3 id="pi-pei-wu-qu" id="åŒ¹é…è¯¯åŒº">åŒ¹é…è¯¯åŒº</h3>
<p>æ¥çœ‹çœ‹ä¸‹é¢ä¸€æ®µä»£ç :</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> aa &#123;</span><br><span class="line">    ($a: expr) =&gt; &#123;&#125;;</span><br><span class="line">    ($a: ident +) =&gt; &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    aa!(a);   <span class="comment">// Yes</span></span><br><span class="line">    aa!(a+);  <span class="comment">// No</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä½ çš„ç›´è§‰, <code>aa!(a+)</code> åº”è¯¥ä¼šä¸ç¬¬äºŒä¸ª rule ç›¸åŒ¹é…, ä½†æ˜¯å®é™…ä¸Šä¼šæŠ¥è¿™ä¹ˆä¸€ä¸ªé”™è¯¯:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">expected expression, found end of <span class="keyword">macro</span> arguments</span><br><span class="line"><span class="comment">// æœŸæœ›è¡¨è¾¾å¼, å´å‘ç°å®å‚æ•°ç»“æŸäº†</span></span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šå‘ç°å®é™…ä¸Šéƒ½æ˜¯åœ¨ä¸ç¬¬ä¸€ä¸ªruleå°è¯•ç€è¿›è¡ŒåŒ¹é…:</p>
<p><code>a (lhs, left hand side)</code> èƒ½è¢«ç¬¬ä¸€ä¸ªruleåŒ¹é…<br>
è€Œ <code>+ (äºŒå…ƒåŠ )</code> å› ä¸ºå¯ä»¥å°¾éšè¡¨è¾¾å¼, ä¹Ÿå¯ä»¥è¢«ç¬¬ä¸€ä¸ªruleåŒ¹é…ä½†ç”±äºç¼ºå°‘ <code>rhs</code>, æ­¤æ—¶ä¼šç›´æ¥æŠ¥é”™, è€Œä¸æ˜¯å»å°è¯•åŒ¹é…ä¸‹ä¸€ä¸ªrule</p>
<p>è¿™é¿å…äº†æŸäº›æƒ…å†µä¸‹, å‘ç”Ÿä¸æœŸæœ›çš„åŒ¹é…, ä½†ä½ å´ä¸çŸ¥, å› æ­¤ruleçš„é¡ºåºå¾ˆé‡è¦</p>
<h3 id="qi-yi-xian-zhi" id="æ­§ä¹‰é™åˆ¶">æ­§ä¹‰é™åˆ¶</h3>
<p>ç”±äºä¸€äº›æ­§ä¹‰, ä¸ºäº†å‘åå…¼å®¹æ€§ä¸ä¸ç ´åä»£ç , å½“å‰å¯¹ <code>Metavariable</code> åé¢å¯ä»¥è·Ÿçš„å†…å®¹æœ‰æ‰€é™åˆ¶, è¯¦æƒ…å¯è§ <a href="https://doc.rust-lang.org/stable/reference/macros-by-example.html#follow-set-ambiguity-restrictions">Rust-Reference: é™åˆ¶</a><br>
è¿™é‡Œåªéœ€ç¨å¾®çœ‹çœ‹, ç•™ä¸ªå°è±¡, å®é™…ä½¿ç”¨æ—¶, è‹¥åœ¨æ­¤æ–¹é¢æŠ¥é”™, åˆ™æ ¹æ®ç¼–è¯‘å™¨çš„æç¤ºæ¥æ”¹å³å¯<br>
<s>(åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆ xxx ç±»å‹åé¢, åŠ  yyy è¿™ä¸ªç¬¦å·ä¸å…è®¸, å› ä¸ºæˆ‘ä¹Ÿæ²¡å…¨ææ‡‚, åæ­£è¿™æ ·ä¸å…è®¸å°±å¯¹äº†)</s></p>
<p>å½“ç„¶, éšç€Rustå£°æ˜å®çš„é€æ¸å®Œå–„, é™åˆ¶ä¼šé€æ¸å‡å°‘(è™½ç„¶ä¹Ÿä¸å¤š)</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Macro</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-decl-macro-p4~&gt; é‡å¤</title>
    <url>/posts/rust-decl-macro/p4.html</url>
    <content><![CDATA[<blockquote>
<p>å®ä¸­éå¸¸é‡è¦çš„è¯­æ³•: é‡å¤(repetition)</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨:</p>
<ul class="lvl-0">
<li class="lvl-2"><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></li>
<li class="lvl-2"><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></li>
</ul>
<h1 id="jie-shao">ä»‹ç»</h1>
<p><code>é‡å¤ (Repetition)</code> æ˜¯å®ä¸­æ— æ¯”é‡è¦çš„æ ¸å¿ƒçº§è¯­æ³•, æƒ³å‘æŒ¥å®çš„å¼ºå¤§å°±å¿…é¡»ç”¨åˆ°å®ƒ</p>
<p>è¯¥è¯­æ³•, å¯ä»¥é‡å¤ä¸€æ®µæ¨¡å¼(ä¸€äº›Token), å‡ºç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Matcher: å°†ä¸€æ®µæŒ‡å®šçš„æ¨¡å¼, é‡å¤åœ°åŒ¹é…ä¸æ•è·</p>
</li>
<li class="lvl-2">
<p>Transcriber: å°†ä¸€æ®µæŒ‡å®šçš„æ¨¡å¼, é‡å¤åœ°å±•å¼€</p>
</li>
</ul>
<p><s>(åºŸè¯, Rustçš„å£°æ˜å®ä¸å°±è¿™ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†å˜›)</s></p>
<p>å‡è®¾ä½ è¦è®¾è®¡ä¸€ä¸ªå®, è¿›è¡Œæ±‚å’Œ(å‚æ•°ä¸ªæ•°ä¸ç¡®å®š):</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Examples:</span></span><br><span class="line"><span class="built_in">assert_eq!</span>( <span class="number">0</span>,  sum!() );</span><br><span class="line"><span class="built_in">assert_eq!</span>( <span class="number">15</span>, sum!(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>) );</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹, å¦‚ä½•ä½¿ç”¨é‡å¤å§</p>
<h1 id="yu-fa">è¯­æ³•</h1>
<p>å…³é”®åœ¨äºå‚æ•°çš„ä¸ªæ•°ä¸ç¡®å®š, å› æ­¤æˆ‘ä»¬åº”ä½¿ç”¨é‡å¤è¯­æ³•:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> sum &#123;</span><br><span class="line">    ($($a:expr),*) =&gt; &#123;</span><br><span class="line">        <span class="number">0</span> $(+ $a)*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    sum!();          <span class="comment">// 0</span></span><br><span class="line">    sum!(<span class="number">5</span>);         <span class="comment">// 5</span></span><br><span class="line">    sum!(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>); <span class="comment">// 15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼ªä»£ç è¡¨ç¤º:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">$( Pattern )   Sep    RepOp</span><br><span class="line">$(   æ¨¡å¼   )  åˆ†éš”ç¬¦  é‡å¤ç¬¦å·</span><br></pre></td></tr></table></figure>
<p>å®ƒå¯ä»¥è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ¨¡å¼(Pattern):<br>
è¢«åŒ…è£¹äº <code>$( )</code>, ç”¨äºåŒ¹é…æ•è·(åœ¨Matcher), æˆ–é‡å¤å±•å¼€(åœ¨Transcriber)</p>
</li>
<li class="lvl-2">
<p>åˆ†éš”ç¬¦(Separator):<br>
ç”¨æ¥åˆ†å‰²é‡å¤çš„æ¨¡å¼, æ¯”å¦‚ <code>vec![1,2,3]</code> ä¸­çš„é€—å·</p>
</li>
<li class="lvl-2">
<p>é‡å¤ç¬¦å·(Repetition Operator):<br>
å¯¹æ¨¡å¼åŒ¹é…æ¬¡æ•°, è¿›è¡Œè¯´æ˜é™åˆ¶, ä¸ç¬¦åˆå°±ç¼–è¯‘æŠ¥é”™</p>
</li>
</ul>
<p>ä»¥ <code>sum!</code> ä¸ºä¾‹å­, å®ƒåœ¨ç¬¬äºŒä¸ªruleä¸­ç”¨åˆ°äº†é‡å¤:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>In Matcher:<br>
æ¨¡å¼: <code>$a:expr</code> æ˜¯é‡å¤çš„æ¨¡å¼, è¡¨ç¤ºé‡å¤åœ°åŒ¹é…ä¸æ•è·expr<br>
åˆ†å‰²: æ¯ä¸ªæ¨¡å¼ä¹‹é—´ç”¨é€—å·åˆ†å‰², è¡¨ç¤ºä¼ å‚æ—¶è¦ä¼ å…¥é€—å·è¿›è¡ŒåŒ¹é…<br>
æ¬¡æ•°: *å·, è¯´æ˜äº†é‡å¤æ¨¡å¼çš„ä¸ªæ•°, å®ƒè¢«é™åˆ¶ä¸º&gt;=0</p>
</li>
<li class="lvl-2">
<p>In Transcriber:<br>
æ¨¡å¼: <code>+ $a</code> æ˜¯é‡å¤æ¨¡å¼, æ¯”å¦‚ä¼ å…¥ <code>1,2,3,4,5</code> æ—¶, ä¼šè¢«å±•å¼€ä¸º <code>0+1+2+3+4+5</code><br>
åˆ†å‰²: æ²¡æ·»åŠ åˆ†å‰²ç¬¦å·, è¡¨ç¤ºå±•å¼€æ—¶, æ¯ä¸ªæ¨¡å¼ä¹‹é—´ä¸ä¼šæ·»åŠ sep<br>
æ¬¡æ•°:	 åŒ Matcher</p>
</li>
</ul>
<p><code>$()</code> ä¸ <code>RepOp</code> æ˜¯å¿…å¡«çš„, <code>Sep</code> æ˜¯å¯é€‰çš„</p>
<p>RepOp æœ‰ä¸‰ç§å¯é€‰é¡¹, æœ‰ç‚¹åƒæ­£åˆ™:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>*</code> è¡¨ç¤º æ¨¡å¼åŒ¹é…çš„æ¬¡æ•° &gt;= 0<br>
è®°å¿†æ³•-&gt; è¯¥ç¬¦å·çœ‹ä¸Šå»åƒæ˜¯ä¸€ä¸ªç‚¹, è”æƒ³ä¸º0</p>
</li>
<li class="lvl-2">
<p><code>+</code> è¡¨ç¤º æ¨¡å¼åŒ¹é…çš„æ¬¡æ•° &gt;= 1<br>
è®°å¿†æ³•-&gt; è”æƒ³ä¸ºæ­£æ•°, é‚£å°±&gt;=1</p>
</li>
<li class="lvl-2">
<p><code>?</code> è¡¨ç¤º æ¨¡å¼åŒ¹é…çš„æ¬¡æ•° = 0 or 1<br>
è®°å¿†æ³•-&gt; é—®å·è¡¨ç¤ºç–‘é—®, ä»£è¡¨ æœ‰ or æ²¡æœ‰</p>
</li>
</ul>
<p>æœ‰ä¸€äº›æ³¨æ„ç‚¹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å½“ RepOp ä¸º ? æ—¶, ä¸å¯ä»¥æ·»åŠ  Sep(å› ä¸ºæœ€å¤šä¹Ÿå°±åŒ¹é…åˆ°ä¸€æ¬¡, ä½ æ€ä¹ˆåˆ†å‰²?)</p>
</li>
<li class="lvl-2">
<p>Sep æ˜¯æœ‰é™åˆ¶çš„, <a href="/posts/rust-decl-macro/p3#qi-yi-xian-zhi">p3#æ­§ä¹‰é™åˆ¶</a> æåˆ°è¿‡, è¯¦æƒ…å¯è§ <a href="https://doc.rust-lang.org/stable/reference/macros-by-example.html#follow-set-ambiguity-restrictions">rust-reference</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Macro</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-decl-macro-p5~&gt; å«ç”Ÿæ€§</title>
    <url>/posts/rust-decl-macro/p5.html</url>
    <content><![CDATA[<blockquote>
<p>æœ¬èŠ‚å°†ä»‹ç»å®çš„ å«ç”Ÿæ€§(hygienic)</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="/categories/rust-decl-macro">åšå®¢: rust-decl-macro</a></p>
</li>
<li class="lvl-2">
<p><a href="https://www.bilibili.com/video/BV1Wv411W7FH?p=1">Bç«™è§†é¢‘: Rustç¼–ç¨‹è¯­è¨€-å£°æ˜å®</a></p>
</li>
</ul>
<h1 id="kai-pian">å¼€ç¯‡</h1>
<p>ä»€ä¹ˆæ˜¯ å«ç”Ÿæ€§(Hygienic) å‘¢?<br>
ç®€å•æ¥è¯´,å°±æ˜¯æ ‡è¯†ç¬¦(ident)åœ¨å®çš„å¤„ç†ä¸å±•å¼€æ—¶,æ˜¯æ— æ­§ä¹‰çš„,ä¸è¢«åŒåæ ‡è¯†ç¬¦æ±¡æŸ“<br>
å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦æ­¤æ¦‚å¿µ, æˆ‘ä¸ä¿¡ä½ ä¸ä¼šæ‡µé€¼<br>
ä¸è¿‡å®é™…ä¸Š, è¿™ä¸ªæ¦‚å¿µç†è§£èµ·æ¥ä¸ç®—å›°éš¾</p>
<p>è®©æˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸ªé—®é¢˜, è¯·çœ‹ä¸‹é¢çš„ä»£ç :</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">macro_rules!</span> create_var &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    create_var!();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥å¤åˆ¶è¯¥æ®µä»£ç , ç„¶åè¿è¡Œ, å°†å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯, æç¤ºæ‰¾ä¸åˆ°a</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Macro</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-async-p1~&gt; ç³»åˆ—è¯´æ˜</title>
    <url>/posts/rust-async/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ å¼‚æ­¥(async) ç³»åˆ—</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p>
<h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1>
<p>æ­¤ç³»åˆ—,æˆ‘ä»¬å°†å­¦ä¹ Rustä¸­çš„ <code>å¼‚æ­¥ (Async)</code><br>
å½“ç„¶ä¹Ÿä¼šä»‹ç»å¼‚æ­¥æ–¹é¢çš„ç›¸å…³æ¦‚å¿µå’¯</p>
<hr>
<h1 id="zi-liao-lai-yuan">èµ„æ–™æ¥æº</h1>
<ol>
<li class="lvl-3">
<p>ä¹¦ç±</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://rust-lang.github.io/async-book/**">async-book</a></p>
</li>
<li class="lvl-2">
<p><a href="https://book.async.rs/overview/async-std">async_std/tutorials</a></p>
</li>
<li class="lvl-2">
<p><a href="https://tokio.rs/tokio/tutorial">tokio/tutorials</a></p>
</li>
<li class="lvl-2">
<p><a href="https://cfsamson.github.io/books-futures-explained/">Futures Explained in 200 Lines of Rust</a></p>
</li>
</ul>
<ol start="2">
<li class="lvl-3">
<p>åšå®¢</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://without.boats/blog/">Withoutboatsâ€™s blogs</a></p>
</li>
</ul>
<hr>
<h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1>
<p>å‘ç°é”™è¯¯çš„è¯,è¯·åŠæ—¶è·Ÿæˆ‘è”ç³»,æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>
ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p>
<p>æœ€å,è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Async</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-async-p2~&gt; å¼‚æ­¥ç®€ä»‹</title>
    <url>/posts/rust-async/p2.html</url>
    <content><![CDATA[<blockquote>
<p>æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å¼‚æ­¥å§</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p>
<h1 id="kai-pian">å¼€ç¯‡</h1>
<p><strong>å¼‚æ­¥ç¼–ç¨‹ (Asynchronous programming)</strong>, æ˜¯ä¸€ç§<strong>å¹¶å‘ç¼–ç¨‹æ¨¡å‹</strong><br>
ç‰¹ç‚¹æ˜¯é€šè¿‡å°‘é‡<code>OS_thread(ç³»ç»Ÿçº¿ç¨‹)</code>, å³å¯è¿è¡Œå¤§é‡<code>å¹¶å‘ä»»åŠ¡</code>, åœ¨æŸäº›åœºæ™¯ä¸‹,å¯ä»¥ç–¯ç‹‚å‹æ¦¨cpuçš„æ€§èƒ½</p>
<hr>
<h1 id="mo-xing-dui-bi">æ¨¡å‹å¯¹æ¯”</h1>
<p>ä¸ºä½•é€‰æ‹©å¼‚æ­¥,å®ƒçš„ä¼˜åŠ¿æœ‰å“ªäº›? è®©æˆ‘ä»¬å¯¹æ¯”ä¸‹ <strong>å¼‚æ­¥</strong> ä¸å…¶ä»– <strong>å¹¶å‘æ¨¡å‹</strong>:</p>
<p>1.<code>ç³»ç»Ÿçº¿ç¨‹ (OS Thread)</code><br>
ç”±æ“ä½œç³»ç»Ÿæä¾›çº¿ç¨‹,è¿›è¡Œå¹¶å‘,å¦‚ <code>std::thread</code></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç®€å•æ˜“ä½¿ç”¨, å»ºæ¨¡èƒ½åŠ›å¼º, è¶³å¤Ÿä¼ ç»Ÿ</p>
</li>
<li class="lvl-2">
<p>æ“ä½œç³»ç»Ÿå°±æ˜¯è¿è¡Œæ—¶, ä¸Cè¯­è¨€äº¤äº’æ–¹ä¾¿</p>
</li>
<li class="lvl-2">
<p>æ•°æ®åŒæ­¥å›°éš¾, æ˜“å‘ç”Ÿæ•°æ®ç«äº‰</p>
</li>
<li class="lvl-2">
<p>å°å‹ä»»åŠ¡æ•°é‡å·¨å¤§æ—¶, è‹¥åˆ†åˆ«å¼€ä¸€ä¸ªçº¿ç¨‹, æ‰€éœ€å†…å­˜ä¸åˆ›å»ºçº¿ç¨‹å¼€é”€å·¨å¤§, æ€§ä»·æ¯”æä½</p>
</li>
</ul>
<p>2.<code>ç»¿è‰²çº¿ç¨‹ (Green Thread)</code><br>
å®ƒå‡ ä¹ä¸ç³»ç»Ÿçº¿ç¨‹ä¸€æ ·, ä¸è¿‡ <code>Runtime(è¿è¡Œæ—¶,jvm/.netå¬è¯´è¿‡å—?)</code> ä»æ“ä½œç³»ç»Ÿå˜ä¸ºäº†ç¨‹åºæœ¬èº«, ç”±ç¨‹åºæœ¬èº«è¿›è¡Œæ¨¡æ‹Ÿ<br>
Ruståœ¨1.0ç‰ˆæœ¬å‰åˆ å»äº†å®ƒ, å› ä¸ºå®ƒä¸èƒ½åœ¨è¯­è¨€å±‚é¢è¢« Rust æ”¯æŒ, ä½†å¯ä»¥ä½¿ç”¨ç›¸å…³åº“</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç¨‹åºæœ¬èº«å¯¹ç»¿è‰²çº¿ç¨‹æœ‰ç»å¯¹çš„ç®¡ç†æƒ, å†…å­˜åˆ†é…çš„ç²’åº¦æ›´ç»†, èƒ½æ ¹æ®ä»»åŠ¡å¤§å°è¿›è¡Œè°ƒåº¦, å †æ ˆå¯ä»¥éšæ—¶é—´æ¨ç§»è€Œå¢é•¿</p>
</li>
<li class="lvl-2">
<p>åˆ›å»º/é”€æ¯/åˆ‡æ¢çº¿ç¨‹çš„ä»£ä»·åˆä½åˆå¿«, è½»æ¾åˆ›å»ºæˆåƒä¸Šä¸‡ä¸ªç»¿è‰²çº¿ç¨‹, æ¥å¤„ç†ä»»åŠ¡</p>
</li>
<li class="lvl-2">
<p>ç”±ç¨‹åºæœ¬èº«å®ç°æ¨¡æ‹Ÿå‡ºæ¥, Runtime è¾ƒå¤§</p>
</li>
<li class="lvl-2">
<p>å¦‚æœæ”¾åœ¨è¯­è¨€å±‚é¢æ”¯æŒRuntime, å…¶ä¼šä¸€ç›´å­˜åœ¨, å³ä½¿ä¸ä½¿ç”¨è¯¥ç‰¹æ€§, ä¹Ÿä¼šæ‹–ç´¯æ€§èƒ½, éš¾ä»¥ä¸Cåº“äº¤äº’</p>
</li>
<li class="lvl-2">
<p>ç»¿è‰²çº¿ç¨‹åœ¨ä¸åŒå¹³å°ä¸Š,å…¶å®ç°å¯èƒ½ä¸åŒ</p>
</li>
<li class="lvl-2">
<p>å¯¹å¤šå¹³å°çš„æ”¯æŒ/ç»´æŠ¤/æ”¹è¿›å¾—é å®ç°è€…ä¿è¯</p>
</li>
</ul>
<hr>
<h1 id="yi-bu">å¼‚æ­¥</h1>
<p>æˆ‘ä»¬ä»¥IOæ“ä½œä¸ºä¾‹å­, å‡è®¾æˆ‘ä»¬æ­£åœ¨å•çº¿ç¨‹ä¸‹, è¯»å–æ–‡ä»¶, å¹¶è¿›è¡Œä¸€ä¸ªè®¡ç®—:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> file = <span class="comment">/*  */</span></span><br><span class="line"><span class="keyword">let</span> content = read(file);</span><br><span class="line">compute()</span><br></pre></td></tr></table></figure>
<p>è¯»å– <code>file</code>, è·å– <code>content</code>, åœ¨æ­¤æœŸé—´, æˆ‘ä»¬åšä¸äº†ä»»ä½•å…¶ä»–äº‹, å¾—ç­‰å¾…<code>IOæ“ä½œ(Input/Output, è¾“å…¥/è¾“å‡º)</code> å®Œæ¯•, æ‰èƒ½è¿›è¡Œæ¥ä¸‹æ¥çš„ <code>compute</code><br>
<code>è¯»å–æ–‡ä»¶</code>, å±äº<code>IOæ“ä½œ</code>, ä¼—æ‰€å‘¨çŸ¥, IOæ“ä½œå¾ˆè€—æ—¶, ç­‰å¾…å®ƒå®Œæˆçš„æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿, å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçº¿ç¨‹åŠ é€Ÿ:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> file = <span class="comment">/*  */</span></span><br><span class="line"><span class="comment">// ä¸ºæ¯ä¸ªè¯»å–ä»»åŠ¡æ–°å»ºçº¿ç¨‹, å¹¶è·å–å¥æŸ„</span></span><br><span class="line"><span class="keyword">let</span> handle_a = thread::spawan(|| read(file) );</span><br><span class="line"><span class="keyword">let</span> handle_b = thread::spawan(|| compute() );</span><br><span class="line"><span class="comment">// ä½¿ç”¨ join é˜»å¡è°ƒç”¨çº¿ç¨‹, ç¡®ä¿å¥æŸ„çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line"><span class="keyword">let</span> content = handle_a.join().unwrap();</span><br><span class="line">handle_b.join().unwrap();</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªä»»åŠ¡ <code>read</code> ä¸ <code>compute</code> æ˜¯ç‹¬ç«‹æ— ä¾èµ–çš„, æ‰€ä»¥æˆ‘ä»¬<code>spawn</code>äº†ä¸¤ä¸ªçº¿ç¨‹</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç¬¬ä¸€ä¸ªç”¨äºè¯»å–æ–‡ä»¶,è·å–æ•°æ®</p>
</li>
<li class="lvl-2">
<p>ç¬¬äºŒä¸ªç”¨äºæ‰§è¡Œ <code>compute</code></p>
</li>
</ul>
<p>é€Ÿåº¦è™½ç„¶ä¸Šå»äº†, ä½†ä»£ä»·å°±æ˜¯é¢å¤–åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹çš„å¼€é”€, è€Œä¹‹åçš„å¼‚æ­¥ä»…ä¾é å•çº¿ç¨‹, ä¹Ÿèƒ½å®Œæˆä¸Šé¢çš„æ“ä½œ<br>
å•çº¿ç¨‹ä¸­çš„å¼‚æ­¥(ä¼ª)ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> file = <span class="comment">/*  */</span></span><br><span class="line"><span class="keyword">let</span> content = read_async(file);</span><br><span class="line">compute_async()</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šæ³¨æ„åˆ°:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>read</code> -&gt; <code>read_async</code></p>
</li>
<li class="lvl-2">
<p><code>compute</code> -&gt; <code>compute_async</code></p>
</li>
</ul>
<p>ä¼ªä»£ç è¡¨ç¤º, è¿™ä¸¤æ“ä½œå˜æˆäº†å¼‚æ­¥çš„, ç°åœ¨ä½ æ— éœ€å…³æ³¨è¿™æ˜¯å¦‚ä½•å˜æˆå¼‚æ­¥çš„, æ­¤å¤„ä»…ä¸ºä¸ºè¯´æ˜å¼‚æ­¥çš„æ¦‚å¿µ:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>read</code>:<br>
å®ƒä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹,ç­‰å¾…è¯¥æ“ä½œå®Œæ¯•å, æ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œ <code>compute</code><br>
é˜»å¡æœŸé—´æ˜¯å‡ ä¹ä¸éœ€è¦ cpu å‚ä¸è¿è¡Œçš„, ç¨‹åºæ­¤æ—¶å‚»ä¹ä¹åœ°ç­‰å¾…é˜»å¡ç»“æŸ, æ— ç–‘æ˜¯å¯¹æ€§èƒ½çš„æµªè´¹, å¯¹cpuçš„ä¸å°Šé‡</p>
</li>
<li class="lvl-2">
<p><code>read_async</code>:<br>
å®ƒå¤„äºé˜»å¡æ—¶,ä¼šè¿è¡Œ <code>compute_async</code>, çº¿ç¨‹ç”± <code>read_async</code> æ¥ç®¡, å˜ä¸ºç”± <code>compute_async</code> æ¥ç®¡<br>
å½“é˜»å¡æ—¶é—´ç»“æŸ,åˆ™ç¨‹åºç»§ç»­å˜ä¸ºè¿è¡Œ<code>read_async</code></p>
</li>
</ul>
<p>ç§, <code>read_async</code> æ“ä½œé˜»å¡, æ— æ³•å–å¾—è¿›å±•æ—¶, å…¶ä»–å¼‚æ­¥ä»»åŠ¡å°†è¢«æ‰§è¡Œ, ç”±å…¶ä»–å¼‚æ­¥ä»»åŠ¡æ¥ç®¡çº¿ç¨‹<br>
æ€»è€Œè¨€ä¹‹, å¼‚æ­¥å…¶å®å°±æ˜¯å½“å‰æ“ä½œå¤„äºé˜»å¡æ—¶, èƒ½è¿è¡Œå…¶ä»–ä¸é˜»å¡çš„æ“ä½œ (å¦‚æœæœ‰), ä½¿å¾—cpuä¸€ç›´å¤„äºè¿ç®—, æ€§èƒ½è¢«æé™å‹æ¦¨<br>
å¼‚æ­¥æ“ä½œ, å°±åƒæ˜¯å¯ä»¥éšæ„ <code>start/stop</code> ä¸€èˆ¬, è°ƒåº¦ç¨‹åºèƒ½è¿›è¡Œè°ƒåº¦, å†³å®šå½“å‰è¦è¿ç®—å“ªä¸ª, ç¡®ä¿ä¸ä¼šå› é˜»å¡è€Œå‚»å‚»ç­‰å¾…</p>
<p>å³ä½¿æ˜¯å•çº¿ç¨‹, ä¹Ÿèƒ½åšåˆ°åŒæ—¶è¿è¡Œå¤šä¸ª <code>Task(å¼‚æ­¥ä»»åŠ¡)</code>, è€Œå¼‚æ­¥ç»“åˆå¤šçº¿ç¨‹ä¹Ÿæ˜¯å¯ä»¥çš„, åªè¦å­˜åœ¨è€—æ—¶çš„IOæ“ä½œ<br>
å¦‚æœæ˜¯éIOå¯†é›†å‹, è€Œæ˜¯è®¡ç®—å¯†é›†å‹, å»ºè®®ç›´æ¥ä½¿ç”¨å¤šçº¿ç¨‹, ä¸ç„¶å°±ç”¨å¼‚æ­¥</p>
<hr>
<h1 id="wei-sheng">å°¾å£°</h1>
<p>Q:<br>
é˜»å¡æ—¶æœŸè¿˜èƒ½åŒæ—¶è¿›è¡Œå…¶ä»–æ“ä½œ? IOæ“ä½œä¸ä¼šå ç”¨cpuå—?<br>
A:<br>
ç°ä»£ç”µè„‘å‘å±•å‡ºäº†ä¸€äº›åˆ†æ‹…IOæ“ä½œå‹åŠ›çš„é«˜ç§‘æŠ€, cpuå¯¹IOæ“ä½œçš„å‹åŠ›è¾ƒå°, IOæ—¶èƒ½è¿›è¡Œå…¶ä»–è¿ç®—, åªè¦æœ€åæ¥æ”¶æ•°æ®æ—¶å‡ºä¸ªåœºå°±è¡Œäº†<br>
æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºä¸éœ€è¦åœ¨IOé˜»å¡æ—¶å‚»å‚»ç­‰å¾…, ç»™å®ƒä»¬æ‰¾ç‚¹äº‹æƒ…åšå§!</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Async</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-async-p3~&gt; Future</title>
    <url>/posts/rust-async/p3.html</url>
    <content><![CDATA[<blockquote>
<p>Rust ä¸­çš„ Future/async/.await è¯´æ˜</p>
</blockquote>
<span id="more"></span>  
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p>
<h1 id="kai-pian">å¼€ç¯‡</h1>
<p>å¤§å®¶å¥½! æˆ‘ä»¬ä¸Šä¸€èŠ‚å·²ç»çŸ¥æ™“å¼‚æ­¥çš„åŸºç¡€æ¦‚å¿µ, ç°åœ¨,æ¥çœ‹çœ‹Rustä¸­çš„å¼‚æ­¥è¯­æ³•å§</p>
<p>æœ¬èŠ‚, æˆ‘ä»¬å°†å­¦ä¹ ä»¥ä¸‹ä¸‰ä¸ªæ¦‚å¿µçš„å¤§è‡´å«ä¹‰:<br>
(æš‚æ—¶ä¸æ¶‰åŠèƒŒååŸç†, åŸç†è¦ç­‰ä¹‹åä¸“é—¨å‡ºå¥½å‡ èŠ‚æ¥è®²)</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Future (trait)</p>
</li>
<li class="lvl-2">
<p>async (keyword)</p>
</li>
<li class="lvl-2">
<p>.await (keyword)</p>
</li>
</ul>
<hr>
<h1 id="future">Future</h1>
<h2 id="gai-nian" id="æ¦‚å¿µ">æ¦‚å¿µ</h2>
<p><code>Future</code>,ä¸€ä¸ªæ ‡å‡†/æ ¸å¿ƒåº“ä¸­çš„trait: <code>std/core::future::Future</code></p>
<p>åœ¨Rustä¸­,ä¸€ä¸ªå®ç°äº†Future(trait)çš„ç±»å‹, è¯¥ç±»å‹çš„å®ä¾‹(ä¸€ä¸ªFutureå®ä¾‹), ä¾¿ä»£è¡¨ <code>ä¸€æ¬¡å¼‚æ­¥è®¡ç®—</code>, å¯å°†å…¶äº¤ç»™ <code>Runtime(è¿è¡Œæ—¶)</code> æ¥å¼‚æ­¥æ‰§è¡Œ</p>
<p><code>å¼‚æ­¥æ‰§è¡Œ</code>, ä¹Ÿå°±æ˜¯æŒ‡:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å…¶ä»–å¼‚æ­¥ä»»åŠ¡é˜»å¡æ—¶,å½“å‰å¼‚æ­¥ä»»åŠ¡æœ‰æœºä¼šæ‰§è¡Œ</p>
</li>
<li class="lvl-2">
<p>å½“å‰å¼‚æ­¥ä»»åŠ¡é˜»å¡æ—¶,å…¶ä»–å¼‚æ­¥ä»»åŠ¡æœ‰æœºä¼šæ‰§è¡Œ</p>
</li>
</ul>
<p>æ€»è€Œè¨€ä¹‹,é˜»å¡æ—¶æœŸæ‰§è¡Œå…¶ä»–ä»»åŠ¡,ä¸ç»™cpuç©ºé—²çš„æœºä¼š</p>
<p><strong>æ³¨æ„ä¸¤ä¸ªåè¯çš„åŒºåˆ«:</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>å¼‚æ­¥ è®¡ç®—</code></p>
</li>
<li class="lvl-2">
<p><code>å¼‚æ­¥ ä»»åŠ¡</code></p>
</li>
</ul>
<p>ä¸¤è€…æœ‰ç€åŒºåˆ«,ä¸¾ä¸ªä¾‹å­ä½ å°±æ˜ç™½äº†:</p>
<p>å‡è®¾æœ‰è¿™ä¹ˆä¸ªçˆ¶è®¡ç®—, ç”±ä¸¤ä¸ªå­è®¡ç®—ç»„æˆ:</p>
<ol>
<li class="lvl-3">
<p>Open: å…ˆå¼‚æ­¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶(async open)</p>
</li>
<li class="lvl-3">
<p>Read: å†å¼‚æ­¥è¯»å–è¯¥æ–‡ä»¶(async read)</p>
</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å‡º, ä¸€æ¬¡è®¡ç®—å¯ä»¥ç”±å¤šä¸ªæœ‰ä¾èµ–å…³ç³»çš„å­è®¡ç®—ç»„æˆ, è‹¥ Open é™·å…¥é˜»å¡, Runtime ä¸èƒ½è°ƒåº¦ Read å¡«å……è¿™æ®µé˜»å¡æ—¶æœŸ<br>
å› æ­¤, å½“æŸä¸ªå­è®¡ç®—é˜»å¡æ—¶, å®ƒæ‰€å±çš„æœ€é¡¶å±‚çš„çˆ¶è®¡ç®—ä¹Ÿåº”é˜»å¡, é¿å… Runtime è°ƒåº¦éæ³•è®¡ç®—<br>
(æˆ‘ä»¬å°†<code>æœ€é¡¶å±‚çš„çˆ¶è®¡ç®—(top-level Future, å³æœ€é¡¶å±‚çš„Futureå®ä¾‹)</code>ç§°ä¸º<code>Task(ä»»åŠ¡)</code>)</p>
<p>å½“å‰ Task é˜»å¡æ—¶, æ¥ç®¡æ‰§è¡Œæƒçš„ä¸èƒ½æ˜¯å½“å‰ Task ä¸­çš„å…¶ä»–å­è®¡ç®—, åªèƒ½æ˜¯å…¶ä»– Task ä¸­çš„å­è®¡ç®—</p>
<p>æ€»ç»“:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Task æ˜¯ä¸€ä¸ªé¡¶å±‚ Future å®ä¾‹ (å³ä¸€æ¬¡é¡¶å±‚å¼‚æ­¥è®¡ç®—)</p>
</li>
<li class="lvl-2">
<p>ä¸€ä¸ª Future å¯ä»¥ç”±å¤šä¸ª Future ç»„æˆ, å³ä¸€ä¸ª Future é‡Œå¯ä»¥æ‰§è¡Œå¤šä¸ª Future</p>
</li>
<li class="lvl-2">
<p>Task_A é˜»å¡æ—¶,æ¥ç®¡æ‰§è¡Œçš„æ˜¯å…¶ä»– Task ä¸­çš„å­è®¡ç®—,ä¸èƒ½æ˜¯ Task_A ä¸­çš„å­è®¡ç®—</p>
</li>
<li class="lvl-2">
<p>Task å¯ä»¥åªæ˜¯ä¸€æ¬¡å•ç‹¬è®¡ç®—</p>
</li>
</ul>
<p>ä¸€ä¸ª Future, å¯ç†è§£ä¸ºæ˜¯ç»„æˆä¸€ä¸ª Task çš„æœ€å°å•ä½</p>
<h2 id="ding-yi" id="å®šä¹‰">å®šä¹‰</h2>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å®šä¹‰:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Future</span></span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Output</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(<span class="keyword">self</span>: Pin&lt;&amp;<span class="keyword">mut</span> <span class="keyword">Self</span>&gt;, cx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ç®€å•äº†è§£ä¸€ä¸‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Future:<br>
ä»£è¡¨ä¸€æ¬¡å¼‚æ­¥è®¡ç®—</p>
</li>
<li class="lvl-2">
<p>Output: ä»£è¡¨ Future æ‰§è¡Œå®Œæ¯•å, äº§å‡ºçš„å€¼çš„ç±»å‹</p>
</li>
<li class="lvl-2">
<p>poll: æ‰€æœ‰æ‰§è¡Œæ“ä½œéƒ½ä¼šæ”¾åœ¨è¯¥å‡½æ•°ä¸­, Runtime ä¼šä¸æ–­è°ƒç”¨ poll æ¥æ¨è¿› Future çš„å®Œæˆ, å…¶è¿”å›å€¼æ˜¯æšä¸¾ç±»å‹, ä»£è¡¨æ˜¯å¦å®Œæˆ</p>
</li>
<li class="lvl-2">
<p>Poll<T>: æšä¸¾ç±»å‹, ä½œä¸º poll çš„è¿”å›å€¼ç±»å‹, å…¶å˜ä½“æœ‰:<br>
<code>Poll::Pending</code>: æŒ‡æ˜è¯¥è®¡ç®—å¤„äºé˜»å¡, è°ƒåº¦ç¨‹åºåœ¨è¯¥è®¡ç®—é˜»å¡å®Œæ¯•å, ç»§ç»­è°ƒç”¨ poll(å› ä¸ºä¹‹åå¯èƒ½è¿˜ä¼šé˜»å¡)<br>
<code>Poll::Ready(T)</code>: æŒ‡æ˜è¯¥è®¡ç®—æ‰§è¡Œå®Œæ¯•, å¹¶äº§å‡ºä¸€ä¸ªç±»å‹ä¸º T çš„å€¼</p>
</li>
</ul>
<hr>
<h1 id="async">Async</h1>
<p>Rust ä¸ºæˆ‘ä»¬æä¾›äº†å…³é”®å­— async, æ–¹ä¾¿äººä»¬ä¸ºæŸæ¬¡è®¡ç®—å®ç° Future<br>
ä½ æƒ³ä¸€æƒ³, å®ç°äº† Future æœ¬èº«çš„ç±»å‹å¯ä»¥æ˜¯éšä¾¿æŸä¸ªç±»å‹, æ¯•ç«Ÿæˆ‘è¦çš„æ˜¯è®¡ç®—, è€Œä¸æ˜¯ç»“æ„ä½“å•Š<br>
async, ä¾¿æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªåŒ¿åç»“æ„ä½“å®ä¾‹, è‡ªåŠ¨ä¸ºè¯¥ç»“æ„ä½“å®ç° Future, å³, ç”¨æ¥åˆ›å»ºä¸€ä¸ª Future å®ä¾‹</p>
<p>æ¥ä¸ªä¾‹å­,çœ‹çœ‹ async çš„å¥½å¤„:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1 </span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_str_1</span></span>() -&gt; <span class="built_in">String</span> &#123; </span><br><span class="line">    <span class="built_in">String</span>::from(<span class="string">&quot;Hello! World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2 </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HelloStr</span></span>;</span><br><span class="line"><span class="keyword">impl</span> Future <span class="keyword">for</span> HelloStr &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Output</span></span> = <span class="built_in">String</span>;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">poll</span></span>(<span class="keyword">self</span>: Pin&lt;&amp;<span class="keyword">mut</span> <span class="keyword">Self</span>&gt;, _cx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) -&gt; Poll&lt;Self::Output&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="built_in">str</span> = <span class="built_in">String</span>::from(<span class="string">&quot;Hello! World!&quot;</span>);</span><br><span class="line">        Poll::Ready(<span class="built_in">str</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">hello_str_2</span></span>() -&gt; <span class="keyword">impl</span> Future&lt;Output = <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    HelloStr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥è§‚å¯Ÿåˆ°, ä½¿ç”¨ async è¿›è¡Œäº†ç¬¦åˆç›´è§‰çš„ç®€åŒ–, è¿™ä¸¤ç§å‡½æ•°,å®é™…ä¸Šæ˜¯ç­‰ä»·çš„<br>
çœ‹çœ‹å®ƒä»¬ä¸¤çš„è¿”å›å€¼:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_str_1</span></span>() -&gt; <span class="built_in">String</span> &#123; </span><br><span class="line">    <span class="built_in">String</span>::from(<span class="string">&quot;Hello! World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">hello_str_1() <span class="comment">// è¿”å›å€¼ä¸º `impl Future&lt;Output = String&gt;`</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">hello_str_2</span></span>() -&gt; <span class="keyword">impl</span> Future&lt;Output = <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">    HelloStr <span class="comment">// Future&lt;Output = String&gt; çš„å®ä¾‹</span></span><br><span class="line">&#125;</span><br><span class="line">hello_str_2() <span class="comment">// è¿”å›å€¼ä¸º `impl Future&lt;Output = String&gt;`  </span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„, å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨, åªæ˜¯è¿”å›ä¸€ä¸ª Futureå®ä¾‹<br>
ä½†å¹¶æ²¡æœ‰å¼€å§‹æ‰§è¡Œ, å®ƒæ˜¯æƒ°æ€§çš„, åªæœ‰è°ƒç”¨ Future çš„ poll æ–¹æ³•, æ‰èƒ½æ¨åŠ¨å®ƒçš„æ‰§è¡Œ, è€Œè°ƒç”¨ poll çš„å·¥ä½œ, åˆ™äº¤ç»™äº†è¿è¡Œæ—¶(æ‰§è¡Œå™¨), è€Œéç”¨æˆ·</p>
<p>è¿™æ ·çš„å¥½å¤„å°±åœ¨äº, å°†ä¸€æ¬¡å¼‚æ­¥è®¡ç®—å½“ä½œä¸€ä¸ªå˜é‡, æ–¹ä¾¿ä¼ å‚ç­‰å·¥ä½œ<br>
æ¯”å¦‚, æƒ³èˆå¼ƒæŸæ¬¡å¼‚æ­¥ä»»åŠ¡, åªéœ€å°†å¯¹åº”çš„ Future å®ä¾‹ç»™ drop æ‰, ä½¿å…¶æ‰€æœ‰æƒä¸¢å¤±å³å¯<br>
å¦‚æœä¸€æ—¦åˆ›å»º Future å®ä¾‹å°±ç«‹åˆ»æ‰§è¡Œ, å°±æ²¡æœ‰è¿™ä¹ˆæ–¹ä¾¿äº†</p>
<p>async çš„ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ª Future å®ä¾‹, ä»¥ä¸‹æ˜¯ä¸åŒçš„è¯­æ³•ç³–:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>async fn</code>: å¼‚æ­¥å‡½æ•°, è¦æ±‚è¿”å›ä¸€ä¸ª Future å®ä¾‹</p>
</li>
<li class="lvl-2">
<p><code>async block</code>: å¼‚æ­¥ä»£ç å—, åˆ›å»ºä¸€ä¸ª Future å®ä¾‹</p>
</li>
<li class="lvl-2">
<p><code>async closure</code>: å¼‚æ­¥é—­åŒ… (ç›®å‰æ˜¯ä¸ç¨³å®šç‰¹æ€§) åˆ›å»ºä¸€ä¸ª Future å®ä¾‹</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ä¸º `impl Future&lt;Output = String&gt;`</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello</span></span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// è¯¥ä»£ç å—åˆ›å»ºäº†ç±»å‹ä¸º `impl Future&lt;Output = i32&gt;` çš„å®ä¾‹</span></span><br><span class="line"><span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">1_i32</span>;</span><br><span class="line">    a</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// `async block` ä¹Ÿå¯ä»¥ä½¿ç”¨move  </span></span><br><span class="line"><span class="comment">// è·å¾—å…¶ä¸­ä½¿ç”¨çš„å˜é‡çš„æ‰€æœ‰æƒ  </span></span><br><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::new();</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">    &amp;s </span><br><span class="line">&#125;</span><br><span class="line">s; <span class="comment">// Error: use of moved value</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// é—­åŒ…å› ä¸ºä¸ç¨³å®š, æˆ‘ä¹Ÿæ‡’å¾—è®²äº†......</span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªFutureå®ä¾‹, æƒ³å¿…å¤§å®¶å·²ç»äº†è§£ä¸€äºŒ, ä½†å¦‚ä½•æ‰§è¡Œä¸€ä¸ªFutureå®ä¾‹?<br>
è¯·æ¥ç€å¾€ä¸‹çœ‹</p>
<hr>
<h1 id="zhi-xing">æ‰§è¡Œ</h1>
<h2 id="bei-jing-jie-shao" id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h2>
<p>Rustæœ¬èº«å¹¶ä¸æä¾› <code>å¼‚æ­¥è¿è¡Œæ—¶ (async runtime)</code>, ä»¥ä¾¿è¯­è¨€å†…æ ¸ç²¾å°, ä¾¿äºè¿›åŒ–/è¿­ä»£/ç»´æŠ¤<br>
ä»”ç»†çœ‹çœ‹ Future çš„å®Œæ•´è·¯å¾„, ä½ ä¼šæ³¨æ„åˆ°, å®ƒä¹Ÿå­˜åœ¨äºæ ¸å¿ƒåº“(core)ä¸­, è¿™æ„å‘³ç€, Rust ä¸€å®šå¯ä»¥æä¾› Future trait, å³ä½¿æ˜¯åµŒå…¥å¼ç­‰ç¯å¢ƒ</p>
<p>å¼‚æ­¥è¿è¡Œæ—¶, ç”±ç¤¾åŒºæä¾›, å›´ç»•è¯­è¨€æœ¬èº«æä¾›çš„å®šä¹‰ (å¦‚ Future) è¿›è¡Œæ‰©å……, æ¥æ”¯æŒå¼‚æ­¥ç¨‹åº<br>
å› æ­¤å®ƒæ˜¯å¯é€‰çš„, ä½ å¯ä»¥å‡­å€Ÿ <code>cartes.io</code> ä¸Šæä¾›çš„ç›¸å…³carte, åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒçš„è¿è¡Œæ—¶, å³ä½¿åœ¨åµŒå…¥å¼ç­‰ç¯å¢ƒ, ä¹Ÿèƒ½è½»æ¾è¿è¡Œå¼‚æ­¥ç¨‹åº</p>
<p>åœ¨å¼€å§‹ä¸‹é¢çš„ç« èŠ‚å‰, è¯·ç¡®ä¿ä½ å·²ç»åœ¨ <code>Cargo.toml</code> ä¸­æ·»åŠ äº†å¦‚ä¸‹ä»£ç <br>
ä»¥ <code>async-std</code> è¿™ä¸ªè™½ç„¶ä¸ä¸»æµ, ä½†å’Œæ ‡å‡†åº“çš„APIä¸€è‡´, å¯¹æ–°äººæ¯”è¾ƒå‹å¥½çš„ crate ä½œä¸ºä¾‹å­:</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">async-std</span> = &#123; version = <span class="string">&quot;1.9&quot;</span>, features = [<span class="string">&quot;attributes&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>
<h2 id="runtime" id="Runtime">Runtime</h2>
<p>æˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªæ‰“å° â€œhello worldâ€ çš„ Futureå§:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> async_std::task;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_world</span></span>() &#123; </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello wrold!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123; </span><br><span class="line">    <span class="keyword">let</span> fut = hello_world();</span><br><span class="line">    task::block_on(fut);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜è®°å¾—æˆ‘ä»¬æåˆ°è¿‡çš„ Task (å¼‚æ­¥ä»»åŠ¡, Top-level Future, å³é¡¶å±‚çš„å¼‚æ­¥è®¡ç®—) å—?<br>
<code>async_std::task</code> æä¾›äº†å¤§é‡ API, ç”¨æ¥æ‰§è¡Œ/æ“æ§è¿™äº› Task</p>
<p>å¦‚è¿™é‡Œå‡ºç°çš„<code>task::block_on</code>, ä¼ å…¥ä¸€ä¸ª Future, Runtime ä¼šæ‰§è¡Œå®ƒ(è°ƒç”¨ poll) å¹¶é˜»å¡è°ƒç”¨çº¿ç¨‹<br>
è¯¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åäº§å‡ºçš„å€¼,ä¼šä½œä¸º <code>block_on</code> çš„è¿”å›å€¼</p>
<p>æˆ‘ä»¬æ‰§è¡Œäº†ä¸€ä¸ª Task, ä¸”è¿™ä¸ª Task æ˜¯å•ä¸ªçš„ Future, ä½†è‹¥æˆ‘ä»¬æƒ³æ‰§è¡Œç”±å¤šä¸ª å­Future æ‰€ç»„æˆçš„ Task, åˆè¯¥æ€ä¹ˆåŠ?<br>
<code>.await</code> å…³é”®å­—å‡ºåœºäº†!</p>
<hr>
<h1 id="await">Await</h1>
<p><code>.await</code> åªèƒ½å‡ºç°åœ¨ <code>async fn/block</code> å†…éƒ¨, åœ¨æŸä¸ª Future å˜é‡åé¢æ·»åŠ  <code>.await</code> å, è¯¥ Future å°±ä¼šæ‰§è¡Œ<br>
ä½†æ˜¯, å®ƒåªæ˜¯è¡¨è¿°è¿™ä¹ˆä¸ªé€»è¾‘è€Œå·², å› ä¸ºRustè¯­è¨€æœ¬èº«æ²¡æœ‰å¼‚æ­¥è¿è¡Œæ—¶(æ— æ‰§è¡Œèƒ½åŠ›)<br>
çœŸæ­£æ‰§è¡Œçš„è¯, å¾—å°† Future äº¤ç»™è¿è¡Œæ—¶, å¸¦åŠ¨ç€æ‰§è¡Œé‡Œé¢çš„ å­Future</p>
<p>æ¥çœ‹çœ‹å®ƒçš„ä½¿ç”¨:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> async_std::task;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello</span></span>() &#123;  </span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;world!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello_world</span></span>() &#123; </span><br><span class="line">    hello().<span class="keyword">await</span>;</span><br><span class="line">    world().<span class="keyword">await</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123; </span><br><span class="line">    <span class="keyword">let</span> fut = hello_world();</span><br><span class="line">    task::block_on(fut);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>.await</code> æ˜¯ä¸€ä¸ªæ ‡è®°ç‚¹, å¯ç†è§£ä¸ºæ˜¯ä¸€ä¸ª <code>yield point</code>, Runtime æ‰§è¡Œåˆ° <code>xxx.await</code> æ—¶,å…ˆä¼šæ‰§è¡Œä¸€æ¬¡ <code>xxx</code></p>
<p>ä¸€å¼€å§‹ä¼šè°ƒç”¨ä¸€æ¬¡ poll, æ¨åŠ¨æ‰§è¡Œè¿›åº¦, é€šè¿‡å®ƒçš„è¿”å›å€¼, å³ <code>Poll::Pending</code> æˆ– <code>Poll::Ready(T)</code><br>
æ¥å†³å®šåšä»¥ä¸‹ä¸¤ä»¶äº‹ä¸­çš„å“ªä¸€ä»¶:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è®©å…¶ä»– Task æ¥ç®¡æ‰§è¡Œæƒ(yield)</p>
</li>
<li class="lvl-2">
<p>ç»§ç»­æ‰§è¡Œå½“å‰ Task</p>
</li>
</ul>
<p>è‹¥ä¸º<code>Pending</code>: åˆ™é€‰ç¬¬ä¸€ä¸ª, è®©å…¶ä»– Task æ¥ç®¡æ‰§è¡Œæƒ(å¦‚IOæ“ä½œçš„é˜»å¡æœŸé—´, è®©å…¶ä»– Task æ‰§è¡Œ)<br>
è‹¥ä¸º<code>Ready</code>: åˆ™é€‰ç¬¬äºŒä¸ª, ç»§ç»­å¾€ä¸‹æ‰§è¡Œ(ä¸€ä¸ª Task å¯èƒ½ç”±å¤šä¸ª å­Future ç»„æˆ)</p>
<p>å¯èƒ½æœ‰ç‚¹éš¾ç†è§£, æ¥ä¸ªç®€å•ç²—æš´ç†è§£ç‰ˆ:</p>
<p><code>.await</code> æŒ‡æ˜ <code>æ‰§è¡ŒæŸä¸ªFuture</code> è¿™ä¸€é€»è¾‘<br>
å½“ <code>xxx.await</code> æ‰€åœ¨çš„ Task äº¤ç»™ Runtime å¹¶å¹¶æ‰§è¡Œåˆ° <code>xxx.await</code> æ—¶, <code>xxx</code> è¿™ä¸ª Futureå®ä¾‹ ä¼šæ‰§è¡Œ</p>
<p>è‹¥å®ƒé˜»å¡(è¿™æ„å‘³ç€è¯¥ Future æ‰€åœ¨çš„ Task ä¹Ÿé˜»å¡), æ‰€ä»¥è°ƒåº¦ç¨‹åºå®‰æ’å…¶ä»– Task, åœ¨è¯¥ç©ºæ¡£æœŸæ‰§è¡Œ<br>
è‹¥ä¸é˜»å¡, å°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œ(å¯èƒ½è¿˜ä¼šç¢°è§ <code>.await</code> å“Ÿ), ç›´åˆ°è¯¥ Task ç»“æŸ</p>
<hr>
<h1 id="bu-chong">è¡¥å……</h1>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>#[async_std::main]</code><br>
è¿™ç©æ„æ˜¯ä¸ªå±æ€§å®, è¦åŠ åœ¨mainå‡½æ•°å¤´ä¸Š, ä½¿å¾— main å‰é¢èƒ½è¢« async æ‰€ä¿®é¥°<br>
ç¨‹åºè¿è¡Œæ—¶, main è¿”å›çš„Future, ä¼šè‡ªåŠ¨äº¤ç»™ Runtime å¼€å§‹è¿è¡Œ, å¦‚ä¸‹:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="meta">#[async_std::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    hello_world().<span class="keyword">await</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç­‰ä»·äº:</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    async_std::task::block_on( <span class="keyword">async</span> &#123;</span><br><span class="line">        hello_world().<span class="keyword">await</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>async_std::task::spawn</code><br>
å› ä¸ºè¿™ç©æ„ä¹Ÿå¾ˆå¸¸è§, å‘å…¶ä¼ å…¥ Future, Runtime ä¼šå¼€å§‹è¿è¡Œå®ƒ, å¹¶è¿”å› <code>async_std::task::JoinHandle</code> ç±»å‹çš„å®ä¾‹<br>
å®ƒå®ç°äº† Future, ä¸æ ‡å‡†åº“ä¸­çš„ <code>JoinHandle</code> æ— æ¯”ç›¸ä¼¼, ä¸è¿‡ <code>join</code> ç›¸åº”åœ°æ”¹å˜ä¸ºäº† <code>.await</code><br>
æƒ³è®©è¯¥ handle ä»£è¡¨çš„ Task è¿è¡Œå®Œæ¯•, åº”åœ¨è¯¥ handle å‰æ”¾ä¸Š <code>.await</code> è¿›è¡Œä¿®é¥°å“¦:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> async_std::task;</span><br><span class="line"><span class="meta">#[async_std::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123; </span><br><span class="line">    <span class="keyword">let</span> handle = task::spawn(<span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="number">1</span> + <span class="number">1</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> two:<span class="built_in">i32</span> = handle.<span class="keyword">await</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Async</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-async-p4~&gt; çŠ¶æ€çš„ä¿å­˜ä¸å˜æ¢</title>
    <url>/posts/rust-async/p4.html</url>
    <content><![CDATA[<blockquote>
<p>æµ…æ˜¾çš„åŸç†ç¬¬ä¸€ç¯‡: çŠ¶æ€çš„ä¿å­˜/å˜æ¢</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-async">rust-async</a></p>
<h1 id="kai-pian">å¼€ç¯‡</h1>
<p><strong>æ³¨</strong>: å‚è€ƒäº† &lt;&lt;Writing an OS in Rust&gt;&gt; ä¸­çš„ async ç¯‡,å¯ä»¥è‡ªå·±æœç´¢ä¸‹çœ‹çœ‹<br>
ä¸ºäº†æ›´å¥½åœ°ç†è§£ <code>Rustå¼‚æ­¥</code>èƒŒåçš„åŸç†, æˆ‘ä»¬å…ˆäº†è§£ä¸‹ä¸€äº›æ¦‚å¿µ, å½“ç„¶, åªæ˜¯å°è¡¥å……è€Œå·²:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¤šä»»åŠ¡: æŠ¢å å¼ä¸åä½œå¼</p>
</li>
<li class="lvl-2">
<p>çŠ¶æ€æœº</p>
</li>
<li class="lvl-2">
<p>è‡ªå¼•ç”¨ç»“æ„ä½“</p>
</li>
</ul>
<p>ç°åœ¨,è®©æˆ‘ä»¬å¼€å§‹å§!</p>
<hr>
<h1 id="liang-chong-duo-ren-wu">ä¸¤ç§å¤šä»»åŠ¡</h1>
<h2 id="jie-shao" id="ä»‹ç»">ä»‹ç»</h2>
<p>æŠ¢å å¼ ä¸ åä½œå¼, æ˜¯ å¤šä»»åŠ¡ çš„ä¸åŒåˆ†ç±»</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æŠ¢å å¼å¤šä»»åŠ¡:<br>
æ“ä½œç³»ç»Ÿå†³å®šCPUçš„è¿è¡Œæƒ<br>
æ¯”å¦‚, æ“ä½œç³»ç»Ÿå…ˆè®©ç½‘æ˜“äº‘éŸ³ä¹è¿è¡Œä¸€ä¼š, å†è®© VSCode è¿è¡Œä¸€ä¼š<br>
å„ä¸ªç¨‹åºä¸­çš„ä»»åŠ¡ä»¬, è¿è¡Œæ—¶é—´å¾ˆçŸ­, ä½†åˆ‡æ¢é€Ÿåº¦ä¹Ÿå¾ˆå¿«, é€ æˆä¸€ç§ä»»åŠ¡ä»¬åŒæ—¶è¿è¡Œçš„æ„Ÿè§‰<br>
è¿™æ˜¯å¼ºè¿«/æŠ¢å çš„</p>
</li>
<li class="lvl-2">
<p>åä½œå¼å¤šä»»åŠ¡:<br>
ä»»åŠ¡ä»¬æœ¬èº«è¿›è¡Œåè°ƒ, å†³å®šCPUçš„è¿è¡Œæƒ<br>
æ¯”å¦‚Rustä¸­, è¿è¡Œæ—¶è°ƒç”¨æŸ Task(top-level Future) çš„ poll é˜»å¡æ—¶, è¿”å› Poll::Pending<br>
è‡ªå·±æ”¾å¼ƒç»§ç»­æ‰§è¡Œ, å¹¶é€šçŸ¥è¿è¡Œæ—¶æ‰§è¡Œå…¶ä»–Task<br>
è¿™æ˜¯è‡ªæ„¿/åä½œçš„, Task ä»¬è‡ªæ„¿æ”¾å¼ƒCPUçš„æ‰§è¡Œæƒ</p>
</li>
</ul>
<h2 id="zhuang-tai-de-hui-fu-bao-cun" id="çŠ¶æ€çš„æ¢å¤-ä¿å­˜">çŠ¶æ€çš„æ¢å¤/ä¿å­˜</h2>
<p>æ—¢ç„¶ä»»åŠ¡ä»¬èƒ½äº’ç›¸åˆ‡æ¢æ‰§è¡Œ, é‚£ä¹ˆ, å½“å†æ¬¡è½®åˆ°æŸä»»åŠ¡æ‰§è¡Œæ—¶<br>
è¯¥ä»»åŠ¡,åº”å½“ä»å…ˆå‰æš‚åœçš„åœ°æ–¹å¼€å§‹, ç»§ç»­æ‰§è¡Œ<br>
å› æ­¤æˆ‘ä»¬åº”å½“å¤‡ä»½æŸä»»åŠ¡çš„å…ˆå‰çŠ¶æ€, ä»¥ä¾¿äºä¹‹åçš„ç»§ç»­æ‰§è¡Œ, è¿™å°±æ˜¯ çŠ¶æ€ä¿å­˜</p>
<p>å¯¹äº æŠ¢å å¼ ä¸ åä½œå¼, å¤„ç† çŠ¶æ€ä¿å­˜ çš„æ€è·¯æ˜¯ä¸ä¸€æ ·çš„:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æŠ¢å å¼:<br>
å› ä¸ºæ˜¯å¼ºè¿«åˆ‡æ¢æ‰§è¡Œçš„, ä»»åŠ¡ä¼šåœ¨ä»»æ„æŸä¸ªæ—¶åˆ»è¢«ä¸­æ–­<br>
ä»»åŠ¡æ­¤æ—¶è¿è¡Œåˆ°äº†å“ªé‡Œ?æˆ‘ä»¬ä¸çŸ¥é“å•Š!<br>
é‚£ä¹ˆ, å°±åªå¥½å°†ä»»åŠ¡çš„æ‰€æœ‰çŠ¶æ€å…¨éƒ¨ä¿å­˜, åŒ…æ‹¬è°ƒç”¨æ ˆ(call stack)</p>
</li>
</ul>
<p>åæ­£, ä½ åªéœ€æ˜ç™½, æ“ä½œç³»ç»Ÿå¼ºåˆ¶åˆ‡æ¢ä»»åŠ¡, ä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ç›¸å¯¹å…¬å¹³çš„æ‰§è¡Œæ—¶é—´<br>
ä½†æ˜¯, ä»£ä»·ä¹Ÿæœ‰, æ¯”å¦‚ä¸å¾—ä¸ä¸ºæ¯ä¸ªä»»åŠ¡ä¿å­˜å®ƒçš„æ‰€æœ‰çŠ¶æ€, å†…å­˜å¼€é”€å¤§</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åä½œå¼:<br>
å› ä¸ºæ˜¯è‡ªæ„¿/åä½œåœ°åˆ‡æ¢æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä¼šåœ¨å“ªé‡Œæ”¾å¼ƒæ‰§è¡Œéƒ½æ˜¯æ¸…æ¥šçš„<br>
è¿™ç§æ”¾å¼ƒæ‰§è¡Œæƒçš„æ“ä½œ, æˆ‘ä»¬ç§°ä¸º<code>yield</code></p>
</li>
</ul>
<p>æ¯”å¦‚åœ¨Rustä¸­, <code>xxx.await</code>ä¼šæ‰§è¡Œä¸€ä¸ªFuture  	<br>
æ„å‘³ç€å½“ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œæ—¶, å¯èƒ½ä¼š<code>yield</code>(pollè¿”å›Poll::Pending, è‡ªæ„¿æ”¾å¼ƒæ‰§è¡Œæƒ)</p>
<p><code>xxx.await</code>å°±æ˜¯ä¸€ä¸ª<code>stop/yield point</code>, ä»£è¡¨æ‰§è¡Œåˆ°æ­¤å¤„æ—¶, å¯èƒ½ä¼šå‘ç”Ÿæš‚åœå¹¶yield<br>
ç§, æ‰€æœ‰å¯èƒ½yieldçš„åœ°æ–¹ä½ éƒ½çŸ¥é“, è¿™å°±æ–¹ä¾¿äº†ä¿å­˜çŠ¶æ€(ä½ å¯ä»¥èˆå¼ƒå·²ç»ä¸éœ€è¦çš„ä¸­é—´å˜é‡)<br>
å› æ­¤, æˆ‘ä»¬å¯ä»¥å‡†ç¡®åˆ†é…Futureæ‰§è¡Œæ‰€éœ€è¦çš„æœ€å¤§ç©ºé—´</p>
<p>å…¶å®, æ¯ä¸ª<code>.await(ä¹Ÿå°±æ˜¯yield point)</code>, å°±ä»£è¡¨ç€<code>ä¸€ç§çŠ¶æ€</code>(ä¹‹åä¼šè®²)</p>
<p>åä½œå¼çš„å¥½å¤„åœ¨äº:<br>
èƒ½è‡ªå·±æŒæ¡æ‰€æœ‰<code>yield point</code>, ä»è€Œç²¾æ‰“ç»†ç®—åœ°é€‰æ‹©æœ€ä¼˜çš„ç­–ç•¥,  è€Œéè®©æ“ä½œç³»ç»Ÿä¸ºä½ æš—åœ°é‡Œå¤„ç†<br>
æ¯•ç«Ÿæœºå™¨å®šä¹‰çš„åˆ†é…ç­–ç•¥,  æ€»æ˜¯æ²¡æœ‰æ¯”ä¸è¿‡æˆ‘ä»¬ç‰¹æ„è®¾è®¡çš„<br>
åœ¨ä»»åŠ¡æš‚åœå¹¶è½¬è®©æ‰§è¡Œæƒå‰, å‡†ç¡®ä¿å­˜<code>ä¸‹æ¬¡ç»§ç»­æ‰€éœ€è¦çš„çŠ¶æ€</code>, å†…å­˜/æ€§èƒ½ä¼˜åŠ¿å¾ˆå¤§<br>
ä½†åå¤„ä¹Ÿæœ‰: å› ä¸ºè¿™æ˜¯è‡ªæ„¿/åä½œçš„, å½“æŸä¸ªä»»åŠ¡å‡ºç°Bug, æ°¸ä¸æ”¾å¼ƒæ‰§è¡Œæƒ, å…¶ä»–ä»»åŠ¡ä¾¿æ— æ³•æ‰§è¡Œ</p>
<hr>
<h1 id="zhuang-tai-ji-de-gai-nian">çŠ¶æ€æœºçš„æ¦‚å¿µ</h1>
<p>åœ¨Rustä¸­çš„å¼‚æ­¥, æˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´è¿‡, å±äº<code>åä½œå¼å¤šä»»åŠ¡</code><br>
è€Œå…¶<code>çŠ¶æ€ä¿å­˜</code>çš„å®ç°, å°±æ˜¯åˆ©ç”¨<code>çŠ¶æ€æœº(state machine)</code>æ¥å®ç°</p>
<p><code>çŠ¶æ€æœº(state machine)</code>ä¸€èˆ¬æŒ‡<code>æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº</code>, æ˜¯ä¸€ç§æ•°å­¦æ¨¡å‹</p>
<ol>
<li class="lvl-3">
<p>çŠ¶æ€(state):<br>
æ¯”å¦‚æœ‰ä¸€æ‰‡é—¨, å®ƒçš„çŠ¶æ€å°±å¤„äºä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€: Open or Closed</p>
</li>
<li class="lvl-3">
<p>äº‹ä»¶(event):<br>
æŸäº‹ä»¶å‘ç”Ÿå, ä¼šè§¦å‘ç›¸åº”åŠ¨ä½œ, å¯èƒ½æ”¹å˜çŠ¶æ€<br>
æ¯”å¦‚: ç”¨é’¥åŒ™é”é—¨(event)=&gt;å…³é—¨(action)=&gt;é—¨è¢«é”ä½(state)</p>
</li>
<li class="lvl-3">
<p>åŠ¨ä½œ (action):<br>
äº‹ä»¶å‘ç”Ÿå, ä¼šè§¦å‘åŠ¨ä½œ</p>
</li>
<li class="lvl-3">
<p>å˜æ¢ (transition):<br>
<code>State_X=&gt;State_Y</code>å°±å«<code>å˜æ¢</code>, æ¯”å¦‚é—¨çš„çŠ¶æ€ä»<code>Open=&gt;Closed</code></p>
</li>
</ol>
<p>ç¨å¾®äº†è§£ä¸‹<code>çŠ¶æ€æœº</code>çš„æ¦‚å¿µå³å¯</p>
<p>é‚£ä¹ˆç°åœ¨, å°±è¦çœ‹å…·ä½“ä»£ç äº†</p>
<p>å¦‚æœä½ æƒ³äº²è‡ªè¿è¡Œä¸€ä¸‹, å…ˆç¡®ä¿ä½ çš„<code>Cargo.toml</code>ä¸­çš„ä¾èµ–å¦‚ä¸‹:</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">async-std</span> = &#123;version = <span class="string">&quot;1&quot;</span>, features = [<span class="string">&quot;attributes&quot;</span>, <span class="string">&quot;unstable&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹ä»£ç , è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„è¡Œæ•°<br>
ä½ å¯ä»¥é€šè¿‡ <code>cargo run -- ./src/main.rs</code> è¿è¡Œ<br>
(é€šè¿‡targetç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶, åŠ ä¸Šå‚æ•°åè¿è¡Œ, ä¹Ÿå¯ä»¥å“¦)</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;</span><br><span class="line">    env::args,</span><br><span class="line">    process,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> async_std::&#123;</span><br><span class="line">    prelude::*,</span><br><span class="line">    fs::File,</span><br><span class="line">    io::&#123;<span class="keyword">self</span>,BufReader&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#[async_std::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; io::<span class="built_in">Result</span>&lt;()&gt; &#123;              <span class="comment">// Start</span></span><br><span class="line">    <span class="keyword">let</span> path = args().nth(<span class="number">1</span>).unwrap_or_else(||&#123;</span><br><span class="line">        eprintln!(<span class="string">&quot;Fuck you! No path for reading&quot;</span>);</span><br><span class="line">        process::exit(<span class="number">1</span>);</span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="keyword">let</span> file = File::open(path).<span class="keyword">await</span>?;          <span class="comment">// Yield point</span></span><br><span class="line">    <span class="keyword">let</span> lines = BufReader::new(file).lines();</span><br><span class="line">    <span class="keyword">let</span> count = lines.count().<span class="keyword">await</span>;             <span class="comment">// Yield point</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;This file contains &#123;&#125; lines&quot;</span>,count);</span><br><span class="line">    <span class="literal">Ok</span>(())</span><br><span class="line">&#125;                                                <span class="comment">// Done</span></span><br></pre></td></tr></table></figure>
<p>mian()äº§ç”Ÿä¸€ä¸ªæ–°å®ä¾‹, å¼‚æ­¥è¿è¡Œ<code>open(path)</code>ä¸<code>count()</code>  	<br>
å¯¹äºç¼–è¯‘å™¨, æ¯ä¸€ä¸ª<code>.await</code>å…¶å®éƒ½ä»£è¡¨ä¸€ç§çŠ¶æ€</p>
<p>Futureå®ä¾‹, å®é™…ä¸Šæ˜¯ä¸ªçŠ¶æ€æœº<br>
åœ¨è¿™é‡Œå…±æœ‰å››ç§çŠ¶æ€/é˜¶æ®µ(å…¶ä¸­åŒ…æ‹¬ä¸¤ä¸ª<code>.await point(yield point)</code>):</p>
<ol>
<li class="lvl-3">
<p>Start: æ­¤Futureåˆšå¼€å§‹æ‰§è¡Œ</p>
</li>
<li class="lvl-3">
<p>Yield1: ç¬¬ä¸€ä¸ª yield point</p>
</li>
<li class="lvl-3">
<p>Yield2: ç¬¬äºŒä¸ª yield point</p>
</li>
<li class="lvl-3">
<p>Done: æ­¤Futureæ‰§è¡Œå®Œæ¯•</p>
</li>
</ol>
<p>è¿™äº›çŠ¶æ€çš„å«ä¹‰æ˜¯: <code>è¡¨ç¤ºå½“å‰Futureæ‰§è¡Œåˆ°äº†å“ªä¸€ä¸ªé˜¶æ®µ</code><br>
æ‰§è¡Œå™¨è°ƒç”¨å½“å‰Futureçš„pollæ¨åŠ¨è¿›åº¦æ—¶, è‹¥åœ¨<code>æŸä¸€é˜¶æ®µ</code>è¿”å›äº†<code>Poll::Pending</code>, åˆ™æ”¾å¼ƒæ‰§è¡Œæƒ<br>
å½“å†æ¬¡è°ƒç”¨å½“å‰Futureçš„pollæ¨åŠ¨è¿›åº¦æ—¶, åˆ™ä»ä¸Šæ¬¡æš‚åœçš„çŠ¶æ€<code>æ¢å¤(resume)</code>, ç»§ç»­æ‰§è¡Œ</p>
<p>å®˜æ–¹ç›®å‰ä¼¼ä¹é‡‡ç”¨<code>Generator(ç”Ÿæˆå™¨)</code>ä¸ºå¼‚æ­¥è¯­æ³•ç”ŸæˆçŠ¶æ€æœº, æ¯ä¸ªçŠ¶æ€éƒ½ä¼šå­˜å‚¨ä¸€äº›æ•°æ®,  ä¾¿äºè¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€</p>
<p><strong>Note 1</strong>:<br>
StartçŠ¶æ€, ä¼šå­˜å‚¨ä¼ å…¥å‡½æ•°çš„å‚æ•°(å¦‚æœæœ‰å‚æ•°)</p>
<p><strong>Note 2</strong>:<br>
DoneçŠ¶æ€ä¸‹, è‹¥è¿›è¡Œresume, åˆ™å¯èƒ½å¾—åˆ°panic! å› ä¸ºæ¢å¤å·²ç»“æŸçš„è®¡ç®—æ˜¯ä¸å¯èƒ½,  ä¹Ÿä¸åº”è¯¥çš„</p>
<p><strong>Note 3</strong>:<br>
æ€ä¹ˆåˆ¤æ–­æ¯ä¸ªçŠ¶æ€éœ€è¦ä¿å­˜å“ªäº›å˜é‡? å¾ˆç®€å•çš„ä¸€å¥è¯:<br>
<code>æŸä¸ªyield pointä¹‹å‰å®šä¹‰,  ä¸”pointä¹‹åè¿˜éœ€è¦ä½¿ç”¨çš„å˜é‡</code><br>
å¦‚ä¸Šæ®µä»£ç ä¸­çš„ <code>file</code> ä¸ <code>count</code>å°±éœ€è¦è¢«ä¿å­˜, å› ä¸ºä»æš‚åœä¸­æ¢å¤åè¿˜éœ€è¦ä½¿ç”¨<br>
å…¶ä»–çš„å˜é‡, æ˜¯ä¸€æ¬¡æ€§æ‰§è¡Œå®Œçš„, ä¸ä¼šå‡ºç°ä»€ä¹ˆæš‚åœä¸€ä¸‹, ç­‰ä¼šç»§ç»­çš„ç°è±¡<br>
æ‰€ä»¥ä¸éœ€è¦ç‰¹æ®Šçš„æŒä¹…åŒ–æ“ä½œ</p>
<hr>
<h1 id="zi-yin-yong-jie-gou-ti">è‡ªå¼•ç”¨ç»“æ„ä½“</h1>
<h2 id="bao-cun-yin-yong" id="ä¿å­˜å¼•ç”¨">ä¿å­˜å¼•ç”¨</h2>
<p>å½“æ¯ä¸ªçŠ¶æ€å­˜å‚¨æ•°æ®æ—¶,  å¯èƒ½ä¼šå¯¼è‡´å‘ç”Ÿ<code>è‡ªå¼•ç”¨</code>, æ¯”å¦‚:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">example</span></span>() -&gt; <span class="built_in">i32</span> &#123;                            <span class="comment">// Start</span></span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> element = &amp;arr[<span class="number">2</span>];</span><br><span class="line">    write_file(<span class="string">&quot;foo.txt&quot;</span>, element.to_string()).<span class="keyword">await</span>;  <span class="comment">// Yield1</span></span><br><span class="line">    *element                                           <span class="comment">// Done</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸‰ä¸ªçŠ¶æ€: <code>Start</code>, <code>Yield1</code>, <code>Done</code>, è€Œåœ¨<code>Yield1</code>è¿™ä¸ªçŠ¶æ€ä¸‹, å­˜å‚¨çš„æ•°æ®å¦‚ä¸‹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çŠ¶æ€çš„å®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Yield1State</span></span> &#123;</span><br><span class="line">    arr: [<span class="built_in">i32</span>; <span class="number">3</span>], </span><br><span class="line">    element: *<span class="keyword">const</span> <span class="built_in">i32</span>, <span class="comment">// æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çŠ¶æ€çš„å®ä¾‹</span></span><br><span class="line">Yield1State &#123;</span><br><span class="line">    arr: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    element: &amp;arr[<span class="number">2</span>] <span class="keyword">as</span> *<span class="keyword">const</span> <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç­‰ç­‰, ä½ å¯èƒ½ä¼šå¯¹ä¸Šé¢çš„ä»£ç æœ‰ç–‘æƒ‘:<br>
ä¸æ˜¯è¯´, çŠ¶æ€åªéœ€è¦ä¿å­˜ <code>åœ¨yield pointä¹‹å‰å®šä¹‰,  å¹¶ä¸”è¯¥pointä¹‹åè¿˜éœ€è¦ä½¿ç”¨çš„å˜é‡</code> å—<br>
ä¸Šé¢çš„ä»£ç , åªæœ‰elementè¿™ä¸ªå¼•ç”¨éœ€è¦è¢«ä¿å­˜å§?</p>
<p>è¿™æ˜¯å› ä¸º, å®ƒæ˜¯<code>å¼•ç”¨</code>å˜›! æ²¡äº†<code>å¼•ç”¨</code>èƒŒåçš„å®é™…æ•°æ®, é‚£å®ƒè¿˜æœ‰å•¥ç”¨, ä¸å°±æ˜¯<code>æ‚¬å‚å¼•ç”¨</code>äº†å—?<br>
å› æ­¤æˆ‘ä»¬è¿˜å¾—ä¿å­˜, <code>è¯¥å¼•ç”¨</code>æŒ‡å‘çš„èƒŒåæ•°æ®: <code>arr</code>, å¹¶<strong>ä¸€èµ·</strong>å­˜å‚¨åœ¨åŒä¸ª<code>struct(ä»£è¡¨åŒä¸€çŠ¶æ€)</code>ä¸­<br>
åƒè¿™ç§ <code>ç»“æ„ä½“å†…éƒ¨çš„æŒ‡é’ˆ, æŒ‡å‘ç»“æ„ä½“æœ¬èº«</code>, å°±å« <code>è‡ªå¼•ç”¨ç»“æ„</code></p>
<p>æ¯”å¦‚ä¸Šé¢ä»£ç : åŒä¸€ç»“æ„ä½“ä¸‹, æˆå‘˜elementæŒ‡å‘äº†æˆå‘˜arr</p>
<h2 id="nei-cun-yi-dong-wen-ti" id="å†…å­˜ç§»åŠ¨é—®é¢˜">å†…å­˜ç§»åŠ¨é—®é¢˜</h2>
<p>å¦‚ä¸Šæ‰€è¿°,  è¿™å¯èƒ½å¯¼è‡´æ‚¬å‚å¼•ç”¨çš„äº§ç”Ÿ, è‹¥è¯¥structå®ä¾‹çš„<code>å†…å­˜åœ°å€å‘ç”Ÿæ”¹å˜</code>, å¦‚ä½¿ç”¨ <code>std::mem</code>, è®©structå®ä¾‹çš„å†…å­˜åœ°å€å‘ç”Ÿç§»åŠ¨<br>
ä»¥ä¸Šé¢çš„é‚£æ®µä»£ç ä¸ºä¾‹, å¦‚ä¸‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>arr:<br>
å†…å­˜åœ°å€ä¼šè·Ÿç€ç»“æ„ä½“å®ä¾‹è€Œæ”¹å˜, ä½†æ˜¯,  <code>å€¼ä»ç„¶æ˜¯ [1, 2, 3]</code></p>
</li>
<li class="lvl-2">
<p>element:<br>
å†…å­˜åœ°å€ä¼šè·Ÿç€ç»“æ„ä½“å®ä¾‹è€Œæ”¹å˜, ä½†æ˜¯, å€¼ä»ç„¶æ˜¯<code>å…ˆå‰arrçš„åœ°å€</code>, <code>æ³¨æ„, æ˜¯å…ˆå‰çš„ ! è€Œä¸æ˜¯åæ¥arrçš„æ–°åœ°å€</code></p>
</li>
</ul>
<p>è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜: å¼•ç”¨å¯èƒ½æ˜¯å¤±æ•ˆ/é”™è¯¯çš„(æ‚¬å‚å¼•ç”¨)<br>
å®˜æ–¹æå‡ºäº†<code>std::pin::Pin(trait)</code> æ¥è§£å†³è‡ªå¼•ç”¨ç»“æ„ä½“æ–¹é¢çš„æ‚¬å‚æŒ‡é’ˆ/å¼•ç”¨é—®é¢˜</p>
<p>å…¶å®ä½ å¬åå­—ä¹Ÿå¾ˆå¥½ç†è§£, <code>Pin(ä¸­æ–‡æ„æ€æ˜¯é’‰å­)</code>çš„ä½œç”¨æ˜¯, é˜²æ­¢å†…å­˜åœ°å€å‘ç”Ÿæ”¹å˜(ç»™çˆ·é’‰æ­»å§!)<br>
ä½†æ˜¯å®ƒåˆæ˜¯æ€ä¹ˆpinä½çš„å‘¢? ä¸‹ä¸€èŠ‚å†æ…¢æ…¢è®²å§, é‚£åˆæ˜¯ä¸€ä¸ªå€¼å¾—æ¢è®¨çš„è¯é¢˜äº†</p>
<p>æ¬²çŸ¥åäº‹å¦‚ä½•,  ä¸”å¬ä¸‹å›åˆ†è§£<br>
<s>(ç–¯ç‹‚çœç•¥,  å› ä¸ºæˆ‘ç´¯æ­»äº†, å¤šä¹ˆå¸Œæœ›èµ¶ç´§ç»“æŸè¿™ä¸€På•Š ! !)</s></p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>Async</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-tui-p1~&gt; ç³»åˆ—è¯´æ˜</title>
    <url>/posts/rust-tui/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ TUI ç³»åˆ—</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-tui">rust-tui</a></p>
<h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1>
<p>æœ¬ç³»åˆ—ä¼šä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <code>TUI(Text-based User Interface)</code><br>
å½“ç„¶, è¿˜ä¼šä»‹ç»Rustä¸­çš„ä¸¤ä¸ªcrate: <code>tui</code> &amp;&amp; <code>crossterm</code></p>
<hr>
<h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1>
<ol>
<li class="lvl-3">
<p>åšå®¢:</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://monkeypatch.io/blog/2021/2021-05-31-rust-tui/">Playing with tui-rs</a></p>
</li>
<li class="lvl-2">
<p><a href="https://blog.logrocket.com/rust-and-tui-building-a-command-line-interface-in-rust/">Building a command-line interface in Rust</a></p>
</li>
</ul>
<ol start="2">
<li class="lvl-3">
<p>æ–‡æ¡£:</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://docs.rs/tui/latest/tui/">tui-rs</a></p>
</li>
<li class="lvl-2">
<p><a href="https://docs.rs/crossterm/latest/crossterm/">crossterm</a></p>
</li>
</ul>
<hr>
<h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1>
<p>å‘ç°é”™è¯¯çš„è¯, è¯·åŠæ—¶è·Ÿæˆ‘è”ç³»<br>
ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p>
<p>æœ€å, è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>TUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p1~&gt; ç³»åˆ—è¯´æ˜</title>
    <url>/posts/rust-gtk4/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æ¬¢è¿å¤§å®¶æ¥åˆ° Rust çš„ gkt-rs ç³»åˆ—</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
<h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1>
<p><a href="https://www.gtk.org/">Gtk</a>, æ˜¯ä¸€ä¸ªè‘—åçš„GUIåº“, æ˜¯ GNOME é¡¹ç›®çš„å…³é”®ç»„æˆ, ç”±äºæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™, å„ç±»è¯­è¨€éƒ½èƒ½ä½¿ç”¨å®ƒå¼€å‘GUIç¨‹åº</p>
<p>Rustè¯­è¨€è‡ªæ˜¯å…¶ä¸­ä¹‹ä¸€, å…·æœ‰ç›¸å…³çš„ç»‘å®šåº“: <a href="https://gtk-rs.org/">gtk-rs</a> (gtkå®˜æ–¹ç½‘é¡µæ‰€æŒ‡å®š)<br>
åŒæ—¶, éå¸¸å»ºè®®ä½ ä½¿ç”¨Linuxä½œä¸ºå¼€å‘ç¯å¢ƒ, Gtkå¯ä»¥è¯´æ˜¯Linuxå¹³å°ä¸‹å¼€å‘GUIç¨‹åºçš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€äº†</p>
<p>ä¸å®šæœŸæ›´æ–°, æ¯•ç«Ÿæˆ‘åªæœ‰å‘¨æœ«æ‰èƒ½ç¢°åˆ°ç”µè„‘<br>
<s>(è€Œä¸”, ç©ºæ´éª‘å£«, CSGO, è€æ»š5, å·«å¸ˆ3, äººç±»ä¸€è´¥æ¶‚åœ°å®ƒä»¬ä¸é¦™å—?)</s></p>
<hr>
<h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1>
<p>èµ„æ–™æ­£åœ¨æŒç»­æ›´æ–°ing. . .</p>
<ol>
<li class="lvl-3">
<p>ä¹¦ç±</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://gtk-rs.org/gtk4-rs/stable/latest/book/">GUI development with Rust and GTK 4</a> (å®˜æ–¹ä¹¦ç±)</p>
</li>
<li class="lvl-2">
<p><a href="https://toshiocp.github.io/Gtk4-tutorial/">Gtk4 Tutorial</a> (ç”±ç¤¾åŒºç¼–å†™çš„gtk4æ•™å­¦ä¹¦ç±)</p>
</li>
</ul>
<ol start="2">
<li class="lvl-3">
<p>åšå®¢/æ–‡æ¡£</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://turbomack.github.io/posts/2019-07-28-rust-vs-gui.html">Rust Vs GUI</a></p>
</li>
<li class="lvl-2">
<p><a href="https://gi.readthedocs.io/en/latest/#gobject-introspection">GObject Introspection</a></p>
</li>
<li class="lvl-2">
<p><a href="https://developer.gnome.org/documentation/tutorials.html">GNOME Developer Doc/Tutorials</a></p>
</li>
</ul>
<hr>
<h1 id="huan-jing-pei-zhi">ç¯å¢ƒé…ç½®</h1>
<p>é¦–å…ˆè¯·å‚ç…§ <a href="https://www.gtk.org/docs/installations/">GTKå®˜æ–¹é¡µé¢</a> , ä¸‹è½½ GTK4, ä¸‹é¢æ˜¯æˆ‘ä¸ºäº†æ–¹ä¾¿è¯»è€…, å¤åˆ¶ç²˜è´´è¿‡æ¥çš„:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Fedora, åŠå…¶è¡ç”Ÿ:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dnf install gtk4-devel gcc libadwaita-devel</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>Debian, åŠå…¶è¡ç”Ÿ:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install libgtk-4-dev build-essential libadwaita-1-dev</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>Arch, åŠå…¶è¡ç”Ÿ:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S gtk4 base-devel libadwaita</span><br></pre></td></tr></table></figure>
<p>Windowsç³»ç»Ÿä¸‹, å»ºè®®ä½¿ç”¨WSL2, åœ¨Linuxç¯å¢ƒä¸‹å¼€å‘, äº²æµ‹å¯ä»¥åšGUI, è™½ç„¶ç›®å‰è¿˜æœ‰è­¦å‘Š <s>(æ— è§†å³å¯)</s><br>
æ¯”å¦‚, ä½¿ç”¨ Arch ä½œä¸º WSL2, é‚£ä¹ˆå¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•, ç›´æ¥å®‰è£…å³å¯</p>
<p>è¯·è‡ªå·±æŸ¥æ‰¾èµ„æ–™, å–„ç”¨æœç´¢å¼•æ“ä¸å®˜æ–¹æ–‡æ¡£, é…ç½®Gtk</p>
<hr>
<h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1>
<p>å‘ç°é”™è¯¯çš„è¯, è¯·åŠæ—¶è·Ÿæˆ‘è”ç³», æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>
ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p>
<p>æœ€å, è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p2~&gt; åˆ›å»ºçª—å£</title>
    <url>/posts/rust-gtk4/p2.html</url>
    <content><![CDATA[<blockquote>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ Gtk åˆ›å»ºçª—å£, äº†è§£ä¸‹ app_id, æ„é€ è€…æ¨¡å¼, ä¿¡å·é‡, handler ç­‰æ¦‚å¿µå§</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
<h1 id="bei-jing-liao-jie">èƒŒæ™¯äº†è§£</h1>
<h2 id="gtk" id="GTK">GTK</h2>
<p>GTK, ç®€å•æ¥è¯´æ˜¯ä¸ªæœ‰åçš„GUIåº“, å¼€æºå…è´¹, ç”¨Cç¼–å†™<br>
åœ¨gtk3å, ç”±äºGI(<a href="https://gi.readthedocs.io/en/latest/">GObject Introspection</a>) çš„åº”ç”¨, å¯ä»¥è½»æ¾åœ°, åˆ›å»ºå…¶ä»–è¯­è¨€çš„ç»‘å®š<br>
è¿™ä½¿ä½ èƒ½åˆ©ç”¨ä¸åŒè¯­è¨€ç¼–å†™GUI, æ¯”å¦‚Rust, Nim, Vala, Python, Javascriptâ€¦ <s>(ä¸ä¼šçœŸçš„æœ‰äººç”¨Cè¯­è¨€å†™Gtkå§?)</s></p>
<p>åŸºæœ¬ä¸Šåæ°”ç¨å¾®å¤§ç‚¹çš„è¯­è¨€, éƒ½æœ‰å¯¹åº”çš„GTKç»‘å®š</p>
<h2 id="gtk-rs" id="gtk-rs">gtk-rs</h2>
<p>ç›®å‰æœ‰ä¸ªé¡¹ç›®, å«åš <a href="https://gtk-rs.org/">gtk-rs</a>, è´Ÿè´£GTKçš„Rustç»‘å®š, åœ¨ <a href="https://crates.io/">crates.io</a> ä¸Šæœç´¢ gtk, æ‰€çœ‹åˆ°çš„ <a href="https://crates.io/crates/gtk">gtk</a> ä¸ <a href="https://crates.io/crates/gtk4">gtk4</a>, å°±å±äºgtk-rs</p>
<p>gtk4è¿™ä¸ªcrate, æ˜¯Rustè¯­è¨€çš„ç»‘å®š, è€ŒéåŒçº¯Cç¼–å†™çš„é‚£ä¸ªgtk4æœ¬èº«<br>
æ‰€ä»¥è¿›è¡Œæ¥ä¸‹æ¥çš„æ­¥éª¤å‰, è¯·ç¡®ä¿ç¯å¢ƒå†…, å·²æœ‰gtk4æœ¬èº«çš„æ­£ç¡®ç‰ˆæœ¬, ä¸ç„¶crateä¼šè£…ä¸ä¸Š</p>
<hr>
<h1 id="xiang-mu-pei-zhi">é¡¹ç›®é…ç½®</h1>
<p>é¦–å…ˆ, ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®, éšåä¿®æ”¹ Cargo.toml, è¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line">cargo add gtk4@0.5.2 --rename gtk</span><br><span class="line">cargo add libadwaita@0.2 --rename adw</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°† gtk4(crate), é‡å‘½åä¸º gtk, æ–¹ä¾¿ä¹‹åç¼–å†™, éšå, è¯·runä¸€ä¸‹, å®‰è£…ä¾èµ– (è¯·ç¡®ä¿å®‰è£…äº†gtk4/libadwaita, å¦‚ <a href="/posts/rust-gtk4/p1">p1</a> ä¸­æ‰€è¿°)<br>
(adw è¿™ä¸ªåº“ä¹‹åä¼šæçš„, ç°åœ¨å…ˆå¿½ç•¥æ‰å³å¯)<br>
ä¸‹é¢å°±æ˜¯æ­£å¼çš„ç¼–ç ç¯èŠ‚äº†</p>
<hr>
<h1 id="jia-su-bian-yi">åŠ é€Ÿç¼–è¯‘</h1>
<p>æœ‰ä¸ªéå¸¸å¿«é€Ÿçš„åä¸º <a href="https://github.com/rui314/mold">mold (github.com/rui314/mold)</a> çš„é“¾æ¥å™¨, éå¸¸é€‚åˆåŠ é€Ÿ gtk é¡¹ç›®çš„ç¼–è¯‘, ä»¥ä¾¿å¿«é€Ÿè°ƒè¯•<br>
ç›´æ¥ç”¨ä½ çš„åŒ…ç®¡ç†å™¨ä¸‹è½½ <code>mold</code>, æˆ–è€…æ ¹æ® github çš„æŒ‡ç¤ºè·å–, éšååƒä¸‹é¢è¿™æ ·ç®€å•çš„æ·»åŠ å‰ç¼€å³å¯:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">mold -run cargo run</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="ji-chu-zhi-shi">åŸºç¡€çŸ¥è¯†</h1>
<p>ä¸€ä¸ªGTK4åº”ç”¨çš„åˆ›å»º, éœ€è¦ç”¨åˆ° <code>gtk::Application</code><br>
åŒæ—¶è¿˜éœ€ <code>use gtk::prelude::*</code>, åŸå› ä¸ <a href="https://doc.rust-lang.org/std/prelude/index.html">std::prelude</a> ä¸€æ ·</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨, å®ƒç›®å‰è¿çª—å£ä¹Ÿæ²¡æœ‰:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆç®€å•å§? ä½†åˆ«æ€¥ç€è¿è¡Œ, å…ˆçœ‹çœ‹ä¸‹é¢ä¸¤å¤„:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://developer.gnome.org/documentation/tutorials/application-id.html">application_id</a>:<br>
æ¯ä¸ªGTKåº”ç”¨, éƒ½å¸¦æœ‰ä¸€ä¸ªid, å³ <code>application_id</code>, å®ƒå¿…é¡»æ˜¯å…¨ä¸–ç•Œå”¯ä¸€çš„, ä¸€èˆ¬ä½¿ç”¨ååŸŸåä½œä¸ºid, å¦‚ â€œorg.gnome.geditâ€<br>
<code>app_id</code> ä½œä¸ºAppçš„å”¯ä¸€æ ‡è¯†ç¬¦, ç”¨äºAppä¹‹é—´çš„é€šä¿¡ä¸è¯†åˆ«, å› æ­¤è¦æ…é‡è€ƒè™‘, æœ€å¥½ç¬¬ä¸€æ¬¡å°±å®šå¥½, é¿å…ä¹‹åçš„éº»çƒ¦!</p>
</li>
<li class="lvl-2">
<p><a href="http://chuxiuhong.com/chuxiuhong-rust-patterns-zh/patterns/builder.html">Builder Pattern (ä¸€ç§Rustä¸­å¸¸è§çš„è®¾è®¡æ¨¡å¼)</a>:<br>
æˆ‘ä»¬åˆ©ç”¨å®ƒè¿›è¡Œé“¾å¼æ„é€ , è®©æ„é€ çš„è¿‡ç¨‹æ›´åŠ æ¸…æ™°, è¿™é‡Œæˆ‘ä»¬åœ¨é“¾å¼ä¸­, æŒ‡å®šäº†ç¨‹åºçš„id: <code>application_id(id: &amp;str)</code><br>
åœ¨gtk4ä¸­, å®ƒè¢«é«˜é¢‘æ¬¡åœ°ä½¿ç”¨, æœ€åè°ƒç”¨çš„ <code>build</code> ä¼šç”Ÿæˆæ¯”å¦‚çª—å£, æŒ‰é’®ç­‰éƒ¨ä»¶çš„å®ä¾‹<br>
å½“ç„¶, ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™XMLæ–‡ä»¶, æ¥æ„é€ å¯¹åº”çš„éƒ¨ä»¶, æŒ‡å®šå…¶å¸ƒå±€, ä½†è¿™æ˜¯åè¯</p>
</li>
</ul>
<hr>
<h1 id="xin-hao-liang">ä¿¡å·é‡</h1>
<p>å½“ä½ è·ƒè·ƒæ¬²è¯•, <code>mold -run cargo run</code> ä¹‹å, ä¼šçœ‹åˆ°:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GLib-GIO-WARNING : Your application does not implement g_application_activate()</span><br><span class="line">and has no handlers connected to the <span class="string">&#x27;activate&#x27;</span> signal.  </span><br><span class="line">It should <span class="keyword">do</span> one of these.</span><br></pre></td></tr></table></figure>
<p>é , è¿™æ˜¯å•¥å­ç©æ„å„¿? å®é™…ä¸Š, æˆ‘ä»¬è¿˜è¦æ·»åŠ ä¸€ä¸ªåä¸º activate çš„ä¿¡å·é‡(Signal):</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    todo!()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶, ç°åœ¨è¿˜æ— æ³•æ‰§è¡Œ, è¯·æ³¨æ„ <code>build_ui</code> å‡½æ•°ä¸­çš„ <code>todo!()</code>, æˆ‘ä»¬è¿˜æ²¡æœ‰å¡«å……è¿™ä¸ªå‡½æ•°!<br>
å› ä¸ºæˆ‘æƒ³é€æ­¥åœ°è®²è§£ä¸€ä¸‹â€¦ å…ˆæ¥è®²ä»€ä¹ˆæ˜¯ signal å—:</p>
<p>å½“æŸä»¶äº‹æƒ…å‘ç”Ÿæ—¶, signal å°±ä¼šè¢«å‘é€, äº¤ç”±Gtkçš„å…¨å±€å¤„ç†ç³»ç»Ÿ, ç”±å®ƒè¿›è¡Œè°ƒåº¦<br>
æ¯”å¦‚çª—å£æ‰“å¼€, æŒ‰é’®è¢«ç‚¹å‡», æ‹–åŠ¨æ§ä»¶â€¦è¿™äº›äº‹ä»¶éƒ½ä¼šå‘é€ä¸€ä¸ª signal æ¥å‘Šè¯‰å¤„ç†ç³»ç»Ÿ, è®©å®ƒçŸ¥é“æœ‰äº‹æƒ…å‘ç”Ÿäº†<br>
ä½ å¯ä»¥ä¸ºæ¯ä¸ª signal ç»‘å®šä¸€ä¸ªå‡½æ•°, å½“å¤„ç†ç³»ç»Ÿæ¥å—åˆ°æŸä¸ª signal, å°±å¯ä»¥è°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°äº†</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æˆ‘ä»¬æŠŠå¤„ç†å‡½æ•°, ç§°ä¹‹ä¸º <code>handler</code></p>
</li>
<li class="lvl-2">
<p>æˆ‘ä»¬å°†ä¸º signal ç»‘å®šä¸€ä¸ª handler çš„è¿‡ç¨‹, ç§°ä¹‹ä¸º <code>connect</code></p>
</li>
</ul>
<p>Gtk çš„ç†å¿µæ˜¯: Appåªå…³å¿ƒåœ¨ç‰¹å®šçš„æ—¶å€™éœ€è¦åšçš„äº‹æƒ…<br>
<code>äº‹ä»¶å‘é€çš„æ—¶é—´</code> , å³ signal ä»€ä¹ˆæ—¶å€™å‘é€å·²ç»å®šå¥½äº†, è‡³äº <code>äº‹æƒ…çš„å†…å®¹</code>, å³ handler çš„å…·ä½“å®ç°, ç”±å¼€å‘è€…è‡ªå·±è´Ÿè´£</p>
<p>ä¸‹é¢æ˜¯å››ä¸ªå¾…å“åº”çš„ä¿¡å·, ä¹Ÿå¯¹åº”ç€å››ä¸ªå¾…å®ç°çš„è™šå‡½æ•°/handler:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>startup:<br>
åœ¨Appç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è¢«è°ƒç”¨, ç”¨äºä¸UIæ˜¾ç¤ºæ— å…³çš„åˆå§‹åŒ–ä»»åŠ¡</p>
</li>
<li class="lvl-2">
<p>shutdown:<br>
åœ¨Appç»“æŸæ—¶è°ƒç”¨, æ¸…ç†èµ„æº, è¿›è¡Œå–„å, ä¸è¿‡è¿™å¥½åƒå¯¹Rustæ²¡å•¥ç”¨? Dropèƒ½è‡ªåŠ¨æ¸…ç†, ä½†æ¯•ç«Ÿæºç æ˜¯C</p>
</li>
<li class="lvl-2">
<p>activate:<br>
GtkAppæ€»å¾—æœ‰è‡³å°‘ä¸€ä¸ªçª—å£, è¯¥å‡½æ•°å†³å®šå¦‚ä½•æ˜¾ç¤º/ç»˜åˆ¶çª—å£</p>
</li>
<li class="lvl-2">
<p>open<br>
å½“Appéœ€è¦æ‰“å¼€æŸä¸ªæ–‡ä»¶æ—¶è¢«æ‰§è¡Œ, æ–‡ä»¶ä¼šåœ¨æ–°çª—å£æ˜¾ç¤º, æ¯”å¦‚æµè§ˆå™¨æ‰“å¼€äº†pdfæ–‡ä»¶</p>
</li>
</ul>
<p>æ­£å¦‚ä¸Šé¢ç¬¬ä¸‰ä¸ªä¿¡å·æ‰€è¯´, ä¸€ä¸ªGtkAppè‡³å°‘å¾—æœ‰ä¸€ä¸ªçª—å£<br>
å½“æŸä¸ªAppè¯•å›¾æ‰“å¼€ç¬¬äºŒä¸ªçª—å£, Gtkå…¨å±€ç³»ç»Ÿ, ä¼šå‘é€ signal(activate/open) ç»™ç¬¬ä¸€ä¸ªçª—å£<br>
æ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œéƒ½åº”åœ¨startupä¸­å®Œæˆ, å“ªæ€•æ˜¯ç¬¬äºŒä¸ªçª—å£ç›¸å…³çš„åˆå§‹åŒ–</p>
<p>è¿™äº›åªæ˜¯Gtkç»™æˆ‘ä»¬çš„ signal ä¸­æœ€ä¸ºå¸¸è§çš„å‡ ä¸ª, å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šä¿¡å·, å¸®ä½ è‡ªå®šä¹‰è®¾è®¡App, æœ¬èŠ‚åé¢, ä¼šå†å¸®ä½ åŠ æ·±ä¸‹å°è±¡</p>
<hr>
<h1 id="chuang-jian-kong-bai-chuang-kou">åˆ›å»ºç©ºç™½çª—å£</h1>
<p>å›åˆ°ä¹‹å‰çš„ä»£ç , å¦‚ä¸‹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::Application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    todo!()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">Your <span class="built_in">application</span> <span class="keyword">does</span> <span class="keyword">not</span> implement g_application_activate()</span><br><span class="line"><span class="keyword">and</span> has no handlers connected <span class="keyword">to</span> <span class="keyword">the</span> &#x27;<span class="built_in">activate</span>&#x27; signal. </span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ä½ åº”è¯¥æ˜ç™½, ä¸ºä»€ä¹ˆä¹‹å‰ä¼šæŠ¥å‡ºè¿™ä¸ªè­¦å‘Šäº†å§? <code>connect_xxxx</code>, ä»£è¡¨ç€è¿æ¥æŸä¸ª signal , å³å®ç°å¯¹åº”çš„è™šå‡½æ•°/handler</p>
<p><code>connect_activate</code>, è¦æ±‚ä¼ å…¥ä¸€ä¸ªå…·æœ‰é™æ€lifetimeçš„å‡½æ•°ä½œä¸ºå‚æ•°, ä¸”è¢«ä¼ å…¥å‡½æ•°åªæœ‰å”¯ä¸€çš„å‚æ•°, å…¶ç±»å‹æ˜¯ <code>&amp;Application</code><br>
æˆ‘ä»¬åˆ›å»ºçš„è¿™ä¸ªå‡½æ•°, åä¸º <code>build_ui</code>, æ­£æ˜¯ä¸ºäº†æ¶ˆé™¤è¯¥è­¦å‘Š, çœŸæ­£æ˜¾ç¤ºçª—å£, æ¯•ç«Ÿä¸€ä¸ªGUIç¨‹åºè‹¥æ— ä»»ä½•æ˜¾ç¤º, è¿™â€¦å•§, ä¸å¤ªèªæ˜?</p>
<p>ç›´æ¥ä¸Š <code>build_ui</code> çš„ä»£ç , æ³¨æ„ use é‚£è¾¹å¤šäº†ä¸œè¥¿:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My App&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    win.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”¨builderæ¨¡å¼, æŒ‡å®šäº†çª—å£å¯¹åº”çš„Appæ˜¯è°, æ ‡é¢˜æ˜¯å•¥, å¹¶åœ¨æœ€åæ˜¾ç¤ºå®ƒ<br>
å¦‚æœä½ å¤„äºGNOME-DE, å¹¶å¯ç”¨äº†ç›¸å…³ä¸»é¢˜, å°†ä¼šçœ‹è§ä¸€ä¸ªå…·æœ‰å¯¹åº”ä¸»é¢˜çš„ç©ºç™½çª—å£, æ ‡é¢˜æ˜¯ <code>My App</code></p>
<p>åœ¨Appå¯åŠ¨ä¹‹åçš„æŸæ—¶åˆ», <code>activate</code> ä¿¡å·å¯¹åº”çš„è™šå‡½æ•°è¢«è°ƒç”¨, ä¹‹å‰å› ä¸ºæ²¡æœ‰å®ç°å®ƒ, ä¸€ä¸ªè­¦å‘Šå‡ºç°<br>
ä½†ç°åœ¨, æˆ‘ä»¬å·²ç»å°†å®ƒè¦†ç›–æˆè‡ªå·±çš„ <code>build_ui</code> äº†, å› æ­¤è­¦å‘Šä¸å†å‡ºç°</p>
<hr>
<h1 id="xin-zeng-an-niu">æ–°å¢æŒ‰é’®</h1>
<p>è®©æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæŒ‰é’®, æç¤ºä¿¡æ¯æ˜¯ <code>Press me!</code>, åœ¨æŒ‰ä¸‹ä¹‹å, å˜æˆæ˜¾ç¤º <code>Hello World!</code>:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::&#123;prelude::*, Button&#125;;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="keyword">let</span> btn = Button::builder().label(<span class="string">&quot;Press me!&quot;</span>).build();</span><br><span class="line">    btn.connect_clicked(|btn| btn.set_label(<span class="string">&quot;Hello World!&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My App&quot;</span>)</span><br><span class="line">        .child(&amp;btn)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    win.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘åœ¨è¿™é‡Œä½¿ç”¨Button, è€Œä¸æ˜¯Label, å•çº¯æ˜¯ä¸ºäº†å¤ä¹ å…ˆå‰å­¦è¿‡çš„æ¦‚å¿µ, ä»…æ­¤è€Œå·²</p>
<p>ä¹‹å‰è¯´è¿‡, æˆ‘ä»¬å¯ä»¥ connect çš„ signal è¿œä¸æ­¢é‚£å››ä¸ª, æ¯”å¦‚è¿™é‡Œçš„ connect_clicked, å°±ä»£è¡¨æŒ‰é’®è¢«ç‚¹å‡»åçš„handler<br>
ç‚¹å‡»äº‹æƒ…å‘ç”Ÿæ—¶, æœ¬æ¥å°±èƒ½å•¥ä¹Ÿä¸åš, å› æ­¤å³ä½¿ä¸è°ƒç”¨ connect_clicked ä¹Ÿä¸ä¼šå‡ºç°è­¦å‘Š, ä¸åƒ activate å¼ºåˆ¶è¦æ±‚ä½ å¤„ç†</p>
<p>ç„¶å, æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>Builder Pattern</code> æ„é€ çª—å£æ—¶, è°ƒç”¨child, å°†è¯¥æŒ‰é’®çš„å¼•ç”¨ä¼ å…¥, è®©æŒ‰é’®ä¹Ÿå‡ºç°åœ¨çª—å£ä¸­<br>
æ³¨æ„: è¿™é‡Œä¼šä½¿å¾—æŒ‰é’®çš„å¼ºå¼•ç”¨æ•°é‡+1, å› ä¸ºButtonæ˜¯GObjectçš„å­ç±», è€ŒGObjectå…·æœ‰å¼•ç”¨è®¡æ•°çš„ç‰¹ç‚¹, ä¸‹èŠ‚ä¼šè®²</p>
<hr>
<h1 id="chang-jian-she-zhi">å¸¸è§è®¾ç½®</h1>
<p><s>ç¨å¾®å†æ°´ä¸€ç‚¹å­—æ•°</s></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è®¾ç½®é—´è·:<br>
è¿è¡Œå…ˆå‰çš„ä»£ç , ä½ ä¼šå‘ç°æŒ‰é’®å æ»¡äº†æ•´ä¸ªçª—å£<br>
æˆ‘ä»¬å¯ä»¥åœ¨é“¾å¼æ„é€ ä¸€ä¸ªæŒ‰é’®æ—¶, é¡ºå¸¦ç€è®¾ç½®å®ƒä¸å››å‘¨çš„é—´è·, ä»£ç å¾ˆç®€å•, å¦‚ä¸‹:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = Button::builder()</span><br><span class="line">    .label(<span class="string">&quot;Press me!&quot;</span>)</span><br><span class="line">    .margin_top(<span class="number">12</span>)</span><br><span class="line">    .margin_bottom(<span class="number">12</span>)</span><br><span class="line">    .margin_start(<span class="number">12</span>)</span><br><span class="line">    .margin_end(<span class="number">12</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>é€æ˜è®¾ç½®:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">    .application(app)</span><br><span class="line">    .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">    .opacity(<span class="number">0.8</span>)         <span class="comment">// çª—å£ä¸é€æ˜åº¦, è¶Šä½è¶Šé€æ˜, è¶Šé«˜è¶Šä¸é€æ˜</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>é»˜è®¤é«˜å®½:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">    .application(app)</span><br><span class="line">    .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">    .default_height(<span class="number">100</span>)</span><br><span class="line">    .default_width(<span class="number">200</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤, æœ¬å°èŠ‚ç»“æŸ, åˆè¦æ„‰å¿«åœ°é¸½é¸½é¸½äº†å‘¢ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p3~&gt; GObject: å†…å­˜ç®¡ç†</title>
    <url>/posts/rust-gtk4/p3.html</url>
    <content><![CDATA[<blockquote>
<p>æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Widget, ç”±æ­¤å‡ºå‘, åˆ›å»ºä¸€ä¸ªåŒæŒ‰é’®åŠ å‡æ•°å­—çš„ç»å…¸ç¨‹åº, æ¢è®¨å†…å­˜ç®¡ç†, é˜²æ­¢å†…å­˜æ³„æ¼</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
<h1 id="widget">Widget</h1>
<p>ä»»ä½•Gtkåº”ç”¨, éƒ½ç”±è®¸å¤šéƒ¨ä»¶(Widget)ç»„æˆ, æ¯”å¦‚çª—å£ã€å¯¹è¯æ¡†ã€æŒ‰é’®ã€å¤šè¡Œæ–‡æœ¬ã€å®¹å™¨ç­‰, å› æ­¤ Widget æ˜¯ä¸ªæŠ½è±¡æ¦‚å¿µ<br>
å†æ¯”å¦‚, <code>Button(æŒ‰é’®)</code>, <code>Container(å®¹å™¨)</code>, éƒ½å±äº <code>Widget</code></p>
<p><a href="https://docs.gtk.org/gtk4/visual_index.html">Widget Gallery</a> æ˜¯Gtkæä¾›çš„ç½‘ç«™, ä½ å¯ä»¥é€šè¿‡æµè§ˆå®ƒ, æ›´å¥½åœ°é€‰æ‹© <code>Widget</code></p>
<p>æˆ‘ä»¬ç”šè‡³èƒ½è‡ªå®šä¹‰å‡ºæ–°çš„Widget, é€šè¿‡<code>ç»§æ‰¿/å­ç±»åŒ–</code>, å› ä¸º Gtk æ˜¯é¢å‘å¯¹è±¡çš„GUIæ¡†æ¶<br>
ä¾‹å¦‚ <code>Button</code>, å…¶ç»§æ‰¿æ ‘å¦‚ä¸‹:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">GObject</span><br><span class="line">â””â”€â”€ Widget</span><br><span class="line">    â””â”€â”€ <span class="selector-tag">Button</span></span><br></pre></td></tr></table></figure>
<p>GObject, ä¹Ÿå°±æ˜¯ <code>gtk::glib::object::Object</code>, æ˜¯ Gtk å¯¹è±¡å±‚çº§ä¸­çš„åŸºç±», ç»§æ‰¿ GObject å¯ä»¥è·å–å…¶ç‰¹æ€§<br>
ä¸¾ä¸ªä¾‹å­, GObject å…·æœ‰ <code>å¼•ç”¨è®¡æ•°</code> çš„ç‰¹æ€§, GObject çš„å­ç±»å¯¹è±¡ä¹Ÿå…·æœ‰è¯¥ç‰¹æ€§, å½“æŒ‡å‘è‡ªèº«çš„å¼ºå¼•ç”¨å½’é›¶æ—¶, è‡ªåŠ¨é‡Šæ”¾å†…å­˜</p>
<p>æ¥ä¸‹æ¥, æˆ‘ä»¬å°±æ¥åˆ›å»ºä¸€ä¸ªåŒæŒ‰é’®åŠ å‡æ•°å­—çš„ç¨‹åº, æ¢è®¨ä¸€ä¸‹ç›¸å…³çš„æ³¨æ„äº‹é¡¹, è¿™æ˜¯æ¥è‡ªå®˜æ–¹ä¹¦ç±ä¸­çš„ä¾‹å­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åˆ›å»ºä¸€ä¸ªçª—å£, ä¸Šé¢æœ‰ä¸¤ä¸ªæŒ‰é’® <code>btn_inc</code>, <code>btn_dec</code>, åˆšåˆšå¼€å§‹åˆ†åˆ«æ˜¾ç¤º <code>Increase</code> ä¸ <code>Decrease</code>, ä¼šåŠ å‡åˆå§‹å€¼ä¸ºé›¶çš„æ•°å­—</p>
</li>
<li class="lvl-2">
<p>æŒ‰ä¸‹ <code>btn_inc</code>, åˆ™å°†æ•°å­—åŠ ä¸€, éšååœ¨ <code>btn_dec</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p>
</li>
<li class="lvl-2">
<p>æŒ‰ä¸‹ <code>btn_dec</code>, åˆ™å°†æ•°å­—å‡ä¸€, éšååœ¨ <code>btn_inc</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p>
</li>
</ul>
<hr>
<h1 id="cuo-wu-shi-xian">é”™è¯¯å®ç°</h1>
<p>é¦–å…ˆè¯·æ³¨æ„, æˆ‘éƒ½è¯´äº†è¿™æ˜¯é”™è¯¯çš„å®ç°, æ¥ä¸‹æ¥çš„æ€è€ƒæ˜¯æœ‰ç‘•ç–µ, æœªè€ƒè™‘å®Œå…¨çš„ ğŸ˜ƒ</p>
<p>ä¸ºäº†å®ç°è¿™æ ·ä¸€ä¸ªç¨‹åº, æˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰è¿™ä¸¤ä¸ªæŒ‰é’®, å¹¶ä¸”å°†å®ƒä»¬æ˜¾ç¤ºåœ¨çª—å£ä¸Š, ä¸Šä¸€èŠ‚è®²çš„æ²¡å¿˜å§?<br>
ä¸‹é¢æ˜¯ä»£ç , å·²ç»è®²è¿‡çš„æ¦‚å¿µä¸å†é‡å¤:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow, Button, Orientation&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ªæŒ‰é’®, è®¾ç½®Label</span></span><br><span class="line">    <span class="keyword">let</span> btn_inc = Button::builder()</span><br><span class="line">        .label(<span class="string">&quot;Increase&quot;</span>)</span><br><span class="line">        .margin_top(<span class="number">12</span>)</span><br><span class="line">        .margin_bottom(<span class="number">20</span>)</span><br><span class="line">        .margin_start(<span class="number">12</span>)</span><br><span class="line">        .margin_end(<span class="number">12</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">let</span> btn_dec = Button::builder()</span><br><span class="line">        .label(<span class="string">&quot;Decrease&quot;</span>)</span><br><span class="line">        .margin_top(<span class="number">12</span>)</span><br><span class="line">        .margin_bottom(<span class="number">20</span>)</span><br><span class="line">        .margin_start(<span class="number">12</span>)</span><br><span class="line">        .margin_end(<span class="number">12</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `Clicked` äº‹ä»¶å‘ç”Ÿåçš„å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="comment">// å‡ºäºç®€å•æ¼”ç¤ºçš„ç›®çš„, è¿™é‡Œåªæ˜¯å•çº¯çš„åŠ å‡æ•°å­—è€Œå·²</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> num = <span class="number">0</span>;</span><br><span class="line">    btn_inc.connect_clicked(|_| &#123;</span><br><span class="line">        num += <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    btn_dec.connect_clicked(|_| &#123;</span><br><span class="line">        num -= <span class="number">1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå®¹å™¨, æŒ‡å®šå…¶æ–¹å‘ä¸ºå‚ç›´, å³æ·»åŠ å…ƒç´ çš„ä½ç½®æ˜¯ä¸Šè‡³ä¸‹</span></span><br><span class="line">    <span class="comment">// å› æ­¤, ä»ä¸Šå¾€ä¸‹ç¬¬ä¸€ä¸ªæ˜¯btn_inc, ç¬¬äºŒä¸ªæ˜¯btn_dec</span></span><br><span class="line">    <span class="keyword">let</span> gtk_box = gtk::<span class="built_in">Box</span>::builder()</span><br><span class="line">        .orientation(Orientation::Vertical)</span><br><span class="line">        .build();</span><br><span class="line">    gtk_box.append(&amp;btn_inc);</span><br><span class="line">    gtk_box.append(&amp;btn_dec);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çª—å£åªèƒ½è®¾ç½®ä¸€ä¸ªchild, å› æ­¤æŠŠå®¹å™¨æ·»åŠ è¿›å»</span></span><br><span class="line">    <span class="comment">// éšååœ¨å®¹å™¨ä¸­æ·»åŠ å¾ˆå¤š widget, è¾¾åˆ°å…¨æ·»åŠ è¿›å»çš„ç›®çš„</span></span><br><span class="line">    <span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">        .child(&amp;gtk_box)</span><br><span class="line">        .build();</span><br><span class="line">    win.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç„¶, éƒ½è¯´äº†æ˜¯é”™è¯¯æ¼”ç¤º, è‡ªç„¶ä¼šæŠ¥é”™, è€Œä¸”è¿™é‡Œæ˜¯ç¼–è¯‘æœŸçš„æŠ¥é”™<br>
å¦‚æœçœ‹ä¸‹ <code>connect_clicked</code> çš„å®šä¹‰, ä¼šå‘ç°å®ƒè¦æ±‚ä¼ å…¥çš„é—­åŒ…, å¿…é¡»æœ‰ 'static çš„ lifetime</p>
<p>é“ç†å¾ˆç®€å•, é¬¼çŸ¥é“ç”¨æˆ·å•¥æ—¶å€™ä¼šç‚¹æŒ‰é’®, è°ƒç”¨è¯¥å›è°ƒå‡½æ•°, è¦æ˜¯é—­åŒ…è¿˜æ´»ç€, numè¿™å˜é‡å·²ç»æ²¡äº†å’‹åŠ?<br>
å› æ­¤, é—­åŒ…æœ‰ä¸ª 'static çš„ lifetime, åœ¨ç¼–è¯‘æœŸå°±èƒ½é™åˆ¶å¼€å‘è€…å†™å‡ºä¸å®‰å…¨çš„ä»£ç , æ‹’ç»æ´»å¾—æ²¡é—­åŒ…ä¹…çš„å˜é‡</p>
<p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸ºé—­åŒ…æ·»åŠ å‰ç¼€, å³æ·»åŠ å…³é”®å­— <code>move</code>, è®©è¢«é—­åŒ…æ•è·çš„å˜é‡, å…¶æ‰€æœ‰æƒè½¬ç§»åˆ°é—­åŒ…ä¸­<br>
è¿™æ ·å­, é—­åŒ…æ­»ä¹‹å‰è‚¯å®šå¯ä»¥ä¸€ç›´è®¿é—®åˆ° num è¿™ä¸ªå˜é‡, æ¯•ç«Ÿæ‰€æœ‰æƒéƒ½è¿›å»äº†, è¿˜æ€•å®ƒé€ƒä¸æˆ?</p>
<p>ä½†é—®é¢˜æ˜¯, è¿™æ ·çš„æ“ä½œåªèƒ½æ»¡è¶³ä¸€ä¸ªé—­åŒ…, æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‰é’®, éœ€è¦å†™ä¸¤ä¸ªå›è°ƒå‡½æ•°, è€Œæ‰€æœ‰æƒåªèƒ½è½¬ç§»ä¸€æ¬¡!<br>
æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•, è®©è¿™ä¸¤ä¸ªé—­åŒ…éƒ½èƒ½æ‹¥æœ‰numçš„æ‰€æœ‰æƒ?</p>
<p>è¯·çœ‹ä¸‹é¢çš„æ­£ç¡®å®ç°, é€šè¿‡å¼•ç”¨è®¡æ•°çš„æ–¹å¼ ğŸ˜ƒ</p>
<hr>
<h1 id="yin-yong-ji-shu">å¼•ç”¨è®¡æ•°</h1>
<p>å˜¿! è¿™ä¸å°±æ˜¯å¤šæ‰€æœ‰æƒé—®é¢˜å˜›, è¿˜æ˜¯åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ <s>(GUIæ¡†æ¶å¥½åƒéƒ½æ˜¯å•çº¿ç¨‹çš„?)</s><br>
é‚£å°±å¯ä»¥ä½¿ç”¨ <code>std::rc::Rc</code> è¿™ä¸ªç±»å‹, é€šè¿‡å¼•ç”¨è®¡æ•°, ç»•è¿‡ç¼–è¯‘æœŸçš„æ£€æŸ¥, å®ç°å¤šæ‰€æœ‰æƒ</p>
<p>å¤šæ‰€æœ‰æƒçš„é—®é¢˜å·²ç»è¾¾æˆäº†, ä½†æˆ‘ä»¬è¿˜éœ€è¦å†…éƒ¨å¯å˜æ€§, å› æ­¤è¿˜éœ€è¦ä½¿ç”¨ <code>std::cell::Cell</code><br>
äºæ˜¯, numå˜é‡çš„ç±»å‹, ä»ç®€å•çš„i32, å˜æˆäº†ä¸€ä¸ªWrapperç±»å‹, å³ <code>Rc&lt;Cell&lt;i32&gt;&gt;</code></p>
<p><strong>æç¤º</strong><br>
å¯¹äºå®ç°äº† Copy çš„ç±»å‹, è¯·ç›´æ¥ä½¿ç”¨ Cell, è€Œé Refcell<br>
å› ä¸º Cell ç®€å•, ä¸”ç›´æ¥ä½¿ç”¨ memcpy æ¥æ”¹å˜å€¼, æ•ˆç‡é«˜æ˜“ç†è§£</p>
<p>ä¸‹é¢æ˜¯ä»£ç , è¯·åŠ¡å¿…è®°å¾—useä¸€ä¸‹:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line"><span class="keyword">let</span> num_clone = num.clone();</span><br><span class="line"></span><br><span class="line">btn_inc.connect_clicked(|_| &#123;</span><br><span class="line">    num_clone.set(num_clone.get() + <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">btn_dec.connect_clicked(|_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ„Ÿè°¢å¼ºå¤§çš„ç¼–è¯‘å™¨ä¸èªæ˜çš„åº“ä½œè€…, ä»–ä»¬é€¼è¿«ç€ä½ , è®©ä½ è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µ, ä¸ç„¶åˆ«æƒ³ç¼–è¯‘é€šè¿‡<br>
å…¶ä»–è¯­è¨€ä¸­å¯èƒ½ä¼šè½»æ˜“å‡ºç°çš„Bug, ä½ æ— æ³•åœ¨Rustä¸­å¤ç°, GNOMEçš„è½¯ä»¶ç”¨Rustè¿›è¡Œé‡å†™, å¯èƒ½å°±å› ä¸ºè¿™?</p>
<p>è®©æˆ‘ä»¬å°†è¿™ä¸ªåˆæ­¥çš„ä»£ç å‡ä¸ªçº§, å®ç°æœ¬èŠ‚å¼€ç¯‡æ‰€æè¿°çš„ç¨‹åº:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åˆ›å»ºä¸€ä¸ªçª—å£, ä¸Šé¢æœ‰ä¸¤ä¸ªæŒ‰é’® <code>btn_inc</code>, <code>btn_dec</code>, åˆšåˆšå¼€å§‹åˆ†åˆ«æ˜¾ç¤º <code>Increase</code> ä¸ <code>Decrease</code>, ä¼šåŠ å‡åˆå§‹å€¼ä¸ºé›¶çš„æ•°å­—</p>
</li>
<li class="lvl-2">
<p>æŒ‰ä¸‹ <code>btn_inc</code>, åˆ™å°†æ•°å­—åŠ ä¸€, éšååœ¨ <code>btn_dec</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p>
</li>
<li class="lvl-2">
<p>æŒ‰ä¸‹ <code>btn_dec</code>, åˆ™å°†æ•°å­—å‡ä¸€, éšååœ¨ <code>btn_inc</code> ä¸Šæ˜¾ç¤ºè¯¥æ•°å­—</p>
</li>
</ul>
<p>æˆ‘ä»¬å·²ç»æˆåŠŸå®ç°äº†æŒ‰ä¸‹æŒ‰é’®åæ•°å­—çš„åŠ å‡, å¹¶å€Ÿç”±ç¼–è¯‘å™¨ä¹‹çœ¼çœ‹åˆ°äº†å±é™©, åˆ©ç”¨æ ‡å‡†åº“æä¾›çš„ç±»å‹, è®©ç¨‹åºå˜å¾—å®‰å…¨<br>
è¦åšçš„ä¸‹ä¸€æ­¥, å°±æ˜¯è®©æŸæŒ‰é’®è¢«æŒ‰ä¸‹å, åœ¨å¦ä¸€ä¸ªæŒ‰é’®ä¸Šæ˜¾ç¤ºå½“å‰çš„æ•°å€¼</p>
<p>åœ¨æœ¬èŠ‚å¼€ç¯‡, æåŠè¿‡Buttonçš„ç»§æ‰¿æ ‘: å®ƒç»§æ‰¿äº†GObject, å› æ­¤å…·æœ‰å¼•ç”¨è®¡æ•°çš„ç‰¹ç‚¹, ç›¸å½“äºRustä¸­çš„Rc<T><br>
å› æ­¤, å¯ä»¥å¤ç”¨å¯¹ä»˜numçš„æ–¹æ³•, æ¥å¯¹ä»˜ btn_inc ä¸ btn_dec, ç›´æ¥clone, ç„¶åä½¿ç”¨è¢«cloneå‡ºæ¥çš„è¿™ä¸ªå˜é‡</p>
<p>ä½†æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨clone, åˆ›å»ºæ–°å˜é‡, è¿™æ˜¯ä¸æ˜¯å¤ªéº»çƒ¦äº†ç‚¹?<br>
æ‰€å¹¸ Gtk4 çš„å¼€å‘äººå‘˜, å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿‡ç¨‹å®, ä¸“é—¨åŒ–ç®€æ‰‹åŠ¨cloneçš„ç¹çæ“ä½œ</p>
<hr>
<h1 id="clone">clone!</h1>
<p>Yeah, è¿™ä¸ªå®çš„åå­—å°±å«clone: <code>glib::clone</code>, ä½ å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£: <a href="https://docs.rs/glib/latest/glib/macro.clone.html">glib::clone</a><br>
è¯·åŠ¡å¿…æ³¨æ„useå¿…é¡»åƒä¸‹é¢è¿™æ ·å†™, ä½ å¾—å…ˆ <code>use gtk::glib</code>, éšå <code>use glib::clone</code>:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::Cell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> glib::clone;</span><br><span class="line"><span class="keyword">use</span> gtk::prelude::*;   <span class="comment">// è¿™é‡Œ</span></span><br><span class="line"><span class="keyword">use</span> gtk::&#123;glib, Application, ApplicationWindow, Button, Orientation&#125;;  <span class="comment">// è¿™é‡Œ</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå®å‘¢?  å¦‚ä¸‹, æ˜ç™½æ€ä¹ˆå†™å°±å®Œäº‹äº†, è¿˜æ˜¯è›®ç®€å•çš„:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line">btn_inc.connect_clicked(clone!(@weak num, @strong btn_dec =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() + <span class="number">1</span>);</span><br><span class="line">    btn_dec.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br><span class="line">btn_dec.connect_clicked(clone!(@strong btn_inc =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">    btn_inc.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>clone!</code> è¿™ä¸ªå®, ç”Ÿæˆäº†å˜é‡çš„å…‹éš†å€¼, å¹¶æŒ‡å®šè¯¥å…‹éš†åˆ°åº•æ˜¯å¼ºå¼•ç”¨(strong), è¿˜æ˜¯å¼±å¼•ç”¨(weak)<br>
è‹¥æ˜¯strong, é‚£è‡ªç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨, æ¯•ç«Ÿä¸€ä¸ªRcç±»å‹çš„å˜é‡, åªæœ‰å¼ºå¼•ç”¨æ•°å½’é›¶æ—¶æ‰ä¼šé‡Šæ”¾å†…å­˜<br>
è‹¥æ˜¯weak, å˜é‡å¯èƒ½å·²ç»é‡Šæ”¾, å› æ­¤ä¼šå°è¯•å…ˆå‡çº§åˆ°strong, å˜é‡æ²¡æ­»å°±å‡çº§æˆåŠŸ, ä¸ç„¶ç›´æ¥ä»é—­åŒ…è¿”å›</p>
<p>æ‡‚äº†åŸºç¡€çš„åŸç†å <s>(æˆ‘ä¸ªäººå–œæ¬¢æŠŠè¯»è€…å½“å‚»å­, å› æ­¤å°½é‡æä¸€å˜´)</s>, æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢è¿™æ®µä»£ç :</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åœ¨ç¬¬ä¸€ä¸ªé—­åŒ…ä¸­, num çš„ weak-ref, ä¸ btn_dec çš„ strong-ref è¢«åˆ›å»º<br>
è€Œ num çš„æ‰€æœ‰æƒè¢«è½¬ç§»åˆ°ç¬¬äºŒä¸ªé—­åŒ…ä¸­, è€Œè¯¥é—­åŒ…çš„ lifetime æ˜¯ 'static, å› æ­¤ weak-ref ä¸€ç›´å¯ä»¥å‡çº§å¹¶è®¿é—® num</p>
</li>
<li class="lvl-2">
<p>ä¸¤ä¸ªé—­åŒ…ä¸­, æˆ‘ä»¬éƒ½åˆ›å»ºäº†å¦ä¸€ä¸ªæŒ‰é’®çš„ strong-ref<br>
æˆ‘ä»¬è·å–äº†å¤šæ‰€æœ‰æƒ, å°±åƒå˜é‡ num ä¸€æ ·, åªæœ‰å•æ‰€æœ‰æƒæ—¶, è¢«moveåˆ°é—­åŒ…åçš„å˜é‡åœ¨ä¹‹åä¼šè¢«ä½¿ç”¨, ç¼–è¯‘æŠ¥é”™, å¦‚ btn_dec</p>
</li>
</ul>
<p><strong>æ³¨æ„:</strong><br>
<code>clone!</code>, åœ¨å°è¯•å‡çº§ weak-ref æ—¶, è‹¥å‡çº§å¤±è´¥, é—­åŒ…å°†ç›´æ¥æå‰è¿”å›ä¸€ä¸ªå¯é€‰å€¼, è‹¥å¯é€‰å€¼æœªæŒ‡å®š, åˆ™é»˜è®¤è¿”å› <code>()</code> å€¼<br>
è¯¦æƒ…è¯·è§æ–‡æ¡£: <a href="https://docs.rs/glib/latest/glib/macro.clone.html">glib::clone</a></p>
<p>è‡³æ­¤, å·²ç»é¡ºåˆ©å®ç°äº†åŠŸèƒ½, ä½†ä»æœ‰ä¸ªå°é—®é¢˜, é‚£å°±æ˜¯:<br>
å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼!</p>
<hr>
<h1 id="xun-huan-yin-yong">å¾ªç¯å¼•ç”¨</h1>
<p>Ruståªä¿éšœå†…å­˜å®‰å…¨, ä¸ä¿éšœå†…å­˜ä¸æ³„æ¼, è®©æˆ‘ä»¬çœ‹çœ‹é—®é¢˜æ‰€åœ¨<br>
<s>(å¤§ä½¬ä»¬å¯èƒ½ä¸€çœ¼å°±çœ‹å‡ºæ¥å“ªé‡Œå¾ªç¯å¼•ç”¨äº†â€¦)</s></p>
<p>è´´ä¸€ä»½åˆšåˆšçš„ä»£ç :</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line">btn_inc.connect_clicked(clone!(@weak num, @strong btn_dec =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() + <span class="number">1</span>);</span><br><span class="line">    btn_dec.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br><span class="line">btn_dec.connect_clicked(clone!(@strong btn_inc =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">    btn_inc.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>è¯´èµ·æ¥ä¹Ÿå¾ˆç®€å•, é‚£å°±æ˜¯ btn_inc äº§ç”Ÿäº†å¯¹ btn_dec çš„ strong-ref, btn_dec ä¹Ÿäº§ç”Ÿäº†å¯¹ btn_inc çš„ strong-ref<br>
ä¸¤ä¸ª strong äº’ç›¸æŒ‡å‘, å¯¼è‡´æ¯ä¸ªå˜é‡çš„å¼ºå¼•ç”¨çš„è®¡æ•°éƒ½è‡³å°‘æ˜¯1, æ°¸è¿œä¸ä¼šå½’é›¶, æ°¸è¿œä¸ä¼šé‡Šæ”¾å†…å­˜<br>
è¿™å°±æ˜¯ <code>å¾ªç¯å¼•ç”¨</code></p>
<p>ç”±äº <code>å¾ªç¯å¼•ç”¨</code>, ä¸€å°å—å†…å­˜åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´, æ°¸è¿œå¾—ä¸åˆ°å¤ç”¨, è¿™å°±æ˜¯ <code>å†…å­˜æ³„æ¼</code></p>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜? éå¸¸ç®€å•, æŠŠ strong-ref æ”¹æˆ weak-ref ä¸å°±Okäº†? ä¸‹é¢æ˜¯ä»£ç :</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> num = Rc::new(Cell::new(<span class="number">0</span>));</span><br><span class="line">btn_inc.connect_clicked(clone!(@weak num, @weak btn_dec =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() + <span class="number">1</span>);</span><br><span class="line">    btn_dec.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br><span class="line">btn_dec.connect_clicked(clone!(@weak btn_inc =&gt; <span class="keyword">move</span> |_| &#123;</span><br><span class="line">    num.set(num.get() - <span class="number">1</span>);</span><br><span class="line">    btn_inc.set_label(&amp;num.get().to_string());</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>å˜¿! num å·²ç»è¢«ç§»åŠ¨åˆ°ç¬¬äºŒä¸ªé—­åŒ…, å› æ­¤ä¸ç”¨æ‹…å¿ƒå®ƒ, ç°åœ¨æ¥çœ‹çœ‹ <code>btn_inc</code>/<code>btn_dec</code><br>
åœ¨é—­åŒ…ä¸­, å¯¹è¿™ä¸¤ä¸ªbtnéƒ½æ˜¯å¼±å¼•ç”¨, å½“ <code>build_ui</code> è°ƒç”¨å®Œæ¯•å, å®ƒä»¬åº”è¯¥ä¼šè‡ªåŠ¨dropæ‰ (å› ä¸ºä½œç”¨åŸŸ)</p>
<p>ä½†è‹¥æ”¹æˆ weak-ref, <code>btn_inc</code>/<code>btn_dec</code> ä¸ä¼šå› ç¼ºå°‘ strong-ref è€Œå‡ºç°é—®é¢˜å—?<br>
ç­”æ¡ˆæ˜¯ä¸ä¼š, åŸå› æ˜¯ä»¥ä¸‹ä¸¤æ®µä»£ç </p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç¬¬ä¸€æ®µ:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> gtk_box = gtk::<span class="built_in">Box</span>::builder()</span><br><span class="line">    .orientation(Orientation::Vertical)</span><br><span class="line">    .build();</span><br><span class="line">gtk_box.append(&amp;btn_inc);</span><br><span class="line">gtk_box.append(&amp;btn_dec);</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç¬¬äºŒæ®µ:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> win = ApplicationWindow::builder()</span><br><span class="line">    .application(app)</span><br><span class="line">    .title(<span class="string">&quot;My Gtk App&quot;</span>)</span><br><span class="line">    .child(&amp;gtk_box)</span><br><span class="line">    .build();</span><br><span class="line">win.present();</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ®µä¸­, <code>btn_inc</code>/<code>btn_dec</code> çš„å¼•ç”¨äº¤ç»™äº† <code>append()</code><br>
ç¬¬äºŒæ®µä¸­, <code>gtk_box</code> çš„å¼•ç”¨äº¤ç»™äº† <code>child()</code></p>
<p>è¿˜è®°å¾—æˆ‘ä»¬å·²ç»å¼ºè°ƒè¿‡å¾ˆå¤šéçš„äº‹å®å—? GObject å…·æœ‰å¼•ç”¨è®¡æ•°çš„ç‰¹ç‚¹, è€Œè¿™äº› Widget éƒ½æ˜¯å…¶å­ç±», ä¹Ÿå…·æœ‰è¯¥ç‰¹æ€§<br>
<code>append()</code>, <code>child()</code>, éƒ½ä¿æŒäº†å¯¹è¿™äº› Widget çš„å¼ºå¼•ç”¨, ä¿æŒäº†å®ƒä»¬çš„æ´»æ€§:<br>
<code>gtk_box</code> æŒæœ‰å¯¹ <code>btn</code> çš„ strong-ref, <code>win</code> æŒæœ‰å¯¹ <code>gtk_box</code> çš„ strong-ref, è€Œ win (çª—å£), ä¸€ç›´æ˜¾ç¤ºç€, è¯´æ˜winä¸€ç›´æ´»ç€<br>
winæ´»ç€, å¯¼è‡´ gtk_box ä¹Ÿä¼šæ´»ç€, gtk_box æ´»ç€, å¯¼è‡´ btn ä¹Ÿä¼šæ´»ç€</p>
<p>æ€»è€Œè¨€ä¹‹, å¯¹å¾…è¿™äº› Widget æ—¶, åªéœ€è¦å°½å¯èƒ½åœ°ä¿æŒ weak-ref, è€Œå¯¹å¾…è‡ªå·±çš„æ•°æ®, åˆ™éœ€è¦å¤šè€ƒè™‘ä¸€ä¸‹, ä»…æ­¤è€Œå·²<br>
å°½å¯èƒ½ä¿æŒ weak-ref, å°±èƒ½å¤Ÿé¿å…å¾ªç¯å¼•ç”¨è€Œå¯¼è‡´å†…å­˜æ³„æ¼äº†!</p>
<p>æœ¬èŠ‚åˆ°æ­¤ç»“æŸ, è¦é¸½ä¸€ä¼šäº†, æˆ‘ä»¬ä¸‹èŠ‚è§ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p4~&gt; GObject: å­ç±»åŒ–</title>
    <url>/posts/rust-gtk4/p4.html</url>
    <content><![CDATA[<blockquote>
<p>æœ¬èŠ‚å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨å­ç±»åŒ–(Subclassing), ä»è€Œå®šåˆ¶è‡ªå·±çš„ Widget</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
<h1 id="mu-lu-jie-gou">ç›®å½•ç»“æ„</h1>
<p>gtk åŸºäº glib, è€Œ glib æœ€è®©äººå°è±¡æ·±åˆ»çš„åœ°æ–¹, åˆæ˜¯å…¶ <code>Gobject System</code><br>
ä¼—æ‰€å‘¨çŸ¥, C æ˜¯ä¸€å¥—é¢å‘è¿‡ç¨‹çš„è¯­è¨€, ä½†åŸºäº C çš„ glibåº“, å´é€šè¿‡é«˜è¶…çš„æ€æƒ³, æä¾›äº†é¢å‘å¯¹è±¡çš„æ”¯æŒ</p>
<p>åœ¨è¿™æ ·ä¸€ä¸ªé¢å‘å¯¹è±¡, ä¾èµ–ç»§æ‰¿çš„ä½“ç³»ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡å­ç±»åŒ–(Subclassing)æ¥åˆ›å»ºæ–°çš„è‡ªå®šä¹‰çš„ GObject<br>
è®©æˆ‘ä»¬ä¿æŒè¿™æ ·å­çš„ç›®å½•ç»“æ„:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="attribute">src</span></span><br><span class="line">â”œâ”€â”€ custom_button</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ imp<span class="selector-class">.rs</span></span><br><span class="line">â”‚Â Â  â””â”€â”€ mod<span class="selector-class">.rs</span></span><br><span class="line">â””â”€â”€ <span class="selector-tag">main</span>.rs</span><br></pre></td></tr></table></figure>
<p>åœ¨ glib ä¸­, æˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºä¸¤ä¸ªç»“æ„ä½“æ¥åˆ›å»ºä¸€ä¸ªå­ç±»<br>
æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ GObject, é€šè¿‡ç»§æ‰¿æˆä¸º <code>gtk::Button</code> çš„å­ç±», ä»¥æ­¤æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„åŠŸèƒ½</p>
<hr>
<h1 id="zi-lei-hua">å­ç±»åŒ–</h1>
<p>å¦‚ä¸Šé¢çš„ç›®å½•ç»“æ„æ‰€ç¤º, æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« <code>custom_button</code> çš„æ¨¡å—, åœ¨ <code>mod.rs</code> ä¸­å°† <code>CustomButton</code> æš´éœ²ç»™å¤–éƒ¨<br>
å…¶å®è¿™å°±æ˜¯ C è¯­è¨€ä¸­å®ç°å­ç±»åŒ–çš„æ¨¡æ¿, æˆ‘ä»¬å°†éµå¾ªè¿™ä¸ªè§„åˆ™, é€šè¿‡å®šä¹‰ä¸¤ä¸ª struct æ¥æè¿°å­ç±»:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>imp.rs</code> è¢«ç”¨æ¥å­˜å‚¨è‡ªå®šä¹‰çš„çŠ¶æ€, å­˜å‚¨ç»§æ‰¿è‡ªçˆ¶ç±»å¾… override çš„è™šå‡½æ•°</p>
</li>
<li class="lvl-2">
<p><code>custom_button::imp</code> æ˜¯ç§æœ‰æ¨¡å—, <code>custom_button::imp::CustomButton</code> ä¹Ÿæ˜¯ç§æœ‰çš„</p>
</li>
<li class="lvl-2">
<p><code>custom_button::imp::CustomButton</code> å°†è¢«æš´éœ²ç»™å¤–ç•Œçš„ <code>custom_button::CustomButton</code> ä½¿ç”¨, ä½œä¸ºå…¶å…»æ–™</p>
</li>
</ul>
<p>ç®€å•æ¥è¯´, æˆ‘ä»¬æ­£åœ¨åˆ©ç”¨æ¨¡å—, å¯¹å­ç±»åŒ–çš„ GObject çš„åŠŸèƒ½è¿›è¡Œåˆ†é—¨åˆ«ç±», è®©å…¶å®šä¹‰æ›´åŠ æ¸…æ™°ç½¢äº†</p>
<p>ä¸‹é¢æ˜¯å…·ä½“ä»£ç , ç›´æ¥æŠ„ä¹¦:</p>
<figure class="highlight rust"><figcaption><span>src/custom_button/imp.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::glib;</span><br><span class="line"><span class="keyword">use</span> gtk::subclass::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object holding the state</span></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">CustomButton</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The central trait for subclassing a GObject</span></span><br><span class="line"><span class="meta">#[glib::object_subclass]</span></span><br><span class="line"><span class="keyword">impl</span> ObjectSubclass <span class="keyword">for</span> CustomButton &#123;</span><br><span class="line">    <span class="keyword">const</span> NAME: &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span> = <span class="string">&quot;MyGtkAppCustomButton&quot;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Type</span></span> = super::CustomButton;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">ParentType</span></span> = gtk::Button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trait shared by all GObjects</span></span><br><span class="line"><span class="keyword">impl</span> ObjectImpl <span class="keyword">for</span> CustomButton &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trait shared by all widgets</span></span><br><span class="line"><span class="keyword">impl</span> WidgetImpl <span class="keyword">for</span> CustomButton &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trait shared by all buttons</span></span><br><span class="line"><span class="keyword">impl</span> ButtonImpl <span class="keyword">for</span> CustomButton &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>å…ˆå‰ä¹Ÿè¯´äº†, æ¨¡å— <code>imp.rs</code> çš„ä½œç”¨ä¾¿æ˜¯æè¿°ä¸€ä¸ªå­ç±», è´Ÿè´£æ–°æ·»åŠ çš„çŠ¶æ€ä¸å¾…è¦†å†™çš„è™šå‡½æ•°<br>
å¯¹äºæŸä¸ªå­ç±» GObject çš„æè¿°, åœ¨ <code>ObjectSubclass</code> ä¸­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>NAME</code>: è¯¥ GObject çš„åå­—, ä¸ºé¿å…å‘½åå†²çª, åº”ä½¿ç”¨ crate-name ä¸ object-name ç»„æˆ (UpperCamelCase)</p>
</li>
<li class="lvl-2">
<p><code>Type</code>: æŒ‡ä¹‹åå°†è¢«åˆ›å»ºçš„, å®é™…çš„ GObject</p>
</li>
<li class="lvl-2">
<p><code>ParentType</code>: æˆ‘ä»¬ç»§æ‰¿çš„é‚£ä¸ªçˆ¶ç±» GObject</p>
</li>
</ul>
<p>ä½ å¯èƒ½ä¼šç–‘æƒ‘, è¿™ä¸ª <code>Name</code> ä¸ <code>Type</code> æ˜¯ä»€ä¹ˆé¬¼, å°±ä¸èƒ½ç›´æ¥ç”¨ <code>Type (æˆ‘ä»¬åœ¨Rustä¸­å®é™…åˆ›å»ºçš„ç±»å‹)</code> ä½œä¸º <code>NAME</code> å—?</p>
<p>åˆ«å¿˜äº†, gtk æ˜¯ä¸€å¥—è·¨è¯­è¨€çš„é€šç”¨ GUI æ¡†æ¶, æ‹¥æœ‰å‡ åç§è¯­è¨€çš„ç»‘å®š, è®¾è®¡å¿…ç„¶ä¸èƒ½æ‹˜æ³¥åœ¨ä¸€ç§è¯­è¨€ä¸Š, å³ä½¿å¯¹ C ä¹Ÿä¸ä¾‹å¤–<br>
ä¸åŒè¯­è¨€è‡ªæœ‰ä¸åŒå‘½åè§„èŒƒ, å¿…ç„¶å¾—å…ˆç»Ÿä¸€é£æ ¼, æ¯”å¦‚ä¹‹åä¼šå­¦ä¹ çš„ <code>.ui</code> ä¸ºåç¼€çš„ xml æ–‡ä»¶, å¯ä»¥ç”¨æ¥æè¿°ç•Œé¢, è¿™å¯æ˜¯ä¸ç®¡å“ªä¸ªè¯­è¨€éƒ½é€šç”¨çš„å•Š<br>
å› æ­¤ <code>NAME</code> æ˜¯ç”¨æ¥æè¿°å…¶åå­—, è€Œ <code>Type/ParentType</code> åˆ™æ˜¯ç‰¹å®šäºè¯­è¨€çš„æŸä¸€ä¸ªç±»å‹ (æ­¤å¤„æ˜¯Rustä¸­çš„ <code>CustomButton</code>/<code>gtk::Button</code>)</p>
<p>å†æä¸€å˜´, ä¹‹åå°†å­¦ä¹ çš„ä»¥ <code>.ui</code> ä¸ºåç¼€çš„ xml æ–‡ä»¶, å¯ä»¥åˆ›å»º GtkBuilder template class(æ¨¡æ¿ç±»), åƒä¸‹é¢è¿™æ ·å»æè¿°ç•Œé¢:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interface</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">class</span>=<span class="string">&quot;GtkAppWindow&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;GtkApplicationWindow&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span>&gt;</span>My GTK App<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- æ­¤å¤„ä½¿ç”¨ `CustomButton` æŒ‡å®š widget çš„ç±»å‹ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;CustomButton&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button_1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;label&quot;</span>&gt;</span>Press me!<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;margin-top&quot;</span>&gt;</span>12<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;margin-bottom&quot;</span>&gt;</span>12<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;margin-start&quot;</span>&gt;</span>12<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;margin-end&quot;</span>&gt;</span>12<span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½ å¯èƒ½è¿˜ä¼šåœ¨ä¹‹åå¯¹ gtk æ¡†æ¶çš„ä¸€äº›åœ°æ–¹æ„Ÿåˆ°ç–‘æƒ‘, å› æ­¤è¯·è®°ä½: gtk æ˜¯ä¸€å¥—é€šç”¨çš„ gui æ¡†æ¶, ä¸æ­¢æ˜¯ä¸ºä¸€ç§è¯­è¨€æœåŠ¡çš„</p>
<p>æ¥ä¸‹æ¥æ˜¯å°†æš´éœ²ç»™å¤–ç•Œçš„ <code>CustomButton</code>:</p>
<figure class="highlight rust"><figcaption><span>src/custom_button/mod.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> imp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> glib::Object;</span><br><span class="line"><span class="keyword">use</span> gtk::glib;</span><br><span class="line"></span><br><span class="line">glib::wrapper! &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">CustomButton</span></span>(ObjectSubclass&lt;imp::CustomButton&gt;)</span><br><span class="line">        @extends gtk::Button, gtk::Widget,</span><br><span class="line">        @implements gtk::Accessible, gtk::Actionable, gtk::Buildable, gtk::ConstraintTarget;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> CustomButton &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">with_label</span></span>(label: &amp;<span class="built_in">str</span>) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        Object::new(&amp;[(<span class="string">&quot;label&quot;</span>, &amp;label)])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>glib::wrapper!</code> é¡¾åæ€ä¹‰, èƒ½å¸®æˆ‘ä»¬å°† <code>imp::CustomButton</code> è¿›è¡ŒåŒ…è£…, è‡ªåŠ¨ç”Ÿæˆç›¸å…³å®ç°, é¿å…å¤§é‡æ ·ä¾‹ä»£ç , æˆ‘ä»¬åªéœ€æŒ‡æ˜å…¶ç»§æ‰¿æƒ…å†µå³å¯:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>@extends</code>: æŒ‡æ˜æ‰€æœ‰çˆ¶ç±» GObject</p>
</li>
<li class="lvl-2">
<p><code>@implements</code>: æŒ‡æ˜æ‰€æœ‰å®ç°çš„ Interface (åœ¨ Rust ä¸­æ˜¯ Trait)</p>
</li>
<li class="lvl-2">
<p><code>imp::CustomButton</code>: ç»è¿‡å®æˆä¸ºäº†è¢«æš´éœ²çš„ <code>CustomButton</code> çš„ inner æˆå‘˜</p>
</li>
<li class="lvl-2">
<p><code>with_label</code>: æ·»åŠ äº†è‡ªå·±çš„å°†è¢«æš´éœ²çš„æ–°æ–¹æ³•, è®¾ç½®äº† GObject çš„ property (<code>Object::new</code> çš„è¿”å›å€¼æ˜¯æ³›å‹, æ­¤å¤„ä¼šè‡ªåŠ¨æ¨å¯¼ä¸º <code>Self</code>)</p>
</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href="https://docs.gtk.org/gtk4/class.Button.html#hierarchy">docs/gtk/hierarchy</a> æ¥æŸ¥çœ‹æŸä¸ª GObject çš„ç»§æ‰¿é“¾æƒ…å†µ</p>
<p>ç°åœ¨, <code>CustomButton</code> å®é™…ä¸Šå·²ç»ä¸ <code>gtk::Button</code> ä¸€æ ·äº†, å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å…¶æ›¿æ¢ <code>Button</code>:</p>
<figure class="highlight rust"><figcaption><span>src/main.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> custom_button;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> custom_button::CustomButton;</span><br><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::&#123;Application, ApplicationWindow&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APP_ID: &amp;<span class="built_in">str</span> = <span class="string">&quot;xyz.jedsek.myapp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> app = Application::builder().application_id(APP_ID).build();</span><br><span class="line">    app.connect_activate(build_ui);</span><br><span class="line">    app.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">build_ui</span></span>(app: &amp;Application) &#123;</span><br><span class="line">    <span class="keyword">let</span> button = CustomButton::with_label(<span class="string">&quot;Press me!&quot;</span>);</span><br><span class="line">    button.set_margin_top(<span class="number">12</span>);</span><br><span class="line">    button.set_margin_bottom(<span class="number">12</span>);</span><br><span class="line">    button.set_margin_start(<span class="number">12</span>);</span><br><span class="line">    button.set_margin_end(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> window = ApplicationWindow::builder()</span><br><span class="line">        .application(app)</span><br><span class="line">        .title(<span class="string">&quot;My GTK App&quot;</span>)</span><br><span class="line">        .child(&amp;button)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    window.present();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ <code>mold -run cargo run</code>, ä½ ä¼šè§è¯†ä¸€æ¨¡ä¸€æ ·çš„æ•ˆæœ ğŸ˜ƒ</p>
<hr>
<h1 id="zi-ding-yi">è‡ªå®šä¹‰</h1>
<p>æ²¡é”™, è¿™è¿˜ä¸å¤Ÿ, å¦‚æœè´¹åŠ²å¿ƒæ€æå‡ºæ¥çš„å­ç±»åªæ˜¯å’Œçˆ¶ç±»ä¸€èˆ¬, é‚£å°±æ²¡å¿…è¦æäº†, å¾ˆç®€å•çš„é“ç†ä¸æ˜¯å—?<br>
ä»¤äººå…´å¥‹çš„æ˜¯, æˆ‘ä»¬è¿˜å¯ä»¥ä¿å­˜çŠ¶æ€, è¦†å†™è™šå‡½æ•°!</p>
<p>ä¸‹é¢æ˜¯ä¾‹å­, ç›´æ¥æŠ„ä¹¦, æˆ‘ä»¬å°†åªè¦†å†™å…¶ä¸­ä¸¤ä¸ªè™šå‡½æ•°:</p>
<figure class="highlight rust"><figcaption><span>src/custom_button/imp.rs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::Cell;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> gtk::glib;</span><br><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="keyword">use</span> gtk::subclass::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object holding the state</span></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">CustomButton</span></span> &#123;</span><br><span class="line">    number: Cell&lt;<span class="built_in">i32</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The central trait for subclassing a GObject</span></span><br><span class="line"><span class="meta">#[glib::object_subclass]</span></span><br><span class="line"><span class="keyword">impl</span> ObjectSubclass <span class="keyword">for</span> CustomButton &#123;</span><br><span class="line">    <span class="keyword">const</span> NAME: &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span> = <span class="string">&quot;MyGtkAppCustomButton&quot;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Type</span></span> = super::CustomButton;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">ParentType</span></span> = gtk::Button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trait shared by all GObjects</span></span><br><span class="line"><span class="keyword">impl</span> ObjectImpl <span class="keyword">for</span> CustomButton &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">constructed</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.parent_constructed();</span><br><span class="line">        <span class="keyword">self</span>.obj().set_label(&amp;<span class="keyword">self</span>.number.get().to_string());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trait shared by all widgets</span></span><br><span class="line"><span class="keyword">impl</span> WidgetImpl <span class="keyword">for</span> CustomButton &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trait shared by all buttons</span></span><br><span class="line"><span class="keyword">impl</span> ButtonImpl <span class="keyword">for</span> CustomButton &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">clicked</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number.set(<span class="keyword">self</span>.number.get() + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">self</span>.obj().set_label(&amp;<span class="keyword">self</span>.number.get().to_string())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸º <code>imp::CustomButton</code> æ·»åŠ äº†ä¸€ä¸ªçŠ¶æ€, ä¹Ÿå°±æ˜¯å…¶æˆå‘˜ <code>number</code>, éšåè¦†å†™äº†ä¸¤ä¸ªè™šå‡½æ•°<br>
(è¦†å†™æ„é€ å‡½æ•°æ—¶, è¿˜å¾—è®°å¾—è°ƒç”¨ä¸€ä¸‹çˆ¶ç±»çš„æ„é€ å‡½æ•°, å®Œæˆæ•´ä¸ªæ„é€ é“¾)</p>
<p>åœ¨è¢«è¦†å†™çš„å‡½æ•°ä¸­, æˆ‘ä»¬éƒ½è°ƒç”¨äº† <code>self.obj()</code>, ä½ å¯ä»¥è§‚å¯Ÿä¸€ä¸‹å…¶ç­¾å:</p>
<figure class="highlight rust"><figcaption><span>glib::subclass::types::obj</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">obj</span></span>(&amp;<span class="keyword">self</span>) -&gt; crate::BorrowedObject&lt;Self::Type&gt;</span><br></pre></td></tr></table></figure>
<p>è¿˜è®°å¾— <code>Self::Type</code> æ˜¯ä»€ä¹ˆå—? æ²¡é”™, å°±æ˜¯è¢«æš´éœ²çš„é‚£ä¸ª <code>CustomButton</code>, è€Œé <code>imp::CustomButton</code>, å®ƒæ‰æ˜¯è¢«ä½¿ç”¨çš„çœŸæ­£å®ä¾‹(instance)<br>
æ­¤å¤„çš„ <code>obj()</code> æ–¹æ³•, å…¶åˆ«åå°±æ˜¯ <code>instance()</code>, å¾—åˆ°çš„æ˜¯åœ¨ <code>main.rs</code> ä¸­è¢«åˆ›å»ºçš„é‚£ä¸ªçœŸæ­£å®ä¾‹çš„å¼•ç”¨</p>
<p>é¡ºä¾¿å†å¤ä¹ ä¸€ä¸‹, é˜²æ­¢æœ‰äººçœ‹è§è¿™é‡Œè€Œæ„Ÿç–‘æƒ‘: ä¸ºä»€ä¹ˆæ˜¯ <code>clicked(&amp;self)</code> è€Œé <code>clicked(&amp;mut self)</code>, è¿™æ ·ä¸åº”è¯¥æ›´æ–¹ä¾¿å—?<br>
è¿™æ˜¯å› ä¸ºæ¯ä¸ª GObject éƒ½æ˜¯å¼•ç”¨è®¡æ•°çš„, æ‰€ä»¥èƒ½ç»•è¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥(å…¨æ˜¯ä¸å¯å˜å€Ÿç”¨), ä¹‹å‰æåˆ°è¿‡äº†</p>
<p>ç»è¿‡è¦†å†™è™šå‡½æ•°, <code>CustomButton</code> ç»ˆäºå‡ºç°äº†æœ‰åˆ«äºçˆ¶ç±» <code>Button</code> çš„æ–°ç‰¹æ€§:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è¢«æ„é€ æ—¶: åˆå§‹åŒ– label ä¸ºè‡ªå·±å­˜å‚¨çš„çŠ¶æ€æ•°å­—</p>
</li>
<li class="lvl-2">
<p>è¢«ç‚¹å‡»æ—¶: ä¼šè®©å­˜å‚¨çš„çŠ¶æ€æ•°å­—+1, éšåæ›´æ–° label</p>
</li>
</ul>
<p>ç°åœ¨è°ƒç”¨ <code>mold -run cargo run</code>, ä½ å°†å¾—åˆ°ä¸€ä¸ªæŒ‰é’®, æŒ‰é’®çš„ label åˆå§‹æ—¶ä¸º 0, è¢«ç‚¹å‡»åä¸æ–­+1</p>
<hr>
<h1 id="shi-yong-qing-kuang">ä½¿ç”¨æƒ…å†µ</h1>
<p>ä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆä½¿ç”¨ <code>glib::wrapper</code> æ¥æ¨¡æ‹Ÿç»§æ‰¿å‘¢ (Rust è¯­è¨€å±‚é¢ä¸Šä¸æ”¯æŒç»§æ‰¿, å› æ­¤å«æ¨¡æ‹Ÿ)</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ä½¿ç”¨ä¸€ä¸ª widget, å…¶æ·»åŠ äº†è‡ªå®šä¹‰çŠ¶æ€ä¸è¦†å†™è™šå‡½æ•°</p>
</li>
<li class="lvl-2">
<p>å°† Rust å¯¹è±¡ä¼ é€’ç»™è¦æ±‚å‚æ•°æ˜¯ GObject çš„å‡½æ•° (å› ä¸º gtk ä¸åªæ˜¯ Rust çš„GUIæ¡†æ¶, è¿˜æ˜¯å…¶ä»–è®¸å¤šè¯­è¨€çš„ GUI æ¡†æ¶)</p>
</li>
<li class="lvl-2">
<p>ä¸ºæŸä¸ªå¯¹è±¡æ·»åŠ  property æˆ– signal, ç»§æ‰¿ glib ä½“ç³»ä¸‹çš„å¼ºå¤§åŠ›é‡ (ä¸‹é¢å‡ èŠ‚ä¼šè®²)</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p5~&gt; GObject: é€šç”¨ç±»å‹</title>
    <url>/posts/rust-gtk4/p5.html</url>
    <content><![CDATA[<blockquote>
<p>æœ¬èŠ‚å°†å­¦ä¹  GObject çš„ generic-values(é€šç”¨å€¼), äº†è§£ glib çš„é€šç”¨ä½“ç³», ä¸åºåˆ—åŒ–çš„ä»£ç </p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
<h1 id="shuo-ming">è¯´æ˜</h1>
<p>ä¹‹å‰è¯´è¿‡, gnomeä½“ç³»ä¾èµ–äº glib, ä»¥Cè¯­è¨€ä¸ºæ ¸å¿ƒçš„å®ç°, é€šè¿‡ Gobject-Introspection ä¸ºå¤§é‡è¯­è¨€æä¾›ç»‘å®š<br>
è¿™æ˜¯ä¸€å¥—ä»¥Cä¸ºæ ¸å¿ƒ, æ”¯æŒå¤šè¯­è¨€äº’ç›¸äº¤äº’çš„è¿è¡Œæ—¶ç³»ç»Ÿ, è‡ªç„¶è¦æœ‰å¥—å®Œæ•´ä¸”å¤Ÿé€šç”¨çš„æ•°æ®ç±»å‹</p>
<p>åœ¨ä¸ºRustæä¾›çš„ç»‘å®šä¸­, æœ‰ä¸¤å¥—è¿™æ ·çš„æ•°æ®ç±»å‹, åˆ†åˆ«æ˜¯:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>glib::Value</code>: ä½œç”¨äº rust ä¸ glib ä¹‹é—´æ•°æ®ç±»å‹çš„äº’ç›¸è½¬æ¢</p>
</li>
<li class="lvl-2">
<p><code>glib::Variant</code>: ä½œç”¨äºæ•°æ®ç±»å‹çš„åºåˆ—åŒ–/ååºåˆ—åŒ–, ä»¥ä½¿åº”ç”¨ä¸å¤–éƒ¨ä¸–ç•Œ(æ¯”å¦‚æŸä¸ªè¿›ç¨‹)äº¤äº’, æˆ–å­˜å‚¨æ•°æ®åˆ°æœ¬åœ°ç£ç›˜</p>
</li>
</ul>
<p>ä¹‹åå­¦ä¹ å±æ€§ä¸ä¿¡å·æ—¶, æˆ‘ä»¬å°†ä¼šç”¨åˆ° <code>glib::Value</code>, å³ <code>GValue</code>, è®© rust ä¸­çš„æ•°æ®ç±»å‹ èƒ½ä¸ glib çš„åº“å‡½æ•°äº’ç›¸äº¤äº’<br>
ä¹‹åå­¦ä¹ åå¥½æŒä¹…åŒ–/è®¾ç½®ä¿å­˜æ—¶, æˆ‘ä»¬å°†ä¼šç”¨åˆ° <code>glib::Variant</code>, å³ <code>GVariant</code>, è¿›è¡Œæ•°æ®çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</p>
<p>ææ¸…æ¥šä»¥ä¸Šçš„è¯´æ˜ä¹‹å, æ¥ä¸‹æ¥çš„éš¾åº¦ä¾¿æ˜¯ä¸€é©¬å¹³å·, åªéœ€ç¨å¾®çœ‹å‡ çœ¼æœ‰ä¸ªå°è±¡, åˆ°æ—¶å€™å¤šæŸ¥æŸ¥æ–‡æ¡£å°± ok äº†<br>
æ¥ä¸‹æ¥çš„ä»£ç ç›´æ¥æŠ„å®˜æ–¹ä¹¦ç±äº†, ä¸è¿‡åŠ äº†å¤§é‡è§£é‡Š, å¸Œæœ›æœ‰åŠ©äºä½ ç†è§£å®ƒä»¬</p>
<hr>
<h1 id="value">Value</h1>
<p>ä½ å¯ä»¥ç®€å•åœ°å°† <code>glib::Value</code> ç†è§£ä¸ºä¸€ä¸ª Wrapper ç±»å‹, å¦‚æœç”¨ rust ä¸­çš„ enum æ¥è¡¨ç¤º, å®ƒå¯ä»¥æ˜¯è¿™æ ·çš„:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Value</span></span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="built_in">bool</span>(<span class="built_in">bool</span>),</span><br><span class="line">    <span class="built_in">i8</span>(<span class="built_in">i8</span>),</span><br><span class="line">    <span class="built_in">i32</span>(<span class="built_in">i32</span>),</span><br><span class="line">    <span class="built_in">u32</span>(<span class="built_in">u32</span>),</span><br><span class="line">    <span class="built_in">i64</span>(<span class="built_in">i64</span>),</span><br><span class="line">    <span class="built_in">u64</span>(<span class="built_in">u64</span>),</span><br><span class="line">    <span class="built_in">f32</span>(<span class="built_in">f32</span>),</span><br><span class="line">    <span class="built_in">f64</span>(<span class="built_in">f64</span>),</span><br><span class="line">    <span class="comment">// boxed-types</span></span><br><span class="line">    <span class="built_in">String</span>(<span class="built_in">Option</span>&lt;<span class="built_in">String</span>&gt;),</span><br><span class="line">    Object(<span class="built_in">Option</span>&lt;<span class="keyword">dyn</span> IsA&lt;glib::Object&gt;&gt;),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šè§‚å¯Ÿåˆ° <code>boxed-types(è£…ç®±ç±»å‹)</code> è¿™å‡ ä¸ªå­—, å®ƒåŒ…è£…ä¸€ä¸ª rust ä¸­çš„ <code>Option&lt;T&gt;</code> ç±»å‹<br>
å³, boxed-types, å¯æ¥å—åŒ…è£… <code>Option&lt;T&gt;::None</code>, ä»¥æ­¤æ¥è¡¨ç¤ºå¯ç©ºè¿™ä¸ªæ¦‚å¿µ</p>
<p>æ­¤æ—¶, è£…ç®±æ‰€å¾—çš„ç»“æœ, æ˜¯ä¸ªä»£è¡¨ç€Cè¯­è¨€ä¸­ <code>null</code> æ¦‚å¿µçš„ä¸œè¥¿, è€Œå…¶ä»–çš„å¦‚æ•°å­—/å¸ƒå°”ç±»å‹çš„ GValue, åˆ™ä¸å…è®¸åŒ…è£… <code>None</code></p>
<p>å¬ç€äº‘é‡Œé›¾é‡Œçš„? é‚£å°±ç›´æ¥çœ‹ä»£ç å§, ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­, æˆ–è®¸èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£:</p>
<figure class="highlight rust"><figcaption><span>non-boxed-types example:</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// Store `i32` as `Value`</span></span><br><span class="line">    <span class="keyword">let</span> integer_value = <span class="number">10</span>.to_value();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve `i32` from `Value`</span></span><br><span class="line">    <span class="keyword">let</span> integer = integer_value</span><br><span class="line">        .get::&lt;<span class="built_in">i32</span>&gt;()</span><br><span class="line">        .expect(<span class="string">&quot;The value needs to be of type `i32`.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the retrieved value is correct</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(integer, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><figcaption><span>boxed-types example:</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// Store `Option&lt;String&gt;` as `Value`</span></span><br><span class="line">    <span class="keyword">let</span> string_some_value = <span class="string">&quot;Hello!&quot;</span>.to_value();</span><br><span class="line">    <span class="keyword">let</span> string_none_value = None::&lt;<span class="built_in">String</span>&gt;.to_value();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve `String` from `Value`</span></span><br><span class="line">    <span class="keyword">let</span> string_some = string_some_value</span><br><span class="line">        .get::&lt;<span class="built_in">Option</span>&lt;<span class="built_in">String</span>&gt;&gt;()</span><br><span class="line">        .expect(<span class="string">&quot;The value needs to be of type `Option&lt;String&gt;`.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> string_none = string_none_value</span><br><span class="line">        .get::&lt;<span class="built_in">Option</span>&lt;<span class="built_in">String</span>&gt;&gt;()</span><br><span class="line">        .expect(<span class="string">&quot;The value needs to be of type `Option&lt;String&gt;`.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the retrieved value is correct</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(string_some, <span class="literal">Some</span>(<span class="string">&quot;Hello!&quot;</span>.to_string()));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(string_none, <span class="literal">None</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ä½ å¸Œæœ›åŒºåˆ†å¯ä»¥è¡¨ç¤ºç©ºçš„Value, åªéœ€å°† <code>get::&lt;String&gt;</code> æ¢æˆ <code>get::&lt;Option&lt;String&gt;&gt;</code> å³å¯, å‡½æ•°ä¼šè‡ªåŠ¨å¸®ä½ è¿›è¡Œè½¬æ¢</p>
<figure class="highlight rust"><figcaption><span>directly use `get::&lt;String&gt;` instead of `get::&lt;Option&lt;String&gt;&gt;` if you are sure it is not none:</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// Store string as `Value`</span></span><br><span class="line">    <span class="keyword">let</span> string_value = <span class="string">&quot;Hello!&quot;</span>.to_value();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve `String` from `Value`</span></span><br><span class="line">    <span class="keyword">let</span> string = string_value</span><br><span class="line">        .get::&lt;<span class="built_in">String</span>&gt;()</span><br><span class="line">        .expect(<span class="string">&quot;The value needs to be of type `String`.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the retrieved value is correct</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(string, <span class="string">&quot;Hello!&quot;</span>.to_string());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†åœ¨ä¹‹åå­¦ä¹  ä¿¡å·(signal) ä¸ å±æ€§(property) æ—¶, ä½¿ç”¨åˆ° <code>glib::Value</code></p>
<hr>
<h1 id="variant">Variant</h1>
<p>æ•°æ®è¦å‘é€åˆ°æŸä¸ªè¿›ç¨‹æˆ–ç½‘ç»œ, æˆ–æƒ³å°†æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šæ—¶, å°±å¯ä»¥ä½¿ç”¨ <code>glib::Variant</code><br>
ä½ å¯ä»¥å°† <code>glib::Variant</code> æƒ³è±¡ä¸º json æ–‡æœ¬, é‚£æ˜¯ä¸€ç§éå¸¸é€šç”¨çš„æ–‡ä»¶æ ¼å¼</p>
<p>æ ¹æ®æ–‡æ¡£æ‰€è¿°:<br>
glib ä¸­çš„ Variant, è¢«è®¾è®¡ä¸ºä¸ dbus ä½“ç³»æœ‰ç€åŸºæœ¬ç›¸åŒçš„æ ¼å¼, èƒ½å¤Ÿæ–¹ä¾¿ä¸ dbus é›†æˆ<br>
Variant åœ¨å¤„ç†åºåˆ—åŒ–å½¢å¼çš„æ•°æ®æ–¹é¢è¿›è¡Œäº†å¤§é‡ä¼˜åŒ–, å¯åœ¨å¾ˆçŸ­çš„å¸¸é‡æ—¶é—´å†…, æ‰§è¡Œå‡ ä¹æ‰€æœ‰çš„ååºåˆ—åŒ–æ“ä½œï¼Œä¸”å ç”¨éå¸¸å°çš„å†…å­˜<br>
åºåˆ—åŒ–çš„ Variant æ•°æ®ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œå‘é€</p>
<p>å› æ­¤ä½ å¸Œæœ›æ›´æ·±å…¥å­¦ä¹ , å¯ä»¥æŸ¥æ‰¾ dbus çš„ç›¸å…³èµ„æ–™, è¿™ä¸åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« èŒƒå›´å†…</p>
<p>ä¸ä½¿ç”¨ <code>glib::Value</code> çš„ç»éªŒéå¸¸ç›¸ä¼¼, æˆ‘ä»¬åªéœ€è¦å°† <code>to_value()</code> æ›¿æ¢ä¸º <code>to_variant()</code>:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// Store `i32` as `Variant`</span></span><br><span class="line">    <span class="keyword">let</span> integer_variant = <span class="number">10</span>.to_variant();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Retrieve `i32` from `Variant`</span></span><br><span class="line">    <span class="keyword">let</span> integer = integer_variant</span><br><span class="line">        .get::&lt;<span class="built_in">i32</span>&gt;()</span><br><span class="line">        .expect(<span class="string">&quot;The variant needs to be of type `i32`.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the retrieved value is correct</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(integer, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¾‹å­, ä»¥ä¸‹ä»£ç å°†å®ç° <code>Vec&lt;T&gt;</code> ä¸ <code>glib::Variant</code> é—´çš„äº’ç›¸è½¬åŒ–:</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> gtk::prelude::*;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> variant = <span class="built_in">vec!</span>[<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;there!&quot;</span>].to_variant();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(variant.n_children(), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> vec = &amp;variant</span><br><span class="line">        .get::&lt;<span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt;&gt;()</span><br><span class="line">        .expect(<span class="string">&quot;The variant needs to be of type `String`.&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec[<span class="number">0</span>], <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†åœ¨ä½¿ç”¨ <code>gio::Settings</code> ä¿å­˜è®¾ç½®, æˆ–ä½¿ç”¨ <code>gio::Action</code> æ¿€æ´»æ“ä½œæ—¶ï¼Œç”¨åˆ° <code>glib::Variant</code></p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p6~&gt; GObject: å±æ€§</title>
    <url>/posts/rust-gtk4/p6.html</url>
    <content><![CDATA[<blockquote>
<p>æœ¬èŠ‚å°†å­¦ä¹  GObject çš„ property(å±æ€§), æ¢ç´¢å…¶å¼ºå¤§ä¸”çµæ´»çš„åŠ¨æ€è¿è¡Œæ—¶</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
<h1 id="shuo-ming">è¯´æ˜</h1>
<p>å±æ€§(Property), è®©æˆ‘ä»¬èƒ½å¤Ÿè®¿é—® GObject çš„çŠ¶æ€(state)</p>
<p>glib è™½ç„¶ä»¥é¢å‘è¿‡ç¨‹çš„ C ä¸ºæ ¸å¿ƒ, ä½†å´å…·æœ‰é¢å‘å¯¹è±¡çš„æ€æƒ³, å±æ€§è‡ªç„¶æ˜¯å…¶ä¸­é‡è¦çš„ä¸€ç¯<br>
é€šè¿‡åº“ä¸ºæˆ‘ä»¬æä¾›çš„è¿è¡Œæ—¶, æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªçµæ´»çš„, åŠ¨æ€çš„è¿è¡Œæ—¶, ç›´æ¥ä½¿ç”¨å°±å¥½</p>
<p>å¾—ç›Šäºæ­¤, æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­, åŠ¨æ€åœ°ä¿®æ”¹å…¶å±æ€§, æ¯”å¦‚:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åŠ¨æ€æ³¨å†ŒæŸä¸ªæ–°çš„å±æ€§</p>
</li>
<li class="lvl-2">
<p>è¿›è¡Œå±æ€§é—´çš„è‡ªåŠ¨ç»‘å®š</p>
</li>
<li class="lvl-2">
<p>å±æ€§å˜æ›´æ—¶å°†æ‰§è¡Œæ“ä½œ</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-gtk4-p7~&gt; GObject: ä¿¡å·</title>
    <url>/posts/rust-gtk4/p7.html</url>
    <content><![CDATA[<blockquote>
<p>æœ¬èŠ‚å°†å­¦ä¹  GObject çš„ signal(ä¿¡å·)</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/rust-gui">rust-gui</a><br>
GNOMEå…¥å‘æŒ‡å—: <a href="/posts/desktop-beautify/gnome">gnome</a></p>
]]></content>
      <tags>
        <tag>Rust</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>high-school-it-p1~&gt; æ•°æ®ä¸ä¿¡æ¯</title>
    <url>/posts/high-school-it/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç« æ˜¯ä¸€äº›å°å°çš„æ¦‚å¿µ, æ¶‰åŠäº†æ•°æ®ä¸ä¿¡æ¯çš„å®šä¹‰, åŠä¹‹é—´çš„å…³ç³»ä¸åŒºåˆ«</p>
</blockquote>
<span id="more"></span>
<p>æˆ‘ä»¬ä¼šå­¦ä¹ æ•°æ®(Data), ä¿¡æ¯(Information), çŸ¥è¯†(Knowledge)çš„æ¦‚å¿µ<br>
å½“ç„¶, ä½ å¯ä»¥è·³è¿‡æœ¬èŠ‚, å› ä¸ºè€ƒè¯•ä¸è€ƒ, æ­¤ç¯‡ä»…ä¸ºå•çº¯ç§‘æ™®</p>
<h1 id="shu-ju-de-ding-yi">æ•°æ®çš„å®šä¹‰</h1>
<p>æ•°æ®(Data), æ˜¯ä¸€ç§ç¬¦å·è¡¨ç¤º, åŒ…æ‹¬å›¾å½¢ç¬¦å·, æ•°å­—, å­—æ¯ç­‰<br>
ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ•°æ®æœ‰ä¹¦ä¸Šçš„æ–‡å­—, è‰ç¨¿çº¸ä¸Šçš„æ•°å­—, ä¿¡æ¯æ—¶ä»£çš„æ•°æ®æœ‰ç”µè„‘ä¸­çš„éŸ³é¢‘, å›¾åƒ, æ–‡ä»¶ç­‰<br>
æ•°æ®ä»…ä¸ºä¸€ç§å®¢è§‚å±‚é¢ä¸Šçš„è½½ä½“, å¦‚æœæ²¡æœ‰ä¸»è§‚ä¸Šçš„ç†è§£, å…¶å®Œå…¨æ²¡æœ‰æ„ä¹‰, ä¸¾ä¸ªä¾‹å­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ä½ æ˜¯ä½å±±é¡¶æ´äºº, çœ‹è§äº†ä»æœªæ¥ç©¿æ¢­è€Œæ¥çš„è‰ç¨¿çº¸, ä¸Šé¢è®°è½½ç€çˆ±å› æ–¯å¦çš„ç›¸å¯¹è®º, ä½ æ— æ³•ç†è§£</p>
</li>
<li class="lvl-2">
<p>ä½ æ˜¯ä½ç°ä»£çš„ç§‘å­¦å®¶, æ¥å—è¿‡é«˜ç­‰æ•™è‚², æ­£åœ¨ç ”ç©¶ç›¸å¯¹è®º, ä½ å¯ä»¥ç†è§£</p>
</li>
</ul>
<p>ä¸Šé¢çš„ä¸¤ç§æƒ…å†µä¸­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>è®°è½½åœ¨çº¸ä¸Šçš„ç›¸å¯¹è®ºçš„æ–‡å­—</code> å°±æ˜¯æ•°æ®, å±äºå®¢è§‚å±‚é¢</p>
</li>
<li class="lvl-2">
<p><code>å±±é¡¶æ´äºº/ç§‘å­¦å®¶</code> çœ‹è§ç›¸å¯¹è®ºçš„ä¸¤ç§æ€åº¦, å±äºä¸»è§‚å±‚é¢</p>
</li>
</ul>
<p>æ²¡æœ‰ä¸»è§‚å±‚é¢ä¸Šçš„ç†è§£, æ•°æ®ä¾¿åªæ˜¯ä¸€å¼ åºŸçº¸, æ¯«æ— æ„ä¹‰</p>
<hr>
<h1 id="xin-xi-de-ding-yi">ä¿¡æ¯çš„å®šä¹‰</h1>
<p>è™½ç„¶æ•°æ®æ˜¯å®¢è§‚çš„, ä½†ä½ å¯ä»¥é€šè¿‡æ•°æ®è·å–ä¿¡æ¯, è·å–çš„ä¿¡æ¯å› äººè€Œå¼‚, å› æ­¤è¿‡ç¨‹æ˜¯ä¸»è§‚çš„ (æƒ³è±¡å±±é¡¶æ´äººä¸ç§‘å­¦å®¶çš„ä¾‹å­)<br>
å…¶å®ç›®å‰ä»ç„¶æ²¡æœ‰å¯¹ä¿¡æ¯çš„å…·ä½“å®šä¹‰, æ¯•ç«Ÿè¿™ä¸œè¥¿ç„ä¹, å› è§‚å¯Ÿè§’åº¦, ç ”ç©¶ç›®çš„ç­‰ä¸åŒè€Œå­˜åœ¨ä¸åŒçš„å®šä¹‰</p>
<p>ä¿¡æ¯è®ºä¹‹çˆ¶, é¦™å†œ, å¯¹æ­¤å°±æœ‰ä¸€å¥—ç†è§£: â€œä¿¡æ¯æ˜¯ç”¨æ¥æ¶ˆé™¤éšæœºä¸ç¡®å®šæ€§çš„ä¸œè¥¿â€, è¿™é€šå¸¸è¢«çœ‹ä½œç»å…¸å®šä¹‰<br>
æ¯”å¦‚, å½“ä½ å‘æœ‹å‹æè¿°ä¸€å°ç”µè„‘ç¬”è®°æœ¬, æœ‰ä»¥ä¸‹ä¸åŒç‰ˆæœ¬:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è¿™æ˜¯ä¸€å°ç”µè„‘ç¬”è®°æœ¬</p>
</li>
<li class="lvl-2">
<p>è¿™æ˜¯ä¸€å°å±å¹•å¤§å°ä¸º15.6è‹±å¯¸çš„ç”µè„‘ç¬”è®°æœ¬</p>
</li>
<li class="lvl-2">
<p>è¿™æ˜¯ä¸€å°å±å¹•å¤§å°ä¸º15.6è‹±å¯¸, æ”¯æŒtype-cæ¥å£çš„ç”µè„‘ç¬”è®°æœ¬</p>
</li>
<li class="lvl-2">
<p>è¿™æ˜¯ä¸€å°å±å¹•å¤§å°ä¸º15.6è‹±å¯¸, æ”¯æŒtype-cæ¥å£, 16GBå†…å­˜çš„ç”µè„‘ç¬”è®°æœ¬</p>
</li>
</ul>
<p>ä½ ä¼šçœ‹åˆ°, ä¿¡æ¯è¶Šå¤š, è¶Šèƒ½æ¶ˆé™¤éšæœºä¸ç¡®å®šæ€§</p>
<hr>
<h1 id="xin-xi-de-te-zheng">ä¿¡æ¯çš„ç‰¹å¾</h1>
<p>æˆ‘ä»¬é€šè¿‡é¦™å†œå¯¹ä¿¡æ¯çš„å®šä¹‰, ä¸ä¸€ä¸ªä¾‹å­, å¤§æ¦‚æ‡‚å¾—äº† â€œä¿¡æ¯æ˜¯ç”¨æ¥æ¶ˆé™¤éšæœºä¸ç¡®å®šæ€§çš„ä¸œè¥¿â€<br>
ä½†æˆ‘ä»¬è¿˜å¾—äº†è§£æ›´å¤šå…³äº&quot;ä¿¡æ¯&quot;çš„ä¿¡æ¯, æ¥å®Œå–„&quot;ä¿¡æ¯&quot;çš„å®šä¹‰, æ¥åŠ é€Ÿç†è§£</p>
<p>ä¸‹é¢æ˜¯ä¿¡æ¯çš„5ä¸ªç‰¹å¾, æ•™ç§‘ä¹¦ä¸Šæ¬çš„:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>è½½ä½“ä¾é™„æ€§<br>
ä¿¡æ¯ä¸èƒ½ç‹¬ç«‹å­˜åœ¨, å®ƒæ˜¯è™šçš„, å¿…é¡»æœ‰è½½ä½“<br>
æ¯”å¦‚çè´µçš„å¤ä»£æ–‡çŒ®, æœ‰å¥½å¤šéƒ½å¤±ä¼ äº†, å°±æ˜¯å› ä¸ºè®°è½½ç€ä¿¡æ¯çš„è½½ä½“, ä¹Ÿå°±æ˜¯ä¹¦ç±, é­å—æŸå®³, å¯¼è‡´ä¿¡æ¯ä¸¢å¤±</p>
</li>
<li class="lvl-2">
<p>ä¸æŸè€—æ€§ä¿¡æ¯åœ¨ä¼ æ’­çš„è¿‡ç¨‹ä¸­, æ˜¯ä¸ä¼šå‘ç”ŸæŸè€—çš„</p>
</li>
<li class="lvl-2">
<p>æ—¶æ•ˆæ€§<br>
ä¿¡æ¯å¾€å¾€åæ˜ çš„æ˜¯æŸäº‹ç‰©ç‰¹å®šæ—¶é—´å†…çš„çŠ¶å†µ, ä½†äº‹ç‰©ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜<br>
æ¯”å¦‚ â€œå¤ªé˜³äº®ç€â€ è¿™æ¡ä¿¡æ¯, ä¸€ç™¾ä¸‡äº¿äº¿äº¿å¹´åå¤ªé˜³ç»å£ç†„ç­äº†, ä½ æ•¢è¯´è¿™æ¡ä¿¡æ¯æ°¸è¿œé€‚ç”¨?</p>
</li>
<li class="lvl-2">
<p>å…±äº«æ€§<br>
ä¿¡æ¯å¯ä»¥è¢«å…±äº«, å¯ä»¥è¢«é‡å¤åˆ©ç”¨, ä¸åƒèƒ½æºé‚£æ ·ä¼šå‘ç”ŸæŸè€—<br>
æ¯•ç«Ÿä¿¡æ¯æ˜¯è™šçš„, ä¸æ˜¯å®ç‰©, ä½ QQå‘çš„æ¶ˆæ¯, å·²ç»è¢«äººçœ‹åˆ°äº†, æ’¤å›åé‚£ä¸ªäººè¿˜æ˜¯è®°å¾—çš„</p>
</li>
<li class="lvl-2">
<p>å¯åŠ å·¥å¤„ç†æ€§/çœŸä¼ªæ€§<br>
ä¿¡æ¯èƒ½è¢«åŠ å·¥, æ¯”å¦‚è¦æ‰“ä»—äº†, è‚¯å®šè¦ç»™åœ°æ–¹ä¸€äº›å‡ä¿¡æ¯, æ¥è¿·æƒ‘æ•Œäºº<br>
åœ¨æ¯”å¦‚ <code>ç›²äººæ‘¸è±¡/ç®¡ä¸­çª¥è±¹</code>, éƒ½ä½“ç°äº†çœŸä¼ªæ€§</p>
</li>
<li class="lvl-2">
<p>ä»·å€¼æ€§<br>
æ¯”å¦‚å¤©æ°”é¢„æŠ¥è®©ä½ å‡ºé—¨é¿å…è¢«é›¨æ·‹æ¹¿, è¿™å°±æ˜¯ä»·å€¼<br>
å¯¹ä¸åŒçš„äºº, åŒä¿¡æ¯ä¼šäº§ç”Ÿä¸åŒçš„ä»·å€¼, æ¯”å¦‚è‹±å›½çš„å¤©æ°”é¢„æŠ¥å¯¹ä¸­å›½å±…æ°‘å°±æ²¡å¤šå¤§ä»·å€¼</p>
</li>
</ul>
<hr>
<h1 id="zhi-shi-de-ding-yi">çŸ¥è¯†çš„å®šä¹‰</h1>
<p>ä¸ç®¡æœ‰ç”¨æ— ç”¨çš„ä¿¡æ¯, é‚£éƒ½æ˜¯ä¿¡æ¯, ä½†çŸ¥è¯†æ˜¯æœ‰ç”¨çš„, èƒ½å¤Ÿè¿ç”¨åœ¨å®è·µä¸­çš„ä¿¡æ¯, æ˜¯äººç±»ç¤¾ä¼šçš„ç»éªŒæ€»å’Œå®ƒèƒ½å¤Ÿè¢«ç»§æ‰¿, è¢«ä¼ é€’, è¿™æ˜¾è€Œæ˜“è§, æ¯•ç«Ÿå®ƒæœ¬èº«å°±æ˜¯ä¿¡æ¯çš„çœŸå­é›†, äººç±»å°±æ˜¯ä¾é çŸ¥è¯†çš„ç»§æ‰¿è€Œä¸æ–­å‘å±•çš„<br>
æŒ‡çš„æ˜¯äººä»¬å·²ç»æŒæ¡çš„èƒ½åŠ›</p>
<p>è¿™éƒ¨åˆ†å¾ˆç®€å•, ç®€å•æ¦‚è¿°å³å¯, ä½†è¯·æ³¨æ„ä¸è¦ä¸ä¸‹é¢çš„ <code>æ™ºæ…§çš„å®šä¹‰æé”™äº†</code></p>
<hr>
<h1 id="zhi-hui-de-ding-yi">æ™ºæ…§çš„å®šä¹‰</h1>
<p>ä¸€èˆ¬æŒ‡äººä»¬è¿ç”¨æ‰€æŒæ¡çš„ä¿¡æ¯, çŸ¥è¯†, åœ¨é¢å¯¹æ–°äº‹ç‰©æ—¶æ‰€å‘æŒ¥çš„èƒ½åŠ›</p>
<hr>
<h1 id="zong-jie">æ€»ç»“</h1>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„, å¯¹ä¸‰è€…è¿›è¡Œäº†åŒºåˆ†çš„ä¾‹å­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ•°æ®: äººä»¬çœ‹åˆ°çš„3.1415926, è¿™æ˜¯å®¢è§‚çš„æ•°å­—, æ˜¯è¡¨è¾¾ç¬¦å·</p>
</li>
<li class="lvl-2">
<p>ä¿¡æ¯: äººä»¬çŸ¥é“åœ†å‘¨ç‡å°±æ˜¯3.1415926</p>
</li>
<li class="lvl-2">
<p>çŸ¥è¯†: äººä»¬çŸ¥é“å¦‚ä½•æ±‚è§£åœ†çš„é¢ç§¯æ¥è§£å†³ç°å®é—®é¢˜</p>
</li>
<li class="lvl-2">
<p>æ™ºæ…§: åˆ˜å¾½åœ¨è½åçš„æ—¶ä»£èƒŒæ™¯ä¸‹, é¢å¯¹å¦‚ä½•æ±‚è§£ pai æ—¶åˆ›é€ äº†å‰²åœ†æœ¯</p>
</li>
</ul>
<p>è¿™æ˜¯æˆ‘èŠ±äº†äºŒååˆ†é’Ÿå†™çš„, æ¯•ç«Ÿåªæ˜¯ç®€å•åœ°æŠ„äº†ä¸‹æ•™ç§‘ä¹¦, è€ƒè¯•ä¹Ÿä¸è€ƒ, å§‘ä¸”å°±è¿™æ ·å§, ç´¯äº†<br>
æ‚¨å¯ä»¥çœ‹ä¹‹åçš„pythonè¯­æ³•, æ•°æ®ç»“æ„, ç®—æ³•, å†…å­˜ç­‰æ–¹é¢çš„æ–‡å­—, ç­‰è¯¾ä¸Šåˆ°äº†æˆ‘åº”è¯¥å°±ä¼šæ›´æ–°â€¦</p>
]]></content>
      <tags>
        <tag>é«˜ä¸­ä¿¡æ¯æŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>high-school-it-p2~&gt; åŸºç¡€ç§‘æ™®</title>
    <url>/posts/high-school-it/p2.html</url>
    <content><![CDATA[<blockquote>
<p>è®©æˆ‘ä»¬äº†è§£ä¸‹python, é¡ºä¾¿ç§‘æ™®ä¸€äº›å¸¸è¯†, è¿›è¡Œç¯å¢ƒæ­å»º, å†™ä¸€ä¸ªHello Worldå§!</p>
</blockquote>
<span id="more"></span>
<p><strong>æ³¨æ„:</strong><br>
æœ¬æ–‡æ˜¯åå‘åˆå­¦è€…çš„ç§‘æ™®æ€§æ–‡ç« , è¯­è¨€å°½é‡å°ç™½åŒ–, æˆ–å› æ­¤ä¸§å¤±ä¸€å®šçš„ä¸¥è°¨, æœ›ç†è§£</p>
<h1 id="bian-yi-yu-jie-shi">ç¼–è¯‘ä¸è§£é‡Š</h1>
<p>è®¡ç®—æœºæ˜¯äºŒè¿›åˆ¶çš„, åªè®¤è¯†äºŒè¿›åˆ¶, ä½†ä½ ä¸å¯èƒ½æ‰‹å†™äºŒè¿›åˆ¶<br>
c/cpp/python ç­‰ç¼–ç¨‹è¯­è¨€, è®©ä½ å†™äººç±»å¯ç†è§£çš„ â€œä»£ç â€, ç„¶åå°†å®ƒä»¬ â€œè½¬åŒ–â€ ä¸ºäºŒè¿›åˆ¶åä¾›æœºå™¨æ‰§è¡Œ</p>
<p>åæ­£è®°ä½ä¸€ç‚¹:<br>
æœºå™¨æ— æ³•ç†è§£ä»£ç , å®ƒåªç†è§£äºŒè¿›åˆ¶, ä½†ä½ èƒ½é€šè¿‡ç¨‹åº, å°†ä»£ç è§£æä¸ºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶, å³ <code>.exe</code> ç»“å°¾çš„æ–‡ä»¶<br>
æˆ‘ä»¬å°†ä»£ç è¢«è§£æä¸ºäºŒè¿›åˆ¶çš„è¿‡ç¨‹, ç§°ä¸º â€œç¼–è¯‘â€, å°†è§£æå·¥å…·, ç§°ä¸º â€œç¼–è¯‘å™¨â€</p>
<p>å½“ç„¶, python ç‰¹æ®Šä¸€äº›, ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯åˆ†æ®µçš„, å…ˆç¼–è¯‘ä¸€æ®µ, å†æ‰§è¡Œè¿™æ®µäºŒè¿›åˆ¶, é‡å¤, ç›´åˆ°å…¨éƒ¨è§£æå®Œæ¯•<br>
æˆ‘ä»¬å°†åˆ†æ®µç¼–è¯‘çš„è¿‡ç¨‹, ç§°ä¸º â€œè§£é‡Šâ€, å°†åˆ†æ®µç¼–è¯‘çš„å·¥å…·, ç§°ä¸º â€œè§£é‡Šå™¨â€</p>
<p>ç¼–ç¨‹è¯­è¨€, ä»¥ python ä¸ºä¾‹å­, åœ¨ä¸æ–­åœ°é«˜é€Ÿè¿­ä»£ä¸è¿›åŒ–, å› æ­¤æœ‰å¾ˆå¤šæ–°æ—§ç‰ˆæœ¬<br>
æ–°ç‰ˆæœ¬çš„ python, å¯èƒ½å°±ä¼šå‡ºç°è®¸å¤šæ–°çš„å¼ºå¤§è¯­æ³•, è®©äººæ›´çˆ½åœ°ç¼–å†™ä»£ç </p>
<p>pyçš„ä»£ç å¾ˆç®€å•, ä¸åƒcè¯­è¨€è¦æ¶‰åŠåº•å±‚çš„å†…å­˜ç®¡ç†çŸ¥è¯†, ä½ ä¸éœ€å…³æ³¨åº•å±‚çš„ç¹çç»†èŠ‚, åªéœ€å…³æ³¨é€»è¾‘<br>
å› æ­¤å®ƒå‡ºç°åœ¨äº†é«˜ä¸­çš„ä¿¡æ¯æŠ€æœ¯å­¦ç§‘æ•™è‚²ä¸­, é€‚åˆåˆå­¦è€…, è™½ç„¶æˆ‘ä¸ªäººå¹¶ä¸å–œæ¬¢python ğŸ˜ƒ</p>
<p><strong>ä»£ç :</strong><br>
ä»£ç å¹¶éç‰¹æ®Šä¹‹ç‰©, ä½ å®Œå…¨èƒ½åœ¨æ¡Œé¢æ–°å»ºä¸ªtxtæ–‡ä»¶, ç„¶ååœ¨é‡Œé¢å†™ä»£ç <br>
å®ƒä»…æ˜¯æ®µæ–‡æœ¬, è‹¥æ²¡äº†ç¼–è¯‘å™¨/è§£é‡Šå™¨, ä»£ç æ¯«æ— ç”¨å¤„<br>
ç¼–è¯‘å™¨/è§£é‡Šå™¨æ‰æ˜¯æœ€é‡è¦çš„, å› ä¸ºå®ƒä»¬å¯ä»¥æ¥æ”¶æ–‡æœ¬, å°†å…¶è§£æä¸ºexeæ–‡ä»¶</p>
<p><strong>æ–‡ä»¶åç¼€:</strong><br>
æ–‡ä»¶æœ¬èº«çš„å†…å®¹, å¹¶ä¸ä¼šå› ä¿®æ”¹æ–‡ä»¶çš„åç¼€åè€Œå‘ç”Ÿæ›´æ”¹<br>
åç¼€åªä¸è¿‡èµ·åˆ°ä¸€ä¸ªè¿›è¡Œåˆ†è¾¨çš„ä½œç”¨, å½“ä½ çœ‹è§ â€œxxx.jpgâ€, å°±çŸ¥é“å®ƒæ˜¯å¼ å›¾ç‰‡, çœ‹è§ â€œxxx.txtâ€, å°±çŸ¥é“å®ƒæ˜¯æ®µæ–‡æœ¬</p>
<p>æ–‡ä»¶çš„åç¼€åªä¸è¿‡æ˜¯ä¸ªçº¦å®š, è®©äººä»¬çŸ¥é“è¯¥æ–‡ä»¶ä»£è¡¨ä»€ä¹ˆ, ä½†çº¦å®šä¸å…·æœ‰å¼ºåˆ¶æ€§<br>
windowsä¼šæ ¹æ®æ–‡ä»¶çš„åç¼€, å°è¯•ç”¨å¯¹åº”çš„å·¥å…·æ‰“å¼€è¯¥æ–‡ä»¶, æ¯”å¦‚:</p>
<p>å½“ä½ æ–°å»ºä¸ªtxt, ç„¶åå°†å…¶åç¼€æ”¹ä¸ºjpg, windowså°±ä¼šä»¥ä¸ºå®ƒæ˜¯å¼ å›¾ç‰‡, ç”¨æŸ¥çœ‹å›¾ç‰‡çš„æ–¹å¼æ¥å¤„ç†å®ƒ, æ­¤æ—¶è‡ªç„¶å°±æ— æ³•æ˜¾ç¤ºäº†<br>
ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶, ä½ éè¦æŠŠå†…å®¹æ”¹æˆä½ éšä¾¿æ•²æ‰“çš„æ–‡å­—, å·¥å…·æ— æ³•è¯†åˆ«, è‡ªç„¶å°±æ˜¯ â€œæ–‡ä»¶æŸåâ€ äº†</p>
<p>å¦‚ä½•æ˜¾ç¤ºæ–‡ä»¶åç¼€?<br>
æŒ‰ä½ â€œwin+eâ€ (â€œwinâ€ æ˜¯é”®ç›˜ä¸‹é¢çš„windowså›¾æ ‡, winä¸eä¸€èµ·æŒ‰), æ‰“å¼€æ–‡ä»¶æµè§ˆå™¨<br>
åœ¨ä¸Šæ–¹é¡¶æ , ç‚¹å‡» â€œæŸ¥çœ‹â€, éšåå‹¾é€‰å³ä¾§çš„ â€œæ–‡ä»¶æ‰©å±•åâ€, ç„¶åå…³é—­æ–‡ä»¶æµè§ˆå™¨<br>
æ­¤æ—¶, æ¡Œé¢ä¸Šçš„æ–‡ä»¶, å°±ä¼šæ˜¾ç¤ºåç¼€äº†, ä½ ä¹Ÿèƒ½é€šè¿‡é‡å‘½åä¿®æ”¹æ–‡ä»¶åç¼€äº†</p>
<hr>
<h1 id="python-de-te-dian">Pythonçš„ç‰¹ç‚¹</h1>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ˜¯ä¸€é—¨ <ins>é«˜çº§è¯­è¨€</ins></p>
</li>
<li class="lvl-2">
<p>æ˜¯ä¸€é—¨ <ins>é¢å‘å¯¹è±¡</ins> çš„è¯­è¨€</p>
</li>
<li class="lvl-2">
<p>æ˜¯ä¸€é—¨ <ins>è§£é‡Šå‹</ins> è¯­è¨€</p>
</li>
<li class="lvl-2">
<p>è¯­æ³•ç®€å•, æ‹¥æœ‰ä¸°å¯Œå¼ºå¤§çš„åº“, é€‚åˆå¿«é€Ÿå¼€å‘</p>
</li>
</ul>
<p><strong>é«˜çº§è¯­è¨€</strong><br>
è®¡ç®—æœºç•Œ, ç¼–ç¨‹è¯­è¨€å…·æœ‰ä¸€ä¸ªæ¼”åŒ–å², é‚£å°±æ˜¯è¶Šæ¥è¶Šå…·æœ‰å¯è¯»æ€§, åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æœºå™¨è¯­è¨€: ç”±äºŒè¿›åˆ¶ä»£ç ç»„æˆ, è®¡ç®—æœºå¯ä»¥è¯†åˆ«å¹¶è¿è¡Œ, ä½†äººç±»æ— æ³•ç†è§£</p>
</li>
<li class="lvl-2">
<p>æ±‡ç¼–è¯­è¨€: åŠ ä¸Šäº†è®¸å¤šç¬¦å·, é€šè¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºæœºå™¨è¯­è¨€, äººç±»ç¨å¾®å¯ä»¥ç†è§£äº†</p>
</li>
<li class="lvl-2">
<p>é«˜çº§è¯­è¨€: åŠ ä¸Šäº†éå¸¸å¤šçš„ç¬¦å·ä¸è¯­æ³•, é€šè¿‡ç¼–è¯‘å™¨/è§£é‡Šå™¨, è½¬ä¸ºæ±‡ç¼–è¯­è¨€, äººç±»å¯è¯», æ¯”å¦‚py/c/cpp</p>
</li>
</ul>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯, è¿˜æœ‰ä¸€ä¸ªå« <ins>è‡ªç„¶è¯­è¨€</ins>, åˆ«å’Œä¸Šé¢çš„ææ··äº†<br>
è‡ªç„¶è¯­è¨€æŒ‡æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­, è¿›è¡Œå¯¹è¯æ—¶ä½¿ç”¨çš„è¯­è¨€, å¦‚æ±‰è¯­/è‹±è¯­/æ³•è¯­/å¾·è¯­</p>
<p><strong>é¢å‘å¯¹è±¡</strong><br>
å‡è®¾ä½ è¦æ­ç§¯æœ¨, è¿™ä¸ªç§¯æœ¨å¾ˆå¤æ‚, é‚£ä¹ˆä½ å¯ä»¥å°†ç§¯æœ¨åˆ†è§£æˆäº”å…­ä¸ªå­å‹çš„å°ç§¯æœ¨<br>
é‚£ä¹ˆ, å¯ä»¥å…ˆæ‹¼å¥½è¿™äº”ä¸ªå°ç§¯æœ¨, ç„¶åç»„åˆæˆæ­ç§¯æœ¨, è€Œä¸æ˜¯ä¸€å—ä¸€å—æ‹¼<br>
(éä¸¥è°¨ç‰ˆ, å‹¿å–·, åªæ˜¯å¿«é€Ÿäº†è§£è€Œå·²)</p>
<p><strong>åº“:</strong><br>
å½“ä½ éœ€è¦å¼€å‘ä¸€ä¸ªæ— æ¯”å¤æ‚çš„ç¨‹åº, ä¸å¯èƒ½è‡ªå·±ä»å¤´å¼€å§‹ä¸€è¡Œä¸€è¡Œæ•², å¤ªå¤æ‚<br>
æ¯”å¦‚ä½ ç”¨Pythonæ—¶, æƒ³ä½¿ç”¨äº§ç”Ÿéšæœºæ•°çš„åŠŸèƒ½, ä¸ç”¨è‡ªå·±å†™, å®˜æ–¹å·²ç»ç»™ä½ å†™å¥½äº†, ä½ ç›´æ¥è°ƒç”¨å°±å®Œäº‹äº†</p>
<hr>
<h1 id="huan-jing-da-jian">ç¯å¢ƒæ­å»º</h1>
<p>ä½ å¯ä»¥é€‰æ‹©ç”¨å®¶é‡Œçš„ç”µè„‘ç»ƒä¹ python, è¿™æ—¶å°±éœ€è¦è‡ªå·±å®‰è£…pythonäº†<br>
<s>(ä»¥Windowsä¸ºä¾‹, æ¯•ç«Ÿä½ è¦æ˜¯ç”¨çš„æ˜¯linuxè¿˜éœ€è¦çœ‹è¿™æ­¥å—â€¦)</s></p>
<p>pythonçš„å®˜ç½‘åœ¨å›½å¤–, è®¿é—®èµ·æ¥æœ‰ç‚¹æ…¢, è®©æˆ‘ä»¬ä½¿ç”¨åä¸ºæ­å»ºçš„é•œåƒç½‘ç«™, ç‚¹å‡»æ­¤å¤„ä¸‹è½½py, ç‰ˆæœ¬æ˜¯3.9.0: <a href="https://mirrors.huaweicloud.com/python/3.9.0/python-3.9.0.exe">å®‰è£…ç¨‹åº</a><br>
è‡³äºå‡ºç°å®‰è£…ç•Œé¢åç‚¹å“ªé‡Œ, ä½ å°±è®°ä½ä¸¤ä¸ªåœ°æ–¹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å…ˆå‹¾é€‰åº•éƒ¨çš„ä¸¤ä¸ªæ¡†æ¡†, åˆ†åˆ«æ˜¯&quot;install launcher&quot; ä¸ â€œadd pathâ€, éƒ½é€‰ä¸Š</p>
</li>
<li class="lvl-2">
<p>ç‚¹å‡» â€œInstall Nowâ€ è¿›è¡Œå®‰è£…, ç­‰å¾…å®‰è£…æˆåŠŸåç›´æ¥ç‚¹å‡»close</p>
</li>
</ul>
<p>å¦‚ä½•æ£€éªŒè‡ªå·±æ˜¯å¦å®‰è£…æˆåŠŸ?<br>
è¯·æŒ‰ä½ <code>win+r</code> (winé”®æ˜¯é”®ç›˜æœ€ä¸‹é¢çš„windowå›¾æ ‡, â€œwinâ€ ä¸ â€œrâ€ è¦ä¸€èµ·æŒ‰)<br>
éšåè¾“å…¥ <code>cmd</code>, ç„¶åå†æ•²å›è½¦, ä¼šå‡ºç°ä¸€ä¸ªé»‘çª—å£, ä¸ç”¨ç†ä¼šé—ªçƒçš„ç²—ä½“å…‰æ ‡, ä¸å…‰æ ‡å‰çš„å‰ç½®æç¤º</p>
<p>è¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤, æ£€éªŒpythonæ˜¯å¦å®‰è£…æˆåŠŸ:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">python</span>  --<span class="keyword">version</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„ <code>python</code>, å°±æ˜¯å®‰è£…çš„pythonè§£é‡Šå™¨, æ˜¯ä¸ªå¯æ‰§è¡Œæ–‡ä»¶(exe)<br>
æˆ‘ä»¬æ‰§è¡Œå®ƒ, ä½†å¹¶ä¸è®©å®ƒè§£é‡Šä»£ç , æ­¤å¤„ä»…è¡¨ç¤º: è®©å®ƒè¾“å‡ºå½“å‰pythonçš„ç‰ˆæœ¬<br>
å®ƒåº”è¯¥ä¼šè¾“å‡ºç±»ä¼¼ä¸‹é¢çš„æ–‡å­—:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Python</span> <span class="number">3</span>.<span class="number">9</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯å…¶ä»–è¾“å‡º, å¾ˆå¯èƒ½æ˜¯å®‰è£…çš„æ—¶å€™, æœªå‹¾é€‰ <code>add path</code> è¿™ä¸ªæ¡†, å¯¼è‡´è·¯å¾„æ— æ³•è¢«è¯†åˆ«</p>
<div class="tips">
<p><strong>å‘½ä»¤ä¸è·¯å¾„</strong><br>
è¿™ä¸ªå‡ºç°çš„é»‘æ¡†æ¡†, ä½œç”¨æ˜¯æ‰§è¡Œä½ æ•²ä¸‹çš„å‘½ä»¤, æˆ‘ä»¬ç§°å…¶ä¸º â€œç»ˆç«¯/å‘½ä»¤è¡Œ/cmdâ€<br>
ç²—ä½“é—ªçƒçš„å…‰æ ‡å‰çš„æç¤ºç¬¦, è¡¨ç¤ºä½ å½“å‰å¤„äºçš„è·¯å¾„</p>
<p>ä½ èƒ½è¾“å…¥å‘½ä»¤, æ•²å›è½¦, æ¥è¿è¡Œè¯¥å‘½ä»¤ (å‘½ä»¤å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªexeæ–‡ä»¶)<br>
äº‹å®ä¸Š, å½“ä½ æƒ³æ‰§è¡Œå‘½ä»¤æ—¶, åº”è¾“å…¥å®ƒçš„å®Œæ•´è·¯å¾„, å‘Šè¯‰äº†windowså¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„, æ‰èƒ½æ‰§è¡Œå¯¹åº”çš„æ–‡ä»¶å˜›<br>
æ¯”å¦‚, æ•²ä¸‹ â€œC:\asdiasdadows\asdadtem32\casd.exeâ€ æ¥æ‰§è¡ŒæŸä¸ªå« casd.exe çš„å¯æ‰§è¡Œæ–‡ä»¶ (ä¹±ç¼–çš„è·¯å¾„)<br>
ä½ é¼ æ ‡ç‚¹å‡»è½¯ä»¶å›¾æ ‡å, å°±ä¼šå‡ºç°ç•Œé¢, è¿™ä¹Ÿç›¸å½“äº, åœ¨ç»ˆç«¯/å‘½ä»¤è¡Œä¸­, æ•²ä¸‹äº†å¯¹åº”çš„è·¯å¾„ ğŸ˜ƒ</p>
<p>ä½†è‹¥æœ‰ä¸ªå¾ˆå¸¸ç”¨çš„å‘½ä»¤, ä¸æƒ³æ¯æ¬¡éƒ½è¾“å®Œæ•´è·¯å¾„, åªæƒ³ç®€å•åœ°ç”¨ â€œxxxâ€ æ¥æ‰§è¡Œ â€œC:\asdad\xxx.exeâ€ è¯¥æ€ä¹ˆåŠå‘¢?<br>
è¿™æ—¶, å¯å°†è¯¥pathæ·»åŠ åˆ°ç³»ç»Ÿpathä¸­, ç„¶åä¸ºè¯¥pathå–ä¸ªåå­—, ä¹‹åè¾“å…¥è¿™åå­—, æ­¤æ—¶å°±ç›¸å½“äº, æ‰§è¡Œäº†å¯¹åº”pathæŒ‡å‘çš„æ–‡ä»¶</p>
<p>ä½ ç°åœ¨æ‡‚å¾—, ä¸ºä»€ä¹ˆåœ¨pythonçš„å®‰è£…å‘å¯¼ç¨‹åºä¸­, éœ€è¦å‹¾é€‰ä¸‹æ–¹çš„ â€œadd pathâ€ äº†å—?<br>
å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿç›´æ¥è¾“å…¥ â€œpythonâ€ æ¥æ‰§è¡Œå‘½ä»¤, è€Œä¸éœ€è¦åœ¨æ„å®ƒçš„è·¯å¾„!</p>
<p>åŒæ ·çš„é“ç†, ä½ æŒ‰ â€œwin+râ€ å, è¾“å…¥çš„ <code>cmd</code>, å…¶å®å°±ä»£è¡¨ç€, é€šè¿‡ <code>cmd</code> èƒŒåå¯¹åº”çš„è·¯å¾„, æ‰§è¡Œäº†å« <code>cmd.exe</code> çš„exeæ–‡ä»¶<br>
å› æ­¤, å‡ºç°äº†è¿™ä¸ªé»‘æ¡†æ¡† ğŸ˜ƒ</p>
<p>ä½†è¯·æ˜ç™½ä¸€ç‚¹, è¿™ä¸ªé»‘æ¡†æ¡†åªä¸è¿‡æ˜¯ä¸ª â€œå¤–å£³â€, åªæ˜¯è®©ä½ è¾“å…¥å‘½ä»¤è€Œå·², èƒ½å¤Ÿæ˜¾ç¤ºæ–‡å­—è€Œå·²<br>
çœŸæ­£æ‰§è¡Œå‘½ä»¤çš„, è¿˜æ˜¯windowsç³»ç»Ÿæœ¬èº«, ä½ åœ¨cmdä¸­æ•²ä¸‹çš„å‘½ä»¤, éƒ½ä¼šäº¤ç»™windowsç³»ç»Ÿæœ¬èº«å»æ‰§è¡Œ<br>
ä½ å¯ä»¥ â€œwin+râ€ åç›´æ¥æ•² python, ä¸åœ¨ cmd ä¸­æ•² python, æ•ˆæœæ˜¯ä¸€æ ·çš„</p>
</div>
<hr>
<h1 id="idle-de-bei-hou-yuan-li">idleçš„èƒŒååŸç†</h1>
<p>ä½ ç°åœ¨å·²ç»äº†è§£äº†å¾ˆå¤šåŸºç¡€çš„æ¦‚å¿µ/å¸¸è¯†äº†, å¯¹å§?!</p>
<p>åœ¨è¯¾å ‚ä¸Š, è€å¸ˆæ˜¯æ€ä¹ˆæ•™ä½ ä»¬ç ä»£ç çš„?  æ˜¯ä¸æ˜¯é€šè¿‡ä¸€ä¸ªå« â€œidleâ€ çš„å·¥å…·, ç¼–è¾‘ä»£ç å, ç‚¹å‡» â€œRunâ€ å¼€å§‹è¿è¡Œ? (æˆ–ç±»ä¼¼å·¥å…·)<br>
å®é™…ä¸Š, è‹¥ä½ æ˜ç™½äº†å…ˆå‰è®²çš„ â€œç¼–è¯‘å™¨/è§£é‡Šå™¨â€, è¿™ä¸ªå›¾å½¢åŒ–çš„ç•Œé¢å®é™…ä¸Šä¹Ÿå¹¶ä¸ç¥ç§˜</p>
<p>ä½ ç¼–è¾‘ä»£ç åç‚¹å‡»çš„ â€œRunâ€, å®é™…ä¸Šçš„ä½œç”¨, å°±æ˜¯è·å–ä½ ç¼–è¾‘çš„å½“å‰æ–‡ä»¶çš„è·¯å¾„, ç„¶åæŠŠè¯¥è·¯å¾„ä¼ é€’ç»™pythonè§£é‡Šå™¨, è¿›è¡Œæ‰§è¡Œ<br>
æ‰§è¡Œå, pythonè§£é‡Šå™¨æ ¹æ®ä½ çš„ä»£ç , å¯èƒ½ä¼šè¿›è¡Œè¾“å‡º, ç„¶å idle å°±ä¼šè¯¥è¾“å‡ºç²˜è¿‡æ¥, æ˜¾ç¤ºç»™ä½ , ä»…æ­¤è€Œå·²</p>
<p>æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶, ç¼–è¾‘, ç„¶åä¿å­˜, å¤åˆ¶è¯¥æ–‡ä»¶çš„è·¯å¾„, å‡è®¾è¯¥è·¯å¾„æ˜¯ â€œ<a href="http://xxx.py">xxx.py</a>â€</p>
</li>
<li class="lvl-2">
<p>åœ¨ cmd ä¸­è¾“å…¥: <code>python xxx.py</code></p>
</li>
</ul>
<hr>
<h1 id="hello-world">Hello world!</h1>
<p>æ¥åŠ æ·±å°è±¡, å†™ä¸ªéå¸¸ç®€å•çš„ç¨‹åºå§, ä½œç”¨æ˜¯æ‰“å°ä¸€å¥è¯: â€œHello world!â€<br>
è¿™æ˜¯è®¡ç®—æœºç•Œéå¸¸ç»å…¸çš„, å‡ ä¹é€‚ç”¨äºä¸€åˆ‡ç¼–ç¨‹è¯­è¨€çš„, éå¸¸ç®€å•çš„åˆå­¦è€…ä»£ç </p>
<div class="tips">
<p><strong>æ³¨æ„:</strong><br>
è¿™æ˜¯æœ¬æ•™ç¨‹å”¯ä¸€çš„ä¸€æ¬¡ä¸ç”¨idle, ç›®çš„æ˜¯ç†è§£ä¸Šé¢çš„çŸ¥è¯†, ä¹‹åçš„æ‰€æœ‰ä»£ç , éƒ½ä¼šä½¿ç”¨idleç¼–è¾‘, å› ä¸ºå°ç™½åŒ–<br>
ä½ å¯ä»¥é€‰æ‹©ç›´æ¥è·³è¿‡æœ¬èŠ‚, è¯¥è®²çš„éƒ½è®²äº†, ç‰¹åœ¨æ­¤è¯´æ˜</p>
</div>
<p>é¦–å…ˆ, åœ¨æ¡Œé¢å³é”®, æ–°å»ºä¸€ä¸ªtxtæ–‡ä»¶, å‡è®¾å®ƒå« â€œfirst_appâ€, ç„¶åå³é”®ç¼–è¾‘, è¾“å…¥ä¸‹é¢çš„å†…å®¹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello world!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>éšåæ‰“å¼€cmd/ç»ˆç«¯, ä½ çš„å½“å‰è·¯å¾„åº”è¯¥æ˜¯ â€œC:\Users\ç”¨æˆ·åâ€<br>
æˆ‘ä»¬æ–°å»ºçš„æ–‡ä»¶, åœ¨æ¡Œé¢ä¸­, æ¡Œé¢å¯¹åº”çš„æ–‡ä»¶å¤¹æ˜¯ â€œDesktopâ€, å› æ­¤æˆ‘ä»¬åº”è¯¥è¿›å…¥Desktopæ–‡ä»¶å¤¹, ç„¶åæ ¹æ®è·¯å¾„æ‰§è¡Œå®ƒ:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> Desktop</span><br><span class="line">python first_app.txt</span><br></pre></td></tr></table></figure>
<p>è¿™å°†ä¼šæ‰“å°:</p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">Hello world!</span><br></pre></td></tr></table></figure>
<p>ç§å§! ç¼–è¾‘å™¨/è§£é‡Šå™¨æœ¬èº«, æ˜¯ä¸åœ¨ä¹æ–‡ä»¶åç¼€çš„, åªåœ¨ä¹æ–‡ä»¶çš„å†…å®¹, ç„¶åè¯»å–æ–‡ä»¶çš„å†…å®¹, å°†å…¶è§£æä¸ºäºŒè¿›åˆ¶, ç„¶åè¿è¡Œ<br>
å½“ç„¶, è¿™æ ·æœ‰ä¸ªé—®é¢˜, é‚£å°±æ˜¯äººä»¬çœ‹è§å…¶åç¼€txt, ä¼šä¸‹æ„è¯†è®¤ä¸ºå®ƒä»…æ˜¯ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶</p>
<p>ä½ å¯ä»¥å°†åç¼€æ”¹ä¸ºpy, å‘Šè¯‰å…¶ä»–äºº, è¿™æ˜¯ä¸ªè£…ç€pyä»£ç çš„æ–‡ä»¶, è®©å«ä¹‰æ›´åŠ æ¸…æ™°, ä»…æ­¤è€Œå·²<br>
(å¦‚æœä½ ä¸æ‡‚æ€ä¹ˆä¿®æ”¹åç¼€, è¯·çœ‹ä¸Šé¢çš„ â€œå¸¸è¯†ç§‘æ™®: æ–‡ä»¶åç¼€â€)</p>
<p>å½“ä½ å°†åç¼€æ›´æ”¹ä¸ºpyå, ä½ ä¼šå‘ç°æ–‡ä»¶çš„å›¾æ ‡å˜æˆäº†pythonçš„å›¾æ ‡, å•Š, å¤šä¹ˆæ¸…æ™°!<br>
å½“ä½ å³é”®å®ƒ, ä¼šå‘ç°èƒ½ç”¨idleç¼–è¾‘äº†, windowsæ ¹æ®åç¼€, çŸ¥é“äº† â€œè¿™æ˜¯æ®µpythonä»£ç â€, ç„¶åå»å¯»æ‰¾ç›¸å…³çš„å·¥å…·äº†<br>
è¿™å°±æ˜¯æ­£ç¡®ä½¿ç”¨åç¼€çš„ä¾¿åˆ©, å³ä½¿åç¼€å¹¶ä¸æ”¹å˜æ–‡ä»¶æœ¬èº«çš„å†…å®¹, ä½†æˆ‘ä»¬èƒ½æ›´å¥½åœ°, æ ¹æ®åç¼€è¾¨åˆ«æ–‡ä»¶çš„ç±»å‹ä¸ç”¨é€”</p>
<p>ä½†è¿˜æ˜¯æœ‰ä¸ªé—®é¢˜<br>
é‚£å°±æ˜¯, å½“ä½ åŒå‡»æ—¶, windowsä¼šæ ¹æ®åç¼€, å°†è¯¥æ–‡ä»¶çš„è·¯å¾„, ä¼ å…¥å‘½ä»¤ â€œpythonâ€, è¿›è¡Œæ‰§è¡Œ<br>
æ‰§è¡Œçš„æ—¶å€™, ä¼šè‡ªåŠ¨æ‰“å¼€cmd, æ¥æ˜¾ç¤ºä½ çš„è¾“å‡º/æ¥æ”¶ä½ çš„è¾“å…¥</p>
<p>è¿™æ—¶, ä½ ä¼šå‘ç°, é»‘çª—çª—ä¸€é—ªè€Œè¿‡, ä¸ºä½•å®ƒæ²¡åœä¸‹æ¥, ç›´æ¥é—ªé€€äº†?!?!<br>
å®é™…ä¸Š, æˆ‘ä»¬çš„ä»£ç å·²ç»æ‰§è¡Œå®Œæ¯•äº†, é‚£ä¹ˆæ—¢ç„¶å·²ç»å¥½äº†, ä¸´æ—¶æ‰“å¼€çš„cmdè‡ªç„¶å°±æ¶ˆå¤±äº†</p>
<p>åœ¨ä¹‹å‰é€šè¿‡win+räº§ç”Ÿçš„cmd, ç”¨é€”æ˜¯è¿›è¡Œäº¤äº’, è®©ä½ èƒ½ä¸€ç›´åœ¨ä¸€ä¸ª â€œè¾“å…¥å‘½ä»¤, å¾—åˆ°ç»“æœâ€ çš„å¾ªç¯<br>
ä½†é€šè¿‡åŒå‡»è€Œè·å¾—çš„cmd, æ­¤æ—¶ä»…ä¸ºå•ä¸ªç¨‹åºæœåŠ¡, ç¨‹åºä¸€ç»“æŸè‡ªå·±å°±æ¶ˆå¤±</p>
<p>æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•æ¥é˜»æ­¢åŒå‡»åé»‘æ¡†æ¡†çš„æ¶ˆå¤±å‘¢? å½“ç„¶æœ‰<br>
windowsä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‘½ä»¤, å«åš â€œpauseâ€, è‹±æ–‡çš„æ„æ€æ˜¯åœé¡¿, ä½œç”¨æ˜¯åœé¡¿cmd, ç›´åˆ°ä½ éšä¾¿æŒ‰ä¸€ä¸ªé”®, æ‰“ç ´è¿™ä¸ªåœé¡¿<br>
ä½ å¯ä»¥ win+r æ‰“å¼€ cmd, ç„¶åè¾“å…¥ pause, è‡ªå·±æ¥è¯•è¯•, å°±æ˜ç™½äº†, å¾ˆç®€å•çš„</p>
<p>pythonæ˜¯å¯ä»¥è°ƒç”¨å¤–éƒ¨å‘½ä»¤çš„!</p>
<p>ä½ å¯ä»¥åœ¨ first_app.py ä¸­, è¿™æ ·æ”¹è¿›ä½ çš„ä»£ç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">os.system(<span class="string">&quot;pause&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ <code>import</code>, è¡¨ç¤ºä½ å¯¼å…¥äº†ä¸€ä¸ªåº“, å…³äºåº“çš„æ¦‚å¿µä¹‹åä¼šè®², æ­¤å¤„ä¸æ‡‚ä¹Ÿæ²¡äº‹<br>
<code>os.system(&quot;pause&quot;)</code> è¡¨ç¤ºè°ƒç”¨ä¸€æ¡å¤–éƒ¨å‘½ä»¤, ç›¸å½“äºåœ¨cmdä¸­è°ƒç”¨äº† pause å‘½ä»¤</p>
<p>å¥½äº†, æœ¬èŠ‚å·²ç»ç»“æŸäº†, ä»…ä½œä¸ºä¸€ç¯‡ç§‘æ™®å‘æ–‡ç« , ä¹‹åä¼šæ­£å¼æ¶‰åŠpythonçš„è¯­æ³•éƒ¨åˆ†</p>
]]></content>
      <tags>
        <tag>é«˜ä¸­ä¿¡æ¯æŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>high-school-it-p3~&gt; pythonåŸºç¡€è¯­æ³•-part1</title>
    <url>/posts/high-school-it/p3.html</url>
    <content><![CDATA[<blockquote>
<p>æ­£å¼çš„å¯¹pythonè¯­æ³•çš„å­¦ä¹ , åŒ…å«å¸¸è§åº“å‡½æ•°çš„ä½¿ç”¨</p>
</blockquote>
<span id="more"></span>
<p>æœ‰å…³pythonçš„åŸºæœ¬ä»‹ç», æ¯”å¦‚ç¼–è¯‘/è§£é‡Š/é¢å‘å¯¹è±¡, æ€ä¹ˆè‡ªå·±ä¸‹è½½python, è¯·çœ‹ <a href="/posts/high-school-it/p2">p2: åŸºç¡€ç§‘æ™®ä¸ç¯å¢ƒæ­å»º</a><br>
<strong>æ„Ÿè°¢:</strong><br>
æœ¬æ–‡çš„åˆ‡ç‰‡éƒ¨åˆ†æ¥æºäº <a href="https://zhuanlan.zhihu.com/p/79541418">pythonåˆ‡ç‰‡å®Œå…¨æŒ‡å—(è¯­æ³•ç¯‡)</a>, å·²ç»è¿‡åŸä½œè€…å‡†è®¸</p>
<h1 id="bian-liang-yu-fu-zhi">å˜é‡ä¸èµ‹å€¼</h1>
<p>ç¼–ç¨‹ä¸å°±æ˜¯ä¸ºäº†æ¨¡æ‹Ÿä¸–ç•Œ, æ±‚è§£é—®é¢˜å—? æ±‚è§£é—®é¢˜éƒ½éœ€è¦ä»€ä¹ˆ?<br>
éœ€è¦æ•°æ®, è¿˜éœ€è¦å­˜æ”¾æ•°æ®çš„åœ°æ–¹, <ins>å˜é‡</ins>, å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå­˜æ”¾æ•°æ®çš„åœ°æ–¹</p>
<p>å˜é‡å˜é‡, é¡¾åæ€ä¹‰, æŒ‡çš„æ˜¯å¯å˜çš„é‡ (æœ‰äº›è¯­è¨€ä¸¥æ ¼åŒºåˆ†å¯å˜æ€§, ä½†pythoné‡Œä¸ç”¨åœ¨æ„è¿™ä¹ˆå¤š)<br>
ä½ å¯ä»¥ç†è§£ä¸º, å˜é‡, æ˜¯ä¸€ä¸ªç®±å­/å¯„å­˜å™¨, è£…ç€ä¸€äº›å¯ä»¥è¿ç®—çš„æ•°å€¼, ç”¨æ¥æ±‚è§£é—®é¢˜, æ¨¡æ‹Ÿç°å®</p>
<p>æœ‰ä¸¤ä¸ªæ¦‚å¿µ:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å£°æ˜å˜é‡:  åˆ›å»ºå˜é‡ (å£°æ˜ä¸€ä¸ªå˜é‡å‡ºç°äº†)</p>
</li>
<li class="lvl-2">
<p>èµ‹å€¼: æŠŠä¸€ä¸ªå€¼è£…åˆ°ç®±å­(å˜é‡)é‡Œ</p>
</li>
</ul>
<p>æ¯”å¦‚, ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ, æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå«åš a çš„å˜é‡, ç„¶åæŠŠå€¼è£…åˆ°äº† a ä¸­, è¿™å°±æ˜¯ å£°æ˜+èµ‹å€¼<br>
å³è¾¹æ˜¯æ•°å€¼, å·¦è¾¹æ˜¯å˜é‡å, ç­‰å·è¡¨ç¤ºæŠŠå³è¾¹çš„å€¼èµ‹ç»™å·¦è¾¹çš„å˜é‡</p>
<p>å˜é‡åæ˜¯éšä¾¿ä½ å–çš„, ä½†å¿…é¡»éµå®ˆå‘½åè§„èŒƒ, åªèƒ½ç”±å­—æ¯, ä¸‹åˆ’çº¿å¼€å¤´, ä¸èƒ½ç”±æ•°å­—å¼€å¤´, ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼åˆ†å‰², ä¸èƒ½ä¸å…³é”®å­—ç›¸åŒ</p>
<p>ä½ ä¹Ÿå¯ä»¥è¿™æ ·:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = a</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆå£°æ˜äº†ä¸€ä¸ªå˜é‡a, å€¼æ˜¯1, ç„¶åæŠŠaæ”¾åœ¨å³è¾¹ä¼ ç»™äº†å·¦è¾¹çš„b<br>
ç¬¬äºŒè¡Œè¡¨ç¤º, æŠŠaé‡Œé¢çš„æ•°å€¼å–å‡ºæ¥, ä¼ ç»™äº†b</p>
<p>pythonæ”¯æŒä¹Ÿæ”¯æŒè¿™æ ·çš„èµ‹å€¼æ“ä½œ, ç”šè‡³å¯ä»¥ç»§ç»­é•¿ä¸‹å»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = b = c = <span class="number">1</span></span><br><span class="line">d = e = f = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a,b,c = d,e,f</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç ä¸­, a,b,céƒ½è¢«åˆå§‹åŒ–ä¸º1, defåˆ™ä¸º2, ç„¶åèµ‹å€¼, æŠŠabcçš„å€¼å˜æˆäº†2</p>
<p>ä½ è¿˜å¯ä»¥è¿™æ ·, è¡¨ç¤ºæŠŠbä¸­çš„å€¼ç»™a, æŠŠaä¸­çš„å€¼ç»™b, è¾¾åˆ°äº¤æ¢å€¼çš„æ•ˆæœ:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">a,b = b,a</span><br></pre></td></tr></table></figure>
<p>ä½ å¯èƒ½ä¼šç–‘æƒ‘:<br>
å½“æˆ‘æŠŠbä¸­çš„å€¼ç»™äº†aæ—¶, açš„å€¼ä¸å°±æ˜¯2äº†å—, æ­¤æ—¶å†æŠŠaèµ‹å€¼ç»™b, é‚£bä¸è¿˜æ˜¯2å—?<br>
è¯¥æƒ³æ³•å¯¹åº”çš„ä»£ç æ˜¯è¿™æ ·çš„:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a = b</span><br><span class="line">b = a</span><br></pre></td></tr></table></figure>
<p>ä½†åœ¨äº¤æ¢æ•°å€¼çš„ä»£ç ä¸­, ä½ åº”è¯¥è¿™æ ·ç†è§£:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">_t1 = b</span><br><span class="line">_t2 = a</span><br><span class="line">a = _t1</span><br><span class="line">b = _t2</span><br></pre></td></tr></table></figure>
<p>è¿™è¡¨ç¤º, è¿›è¡Œ <code>a,b = b,a</code> æ—¶, ä¼šå…ˆæŠŠå³è¾¹çš„å˜é‡ç»™å¤åˆ¶(èµ‹å€¼ç»™æ–°çš„å˜é‡)ä¸€é, å†åˆ†åˆ«èµ‹ç»™a,b<br>
åªä¸è¿‡, åªè¦æˆ‘ä»¬æŒ‰ç…§pyçš„è¯­æ³•å†™, æˆ‘ä»¬å°±ä¸éœ€è¦è€ƒè™‘è¿™ä¹ˆå¤šäº†, pyä¸ºæˆ‘ä»¬éšè—äº†_t1, _t2, ä½ åªéœ€è¦å¯ä»¥è¿™ä¹ˆå†™å°±è¡Œäº†<br>
ç°åœ¨æœ‰æ²¡æœ‰æ˜ç™½, ä¸ºä»€ä¹ˆå¤§å®¶éƒ½è¯´pyè¯­æ³•ç®€å•å‘¢? ä¹‹åè¿˜ä¼šæœ‰å¾ˆå¤šåƒè¿™æ ·ç”œçš„åœ°æ–¹ ğŸ˜ƒ</p>
<p>å¦å¤– é€‰æ‹©é¢˜ä¼šå‡ºç°è¿™æ ·çš„å¸¸è§é€‰é¡¹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">A.  a = <span class="number">1</span>, b = <span class="number">2</span>, c = <span class="number">3</span></span><br><span class="line">B.  a, b, c = <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">C.  a = <span class="number">1</span>; b = <span class="number">2</span>; c = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ A æ˜¯é”™çš„, åˆ«é—®ä¸ºä»€ä¹ˆ, å› ä¸º python çš„ä½œè€…è¿™æ ·è®¾è®¡ python çš„è€Œå·²</p>
<hr>
<h1 id="bian-liang-ming-ming-gui-fan">å˜é‡å‘½åè§„èŒƒ</h1>
<p>pythonä¸­, å˜é‡çš„å‘½åå¿…é¡»ç¬¦åˆè§„èŒƒ, ä¸ç„¶ç›´æ¥æŠ¥é”™<br>
åœ¨ç¬¦åˆè§„èŒƒçš„åŒæ—¶, ä½ ä¹Ÿåº”å½“å°½å¯èƒ½åœ°, è®©å˜é‡åæ›´åŠ æ¸…æ´—ç›´è§‚, æ¯”å¦‚å¹´é¾„ç”¨age, è€Œä¸æ˜¯a</p>
<p>å‘½åè§„èŒƒå¦‚ä¸‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å˜é‡åç”±å­—æ¯, æ•°å­—, ä¸‹åˆ’çº¿ç»„æˆ</p>
</li>
<li class="lvl-2">
<p>ä¸èƒ½ç”±æ•°å­—å¼€å¤´</p>
</li>
<li class="lvl-2">
<p>ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼åˆ†å‰²</p>
</li>
<li class="lvl-2">
<p>ä¸èƒ½ä¸pythonä¸­çš„å…³é”®å­—é‡å</p>
</li>
</ul>
<p>ä»¥ä¸‹éƒ½æ˜¯åˆæ³•çš„å˜é‡å</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a</span><br><span class="line">abada</span><br><span class="line">asd111231</span><br><span class="line">ad190123kkad</span><br><span class="line">asd_asd1_asd2</span><br><span class="line">_123daa</span><br><span class="line">_as11</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ä¸åˆæ³•çš„å˜é‡å:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span></span></span><br><span class="line"><span class="function"><span class="title">not</span></span></span><br><span class="line"><span class="function"><span class="title">in</span></span></span><br><span class="line"><span class="function"><span class="title">lambda</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">1123</span></span><br><span class="line"><span class="function">123<span class="title">adad</span></span></span><br><span class="line"><span class="function"><span class="title">sad</span>;;-``</span></span><br><span class="line"><span class="function">``?/</span></span><br><span class="line"><span class="function">&#x27;,</span></span><br></pre></td></tr></table></figure>
<p><strong>å…³é”®å­—:</strong><br>
å…³é”®å­—/ä¿ç•™å­—, æ˜¯pythonè¯­æ³•ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„ä¸œè¥¿, æ¯”å¦‚for/while/and/or/not/in<br>
è¿™äº›éƒ½è¢«ç§°ä½œå…³é”®å­—, ä¸€èˆ¬å‡ºç°äº†å…³é”®å­—, å°±èƒ½ç”¨å¯¹åº”çš„è¯­æ³•, å®ç°ä¸€äº›æ•ˆæœ<br>
æ¯”å¦‚forå°±å¯¹åº”forå¾ªç¯, notå°±å¯¹åº”é€»è¾‘å–å, å…·æœ‰ç‰¹æ®Šä½œç”¨</p>
<p>ä½ æ€ä¹ˆçŸ¥é“å“ªäº›æ˜¯å…³é”®å­—å‘¢? æ…¢æ…¢çœ‹å§, åƒ <code>def/import/for/if/break</code> è¿™ç§ç»å¸¸ä½¿ç”¨åœ¨ç‰¹æ®Šä½ç½®, æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„å­—ç¬¦, è‡ªç„¶å°±æ˜¯å…³é”®å­—äº†, åˆä¸ä¼šè€ƒä½ è¶…çº²çš„å…³é”®å­—</p>
<hr>
<h1 id="zhu-shi">æ³¨é‡Š</h1>
<h2 id="zuo-yong" id="ä½œç”¨">ä½œç”¨</h2>
<p>æ³¨é‡Š, æ˜¯ä»¥pyè§„å®šçš„ç‰¹æ®Šå­—ç¬¦, è€Œå¼€å¤´çš„è¯­å¥, è§£é‡Šå™¨ä¼šæ— è§†è§£æåˆ°çš„æ³¨é‡Š, åªè§£æä»£ç <br>
æ³¨é‡Š, èƒ½å¤Ÿä¸ºé˜…è¯»ä»£ç çš„äººæä¾›æ€è·¯, è¿…é€Ÿæ˜ç™½è¿™æ®µä»£ç åšäº†ä»€ä¹ˆ, è€Œä¸ç”¨ä¸€è¡Œä¸€è¡Œè¯»ä»£ç æ¥æ˜ç™½ä»£ç åšäº†ä»€ä¹ˆ</p>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span>  æ­¤æ—¶ a çš„å€¼ä¸º <span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span>  <span class="comment"># æ­¤æ—¶ a çš„å€¼ä¸º 1</span></span><br></pre></td></tr></table></figure>
<p>å‰è€…ä¼šæŠ¥é”™, å› ä¸º â€œæ­¤æ—¶ a çš„å€¼ä¸º 1â€ ä¹Ÿè¢«è§£é‡Šå™¨å½“ä½œä»£ç è€Œè¿›è¡Œè§£æ, è‡ªç„¶å°±ä¼šæŠ¥é”™äº†<br>
åè€…ä¸ä¼šæŠ¥é”™, å› ä¸ºè§£é‡Šå™¨è§£æåˆ° # å¼€å¤´çš„é‚£æ®µæ–‡å­—å, ä¼šæ— è§†/è·³è¿‡è¿™æ®µæ³¨é‡Š</p>
<p>å†ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»¥ä¸‹çš„ä»£ç èƒ½å¤Ÿè·å–a,b,cä¸‰ä¸ªå˜é‡ä¸­çš„æœ€å¤§å€¼, å¹¶è¿›è¡Œè¾“å‡º</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line">c = <span class="number">3</span></span><br><span class="line"><span class="built_in">max</span> = -<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> a &gt; b &gt; c:</span><br><span class="line">  <span class="built_in">max</span> = a</span><br><span class="line"><span class="keyword">elif</span> b &gt; c:</span><br><span class="line">  <span class="built_in">max</span> = b</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="built_in">max</span> = c</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>)</span><br></pre></td></tr></table></figure>
<p>ç§, ä½ çœ‹ä¸Šé¢çš„ä»£ç æ—¶,ä¸ç”¨ä¸€è¡Œä¸€è¡Œåœ°å»ç†è§£è¿™æ®µä»£ç åˆ°åº•æ˜¯å¹²å•¥çš„, ç›´æ¥çœ‹åˆ«äººç»™ä½ å†™çš„æ³¨é‡Š, å°±èƒ½å¤§è‡´æ˜ç™½è¿™æ®µä»£ç çš„ä½œç”¨äº†</p>
<h2 id="dan-duo-xing-zhu-shi" id="å•-å¤šè¡Œæ³¨é‡Š">å•/å¤šè¡Œæ³¨é‡Š</h2>
<p>python çš„æ³¨é‡Šåˆ†ä¸ºä¸¤ç§, ä¸€ç§æ˜¯ä»¥å•è¡Œæ³¨é‡Š, ä¸€ç§æ˜¯å¤šè¡Œæ³¨é‡Š, ç›´æ¥çœ‹ä¾‹å­å°±æ˜ç™½äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 12345</span></span><br><span class="line"><span class="comment"># ä¸Šå±±æ‰“è€è™</span></span><br><span class="line"><span class="comment"># è€è™æ‰“ä¸ç€</span></span><br><span class="line"><span class="comment"># æ‰“åˆ°å°æ¾é¼ </span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">12345</span></span><br><span class="line"><span class="string">ä¸Šå±±æ‰“è€è™</span></span><br><span class="line"><span class="string">è€è™æ‰“ä¸ç€</span></span><br><span class="line"><span class="string">æ‰“åˆ°å°æ¾é¼ </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥äº•å·å¼€å¤´çš„æ˜¯å•è¡Œæ³¨é‡Š, é€šå¸¸ç”¨åœ¨æ³¨é‡Šä»…ä»…æ˜¯ä¸€ä¸¤å¥è¯çš„æ—¶å€™<br>
å¦‚æœè¦æ³¨é‡Šæœ‰å¾ˆå¤šè¡Œ, ç”¨ä»¥ä¸‰ä¸ªå¼•å·å¼€å¤´, ä¸‰ä¸ªå¼•å·ç»“å°¾çš„å¤šè¡Œæ³¨é‡Šæ›´æ–¹ä¾¿ (æ— è®ºå•åŒå¼•å·éƒ½å¯ä»¥)</p>
<hr>
<h1 id="ji-ben-shu-ju-lei-xing">åŸºæœ¬æ•°æ®ç±»å‹</h1>
<p>å‰é¢è¯´äº†, æ±‚è§£é—®é¢˜æ—¶, ä½ éœ€è¦æ•°æ®, è¿˜æœ‰å­˜æ”¾æ•°æ®çš„åœ°æ–¹<br>
å¦‚ä½•å­˜æ”¾æ•°æ®, æˆ‘ç›¸ä¿¡ä½ å·²ç»æ˜ç™½äº†, ç°åœ¨å°±è¦è®²æ•°æ®æœ¬èº«äº†</p>
<p>ä¸ºäº†æ¨¡æ‹Ÿç°å®, pyå°†æ•°æ®è¿›è¡Œäº†æŠ½è±¡ä¸åˆ†ç±»:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>int: å¯¹åº”æ•´æ•°</p>
</li>
<li class="lvl-2">
<p>float: å¯¹åº”å®æ•°</p>
</li>
<li class="lvl-2">
<p>string: å¯¹åº”æ–‡å­—</p>
</li>
<li class="lvl-2">
<p>bool: å¯¹åº”çœŸä¸å‡</p>
</li>
</ul>
<p>æœ‰äº†è¿™äº› <ins>åŸºæœ¬æ•°æ®ç±»å‹</ins>, æˆ‘ä»¬å°±èƒ½å¤Ÿæ¨¡æ‹Ÿä¸–ç•Œäº†, è¿›è¡ŒæŠ½è±¡, æ±‚è§£é—®é¢˜äº†</p>
<p>ä¸¾äº›ä¾‹å­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>æˆ‘ä»Šå¤©åƒé¥­äº†å—: ç”¨boolæ¥æŠ½è±¡åˆ°åº•åƒé¥­æ²¡, Trueå°±æ˜¯åƒäº†, Falseå°±æ˜¯æ²¡åƒ</p>
</li>
<li class="lvl-2">
<p>æˆ‘çš„å¹´é¾„æ˜¯16å²: ç”¨intæ¥è¡¨ç¤º 16 è¿™ä¸ªæ•°å­—</p>
</li>
<li class="lvl-2">
<p>æˆ‘çš„åå­—å«åš: ç”¨stringæ¥è¡¨ç¤º â€œèµµäºŒç‹—â€, â€œAnasdpaâ€ è¿™æ ·çš„æ–‡å­—</p>
</li>
</ul>
<p>åŒæ—¶, æˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¿™äº› <ins>åŸºæœ¬æ•°æ®ç±»å‹</ins>, æ„å»ºå‡º <ins>å¤æ‚æ•°æ®ç±»å‹</ins>, æ¯”å¦‚, æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªç±»å‹, å« student, è¡¨ç¤ºå­¦ç”Ÿ<br>
ä½ å¯ä»¥è¿™æ ·æŠ½è±¡:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">student &#123;</span><br><span class="line">  age:  <span class="built_in">int</span>,</span><br><span class="line">  height: <span class="built_in">float</span>,</span><br><span class="line">  name: string,</span><br><span class="line">  fat_or_not: <span class="built_in">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pyä¸­ä¹Ÿæœ‰è¯­æ³•, æ”¯æŒåˆ›å»ºè‡ªå®šä¹‰çš„ç±»å‹, ä½†ä¸æ˜¯æœ¬ç³»åˆ—çš„é‡ç‚¹, æ­¤å¤„ä»…æä¸€å˜´è€Œå·²</p>
<hr>
<h1 id="yun-suan-fu-yu-you-xian-ji">è¿ç®—ç¬¦ä¸ä¼˜å…ˆçº§</h1>
<p>python æä¾›äº†ä¸€äº›è¿ç®—ç¬¦, èƒ½å¤Ÿè®©ä½ è¿›è¡ŒåŠ å‡ä¹˜é™¤, é€»è¾‘è¿ç®—ä¹‹ç±»çš„æ“ä½œ<br>
è¿™äº›è¿ç®—ç¬¦, æœ‰å„è‡ªçš„ä¼˜å…ˆçº§, å†³å®šäº†å½“è¿ç®—ç¬¦æœ‰å¤šä¸ªæ—¶, åº”è¯¥ä¼˜å…ˆè®¡ç®—å“ªä¸ª<br>
åœ¨ä»¥ä¸‹çš„å›¾è¡¨ä¸­, ä¼˜å…ˆçº§1æ˜¯æœ€é«˜, æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½</p>
<h2 id="suan-zhu-yun-suan-fu" id="ç®—æœ¯è¿ç®—ç¬¦">ç®—æœ¯è¿ç®—ç¬¦</h2>
<p>ç®—æœ¯è¿ç®—ç¬¦, å¯ä»¥è®©ä½ å¯¹æ•°å­—ç±»å‹ (int, float) è¿›è¡Œè®¡ç®—, å¾—åˆ°æ–°çš„æ•°å­—</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>æè¿°</th>
<th>ä¾‹å­</th>
<th>ä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody>
<tr>
<td>**</td>
<td>xçš„yæ¬¡æ–¹</td>
<td>x**y</td>
<td>1</td>
</tr>
<tr>
<td>*</td>
<td>xä¹˜ä»¥y</td>
<td>x*y</td>
<td>2</td>
</tr>
<tr>
<td>/</td>
<td>xé™¤ä»¥y, äº§ç”Ÿå®æ•°å€¼</td>
<td>x/y</td>
<td>2</td>
</tr>
<tr>
<td>//</td>
<td>xé™¤ä»¥y, äº§ç”Ÿæ•´æ•°å€¼</td>
<td>x//y</td>
<td>2</td>
</tr>
<tr>
<td>%</td>
<td>xé™¤ä»¥y, å–ä½™æ•°</td>
<td>x%y</td>
<td>2</td>
</tr>
<tr>
<td>+</td>
<td>xåŠ y</td>
<td>x+y</td>
<td>3</td>
</tr>
<tr>
<td>-</td>
<td>xå‡y</td>
<td>x-y</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>ç§, éå¸¸ç¬¦åˆå°å­¦æ•°å­¦çš„ä¼˜å…ˆçº§æ¦‚å¿µ, ä¹˜æ³•è¦æ¯”åŠ æ³•å…ˆç®—, æ¬¡æ–¹è¦æ¯”ä¹˜æ³•å…ˆç®— ğŸ˜ƒ</p>
<p>ç®—æœ¯è¿ç®—ç¬¦, å¯ä»¥ä¸èµ‹å€¼è¿ç®—ç¬¦ç›¸äº’ç»“åˆ:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = a + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">a += <span class="number">1</span>  <span class="comment"># æ˜¯ä¸Šé¢çš„ç­‰ä»·ç‰©</span></span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼çš„, è¿˜æœ‰ <code>-=</code>, <code>*=</code>, <code>%=</code><br>
è¿™ç§è¯­æ³•åœ¨å˜é‡åå¾ˆé•¿æ—¶, ä¼šå¾ˆæœ‰ç”¨, ä¸å¿…æŠŠå˜é‡åå†™ä¸¤é</p>
<h2 id="guan-xi-yun-suan-fu" id="å…³ç³»è¿ç®—ç¬¦">å…³ç³»è¿ç®—ç¬¦</h2>
<p>å…³ç³»è¿ç®—ç¬¦, è‹¥å…³ç³»æˆç«‹åˆ™è¿”å› True, ä¸ç„¶è¿”å› False, å¦‚ <code>1 &lt; 2</code> æ˜¯ True, å› æ­¤åˆç§°ä¸º æ¯”è¾ƒè¿ç®—ç¬¦<br>
(å…³ç³»è¿ç®—ç¬¦å¹¶ä¸æ³¨é‡ä¼˜å…ˆçº§, è°å…ˆè°åä¸€çœ¼å°±çœ‹å‡ºæ¥äº†)</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>æè¿°</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td>&gt;</td>
<td>x å¤§äº y</td>
<td>x &gt; y</td>
</tr>
<tr>
<td>&lt;</td>
<td>x å°äº y</td>
<td>x &lt; y</td>
</tr>
<tr>
<td>&gt;=</td>
<td>x å¤§äºç­‰äº y</td>
<td>x &gt;= y</td>
</tr>
<tr>
<td>&lt;=</td>
<td>x å°äºç­‰äº y</td>
<td>x &lt;= y</td>
</tr>
<tr>
<td>==</td>
<td>x ç­‰äº y</td>
<td>x == y</td>
</tr>
<tr>
<td>!=</td>
<td>x ä¸ç­‰äº y</td>
<td>x != y</td>
</tr>
</tbody>
</table>
<p><strong>æ³¨:</strong><br>
æœ¬åšå®¢ä½¿ç”¨äº†è¿ä½“å­—ç‰¹æ€§, å› æ­¤ä½ çœ‹è§çš„&gt;=å…¶å®æ˜¯&gt;å·å³è¾¹è·Ÿç€=, !=å…¶å®æ˜¯æ„Ÿå¹å·!åé¢è·Ÿç€=, ==å…¶å®æ˜¯ä¸¤ä¸ª=</p>
<hr>
<h1 id="ji-ben-shu-ju-jie-gou">åŸºæœ¬æ•°æ®ç»“æ„</h1>
<p>æ•°æ®ç»“æ„, å…¶å®å°±æ˜¯æ•°æ®çš„å­˜å‚¨ç»“æ„, æ ¹æ®åœºæ™¯ä¸æ•°æ®ä¹‹é—´çš„é€»è¾‘å…³ç³», è®¾è®¡å‡ºçš„ä¸åŒå¤æ‚ç¨‹åº¦çš„ç»“æ„</p>
<p>ä¸¾ä¸ªä¾‹å­, æœ‰ç§æ•°æ®ç»“æ„, å«åš <code>é˜Ÿåˆ— (Queue)</code>, å…¶å®æ¨¡æ‹Ÿçš„å°±æ˜¯æ—¥å¸¸ç”Ÿæ´»ä¸­æ’é˜Ÿçš„åœºæ™¯, å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨:<br>
åœ¨æ’é˜Ÿæ—¶, æ¥å¾—è¶Šæ—©ç¦»å¼€è¶Šæ—©, æ¥å¾—è¶Šæ™šç¦»å¼€è¶Šæ™š, è¿™ä¸éš¾ç†è§£<br>
æ­¤æ—¶çš„é˜Ÿåˆ—, å°±æ˜¯ä¸€ä¸ª <code>å•å‘é˜Ÿåˆ—</code>, åªå…è®¸åœ¨ä¸€ç«¯åˆ é™¤å…ƒç´ (æ’é˜Ÿçš„äººä¹°å¥½ä¸œè¥¿èµ°äº†), å¦ä¸€ç«¯å¢åŠ æ•°æ®(æ–°æ¥ä¸ªæ’é˜Ÿçš„)</p>
<p>æ ¹æ®ä¸åŒçš„åœºæ™¯, ä¸åŒçš„é€»è¾‘å…³ç³», éœ€è¦ä½¿ç”¨ä¸åŒçš„æ–¹å¼å­˜å‚¨æ•°æ®, è¿™ç§æ–¹å¼, ä¾¿æ˜¯æ•°æ®ç»“æ„<br>
å½“ç„¶, æˆ‘ä»¬æ­¤å¤„ä»…å­¦ä¹ åŸºæœ¬æ•°æ®ç»“æ„</p>
<h2 id="lie-biao" id="åˆ—è¡¨">åˆ—è¡¨</h2>
<p>åˆ—è¡¨(list) ä»…è¡¨ç¤ºè£…ç€ä¸€å®šæ•°é‡å…ƒç´ çš„åºåˆ—, å¯ä»¥é€šè¿‡ ç´¢å¼•(index) è®¿é—®å…ƒç´ </p>
<h3 id="dan-suo-yin" id="å•ç´¢å¼•">å•ç´¢å¼•</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å•ä¸ªç´¢å¼•, è®¿é—®å¯¹åº”çš„å•ä¸ªå…ƒç´ </p>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ‰ç€ 3 ä¸ªå…ƒç´ çš„åˆ—è¡¨</span></span><br><span class="line"><span class="built_in">list</span> = [<span class="number">300</span>, <span class="number">400</span>, <span class="number">500</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ç´¢å¼•, è®¿é—®å…ƒç´  (ç´¢å¼•ä» 0 å¼€å§‹)</span></span><br><span class="line"><span class="built_in">list</span>[<span class="number">0</span>]  <span class="comment"># 300</span></span><br><span class="line"><span class="built_in">list</span>[<span class="number">1</span>]  <span class="comment"># 400</span></span><br><span class="line"><span class="built_in">list</span>[<span class="number">2</span>]  <span class="comment"># 500</span></span><br></pre></td></tr></table></figure>
<p><strong>æ‰©å±•: ä¸ºä½• index ä» 0 å¼€å§‹?</strong><br>
å› ä¸º, æ‰€è°“çš„index, ä»£è¡¨çš„æ¦‚å¿µ, å…¶å®æ˜¯ <code>åç§»é‡</code><br>
å®é™…ä¸Š, pyä¸­çš„åˆ—è¡¨, å…¶å…ƒç´ çš„å†…å­˜åœ°å€æ˜¯è¿ç»­çš„, åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨æ—¶, ä¼šå…ˆç”³è¯·ä¸€å—å†…å­˜ç©ºé—´, ç”¨æ¥å­˜æ”¾å…ƒç´ <br>
ç”¨ä¸‹æ ‡å¾—åˆ°å…ƒç´ æ—¶, å®é™…æ˜¯é€šè¿‡ä¸‹æ ‡, è®¡ç®—è¯¥å…ƒç´ çš„å¯¹åº”å†…å­˜åœ°å€, è¿›è¡Œè®¿é—®, é‚£ä¹ˆ, å¦‚ä½•è®¡ç®—çš„å‘¢?</p>
<p>ä½ å¯ä»¥è¿™æ ·ç†è§£:<br>
ä¸€ä¸ªé•¿åº¦ä¸º 3(æœ‰ 3 ä¸ªå…ƒç´ )çš„åˆ—è¡¨, æ‹¥æœ‰ 3 å—å†…å­˜ç©ºé—´<br>
ä½ å¯ä»¥ä»å·¦å‘å³, ç”» 3 ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„æ ¼å­, åˆ—è¡¨æœ¬èº«, å°±ä»£è¡¨ç€è¿™ 3 ä¸ªæ ¼å­</p>
<p>åˆ—è¡¨æœ¬èº«çš„å†…å­˜åœ°å€, å…¶å®å°±ç›¸å½“äºç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€, ä½ å¯ä»¥æƒ³è±¡ä¸ºç¬¬ä¸€ä¸ªæ ¼å­<br>
å¦‚ä½•è®¿é—®ç¬¬ 1 ä¸ªæ ¼å­? ç¬¬ä¸€ä¸ªæ ¼å­å‘å³è·³ 0 æ ¼<br>
å¦‚ä½•è®¿é—®ç¬¬ 2 ä¸ªæ ¼å­? ç¬¬äºŒä¸ªæ ¼å­å‘å³è·³ 1 æ ¼<br>
å¦‚ä½•è®¿é—®ç¬¬ 3 ä¸ªæ ¼å­? ç¬¬ä¸‰ä¸ªæ ¼å­å‘å³è·³ 2 æ ¼</p>
<p>ç°åœ¨æ‡‚äº†å§? ä¸‹æ ‡å…¶å®å°±æ˜¯åç§»é‡, ä»£è¡¨çš„æ˜¯ <code>ç›¸å¯¹äºç¬¬ 1 ä¸ªæ ¼å­åç§»äº†å¤šå°‘æ ¼</code><br>
è¦è®¿é—®ç¬¬å‡ ä¸ªæ ¼å­, ç›´æ¥åŠ ä¸Šåç§»é‡å³å¯ (æ¯”å¦‚ <code>list[0]</code> åç§»äº†0, æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ )</p>
<p>å¦‚æœä½ éè¦æŠŠä¸‹æ ‡ä» 1 å¼€å§‹, é‚£å°±å¾—è¿™æ ·:<br>
list[1] ä»£è¡¨ç¬¬ 1 ä¸ªå…ƒç´ , ä½†ç›¸å¯¹äºç¬¬ä¸€ä¸ªå…ƒç´ çš„åç§»é‡è¿˜æ˜¯0<br>
äºæ˜¯åœ¨æ ¹æ®ä¸‹æ ‡1, æ±‚ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶, åç§»é‡å°±æ˜¯ <code>1 - 1 = 0</code><br>
åŒç†, æ ¹æ®ä¸‹æ ‡2, æ±‚ç¬¬äºŒä¸ªå…ƒç´ æ—¶, åç§»é‡å°±æ˜¯ <code>2 - 1 = 1</code><br>
åŒç†, å—¯ä¸¾ä¸‹æ ‡index, æ±‚ç¬¬ index ä¸ªå…ƒç´ æ—¶, åç§»é‡å°±æ˜¯ <code>index - 1</code></p>
<p>å¦‚æœä½ æ¯æ¬¡è®¡ç®—åç§»é‡, éƒ½å¾—è®¡ç®—ä¸€é index-1, æ¬¡æ•°ä¸€å¤šèµ·æ¥ä¸å°±ä¼šé™ä½æ•ˆç‡?<br>
ç°ä»£è®¡ç®—æœºå…¶å®å¯ä»¥å¿½ç•¥è¿™ç‚¹å½±å“, ä½†æ—©æœŸè®¡ç®—æœºå¯æ˜¯ä¸€å¯¸å†…å­˜ä¸€å¯¸é‡‘, è¿™ä¸ªä¹ æƒ¯è‡ªç„¶è€Œç„¶åœ°è¢«ä¿ç•™ä¸‹æ¥äº†<br>
<s>(å¥½å§, åŸå› å…¶å®çœŸçš„åªæ˜¯å› ä¸ºä¹ ä¿—)</s></p>
<p>è€Œä¸”åœ¨æŸäº›æƒ…å†µä¸‹, ä¸‹æ ‡ä»0å¼€å§‹ä¼šå¾ˆæ–¹ä¾¿, æœ‰ç›¸å…³è®ºæ–‡, ä½†æœ¬èœé¸¡çœ‹ä¸æ‡‚ ğŸ˜ƒ</p>
<p>py ä¸­è¿˜å­˜åœ¨ <code>è´Ÿç´¢å¼•</code> çš„è¯­æ³•ç³–, ä¹Ÿå°±æ˜¯ç”¨è´Ÿæ•°æ¥å……å½“ç´¢å¼•, æ­¤æ—¶, ä¸‹æ ‡ä»å³å¾€å·¦, ä» -1 ä¾æ¬¡é€’å‡<br>
æ¯”å¦‚ <code>ls[-1]</code>, å°±ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ , <code>ls[-2]</code> å°±ä»£è¡¨å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ </p>
<p>ä¸¾ä¸ªä¾‹å­, å·²çŸ¥ <code>a = [10, 20, 30, 40, 50]</code> è®©æˆ‘ä»¬å°†å…¶ä¸å›¾è¡¨è¿›è¡Œå¯¹ç«‹:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>å…ƒç´ </td>
<td>10</td>
<td>20</td>
<td>30</td>
<td>40</td>
<td>50</td>
</tr>
<tr>
<td>æ­£ç´¢å¼•</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>è´Ÿç´¢å¼•</td>
<td>-5</td>
<td>-4</td>
<td>-3</td>
<td>-2</td>
<td>-1</td>
</tr>
</tbody>
</table>
<p>æ˜¾è€Œæ˜“è§çš„, <code>ls[-1]</code>, å°±ç›¸å½“äº <code>ls[len(ls) - 1]</code> ( len(ls) è¡¨ç¤ºå¾—åˆ°åˆ—è¡¨lsçš„é•¿åº¦ )</p>
<h3 id="suo-yin-yue-jie" id="ç´¢å¼•è¶Šç•Œ">ç´¢å¼•è¶Šç•Œ</h3>
<p>äºæ­¤åŒæ—¶, é€šè¿‡ä¸‹æ ‡/ç´¢å¼•è®¿é—®æŸä¸ªåˆ—è¡¨çš„å…ƒç´ æ—¶, ä¸åº”è¯¥è¶…å‡ºèŒƒå›´:</p>
<figure class="highlight python"><figcaption><span>demo.py</span></figcaption><table><tr><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]</span><br><span class="line">a[<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>python demo.py</code> (è§ <a href="/posts/high-school-it/p2#huan-jing-da-jian">p2: åŸºç¡€ç§‘æ™®#ç¯å¢ƒæ­å»º</a> ) æˆ–ç›´æ¥ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·, ç‚¹å‡»è¿è¡ŒæŒ‰é’®</p>
<p>è„‘å­æƒ³ä¸€æƒ³éƒ½çŸ¥é“è‚¯å®šç¼–è¯‘ä¸è¿‡, æˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹æŠ¥é”™:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  File <span class="string">&quot;/home/jedsek/a.py&quot;</span>, <span class="built_in">line</span> <span class="number">2</span>, in <span class="symbol">&lt;module&gt;</span></span><br><span class="line">    <span class="keyword">a</span>[<span class="number">5</span>]</span><br><span class="line">    ~^^^</span><br><span class="line">IndexError: <span class="keyword">list</span> <span class="built_in">index</span> out of <span class="built_in">range</span></span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸æ‡‚çš„ç›´æ¥åƒåšç©è‹±è¯­å®Œå½¢ä¸€æ ·å½“ä½œ â€œå“”(å±è”½è¯)â€ è·³è¿‡å°±å¥½, index æ˜¯ â€œç´¢å¼•/ä¸‹æ ‡çš„æ„æ€â€, è¿™æ¡æŠ¥é”™è¡¨ç¤º, ä¸‹æ ‡è¶Šç•Œäº†!<br>
å› ä¸º a æ˜¯ä¸ªé•¿åº¦ä¸º 5 çš„åˆ—è¡¨, æ‰€ä»¥åªèƒ½ç”¨ <code>n âˆˆ [0, 5) âˆ© N (åŒºé—´[0, 5) èŒƒå›´å†…çš„è‡ªç„¶æ•°)</code> æ¥å½“ä¸‹æ ‡, å³ 0 åˆ° 4, å› æ­¤ 5 æ˜¯éæ³•çš„<br>
è´Ÿç´¢å¼•ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†, ä¸èƒ½è¶Šç•Œå“Ÿ~~</p>
<h3 id="qie-pian" id="åˆ‡ç‰‡">åˆ‡ç‰‡</h3>
<p>åˆ‡ç‰‡, èƒ½é€šè¿‡ç´¢å¼•ä¸å†’å·, åˆ›å»ºä¸€ä¸ªåŒºé—´, è®¿é—®ä¸€å®šèŒƒå›´å†…, åˆ—è¡¨çš„å¤šä¸ªå…ƒç´ </p>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">numbers = [<span class="number">201</span>, <span class="number">202</span>, <span class="number">203</span>, <span class="number">204</span>]  <span class="comment"># å®šä¹‰åˆ—è¡¨</span></span><br><span class="line">numbers[<span class="number">0</span>:<span class="number">4</span>]  <span class="comment"># [201, 202, 203, 204]</span></span><br><span class="line">numbers[<span class="number">0</span>:<span class="number">2</span>]  <span class="comment"># [201, 202]</span></span><br><span class="line">numbers[<span class="number">0</span>:<span class="number">1</span>]  <span class="comment"># [201]</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ä»¬é€šè¿‡ç´¢å¼•+å†’å·, åˆ›å»ºäº†ä¸€ä¸ªå·¦å¼€å³é—­çš„åŒºé—´, è®¿é—®ç´¢å¼•åœ¨è¯¥åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ <br>
æˆ‘ä»¬é€šè¿‡ <code>list[m:n]</code>, å¾—åˆ°äº†ä¸€ä¸ªå­åˆ—è¡¨, åªè¦ç´¢å¼•åœ¨ <code>[m, n) (å·¦å¼€å³é—­åŒºé—´)</code> å†…, å°±ä¼šè¢«æ”¾å…¥è¿™ä¸ªå­åˆ—è¡¨</p>
<p>å›¾è¡¨ä¾ç„¶ä¼šè¾ƒä¸ºç›´è§‚:</p>
<p><code>numbers = [201, 202, 203, 204]</code></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆ‡ç‰‡</td>
<td>å¯¹åº”ç´¢å¼•</td>
<td>å–å‡ºçš„å­åˆ—è¡¨</td>
</tr>
<tr>
<td>0:4</td>
<td>[0, 1, 2, 3]</td>
<td>[201, 202, 203, 204]</td>
</tr>
<tr>
<td>0:2</td>
<td>[0, 1]</td>
<td>[201, 202]</td>
</tr>
<tr>
<td>0:1</td>
<td>[0]</td>
<td>[201]</td>
</tr>
<tr>
<td>-3:-1</td>
<td>[-3, -2]</td>
<td>[202, 203]</td>
</tr>
</tbody>
</table>
<p>é»˜è®¤çš„æ­¥é•¿æ˜¯1, æˆ‘ä»¬è¿˜å¯ä»¥å†åŠ ä¸€ä¸ªå†’å·è®¾ç½®å…¶æ­¥é•¿, æ¯”å¦‚ <code>numbers[0:4:1]</code> å°±ç›¸å½“äº <code>numbers[0:4]</code><br>
è€Œ <code>numbers[0:4:2]</code> åˆ™ç›¸å½“äºä» <code>[0, 1, 2, 3]</code> ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  <code>0</code> å¼€å§‹, ä½œä¸ºä¸‹æ ‡å– numbers çš„å…ƒç´ , ç„¶åèµ°ä¸¤æ­¥åˆ° <code>2</code>, ä¾æ¬¡ç±»æ¨<br>
æ­¥é•¿ä¸èƒ½è®¾ç½®ä¸º 0, ä¸ç„¶ä¼šæŠ¥é”™</p>
<p>æœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„: å½“åˆ‡ç‰‡å¯¹åº”çš„ç´¢å¼•ä¸ªæ•°ä¸º 0 æ—¶, å­åˆ—è¡¨æ˜¯ä¸ªç©ºåˆ—è¡¨, å³å•ä¸ªçš„ <code>[]</code><br>
ä¸¾ä¸ªä¾‹å­: <code>numbers[3:2]</code> å°†ä¼šå¾—åˆ°ç©ºåˆ—è¡¨, å› ä¸ºæ­¥é•¿é»˜è®¤æ˜¯ 1, è€Œç´¢å¼•è¶Šç•Œä¼šç›´æ¥æŠ¥é”™, ä¸¤è€…æ³¨æ„åŒºåˆ†</p>
<h3 id="sheng-lue-yu-mo-ren-zhi" id="çœç•¥ä¸é»˜è®¤å€¼">çœç•¥ä¸é»˜è®¤å€¼</h3>
<p>å…³äºæ­¤å¤„çš„çŸ¥è¯†ç‚¹, å‰é¢å·²ç»æåˆ°è¿‡ä¸€éƒ¨åˆ†äº†, å³æ­¥é•¿é»˜è®¤æ˜¯1, ä½†ç°åœ¨è¿˜æœ‰æ›´å¤šæ›´å¤šæ»´ç»†èŠ‚ ğŸ˜ƒ</p>
<p>å·²çŸ¥ <code>a = [10, 20, 30, 40, 50]</code>, ä½ å¯ä»¥ä½¿ç”¨ <code>a[start:stop:step]</code> æ¥è¡¨ç¤º a çš„åˆ‡ç‰‡, å…¶ä¸­ start/stop/step éƒ½æ˜¯å¯ä»¥çœç•¥çš„<br>
å½“å®ƒä»¬è¢«çœç•¥æ—¶, ä¼šæœ‰ä¸€ä¸ªé»˜è®¤å€¼ä½œä¸ºæ›¿è¡¥ç™»åœº, æ¯”å¦‚æ­¥é•¿è¢«çœç•¥, å³ <code>a[start:stop]</code>/<code>a[start:stop:]</code> çš„å½¢å¼æ—¶, æ­¥é•¿ä¼šä½¿ç”¨é»˜è®¤å€¼1</p>
<p>è€Œå¯¹äº <code>start/stop</code> æ¥è®², å½“æ­¥é•¿åˆ†åˆ«ä¸ºæ­£æ•°æˆ–è´Ÿæ•°æ—¶, é»˜è®¤å€¼æ˜¯ä¸åŒçš„, å› ä¸ºæ­¥é•¿ä¸ºæ­£æ—¶, åˆ‡ç‰‡æ˜¯æ­£ç€å–å…ƒç´ çš„, ä¸ºè´Ÿæ—¶è‡ªç„¶æ˜¯å€’ç€å–<br>
ä¸¾äº›ä¾‹å­, å·²çŸ¥ <code>a = [10, 20, 30, 40, 50, 60, 70]</code>:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>a[2:5:1]</code> ä¸­, <code>2:4</code> å¯¹åº”çš„ä¸‹æ ‡æ˜¯ <code>[2, 3, 4]</code>, ç´¢å¼•å¯¹åº”çš„å…ƒç´ æ˜¯ <code>[30, 40, 50]</code>, å› ä¸ºæ­¥é•¿ä¸º1, æ‰€ä»¥ç»“æœç›´æ¥å°±æ˜¯ <code>[30, 40, 50]</code></p>
</li>
<li class="lvl-2">
<p><code>a[2::1]</code> ä¸­,  å³è¾¹ç•Œä¸ºçœç•¥, å› ä¸ºæ­¥é•¿ä¸ºæ­£, å…¶é»˜è®¤å€¼æ˜¯è¯¥åˆ—è¡¨çš„é•¿åº¦, ç»“æœæ˜¯ <code>[30, 40, 50, 60, 70]</code></p>
</li>
<li class="lvl-2">
<p><code>a[:2:1]</code> ä¸­, å·¦è¾¹ç•Œå¿½ç•¥, å› ä¸ºæ­¥é•¿ä¸ºæ­£, å…¶é»˜è®¤å€¼æ˜¯0, ç»“æœæ˜¯ <code>[10, 20]</code></p>
</li>
<li class="lvl-2">
<p><code>a[2::-1]</code> ä¸­, å³è¾¹ç•Œå¿½ç•¥, å› ä¸ºæ­¥é•¿ä¸ºè´Ÿ, å…¶é»˜è®¤å€¼æ˜¯0, ç»“æœæ˜¯ <code>[30, 20, 10]</code></p>
</li>
<li class="lvl-2">
<p><code>a[:2:-1]</code> ä¸­, å·¦è¾¹ç•Œå¿½ç•¥, å› ä¸ºæ­¥é•¿ä¸ºè´Ÿ, å…¶é»˜è®¤å€¼æ˜¯è¯¥åˆ—è¡¨é•¿åº¦, ç»“æœæ˜¯ <code>[70, 60, 50, 40]</code></p>
</li>
</ul>
<p>ä»€ä¹ˆé¬¼, è¿™æ˜¯äººèƒ½è®°å¾—ä¸‹æ¥çš„? è€Œä¸”è¿™äº›è¿˜åªæ˜¯æ­£ç´¢å¼•, å¯¹äºè´Ÿç´¢å¼•å‘¢? åˆ«æ…Œ, ***æ‰ç›´æ¥èƒŒ, ä½ åªéœ€è¦ç†Ÿæ‚‰å®šä¹‰å°±è¡Œ:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>start</code> ä»£è¡¨åˆ—è¡¨ä¸­æŸä¸ªå…ƒç´ çš„ä¸‹æ ‡, è¿™ä¸ªå…ƒç´ æ˜¯åˆ‡ç‰‡çš„èµ·å¤´</p>
</li>
<li class="lvl-2">
<p><code>stop</code> ä»£è¡¨åˆ—è¡¨ä¸­æŸä¸ªå…ƒç´ çš„ä¸‹æ ‡, åŸåˆ—è¡¨ä¸­è¯¥å…ƒç´ é™„è¿‘çš„é‚£ä¸ªå…ƒç´ æ‰æ˜¯åˆ‡ç‰‡çš„ç»“å°¾ (å› ä¸ºå·¦é—­å³å¼€, ä¸”æ­¥é•¿æ­£è´Ÿä¸çŸ¥)</p>
</li>
<li class="lvl-2">
<p><code>step</code> ä»£è¡¨æ­¥é•¿, å…¶æ­£è´Ÿå†³å®šæ­£åºè¿˜æ˜¯å€’åºå–, å…¶å¤§å°å†³å®šä¸€æ¬¡æ€§è·³è¿‡å¤šå°‘ä¸ªå…ƒç´ åå†å–</p>
</li>
</ul>
<p>è¦å¼€å§‹äº†å“¦, è¶…çº§ç›´è§‚çš„æ–¹æ³•:</p>
<p>ä»¥ <code>a[2:5:1]</code> ä¸ºä¾‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å› ä¸ºæ­¥é•¿ä¸ºæ­£, å…ˆç”»æ¡ä»å·¦å¾€å³çš„ç®­å¤´: <s>[10, 20, 30, 40, 50, 60, 70]</s>&gt;</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>start</code> æ˜¯ <code>2</code>, æ‰€ä»¥ç®­å¤´çš„èµ·ç‚¹ä» <code>30</code> å¼€å§‹: [10, 20, <s>30, 40, 50, 60, 70]</s>&gt;</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>stop</code> æ˜¯ <code>5</code>, æ‰€ä»¥ç®­å¤´çš„ç»ˆç‚¹æ˜¯ <code>50</code> (ç®­å¤´ä» 60 é€†æ–¹å‘ç¼©ä¸€æ ¼): [10, 20, <s>30, 40, 50</s>&gt;, 60, 70]</p>
</li>
</ul>
<p>ä»¥ <code>a[2::1]</code> ä¸ºä¾‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å› ä¸ºæ­¥é•¿ä¸ºæ­£, å…ˆç”»æ¡ä»å·¦å¾€å³çš„ç®­å¤´: <s>[10, 20, 30, 40, 50, 60, 70]</s>&gt;</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>start</code> æ˜¯ <code>2</code>, æ‰€ä»¥ç®­å¤´çš„èµ·ç‚¹ä» <code>30</code> å¼€å§‹: [10, 20, <s>30, 40, 50, 60, 70]</s>&gt;</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>stop</code> è¢«çœç•¥, æ‰€ä»¥ç®­å¤´æ— ç»ˆç‚¹, ä¸€ç›´å»¶ä¼¸: [10, 20, <s>30, 40, 50, 60, 70]</s>&gt;</p>
</li>
</ul>
<p>ä»¥ <code>a[:2:1]</code> ä¸ºä¾‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å› ä¸ºæ­¥é•¿ä¸ºæ­£, å…ˆç”»æ¡ä»å·¦å¾€å³çš„ç®­å¤´: <s>[10, 20, 30, 40, 50, 60, 70]</s>&gt;</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>start</code> è¢«çœç•¥, æ‰€ä»¥ç®­å¤´çš„èµ·ç‚¹åœ¨å·¦è¾¹çš„æ— é™è¿œå¤„, ä¸ç”¨åŠ¨: <s>[10, 20, 30, 40, 50, 60, 70]</s>&gt;</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>stop</code> æ˜¯ <code>2</code>, æ‰€ä»¥ç®­å¤´çš„ç»ˆç‚¹æ˜¯ <code>20</code> (ç®­å¤´ä» 30 é€†æ–¹å‘ç¼©ä¸€æ ¼): <s>[10, 20</s>&gt;, 30, 40, 50, 60, 70]</p>
</li>
</ul>
<p>ä»¥ <code>a[2::-1]</code> ä¸ºä¾‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å› ä¸ºæ­¥é•¿ä¸ºè´Ÿ, å…ˆç”»æ¡ä»å³å¾€å·¦çš„ç®­å¤´: &lt;<s>[10, 20, 30, 40, 50, 60, 70]</s></p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>start</code> æ˜¯ <code>2</code>, æ‰€ä»¥ç®­å¤´çš„èµ·ç‚¹ä» <code>30</code> å¼€å§‹: &lt;<s>[10, 20, 30</s>, 40, 50, 60, 70]</p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>stop</code> è¢«çœç•¥, æ‰€ä»¥ç®­å¤´æ— ç»ˆç‚¹, ä¸€ç›´å»¶ä¼¸: &lt;<s>[10, 20, 30</s>, 40, 50, 60, 70]</p>
</li>
</ul>
<p>ä»¥ <code>a[:2:-1]</code> ä¸ºä¾‹:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å› ä¸ºæ­¥é•¿ä¸ºè´Ÿ, å…ˆç”»æ¡ä»å³å¾€å·¦çš„ç®­å¤´: &lt;<s>[10, 20, 30, 40, 50, 60, 70]</s></p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>start</code> è¢«çœç•¥, æ‰€ä»¥ç®­å¤´çš„èµ·ç‚¹åœ¨å³è¾¹çš„æ— é™è¿œå¤„, ä¸ç”¨åŠ¨: &lt;<s>[10, 20, 30, 40, 50, 60, 70]</s></p>
</li>
<li class="lvl-2">
<p>å› ä¸º <code>stop</code> æ˜¯ <code>2</code>, æ‰€ä»¥ç®­å¤´çš„ç»ˆç‚¹æ˜¯ <code>40</code> (ç®­å¤´ä» 30 é€†æ–¹å‘ç¼©ä¸€æ ¼): [10, 20, 30, &lt;<s>40, 50, 60, 70]</s></p>
</li>
</ul>
<p>å¯¹äºè´Ÿç´¢å¼•ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†, å…ˆç¡®å®šå¥½ <code>start</code> ä¸ <code>stop</code> çš„ä½ç½®, ç„¶åæ ¹æ®æ­¥é•¿ç”»å¯¹åº”æ–¹å‘çš„ç®­å¤´<br>
ç…§è¿™æ ·ç®—, æœ€åè¢«è¦†ç›–çš„å…ƒç´ , å°±æ˜¯å½“æ­¥é•¿å¤§å°ä¸º 1 æ—¶, æ„æˆåˆ‡ç‰‡çš„å…ƒç´ , é€†åºè¿˜æ˜¯å€’å™çœ‹ç®­å¤´å°±è¡Œ<br>
æœ€åæ ¹æ®æ­¥é•¿å¤§å°, å†³å®šè·³è¿‡å¤šå°‘ä¸ªå…ƒç´ åå–ä¸€ä¸ª, å°†å…¶ä½œä¸ºåˆ‡ç‰‡çš„å…ƒç´ å³å¯</p>
<hr>
<h2 id="zi-dian" id="å­—å…¸">å­—å…¸</h2>
<p>python ä¸­çš„å­—å…¸, å®é™…ä¸Šå°±æ˜¯ä¸€äº›é”®å€¼å¯¹ç»„æˆçš„é›†åˆ<br>
é”®å€¼å¯¹, æŒ‡çš„å°±æ˜¯æ ¹æ®æŸä¸ªé”®å€¼, è·å–å…¶å¯¹åº”çš„å¦å¤–ä¸€ä¸ªå€¼</p>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åå­—: â€œå°æ˜â€</p>
</li>
<li class="lvl-2">
<p>å¹´é¾„(year): 16</p>
</li>
<li class="lvl-2">
<p>èº«é«˜(cm): 178</p>
</li>
</ul>
<p>åå­— -&gt; â€œå°æ˜â€, æ ¹æ®é”®, å¾—åˆ°å¯¹åº”çš„å€¼, è¿™å°±æ˜¯ä¸€å¯¹é”®å€¼å¯¹, ç”±é”®å€¼å¯¹ç»„æˆçš„é›†åˆ, åœ¨ python ä¸­ä¾¿å«ä½œå­—å…¸äº†</p>
<p>åœ¨ python ä¸­, ä½ å¯ä»¥ç”¨ä¸€å¯¹èŠ±æ‹¬å·æ¥å®šä¹‰å­—å…¸:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = &#123;<span class="string">&#x27;Shadd&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;Lasd&#x27;</span>: <span class="number">111</span>, <span class="string">&#x27;PPqwea&#x27;</span>: <span class="number">899</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å†’å·å‰çš„å°±æ˜¯é”®, å†’å·åçš„å°±æ˜¯è¿™ä¸ªé”®å¯¹åº”çš„å€¼, é”®å€¼å¯¹ä¹‹é—´ç”¨é€—å·è¿›è¡Œåˆ†å‰², æ¯”å¦‚:  <code>a['Shadd']</code> å°†å¾—åˆ° <code>10</code></p>
]]></content>
      <tags>
        <tag>é«˜ä¸­ä¿¡æ¯æŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>high-school-it-p4~&gt; pythonåŸºç¡€è¯­æ³•-part2</title>
    <url>/posts/high-school-it/p4.html</url>
    <content><![CDATA[]]></content>
      <tags>
        <tag>é«˜ä¸­ä¿¡æ¯æŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>high-school-it-p5~&gt; è¿›åˆ¶çš„è½¬æ¢ä¸åº”ç”¨</title>
    <url>/posts/high-school-it/p5.html</url>
    <content><![CDATA[<blockquote>
<p>å…³äºä»»æ„è¿›åˆ¶é—´çš„äº’ç›¸è½¬æ¢ä¸åº”ç”¨</p>
</blockquote>
<span id="more"></span>
]]></content>
      <tags>
        <tag>é«˜ä¸­ä¿¡æ¯æŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>haskell-basic-p1~&gt; ç³»åˆ—è¯´æ˜</title>
    <url>/posts/haskell-basic/p1.html</url>
    <content><![CDATA[<blockquote>
<p>æ¬¢è¿å¤§å®¶æ¥åˆ° Haskell çš„å­¦ä¹ ç³»åˆ—</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p>
<h1 id="xi-lie-shuo-ming">ç³»åˆ—è¯´æ˜</h1>
<p>æœ¬ç³»åˆ—ä¼šä»‹ç»ä¸‹Haskell, åŒæ—¶å­¦ä¹ å®ƒçš„è¯­æ³•ä¸æ€æƒ³<br>
è¿™å°†ä¼šæ˜¯ä¸ªæ¼«é•¿çš„è¿‡ç¨‹, é¢„è®¡æ›´æ–°ä¼šå¾ˆæ…¢, åŠ¡å¿…åšå¥½å¿ƒç†å‡†å¤‡ ğŸ˜ƒ<br>
<s>(æ¯•ç«Ÿæ˜¯Haskell)</s></p>
<hr>
<h1 id="can-kao-zi-liao">å‚è€ƒèµ„æ–™</h1>
<ol>
<li class="lvl-3">
<p>ä¹¦ç±</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="http://learnyouahaskell.com/chapters">Learn You a Haskell for Great Good! (è¶£å­¦æŒ‡å—)</a></p>
</li>
<li class="lvl-2">
<p><a href="https://www.haskell.org/tutorial/">A Gentle Introduction to Haskell, Version 98</a></p>
</li>
</ul>
<ol start="2">
<li class="lvl-3">
<p>è®ºå›</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://discourse.haskell.org/">Haskell Discourse</a></p>
</li>
</ul>
<ol start="3">
<li class="lvl-3">
<p>åšå®¢</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="http://cgnail.github.io/tags/#lambda%E6%BC%94%E7%AE%97">Lambda Calculus (Lambdaæ¼”ç®—)</a></p>
</li>
<li class="lvl-2">
<p><a href="https://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">Functors In Pictures (å›¾è§£å‡½å­)</a></p>
</li>
</ul>
<ol start="4">
<li class="lvl-3">
<p>Wiki</p>
</li>
</ol>
<ul class="lvl-0">
<li class="lvl-2">
<p><a href="https://wiki.haskell.org/">Haskell Wiki</a></p>
</li>
</ul>
<hr>
<h1 id="huan-ying-sao-rao">æ¬¢è¿éªšæ‰°</h1>
<p>å‘ç°é”™è¯¯çš„è¯,è¯·åŠæ—¶è·Ÿæˆ‘è”ç³»,æ¯•ç«Ÿæˆ‘ä¹Ÿåœ¨å­¦ä¹ ä¸­<br>
ä½ å¯ä»¥é€šè¿‡åšå®¢ä¾§è¾¹æ ä¸Šçš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ‘~~</p>
<p>æœ€å,è°¢è°¢ä½ çš„è§‚çœ‹ ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Haskell</tag>
      </tags>
  </entry>
  <entry>
    <title>haskell-basic-p2~&gt; ç¯å¢ƒæ­å»º</title>
    <url>/posts/haskell-basic/p2.html</url>
    <content><![CDATA[<blockquote>
<p>é¦–å…ˆ, æˆ‘ä»¬å¾—æ­å»ºå¥½ Haskell çš„ç¯å¢ƒ</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p>
<h1 id="bian-yi-qi-amp-amp-bao-guan-li">ç¼–è¯‘å™¨ &amp;&amp; åŒ…ç®¡ç†</h1>
<p>æœ¬æ–‡å‡è®¾ä½ ä½¿ç”¨çš„æ˜¯Linuxç³»ç»Ÿ</p>
<p>é€šè¿‡Linuxå‘è¡Œç‰ˆè‡ªå¸¦çš„åŒ…ç®¡ç†å™¨, ä¸‹è½½ <code>haskell-platform</code> æ¥ç›´æ¥é…ç½®ç¯å¢ƒ<br>
éšå, ä½ ä¼šè·å¾— <code>ghc</code>, <code>ghci</code>, <code>cabal</code></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>ghc</code>: Haskell çš„ç¼–è¯‘å™¨</p>
</li>
<li class="lvl-2">
<p><code>ghci</code>: ä¸€ä¸ªREPL, å³ç”¨äºæ–°æ‰‹å­¦ä¹ çš„äº¤äº’å¼è§£é‡Šå™¨</p>
</li>
<li class="lvl-2">
<p><code>cabal</code>: Hsakellçš„åŒ…ç®¡ç†å™¨</p>
</li>
</ul>
<p>(æ³¨, ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸‹è½½å¦ä¸€ä¸ªå« <code>stack</code> çš„åŒ…ç®¡ç†å™¨, ä¸è¿‡æˆ‘é€‰æ‹©äº† <code>cabal (å®˜æ–¹çš„)</code>, ä»…æ­¤è€Œå·²)</p>
<p>è¯·ç¡®ä¿éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºç‰ˆæœ¬:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ghc -V</span><br><span class="line">ghci -V</span><br><span class="line">cabal -V</span><br></pre></td></tr></table></figure>
<p>æœ¬ç³»åˆ—æš‚æ—¶åªæ¶‰åŠ Haskell çš„è¯­æ³•éƒ¨åˆ†ï¼Œ å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨ <code>ghci</code>, å› æ­¤ <code>cabal-install (å³ä¸Šé¢çš„ cabal)</code> è¿™ä¸œè¥¿ä¸å¤ªä¼šç”¨åˆ°</p>
<hr>
<h1 id="dai-ma-bian-ji">ä»£ç ç¼–è¾‘</h1>
<p>æ¨èçš„ä»£ç ç¼–è¾‘å™¨:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Helix (å¼ºæ¨)</p>
</li>
<li class="lvl-2">
<p>Nvim/Vim</p>
</li>
<li class="lvl-2">
<p>Emacs</p>
</li>
<li class="lvl-2">
<p>Vscode</p>
</li>
</ul>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Vscode, ç›´æ¥ä¸‹è½½å¯¹åº”çš„Haskellæ’ä»¶<br>
å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>Helix/Vim/Emacs</code>, è¦ä¸‹è½½å¯¹åº”çš„LSP: <code>haskell-language-server</code></p>
<p>æ¯”å¦‚, æˆ‘ç°åœ¨ç”¨çš„æ˜¯Fedora-Linux, å¯ä»¥è¿™æ ·ä¸‹è½½LSP:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dnf copr <span class="built_in">enable</span> -y petersen/haskell-language-server</span><br><span class="line">sudo dnf install -y haskell-language-server</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <a href="https://helix-editor.com/">Helix</a>, LSPå°†ä¼šç›´æ¥å¯ç”¨<br>
å½“ç„¶, ä½ ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨å…¶ä»–ä»£ç ç¼–è¾‘å™¨, æœ€å¥½èƒ½æ”¯æŒLSP</p>
<hr>
<h1 id="huan-yuan">æ¢æº</h1>
<p>Haskellçš„åŒ…éƒ½æ”¾åœ¨ <a href="https://hackage.haskell.org/">hackage</a>, ä¸‹è½½ä¾èµ–æ—¶, é€Ÿåº¦å¯èƒ½ææ…¢<br>
è¿™æ—¶, æˆ‘ä»¬åº”è¯¥è¿›è¡Œå°†å…¶æ¢æˆé•œåƒæº</p>
<p>è‹¥ä½ ä½¿ç”¨cabal, å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„åš:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cabal user-config init</span><br><span class="line">sed -i <span class="string">&#x27;s/repository hackage.haskell.org/repository mirrors.ustc.edu.cn/g&#x27;</span> ~/.cabal/config</span><br><span class="line">sed -i <span class="string">&#x27;s/http:\/\/hackage.haskell.org\//http:\/\/mirrors.ustc.edu.cn\/hackage\//g&#x27;</span> ~/.cabal/config</span><br><span class="line">sed -i <span class="string">&#x27;s/-- secure: True/secure: True/g&#x27;</span> ~/.cabal/config</span><br><span class="line">cabal update</span><br></pre></td></tr></table></figure>
<p>è¿™ä¼šç”Ÿæˆcabalçš„é…ç½®æ–‡ä»¶, å¹¶ä¸”å°†urlæ›¿æ¢ä¸ºä¸­ç§‘å¤§çš„æº</p>
<p>è‡³æ­¤, ç¯å¢ƒå‡†å¤‡å·¥ä½œå·²å…¨éƒ¨å®Œæˆ<br>
ä¸‹ä¸€èŠ‚, æˆ‘ä»¬å°†æ­£å¼å¼€å§‹å­¦ä¹  Haskell</p>
<hr>
<h1 id="geng-gai-ghci-ti-shi-fu">æ›´æ”¹ghciæç¤ºç¬¦</h1>
<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œ <code>ghci</code> æ—¶, ä½ ä¼šå‘ç°å‰ç½®çš„æç¤ºç¬¦ä¸º <code>Prelude&gt;</code>, è¿™æ˜¯é»˜è®¤æ ·å¼<br>
ä½†å®ƒä¼šéšç€ä½ å¼•å…¥çš„æ¨¡å—çš„å¢å¤š, è€Œå˜å¾—å†—æ‚, æ¯”å¦‚:</p>
<p>å½“ä½ è¾“å…¥ <code>:m Data.Time</code> (è¡¨ç¤ºå¼•å…¥ä¸€ä¸ªæ¨¡å—, åé¢ä¼šå­¦), å‰ç½®æç¤ºç¬¦å˜æˆäº† <code>Prelude Data.Time&gt;</code></p>
<p>ä¸ºäº†é˜²æ­¢æ¯å¼•å…¥æ¨¡å—è¿‡å¤š, å¯¼è‡´å‰ç½®æç¤ºç¬¦è¿‡äºæ‚ä¹±, å¯ä»¥é€‰æ‹©ä¿®æ”¹ ghci çš„å‰ç½®ç¬¦, æ¯”å¦‚:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;:set prompt &quot;ghci&gt; &quot;&#x27;</span> &gt; ~/.ghci</span><br><span class="line">chmod go-w ~/.ghci</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€è¡Œæ›´æ”¹æç¤ºç¬¦<br>
ç¬¬äºŒè¡Œç§»é™¤å¯å†™æƒé™, é˜²æ­¢ä»–äººæ›´æ”¹, ä¸ç„¶ ghci ä¼šè­¦å‘Š, ç„¶åæ‹’ç»æ›´æ”¹</p>
]]></content>
      <tags>
        <tag>Haskell</tag>
      </tags>
  </entry>
  <entry>
    <title>haskell-basic-p3~&gt; å‡½æ•°å¼ä»‹ç»</title>
    <url>/posts/haskell-basic/p3.html</url>
    <content><![CDATA[<blockquote>
<p>ä½•ä¸ºå‡½æ•°å¼ç¼–ç¨‹(FP, å³Functional Programming) ?</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p>
<p>æœ¬èŠ‚æˆ‘ä»¬å°†ä»‹ç»ä¸‹å‡½æ•°å¼ç¼–ç¨‹, å°½é‡ä¸æ¶‰åŠä»£ç , éƒ½æ˜¯æ¦‚å¿µä¸Šçš„ä¸œè¥¿<br>
é‚£ä¹ˆ, å¼€å§‹å§!</p>
<h1 id="bian-cheng-fan-shi">ç¼–ç¨‹èŒƒå¼</h1>
<h2 id="gai-lan" id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>FP, æ˜¯ä¸€ç§åå«å‡½æ•°å¼çš„, å¼ºå¤§çš„ç¼–ç¨‹èŒƒå¼, å› æ­¤, æˆ‘æƒ³å…ˆè®²ä¸€è®²ä»€ä¹ˆæ˜¯ç¼–ç¨‹èŒƒå¼</p>
<p>ç¼–ç¨‹èŒƒå¼æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼, æŠ€æœ¯, è¯­è¨€èŒƒå¼, ç¼–ç¨‹æ¨¡å‹<br>
åœ¨ä¸–ç•Œä¸Š, æœ‰è®¸å¤šç¼–ç¨‹èŒƒå¼, æœ€ä¸»è¦çš„æœ‰:</p>
<table>
<thead>
<tr>
<th>ç®€ç§°</th>
<th>ä¸­æ–‡å</th>
<th>è‹±æ–‡å</th>
</tr>
</thead>
<tbody>
<tr>
<td>FP</td>
<td>å‡½æ•°å¼ç¼–ç¨‹</td>
<td>Functional Programming</td>
</tr>
<tr>
<td>OOP</td>
<td>é¢å‘å¯¹è±¡ç¼–ç¨‹</td>
<td>Object-Oriented Programming</td>
</tr>
<tr>
<td>POP</td>
<td>é¢å‘è¿‡ç¨‹ç¼–ç¨‹</td>
<td>Procedure-Oriented Programming</td>
</tr>
<tr>
<td>LP</td>
<td>é€»è¾‘å¼ç¼–ç¨‹</td>
<td>Logic Programming</td>
</tr>
<tr>
<td>DP</td>
<td>å£°æ˜å¼ç¼–ç¨‹</td>
<td>Declarative Programming</td>
</tr>
<tr>
<td>IP</td>
<td>å‘½ä»¤å¼ç¼–ç¨‹</td>
<td>Imperative Programming</td>
</tr>
</tbody>
</table>
<p>ç¼–ç¨‹èŒƒå¼å®åœ¨å¤ªå¤š, ä½†ä¸ç”¨åˆ»æ„å»è®°å¿†, è¿™äº›éƒ½æ˜¯äº›é¡¾åæ€ä¹‰çš„ä¸œè¥¿<br>
è®°ä½FPä¸OOPè¿™ä¸¤ä¸ªç¼©å†™å³å¯, è¿™ä¸¤ä¸ªæ˜¯æœ€å¸¸è¢«æåŠçš„, å…¶ä»–çš„æ— éœ€è®°å¿†</p>
<p>ç¼–ç¨‹èŒƒå¼, å®ƒå°±åƒæ˜¯å›½å®¶çš„æ„è¯†å½¢æ€ä¸€æ ·, å…·æœ‰æŒ‡å¯¼æ„ä¹‰, å¯¹å¦‚ä½•ç¼–ç¨‹æ±‚è§£é—®é¢˜çš„æ€è€ƒæ–¹æ³•æœ‰å·¨å¤§å½±å“<br>
ä¸‹é¢æ˜¯ä¸€äº›ç¼–ç¨‹èŒƒå¼çš„ä¾‹å­:</p>
<p><strong>æç¤º</strong><br>
å¦‚æœä½ å·²ç»äº†è§£è¿‡ä»¥ä¸‹èŒƒå¼, ç›´æ¥è·³åˆ° <a href="#zong-jie"><strong>æ€»ç»“</strong></a> å§</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>é¢å‘è¿‡ç¨‹:<br>
ä¼˜ç‚¹:<br>
è§£å†³é—®é¢˜æ—¶, å¼ºè°ƒè¿‡ç¨‹, ä¸äººæœ¬èº«çš„æ€è€ƒæ–¹å¼ä¸€è‡´, ç¬¦åˆç›´è§‰<br>
ç¼ºç‚¹:<br>
ä»£ç å¤ç”¨èƒ½åŠ›å·®, æ‰©å±•æ€§å·®, ç¹ç</p>
</li>
<li class="lvl-2">
<p>é¢å‘å¯¹è±¡:<br>
ä¼˜ç‚¹:<br>
å°†é—®é¢˜æŠ½è±¡ä¸ºä¸€ä¸ªä¸ªå¯¹è±¡, é€šè¿‡å»ºç«‹æ¨¡å‹, ä½¿ç”¨ç»§æ‰¿/å¤šæ€ç­‰æ¥æè¿°ä¸–ç•Œ, å¤ç”¨ä»£ç çš„èƒ½åŠ›å¼ºæ‚<br>
ç¼ºç‚¹:<br>
ä¸èƒ½é€‚ç”¨äºæ‰€æœ‰é—®é¢˜, ç¡¬å¥—èŒƒå¼å¯èƒ½ä¼šè®©ä»£ç å˜å¾—æ›´åŠ ç¹ç</p>
</li>
<li class="lvl-2">
<p>é€»è¾‘å¼:<br>
ä¼˜ç‚¹:<br>
é€šè¿‡å»ºç«‹ <code>äº‹å®</code>, å‘Šè¯‰ç¼–ç¨‹å™¨è¿™äº›éƒ½æ˜¯ç»å¯¹æ­£ç¡®çš„, éšåæ ¹æ®é€»è¾‘å…³ç³»ç›´æ¥æ±‚è§£, ååˆ†ç¥å¥‡<br>
ç¼ºç‚¹:<br>
ç„å­¦ç¼–ç¨‹, å¯èƒ½æƒ³è±¡ä¸åˆ°æ€ä¹ˆæ ·å»ºç«‹å‡º <code>èƒ½æ­£ç¡®æ±‚è§£çš„å‰ææ¡ä»¶/å®šä¹‰</code>, ä¹Ÿå¯èƒ½å› æ¨ç†è¿‡äºå¤æ‚, å¯¼è‡´æ€§èƒ½ä½ä¸‹</p>
</li>
<li class="lvl-2">
<p>å‡½æ•°å¼:<br>
ä¼˜ç‚¹:<br>
é€šè¿‡ä»¥æ•°å­¦ä¸­çš„ <code>å‡½æ•°</code> ä¸ºæŒ‡å¯¼, å¼ºè°ƒç»“æœ, ä¸å…³æ³¨è¿‡ç¨‹, é€šè¿‡æ•°æ®ä¸å¯å˜æå¤§å‡å°‘å¤æ‚æ€§<br>
ç¼ºç‚¹:<br>
å­¦ä¹ éš¾åº¦è¾ƒå¤§, æ€§èƒ½å› ä¸å¯å˜æ•°æ®, ä¸å¯é¿å…åœ°ä¼šä½ä¸‹ä¸€äº›</p>
</li>
<li class="lvl-2">
<p>å‘½ä»¤å¼:<br>
æœ‰äº›è¯´æ³•æ˜¯å‘½ä»¤å¼æŒ‡ç±»ä¼¼æ±‡ç¼–è¿™ç§çš„, è¿˜æœ‰çš„è¯´å‘½ä»¤å¼ä¸é¢å‘è¿‡ç¨‹å«æ³•ä¸åŒè€Œå·²<br>
æˆ‘å…¶å®ä¹Ÿä¸æ˜¯å¤ªèƒ½åŒºåˆ†è¿™ä¸¤è€…, å¤§å®¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ç›´æ¥è®¤ä¸ºä¸¤è€…çº¦ç­‰äºå³å¯<br>
æ¯•ç«Ÿéƒ½2022å¹´äº†, ç°åœ¨ä¸å¤ªéœ€è¦å…³æ³¨è¿™äº›ä½çº§å±‚é¢çš„å·®å¼‚äº†<br>
ç°åœ¨è¯¥å…³æ³¨çš„, æ˜¯æ›´å¤§å·®å¼‚çš„èŒƒå¼ä»¬, æ¯”å¦‚é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡, å‡½æ•°å¼ä¸é¢å‘å¯¹è±¡ç­‰ç­‰</p>
</li>
<li class="lvl-2">
<p>å£°æ˜å¼:<br>
æŒ‡ä½ ç¼–ç¨‹ä¾é æè¿°, è€Œéé¢å‘è¿‡ç¨‹åœ°å»æ€è€ƒ<br>
è¿™ç§èŒƒå¼å¸¸è§äºä¸€äº›DSL(é¢†åŸŸç‰¹å®šè¯­è¨€), ä»¥æ­¤ç®€åŒ–åœ¨æŸé¢†åŸŸä¸‹çš„å¼€å‘<br>
DSL, å³ä¸ºä¸“é—¨é¢†åŸŸåˆ›é€ çš„è¯­æ³•, æ˜¯ä¸ºäº†ä¸“æ³¨äºè¯¥é¢†åŸŸçš„å¼€å‘, æ¯”å¦‚HTMLå†™ç½‘é¡µ, SQLå†™æ•°æ®åº“<br>
ç‰¹ç‚¹æ˜¯ä¸€æ—¦è„±ç¦»ç›¸å…³é¢†åŸŸ, è¯­æ³•å°±ä¸å†ä¾¿åˆ©</p>
</li>
</ul>
<h2 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h2>
<p>å„ç§ç¼–ç¨‹èŒƒå¼æœ‰å„è‡ªçš„ç‰¹ç‚¹, äººä»¬é€šè¿‡ç ”ç©¶å®ƒä»¬, æ¢ç©¶é«˜æ•ˆçš„ç¼–ç¨‹æ–¹å¼<br>
ç¼–ç¨‹èŒƒå¼å¹¶éä¸¥æ ¼çš„äº’ç›¸ç‹¬ç«‹çš„, å®ƒä»¬å¤§å¤šåœ¨æ¦‚å¿µä¸Šä¹Ÿå­˜åœ¨äº¤é›†</p>
<p>æ¯”å¦‚:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>é¢å‘è¿‡ç¨‹/é¢å‘å¯¹è±¡ &amp;&amp; å‘½ä»¤å¼</p>
</li>
<li class="lvl-2">
<p>å‡½æ•°å¼/é€»è¾‘å¼ &amp;&amp; å£°æ˜å¼</p>
</li>
<li class="lvl-2">
<p>æ··åˆä¸€ç§, ä¸¤ç§, ç”šè‡³å„ç§èŒƒå¼</p>
</li>
</ul>
<p>å†æ¯”å¦‚, ç°ä»£çš„ç¼–ç¨‹è¯­è¨€, ä¸€èˆ¬éƒ½æ±²å–äº†å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„æ€æƒ³<br>
æ¯”å¦‚åŒ¿åå‡½æ•°, é«˜é˜¶å‡½æ•°ç­‰åœ¨å‡½æ•°å¼è¯­è¨€ä¸­è¾ƒä½çº§çš„æ¦‚å¿µ, è¢«ä¸€äº›é¢å‘å¯¹è±¡çš„è¯­è¨€ä½¿ç”¨å, ä¹Ÿèƒ½çˆ†å‘å‡ºä¸ä¿—çš„å¨åŠ›<br>
å†æ¯”å¦‚ Rust ä¸­çš„ Option/Result, æœ‰ç€ Haskell çš„å½±å­</p>
<p>ç›¸ä¿¡ç»è¿‡æœ¬å°èŠ‚, ä½ å¯¹ä»€ä¹ˆæ˜¯ç¼–ç¨‹èŒƒå¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤çŸ¥<br>
æ¥ä¸‹æ¥, æˆ‘ä»¬å°±è¦ä¸“æ³¨äºæœ¬èŠ‚çš„ä¸»è§’, å‡½æ•°å¼</p>
<p>ç®€å•æ¥è¯´, å‡½æ•°å¼ç¼–ç¨‹ä¾é ç€æ•°å­¦çš„å¨åŠ›, å°†å…¶å¼•å…¥ç¼–ç¨‹çš„æ¦‚å¿µä¹‹ä¸­<br>
è®©æˆ‘ä»¬å¼€å§‹å¯¹å‡½æ•°å¼çš„æ­£å¼ä»‹ç»å§!</p>
<hr>
<h1 id="gao-jie-han-shu">é«˜é˜¶å‡½æ•°</h1>
<p>é«˜é˜¶å‡½æ•°(HOF, Higher-order Functions), æŒ‡ä¸€ä¸ªä½œä¸ºå‚æ•°, æˆ–å½“ä½œè¿”å›å€¼çš„å‡½æ•°</p>
<p>ä½ å¯èƒ½ç»å¸¸ä¼šå¬åˆ°è¿™ä¹ˆä¸€å¥è¯: åœ¨ XXX è¯­è¨€ä¸­, å‡½æ•°è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘<br>
å‡½æ•°è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘, æŒ‡å‡½æ•°åœ°ä½çªå‡º, ä¸ä¼šè¢«é™åˆ¶, é€šå¸¸ä¸é‚£äº›ä¸æ”¯æŒHOFçš„ç¼–ç¨‹è¯­è¨€åšæ¯”è¾ƒ<br>
æ¯”å¦‚åŒ¿åå‡½æ•°, Lambdaè¡¨è¾¾å¼, é—­åŒ…, å…¶å®éƒ½æ˜¯å› ä¸ºHOF(å‡½æ•°å¯ä»¥è¢«å½“ä½œå‚æ•°ä¼ é€’)<br>
<s>(è¯è¯´2022å¹´äº†, ä¸»æµè¯­è¨€æˆ–å¤šæˆ–å°‘éƒ½æ”¯æŒHOFäº†, è¿Cè¯­è¨€éƒ½èƒ½æ¨¡æ‹Ÿå‡ºæ¥å‘¢)</s></p>
<p>ä¸€å¥è¯æ¦‚æ‹¬: å‡½æ•°èƒ½è¢«è½»æ¾éšæ„åœ°ä¼ é€’, å¾ˆè‡ªç”±, å°±åƒä¸€ç­‰å…¬æ°‘</p>
<hr>
<h1 id="bu-ke-bian-shu-ju">ä¸å¯å˜æ•°æ®</h1>
<p>ä¸å¯å˜æ•°æ®(Immutable Data), æŒ‡ä½ æ— æ³•ä¿®æ”¹å·²ç»å­˜åœ¨çš„æ•°æ®</p>
<p>æ¢å¥è¯è¯´, å½“ä½ æƒ³è¿›è¡Œæ–°è¿ç®—, å¾—åˆ°æ–°æ•°æ®æ—¶, ä¸æ˜¯æ›¿æ¢è¿›åŸæœ‰çš„æ•°æ®, è€Œæ˜¯æ–°å¼€è¾Ÿä¸€å—ç©ºé—´æ¥å­˜æ”¾å®ƒ<br>
è¢«åˆ›å»ºçš„å€¼, ä½ å°†æ°¸è¿œæ— æ³•ä¿®æ”¹, å°±å¦‚åŒæ•°å­¦é‡Œé‚£æ ·, ç›¸ä¿¡æˆ‘, å½“ä½ ç¬¬ä¸€æ¬¡å­¦ç¼–ç¨‹æ—¶, æ€»ä¼šå¯¹ <code>å˜é‡</code> æ„Ÿåˆ°å›°æƒ‘</p>
<p>è¿™ä¹Ÿæ„å‘³ç€, ä½ ä¸å†éœ€è¦å…³æ³¨ä¸€äº›ä¸è®¡ç®—æœºåº•å±‚æœ‰å…³çš„å¥‡æŠ€æ·«å·§, è€Œæ˜¯ä¸“æ³¨äºé—®é¢˜æœ¬èº«<br>
ä½†æœ‰ä¸ªé“ç†äº˜å¤ä¸å˜: éšç€æŠ½è±¡ç­‰çº§çš„æé«˜, å°±è¶Šåç§»åº•å±‚, å¯èƒ½ä¼šé€ æˆæ›´å¤šçš„èµ„æºæµªè´¹</p>
<p>è€Œä¸”, å¯å˜æ€§è¿˜ä¼šå½±å“å¹¶å‘æ€§, å‡ºç°ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯, å¾—å­¦ä¹ å„ç§é”æ¨¡å‹æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶<br>
ä½†ä¸å¯å˜çš„æ•°æ®èƒ½å¤Ÿæœ‰æ•ˆé™ä½å¹¶å‘çš„éš¾åº¦</p>
<p>è€Œä¸”ä¹Ÿåˆ«å¤ªæ‹…å¿ƒæ•ˆç‡, è™½ç„¶è‚¯å®šä¼šä½ç‚¹, ä½†ä¹Ÿæ²¡å°ç§ç°ä»£ç¼–è¯‘å™¨çš„ç–¯ç‹‚ä¼˜åŒ–å•Š<br>
æ¯”å¦‚æ¯æ¬¡è®¡ç®—ä¸ä¸€å®šä¼šäº§ç”Ÿæ–°å€¼, è€Œæ˜¯é€šè¿‡å…±äº«å†…å­˜, è¾¾åˆ°é‡å¤ä½¿ç”¨æ—§å€¼</p>
<hr>
<h1 id="fu-zuo-yong">å‰¯ä½œç”¨</h1>
<p>å‰¯ä½œç”¨(Side Effects), æŒ‡ä¸å¤–ç•Œå‘ç”Ÿçš„äº¤äº’</p>
<p>å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°:<br>
å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ä½œä¸ºæ–‡ä»¶å, è¿›è¡Œè¯»å–, è¾“å‡ºå†…å®¹, å³ä½¿è¿™ä¹ˆç®€å•, ä¹Ÿåšä¸åˆ°ç›¸åŒçš„è¾“å…¥, èƒ½å¾—åˆ°ç›¸åŒçš„è¾“å‡º<br>
å¯èƒ½ä½ æ— æƒè¯»å–æ–‡ä»¶, å¯èƒ½æ–‡ä»¶ä¸å­˜åœ¨, å¯èƒ½æ–‡ä»¶è¢«ä¿®æ”¹è¿‡, æ‰€ä»¥, è¾“å…¥ä¸€ä¸ªå›ºå®šè·¯å¾„, ä¸ä¸€å®šèƒ½å¾—åˆ°å›ºå®šçš„è¾“å‡º</p>
<p>å› æ­¤, è¿™ç§IOæ“ä½œ, ä¾¿æ˜¯ç§å‰¯ä½œç”¨, å› ä¸ºå®ƒæ¶‰åŠåˆ°ä¸å¤–ç•Œçš„äº¤äº’, å¯èƒ½äº§ç”Ÿæ— æ³•é¢„æµ‹çš„äº‹æƒ…<br>
è¿™ç§è¶…è„±äºè¯­è¨€, æ¥è‡ªæ›´çœŸå®ä¸–ç•Œçš„äº¤äº’, æˆ‘ä»¬ç§°ä¹‹ä¸º <code>å‰¯ä½œç”¨</code></p>
<p>å‰¯ä½œç”¨åŒ…æ‹¬, ä½†ä¸é™äº:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>å‘é€ç½‘ç»œè¯·æ±‚</p>
</li>
<li class="lvl-2">
<p>è®¿é—®ç³»ç»ŸçŠ¶æ€</p>
</li>
<li class="lvl-2">
<p>æ“ä½œæ•°æ®åº“</p>
</li>
<li class="lvl-2">
<p>æ“ä½œDOM</p>
</li>
<li class="lvl-2">
<p>IOæ“ä½œ</p>
</li>
<li class="lvl-2">
<p>ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡</p>
</li>
<li class="lvl-2">
<p>ä½¿ç”¨å…·æœ‰å‰¯ä½œç”¨çš„å‡½æ•° (ä¼ æ’­æ€§)</p>
</li>
</ul>
<p>ä½ ä¼šæ³¨æ„åˆ° <code>ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡</code>, å®ƒä¹Ÿå¯ä»¥çœ‹ä½œ <code>ä¸å¤–ç•Œçš„äº¤äº’</code><br>
æ¯”å¦‚, è‹¥è¯¥å‡½æ•°ä¿®æ”¹äº†ä¸€ä¸ªå‡½æ•°å¤–éƒ¨çš„å€¼, å¹¶ä¸”è¿”å›å€¼ä¾é è¿™ä¸ªä¸å›ºå®šçš„å€¼<br>
é‚£ä¹ˆè¿™å°†æ— æ³•ä¿è¯ç›¸åŒè¾“å…¥, èƒ½å¾—åˆ°ç›¸åŒè¾“å‡º</p>
<p>ä½†æ˜¯, ç¨‹åºå°±æ˜¯ä¾é å‰¯ä½œç”¨æ¥äº§ç”Ÿä»·å€¼çš„, å‰¯ä½œç”¨è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´æ”¹å¤–éƒ¨æ¡ä»¶, è¿›è¡Œäº¤äº’<br>
ç»å¯¹çš„æ²¡æœ‰å‰¯ä½œç”¨, æ„å‘³ç€è¿™ä¸ªç¨‹åºç»å¯¹çš„æ²¡ç”¨</p>
<hr>
<h1 id="yin-yong-tou-ming">å¼•ç”¨é€æ˜</h1>
<p>å¼•ç”¨é€æ˜(RT, Referential Transparency), æŒ‡æŸä¸ªè¡¨è¾¾å¼, èƒ½æ›¿æ¢ä¸ºå®ƒè®¡ç®—å¾—åˆ°çš„å€¼, ä¸”æ›¿æ¢å‰åçš„è¯­ä¹‰ä¸€å®šç­‰ä»·</p>
<p>å¼•ç”¨é€æ˜æ€§, æ˜¯ä¸ªå­˜åœ¨äºä¼—å¤šå­¦è¯´ä¸­çš„çŸ¥è¯†, ä¸å…‰æ˜¯è®¡ç®—æœº, è¿˜æœ‰æ•°å­¦, å“²å­¦, è¯­è¨€å­¦ç­‰<br>
ä»¥ä¸‹æ˜¯æ•°å­¦ä¸­çš„ RT, ç®€å•æ¥è®², å°±æ˜¯ç­‰å¼æ¨å¯¼:</p>
<p>f(x) = (x+1)<sup>2</sup><br>
f(2) = (2+1)<sup>2</sup> = (3)<sup>2</sup> = 9</p>
<p>å¯ä»¥çœ‹åˆ°, <code>2+1</code>å¯ä»¥è¢«<code>3</code>ä»£æ›¿, ä¸”æ›¿æ¢å‰åçš„è¯­ä¹‰ä¸€è‡´, è¿™ä¾¿æ˜¯æ•°å­¦ä¸­çš„ RT, æˆ–è€…ç§°å‘¼å®ƒä¸º <code>ç­‰å¼æ¨å¯¼</code>:<br>
æŸä¸ª <code>çˆ¶è¡¨è¾¾å¼</code> ç”±è®¸å¤š <code>å­è¡¨è¾¾å¼</code> ç»„æˆ, å¦‚æœå¯ä»¥å°†è¿™äº› <code>å­è¡¨è¾¾å¼</code> æ›¿æ¢ä¸ºå®ƒä»¬è®¡ç®—å¾—åˆ°çš„å¯¹åº”å€¼, å°±èƒ½ç®€åŒ–è¿™ä¸ª <code>çˆ¶è¡¨è¾¾å¼</code><br>
è®¡ç®—æœºä¸­çš„ RT, ä¹Ÿå·®ä¸å¤šæ˜¯è¿™ä¸ªæ„æ€, åªè¦æŸä¸ªè¡¨è¾¾å¼èƒ½è¢«æ›¿æ¢, ä¸”è¯­ä¹‰ä¸å˜, å°±å…·æœ‰ RT</p>
<p>æ€»è€Œè¨€ä¹‹, å°±æ˜¯æ›¿æ¢, æ›¿æ¢, è¿˜æ˜¯æ›¿æ¢<br>
å³ä½¿æ•ˆç‡å˜åŒ–, åªè¦è¯­ä¹‰ä¸å˜å°±è¡Œ, è¿™æœ‰åˆ©äºè®©æ¨å¯¼é—®é¢˜å˜å¾—å®¹æ˜“, åˆ é™¤å¤§é‡å†—æ‚çš„ä»£ç , æ–¹ä¾¿è¿›è¡Œé‡æ„ç­‰</p>
<p>RT è¿˜èƒ½ä¸ non-RT(éå¼•ç”¨é€æ˜) è¿›è¡Œå¯¹æ¯”, ä½“ç° RT çš„å¥½å¤„:<br>
è‹¥æœ‰è¿™ä¹ˆä¸ªå‡½æ•°:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">double_x</span>(x: <span class="type">Int</span>): <span class="type">Int</span> &#123;</span><br><span class="line">    println(x);</span><br><span class="line">    return x+x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆ, å®ƒå°±ä¸å…·æœ‰ RT, å› ä¸ºå®ƒæ¶‰åŠåˆ°äº† IOæ“ä½œ(æ‰“å°äº†x)<br>
æ­¤æ—¶è¿›è¡Œæ›¿æ¢çš„è¯, æ¯”å¦‚ <code>double_x(10) -&gt; 20</code>, å› ä¸ºåè€…å°‘äº†æ¬¡æ‰“å°, è¯­ä¹‰ä¸ä¸€è‡´<br>
å‡è®¾ä½ å°†å…¶ä¸­10æ¬¡å¯¹ <code>double_x(x)</code> çš„è°ƒç”¨, éƒ½ç”¨ <code>x+x</code> æ¥æ›¿æ¢, é‚£ä½ å°†ç¼ºå°‘10æ¬¡æ‰“å°</p>
<p>è¿™åªæ˜¯ä¸ªç®€å•çš„ä¾‹å­, ä½ å®Œå…¨èƒ½å°†å‡½æ•°ä¸­çš„ <code>println(x)</code>, æ¢æˆå…¶ä»–å…·æœ‰å‰¯ä½œç”¨, è€Œéå•çº¯æ•°è¿ç®—çš„è¡¨è¾¾å¼<br>
ä½¿ç”¨è¿™äº› non-RT çš„å®¶ä¼™, ä½ å°†ä¸§å¤±è¿›è¡Œæ’ç­‰çš„èƒ½åŠ›, é—®é¢˜æ¨å¯¼æ›´åŠ å¤æ‚, æ’æŸ¥é”™è¯¯ååˆ†å›°éš¾<br>
ä½ å°†éœ€è¦é¢å¤–ä½¿ç”¨å¤æ‚çš„å·¥å…·, å»åˆ†æä¸€æ®µå¤æ‚çš„ä»£ç <br>
è¿™é€šå¸¸æ˜¯ä¸€äº› BUG çš„æ¥æº</p>
<p>RT, å³å¼•ç”¨é€æ˜, æ³¨å®šä¸å‰¯ä½œç”¨äº’æ–¥</p>
<hr>
<h1 id="chun-han-shu">çº¯å‡½æ•°</h1>
<p>çº¯å‡½æ•°(Pure Functions), è¡¨ç¤ºå¼•ç”¨é€æ˜çš„å‡½æ•°</p>
<p>å¼•ç”¨é€æ˜çš„æ€§è´¨, ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥æ‹¥æœ‰, ä¸€ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æ‹¥æœ‰, æˆ‘ä»¬æŠŠè¿™æ ·çš„å‡½æ•°å«çº¯å‡½æ•°, ä»…æ­¤è€Œå·²<br>
ç›¸å¯¹åº”çš„, è¿˜æœ‰çº¯æ“ä½œ, çº¯è¡¨è¾¾å¼, çº¯ä»£ç ç­‰ç­‰å·®ä¸å¤šæ„æ€çš„è¡¨è¿°, çŸ¥é“å°±å¥½</p>
<p>å› ä¸ºçº¯å‡½æ•°çš„å¼•ç”¨é€æ˜æ€§, å®ƒä¸ä¼šå»ä¿®æ”¹å¤–ç•ŒçŠ¶æ€, ä¸å»äº¤äº’, åªæ˜¯æ ¹æ®å‚æ•°, è‡ªç»™è‡ªè¶³åœ°ç®—å‡ºç»“æœè€Œå·²<br>
ç®€å•æ¦‚æ‹¬: çº¯å‡½æ•°æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°, å¤–é¢å‘ç”Ÿäº†ä»€ä¹ˆé¸Ÿäº‹, å’Œæˆ‘æœ‰å±å…³ç³»</p>
<p>ä¸€ä¸ªå‡½æ•°ç‹¬ç«‹, å¯èƒ½æ²¡å•¥, ä¸€å †å‡½æ•°ç‹¬ç«‹, è¡¨ç¤ºå®ƒä»¬å¯ä»¥ä¸€èµ·è®¡ç®—, å› ä¸ºå®ƒä»¬ä¹‹é—´æ²¡æœ‰äº¤äº’, æ¯”å¦‚:<br>
æœ‰ä¸‰ä¸ªçº¯å‡½æ•°: <code>f(x), h(x), g(x)</code>, é‚£ä¹ˆ <code>f(x) + h(x) + g(x)</code> ä¸­, ä¸‰ä¸ªå‡½æ•°ç›´æ¥å¹¶è¡Œè®¡ç®—å³å¯<br>
è¿™æ„å‘³ç€, åƒ Haskell è¿™ç§è¯­è¨€, æœ¬èº«å°±å…·æœ‰å¼ºå¤§çš„å¹¶å‘æ€§</p>
<p>ä½†çº¯å‡½æ•°ä¸æ˜¯ç¥, æ— å¯é¿å…è¦ä¾é å‰¯ä½œç”¨, å³ä½¿å¦‚æ­¤, ä½ ä¹Ÿåº”å°½é‡å°† éçº¯å‡½æ•° ä¸­çº¯çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥</p>
<hr>
<h1 id="qi-ta">å…¶ä»–</h1>
<p>ä»¥ä¸Šæ˜¯å¯¹å‡½æ•°å¼çš„å°å°æ¦‚æ‹¬<br>
è¿˜æœ‰è¯¸å¦‚æŸ¯é‡ŒåŒ–, æƒ°æ€§æ±‚å€¼, å¤šæ€æ€§, ç±»å‹çº¦æŸç­‰å†…å®¹, å°†ä¼šæ”¾åœ¨åé¢é…åˆä»£ç è®²è§£</p>
<p>ä¸ºäº†å¸å¼•å°å´½å­ä»¬æ¥å­¦ Haskell, èƒ½éª—å‡ ä¸ªæ˜¯å‡ ä¸ª, ç‰¹æ„æ¥å‡ æ®µæ— æ¯”ç®€æ´çš„ä»£ç </p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åŸƒæ°ç­›æ±‚ç´ æ•°:</p>
</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">primes</span> = filterPrime [<span class="number">2.</span>.]</span><br><span class="line">  <span class="keyword">where</span> filterPrime (p:xs) = p : filterPrime [x | x &lt;- xs, x `mod` p /= <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ–æ³¢é‚£å¥‘æ•°åˆ—:</p>
</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">fibs</span> = <span class="number">0</span> : <span class="number">1</span> : zipWith (+) fibs (tail fibs)</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>å¿«é€Ÿæ’åˆ—:</p>
</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">qsort</span> [] = []</span><br><span class="line"><span class="title">qsort</span> (x : xs) = qsort sList ++ [x] ++ qsort bList</span><br><span class="line">  <span class="keyword">where</span> (sList, bList) = partition (&lt; x) xs</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>è¾—è½¬ç›¸é™¤æ³•æ±‚æœ€å¤§å…¬çº¦æ•°:</p>
</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">gcd&#x27;</span> x y</span><br><span class="line">  | y == <span class="number">0</span> = x</span><br><span class="line">  | otherwise = gcd&#x27; y (x `mod` y)</span><br></pre></td></tr></table></figure>
<p>æ„Ÿè°¢ä½ çš„è§‚çœ‹, å’‹ä»¬ä¸‹æœŸè§!!<br>
å…ˆè®©æˆ‘é¸½å‡ å¤© ğŸ˜ƒ</p>
]]></content>
      <tags>
        <tag>Haskell</tag>
      </tags>
  </entry>
  <entry>
    <title>haskell-basic-p4~&gt; åŸºç¡€è¯­æ³•</title>
    <url>/posts/haskell-basic/p4.html</url>
    <content><![CDATA[<blockquote>
<p>å…³äº Haskell çš„æ•°å­—, Bool, List, Ifè¯­å¥</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p>
<p>Haskell æ˜¯ä¸€é—¨é™æ€å¼ºç±»å‹è¯­è¨€, æˆ‘ä»¬æ¥ä¸‹æ¥å°†å­¦ä¹ ä¸€äº›åŸºç¡€ç±»å‹<br>
ä½ å¯ä»¥åœ¨ç»ˆç«¯æ•²ä¸‹ <code>ghci</code> è¿›å…¥äº¤äº’è§£é‡Šå™¨, å»æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç </p>
<h1 id="shu-zi">æ•°å­—</h1>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">(<span class="number">2</span> + <span class="number">8</span>) * <span class="number">9</span> - <span class="number">10</span>   <span class="comment">-- 80</span></span><br><span class="line"><span class="number">5</span> / <span class="number">2</span>              <span class="comment">-- 2.5</span></span><br><span class="line"><span class="number">5</span> ^ <span class="number">2</span>              <span class="comment">-- 25</span></span><br><span class="line"><span class="number">5</span> ^  (<span class="number">2.0</span>)         <span class="comment">-- error</span></span><br><span class="line"><span class="number">5</span> ** (<span class="number">2.0</span>)         <span class="comment">-- 25.0 </span></span><br></pre></td></tr></table></figure>
<p>åŠ å‡ä¹˜é™¤å°±ä¸è¯´äº†, å¯¹äº <code>^</code> ä¸ <code>**</code> éƒ½æ˜¯å¹‚å‡½æ•°, åº•æ•°çš„ç±»å‹éšæ„<br>
ä½† <code>^</code> æ¥å—çš„æŒ‡æ•°æ˜¯ä¸ªæ•´æ•°, <code>**</code> åˆ™å¯ä»¥æ¥å—å°æ•°/æ•´æ•° (ç±»å‹æ–¹é¢ä¹‹åå†è®², è¿™é‡Œæœ‰ç‚¹ä¸å‡†ç¡®)<br>
ä»¥ä¸Šçš„è¿ç®—ç¬¦å·, å®é™…ä¸Šéƒ½æ˜¯å‡½æ•°</p>
<p>æ¯”å¦‚, ä½ å¯ä»¥é”®å…¥ <code>:t (+)</code>, æ¥å¾—åˆ° <code>+</code> è¿™ä¸ªå‡½æ•°çš„ç±»å‹:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">(+) :: <span class="type">Num</span> a =&gt; a -&gt; a -&gt; a</span><br></pre></td></tr></table></figure>
<p><code>=&gt;</code> åé¢çš„è¡¨ç¤ºå‚æ•°ä¸è¿”å›å€¼çš„ç±»å‹<br>
<code>=&gt;</code> å‰çš„ä¸€å—æ˜¯ç±»å‹ç±»(Typeclass), èµ·ç±»å‹çº¦æŸçš„ä½œç”¨, ç›¸å½“äºå…¶ä»–è¯­è¨€çš„ trait/interface</p>
<p>çœ‹ä¸æ‡‚æ²¡å…³ç³», ä¹‹åä¼šå­¦, è·³è¿‡å³å¯, æ­¤å¤„åªæ˜¯ä¸ºäº†å‘Šè¯‰ä½ , åœ¨ <code>ghci</code> ä¸­, å¦‚ä½•æŸ¥çœ‹ç±»å‹è€Œå·²<br>
ä»¥ä¸Šçš„ä¸œè¥¿, å®é™…ä¸Šç±»ä¼¼äº:</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="params">(+)</span>&lt;<span class="title">a</span>: <span class="title">Num</span>&gt; <span class="params">(a, a, a)</span> -&gt;</span> a &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>Haskell ä¸­çš„å°å†™å­—æ¯ç›¸å½“äºæ— çº¦æŸçš„æ³›å‹, å•¥éƒ½èƒ½åŒ¹é…<br>
Num è¿™ä¸ªç±»å‹ç±»äº†, ä¾¿èµ·åˆ°ä¸€ä¸ªçº¦æŸçš„ä½œç”¨</p>
<p>åŒæ—¶, ç”±äºåŠ æ³•å‡½æ•°çš„å®šä¹‰, <code>&quot;ABC&quot; + 123</code> è¿™æ ·çš„è¡¨è¾¾å¼, ä¼šç›´æ¥æŠ¥é”™<br>
å› ä¸ºä¸æ»¡è¶³ä¼ å…¥å‚æ•°çš„è¦æ±‚: ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å¿…é¡»ç›¸ç­‰, å› ä¸ºå®ƒä»¬éƒ½æ˜¯a</p>
<hr>
<h1 id="bool">Bool</h1>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="type">True</span> &amp;&amp; <span class="type">False</span>      <span class="comment">-- False</span></span><br><span class="line"><span class="type">True</span> || <span class="type">False</span>      <span class="comment">-- True</span></span><br><span class="line"><span class="title">not</span> <span class="type">True</span>           <span class="comment">-- False</span></span><br></pre></td></tr></table></figure>
<p>ä½ è¿˜å¯ä»¥ç”¨ <code>==</code> æˆ– <code>/=</code> æ¥å¾—åˆ°ä¸€ä¸ªBoolå€¼:<br>
(æ³¨: æˆ‘çš„åšå®¢å¯èƒ½å¯ç”¨äº†è¿ä½“å­—, ä¸Šé¢çš„ç­‰å·æ˜¯ä¸¤ä¸ªç­‰å·, ä¸ç­‰å·æ˜¯æ–œæ +ç­‰å·)</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> == <span class="number">0</span>             <span class="comment">-- False</span></span><br><span class="line"><span class="number">2</span> + <span class="number">3</span> == <span class="number">1</span> + <span class="number">4</span>     <span class="comment">-- True</span></span><br><span class="line"><span class="string">&quot;ABC&quot;</span> /= <span class="string">&quot;AB&quot;</span>      <span class="comment">-- True</span></span><br></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯, ç­‰å·ä¸ä¸ç­‰å·çš„å·¦å³, ä¸¤ä¸ªå€¼çš„ç±»å‹å¿…é¡»ç›¸ç­‰<br>
è¿™æ˜¯å› ä¸º Haskell ä¸­çš„è¿ç®—ç¬¦éƒ½æ˜¯å‡½æ•°, å·²ç»å®šä¹‰å¥½äº†ç±»å‹<br>
å¯ä»¥é”®å…¥ <code>:t (==)</code> æŸ¥çœ‹å…¶ç±»å‹:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">(==) :: <span class="type">Eq</span> a =&gt; a -&gt; a -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºæ¥å—çš„ä¸¤ä¸ªå‚æ•°, å…¶ç±»å‹ç›¸åŒ, éƒ½æ˜¯a<br>
å¹¶ä¸”aç±»å‹å¿…é¡»å…·æœ‰ç›¸ç­‰æ€§, è¿”å›å€¼æ˜¯Boolç±»å‹</p>
<p>æ³¨æ„:<br>
ç”±äºå…¶å®šä¹‰, <code>&quot;ABC&quot; == 123</code> è¿™æ ·çš„è¡¨è¾¾å¼, ä¼šç›´æ¥æŠ¥é”™<br>
åŸå› ä¸å…ˆå‰çš„åŠ æ³•å‡½æ•°åŒç†</p>
<p>ç­‰åˆ°åé¢, æˆ‘ä»¬å¯ä»¥è‡ªå·±åŠ¨æ‰‹, å®ç° <code>&amp;&amp;</code>, <code>||</code>, <code>not</code> è¿™ä¸‰ä¸ªå‡½æ•°<br>
ç”šè‡³è¿ Ifè¯­å¥, æˆ‘ä»¬éƒ½å¯ä»¥è‡ªå·±å†™ä¸ªå‡½æ•°æ¥ä»£æ›¿</p>
<p>Ifè¯­å¥åœ¨ Haskell ä¸­ä»…ä»…æ˜¯ä¸ªè¯­æ³•ç³–è€Œå·²<br>
åœ¨ Haskell-Wiki ä¸Š, ç”šè‡³æœ‰ä¸ªè®¨è®º, æ­£ååŒæ–¹è¾©è®ºè¦ä¸è¦æŠ›å¼ƒ <code>if-else</code> è¿™æ ·çš„è¯­æ³•ç³–<br>
æ„Ÿå…´è¶£çš„è¯, å¯ä»¥è‡ªå·±å»çœ‹ä¸‹: <a href="https://wiki.haskell.org/If-then-else">ä¼ é€é—¨</a></p>
<hr>
<h1 id="list">List</h1>
<p>List(åˆ—è¡¨), åœ¨ Haskell ä¸­æ‰®æ¼”ç€ä¸€ä¸ªéå¸¸é‡è¦çš„è§’è‰²<br>
å°±åƒæ˜¯å…¶ä»–è¯­è¨€çš„æ•°ç»„ä¸€æ ·, ä½†å´æ›´åŠ å¼ºå¤§</p>
<h2 id="sheng-lue-you-duan" id="çœç•¥å³ç«¯">çœç•¥å³ç«¯</h2>
<p>åƒä¸‹é¢, å°±åˆ›å»ºäº†ä¸€ä¸ªæœ‰åä¸ªå…ƒç´ çš„List:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„List, ç±»å‹ä¸º <code>Num a =&gt; [a]</code><br>
a å®é™…ä¸Šå°±æ˜¯å…ƒç´ çš„ç±»å‹, [a] è¡¨ç¤ºè£…ç€è¿™ç§ç±»å‹å…ƒç´ çš„List</p>
<p>è™½ç„¶æˆ‘æƒ³æŠŠå¸¸ç”¨çš„å‡½æ•°æ”¾åˆ°ä¹‹åå†è®², ä½†è¿˜æ˜¯å¾—å…ˆæ•™ä½ ä¸€ä¸ª: <code>take</code><br>
ä½ å¯ä»¥æŸ¥çœ‹å®ƒçš„ç±»å‹:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">take</span> :: <span class="type">Int</span> -&gt; [a] -&gt; [a]</span><br></pre></td></tr></table></figure>
<p>è¿™è¡¨ç¤º, å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°, ç¬¬ä¸€ä¸ªè¡¨ç¤ºè¦å–å‰é¢å¤šå°‘ä¸ªå…ƒç´ , ç¬¬äºŒä¸ªæ˜¯ä»»æ„ç±»å‹çš„List, éšåè¿”å›æ–°çš„List<br>
æ¯”å¦‚:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">take</span> <span class="number">5</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]      <span class="comment">-- [1,2,3,4,5]</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°ä½ é©¬ä¸Šå°±ä¼šç”¨åˆ°, åœ¨å¤„ç†æ— é™å…ƒç´ çš„Listæ—¶éå¸¸å¥½ç”¨</p>
<p>å›åˆ°åˆšæ‰, ä½ å¯ä»¥ä¸€ä¸ªä¸ªåœ°è¾“å…¥å…ƒç´ , åˆ›å»ºList<br>
ä¸è¿‡è¿™å¤ªéº»çƒ¦äº†, å¦‚æœæˆ‘æƒ³è¦ä¸€ç™¾ä¸ª, ä¸€åƒä¸ªè¿ç»­çš„æ•´æ•°å‘¢? ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1.</span><span class="number">.10</span>]</span><br><span class="line">[<span class="number">1.</span><span class="number">.100</span>]</span><br><span class="line">[<span class="number">1.</span><span class="number">.1000</span>]</span><br></pre></td></tr></table></figure>
<p>è¯¸å¦‚ <code>[m..n]</code> è¿™æ ·çš„å½¢å¼, ä¼šåˆ›å»ºä¸€ä¸ªé—­åŒºé—´, ä»méå†åˆ°n<br>
å½“ç„¶, å¾—å…ˆä¿è¯å…ƒç´ æœ¬èº«çš„ç±»å‹, æ˜¯å¯ä»¥è¿›è¡Œéå†çš„, å³å…ƒç´ æœ¬èº«æ˜¯ <code>Enum</code> è¿™ä¸ªç±»å‹ç±»çš„æˆå‘˜<br>
ä» Rust, Scala, Java ç­‰è¯­è¨€å‡ºå‘, ç›¸å½“äºå®ç°äº† <code>Enum</code> è¿™ä¸ª Trait/Interface</p>
<p>ä½ ç”šè‡³å¯ä»¥èˆå»å³ç«¯, å†™ä¸‹ <code>[1..]</code> è¿™æ ·çš„å¼å­æ¥è¡¨è¾¾1åˆ°æ— ç©·<br>
ä½ è¿˜å¯ä»¥ç”Ÿæˆ [Char], æ¯”å¦‚ <code>['a'..'z']</code> å°†ä¼šç”Ÿæˆ <code>&quot;abcdefghijklmnopqrstuvwxyz&quot;</code>, å› ä¸ºStringç±»å‹ç­‰ä»·äº [Char]</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯, å¿½ç•¥å³ç«¯ç‚¹æ—¶, ç”Ÿæˆçš„Listå¯èƒ½æ— ç©·å¤§, ä¹Ÿå¯èƒ½æ˜¯æœ‰ç•Œçš„, æˆ‘ä»¬å…ˆå‡è®¾å…ƒç´ çš„ç±»å‹ä¸ºa<br>
å½“aä¹Ÿæ˜¯ <code>Bounded</code> ç±»å‹ç±»çš„æˆå‘˜æ—¶, è¯´æ˜è¿™ç§ç±»å‹ä¸€å®šæœ‰è¾¹ç•Œ, æ¯”å¦‚ <code>Int</code>, <code>Char</code> ç­‰<br>
ä¸ç„¶çš„è¯, aå°†æ— ç•Œ, æ¯”å¦‚ <code>[1..]</code> ä¾¿æ˜¯ä¸€ä¸ªçœŸæ­£çš„, ä»1åˆ°æ­£æ— ç©·çš„List, ç±»å‹ä¸º <code>Num a =&gt; [a]</code></p>
<p>å½“ä½ çœ‹åˆ°è¿™é‡Œæ—¶, å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®: 1 çš„ç±»å‹ä¸åº”è¯¥æ˜¯Intå—?  ä¸ºä»€ä¹ˆä¼šæ˜¯ <code>Num a =&gt; a</code> å‘¢?</p>
<p>äº‹å®ä¸Š, è¿™æ˜¯ Haskell ä¸­ä¸ºæ•°ä¸å¤šçš„éšå¼è¡Œä¸º<br>
ä»»ä½•æ•´æ•°çš„å­—é¢é‡, ä¸ºäº†è¿ç®—æ–¹ä¾¿, éƒ½æŠŠå®ƒä»¬çœ‹ä½œå®ç°äº†Numç±»å‹ç±»çš„ç±»å‹, ä»¥ä¾¿äºå‘ä¸‹è½¬å‹</p>
<p>ä¸¾ä¸ªä¾‹å­, ä½ ä½¿ç”¨äº†Integer(æ— é™ç²¾åº¦çš„Int) ä¸ æ•´æ•°å­—é¢é‡:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">a</span> = <span class="number">100</span>::<span class="type">Integer</span>      <span class="comment">-- 100</span></span><br><span class="line"><span class="title">a</span> + <span class="number">1</span>                 <span class="comment">-- 101</span></span><br><span class="line"><span class="title">a</span> + <span class="number">1</span>::<span class="type">Int</span>            <span class="comment">-- error</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆå£°æ˜äº†a, åˆ†åˆ«ä¸æ•´æ•°å­—é¢é‡, Intç±»å‹æ•°å­—ç›¸åŠ <br>
å¯¹äºç¬¬ä¸€ä¸ªåŠ æ³•, 1æ˜¯ä¸ªå­—é¢é‡, æ˜¯Num, ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡º1åº”è¯¥ä¹Ÿæ˜¯Integerç±»å‹çš„<br>
æ ¹æ® <a href="#shu-zi">(+)å‡½æ•°</a> çš„å®šä¹‰, åŒæ—¶ä¹Ÿå› ä¸ºIntegeræ˜¯Numè¿™ä¸ªTypeclassçš„æˆå‘˜</p>
<p>å›åˆ°å…ˆå‰çš„ <code>[1..]</code>, 1æ˜¯Num, å½“ List äº§ç”Ÿçš„æ•°å­—è¶…è¶Š Int çš„æœ€å¤§å€¼æ—¶, ä¸ä¼šæº¢å‡º, è€Œæ˜¯è½¬æˆ Integer ä»¥æ»¡è¶³éœ€æ±‚</p>
<h2 id="she-zhi-bu-chang" id="è®¾ç½®æ­¥é•¿">è®¾ç½®æ­¥é•¿</h2>
<p>å…ˆå‰æˆ‘ä»¬è®²åˆ°, ä½ é™¤äº†å‚»ä¹ä¹åœ°å»ä¸€ä¸ªä¸ªåœ°å¡«å†™Listçš„å…ƒç´ , è¿˜å¯ä»¥çœç•¥å³ç«¯ç‚¹<br>
åŒæ—¶, å–å†³äºå…ƒç´ çš„ç±»å‹, ä¼šäº§ç”Ÿæ— é™æˆ–æœ‰ç•Œçš„List</p>
<p>ä½†æ˜¯, æ¯”å¦‚ [1â€¦5] ä¼šç”Ÿæˆ <code>[1,2,3,4,5]</code>, é»˜è®¤æƒ…å†µä¸‹çš„æ­¥é•¿æ˜¯1<br>
å¦‚æœä½ æƒ³è°ƒæ•´æ­¥é•¿çš„è¯, å¯ä»¥åƒä¸‹é¢è¿™æ ·:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">3.</span>.]          <span class="comment">-- æ­¥é•¿æ˜¯2, [1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33..]</span></span><br><span class="line">[<span class="number">5</span>,<span class="number">10.</span>.]         <span class="comment">-- æ­¥é•¿æ˜¯5, [5,10,15,20,25,30,35,40,45,50,55,60,65,70..]</span></span><br></pre></td></tr></table></figure>
<p>ä½ è¿˜å¯ä»¥è®¾ç½®å°æ•°çš„æ­¥é•¿, æ¯”å¦‚:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[<span class="number">1.0</span>, <span class="number">1.5</span>..]     <span class="comment">-- æ­¥é•¿æ˜¯0.5, [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0..]</span></span><br></pre></td></tr></table></figure>
<p>å“‡å¡, çœŸæ˜¯ä¸ªèªæ˜çš„ç¼–è¯‘å™¨å‘¢, å½“ç„¶, ç¼–è¯‘å™¨æœ‰æ—¶å€™ä¹Ÿä¸ä¼šå¦‚ä½ æ‰€æ„¿çš„ ğŸ˜ƒ</p>
<h2 id="lie-biao-tui-dao" id="åˆ—è¡¨æ¨å¯¼">åˆ—è¡¨æ¨å¯¼</h2>
<p>Haskell ä¸­çš„ List, è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„åœ°æ–¹, é‚£å°±æ˜¯ <code>List Comprehension (åˆ—è¡¨æ¨å¯¼)</code><br>
å¬ç€æŒºæ‡µçš„, æ¥ä¸ªä¾‹å­å§, ä»¥ä¸‹è¡¨è¾¾å¼å°†åˆ›å»ºä¸€ä¸ªæ— é™çº§List, å…ƒç´ æ˜¯2çš„å€æ•°</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[x | x &lt;- [<span class="number">1.</span>.], mod x <span class="number">2</span> == <span class="number">0</span>]  <span class="comment">-- [2,4,6,8,10,12,14,16,18, 20..]</span></span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šå‘ç°, ä¸Šé¢è¡¨ç¤ºè¿™æ ·ä¸€ä¸ªListçš„æ–¹æ³•, å’Œé«˜ä¸€å­¦çš„é›†åˆçš„è¡¨ç¤ºæ³•éå¸¸ç›¸è¿‘ <s>(å› ä¸ºå°±æ˜¯è¿™æ ·æŠ„æ¥çš„å•Š)</s><br>
å¸Œæœ›ä½ è¿˜æ²¡å¿˜è®°é«˜ä¸€å­¦ä¹ çš„, è¡¨ç¤ºé›†åˆçš„æ–¹æ³•ä¹‹ä¸€, åˆ—ä¸¾æ³•: <code>&#123;x | n âˆˆ Z, x = 2n&#125;</code> , è¡¨ç¤ºäº†å¶æ•°é›†</p>
<p>Haskell ä¸­çš„ <code>List Comprehension</code> ä¹Ÿæœ‰è¿™ä¹ˆä¸ªæ :</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[ x | x &lt;- xs, bool_expr1, bool_expr2 ]   </span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç”¨ <code>|</code> åˆ†å‰²ç»„æˆçš„è¡¨è¾¾å¼, ä¸åé¢çš„æ¨å¯¼</p>
</li>
<li class="lvl-2">
<p>xs è¡¨ç¤ºä¸€ä¸ªList, å› ä¸ºæ˜¯ x çš„å¤æ•°, ä¹Ÿæ˜¯å°¾å·´åé¢åŠ ä¸Šs, å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª</p>
</li>
<li class="lvl-2">
<p><code>bool_expr</code> è¡¨ç¤ºè¦æ»¡è¶³çš„æ¡ä»¶, åªæœ‰å½“ x ä»£å…¥è¿™ä¸ªè¡¨è¾¾å¼, æ»¡è¶³æ¡ä»¶æ‰è¡Œ, å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ª</p>
</li>
</ul>
<p>å¯èƒ½ä½ è¿˜æ˜¯æœ‰ç‚¹æ‡µ? æ²¡äº‹, å¤šçœ‹ç‚¹ä¾‹å­, ç›´è§‰ä¸Šæ˜ç™½å°±å¯ä»¥äº†</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[x + y | x &lt;- [<span class="number">1.</span><span class="number">.3</span>], y &lt;- [<span class="number">1.</span><span class="number">.3</span>]]                   <span class="comment">-- [2,3,4,3,4,5,4,5,6]</span></span><br><span class="line">[x | x &lt;- [<span class="number">1.</span><span class="number">.100</span>], x `mod` <span class="number">2</span> == <span class="number">0</span>, x `mod` <span class="number">3</span> == <span class="number">0</span>]  <span class="comment">-- [6,12,18,24,30,36,42,48,54,60,66,72,78,84,90,96]</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®, å°±ç›¸å½“äº <code>å¤šé‡forå¾ªç¯</code> + <code>æœ€åä¸€é‡forå¾ªç¯ä¸­çš„é›¶ä¸ªæˆ–å¤šä¸ªifè¯­å¥</code><br>
éšååˆ©ç”¨æ»¡è¶³æ¡ä»¶çš„å€¼, åˆ›å»ºæ–°çš„è¡¨è¾¾å¼, æ”¾è¿›æ–°çš„é›†åˆå¹¶è¿”å›:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç¬¬ä¸€ä¸ªå¼å­ <code>[x + y | x &lt;- [1..3], y &lt;- [1..3]]</code>, ç›¸å½“äº:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> new_array</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>..<span class="number">3</span>]</span><br><span class="line">  <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">1</span>..<span class="number">3</span>]</span><br><span class="line">    (x + y) -&gt; new_array</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç¬¬äºŒä¸ªå¼å­ <code>[x | x &lt;- [1..100], x </code>mod<code>2 == 0, x</code>mod<code> 3 == 0]</code>, ç›¸å½“äº:</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> new_array</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>..<span class="number">100</span>]</span><br><span class="line">  <span class="keyword">if</span> x `<span class="keyword">mod</span>` <span class="number">2</span> == <span class="number">0</span> &amp;&amp; x `<span class="keyword">mod</span>` <span class="number">3</span> == <span class="number">0</span></span><br><span class="line">    (x) -&gt; new_array</span><br></pre></td></tr></table></figure>
<p>å› æ­¤, ä½ å¯ä»¥å¯¹æ¯”ä¸‹ä¸‹é¢ä¸¤ç§å¼å­:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">[ x * y | x &lt;- [<span class="number">1.</span><span class="number">.10</span>], y &lt;- [<span class="number">1.</span>.x]  ]</span><br><span class="line">[ x * y | x &lt;- [<span class="number">1.</span>.y],  y &lt;- [<span class="number">1.</span><span class="number">.10</span>] ]</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ç§åˆæ³•, ä½†ç¬¬äºŒç§ä¸åˆæ³•, æŠŠå®ƒä»¬ç†è§£ä¸ºforå¾ªç¯, ä½ å°±çŸ¥é“åŸå› äº†, æ­¤å¤„è·³è¿‡</p>
<p>å¥½äº†, å…³äºList, æš‚æ—¶å…ˆåˆ°è¿™å§<br>
å…¶å®åé¢è¿˜æœ‰å¾ˆå¤šå…³äºListçš„, æ¯•ç«Ÿå®ƒå¤ªé‡è¦äº†</p>
<hr>
<h1 id="if-yu-ju">Ifè¯­å¥</h1>
<p>å…ˆå‰è¯´é“, Ifè¯­å¥ä»…ä»…æ˜¯ä¸ªè¯­æ³•ç³–, ä½†æˆ‘ä»¬è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¸‹è¿™ä¸ªè¯­æ³•çš„<br>
é¡ºä¾¿æ‰¾ä¸ªæœºä¼š, æ•™ä¸‹å¦‚ä½•å°†ä»£ç å†™è¿›æ–‡ä»¶å¹¶ç¼–è¯‘, è„±ç¦» ghci</p>
<p>æ¯•ç«Ÿ Haskell æ¯”è¾ƒç‰¹æ®Š, ä¸ºäº†å‡½æ•°çš„ <a href="/posts/haskell-basic/p3/#chun-han-shu">çº¯åº¦</a> , ç‰¹æ„æäº†ä¸€å †ä¸œè¥¿<br>
å†ä¸è®²ææ€•ä¹‹åéƒ½è®²ä¸äº†å‘¢, æ‰€ä»¥æˆ‘æ‰“ç®—å¼ºç¡¬ç‚¹ç©¿æ’ç€è®² (æ‚å˜´ç¬‘)</p>
<p>å¼€å§‹å§!</p>
<h2 id="dan-if" id="å•if">å•if</h2>
<p>é¦–å…ˆ, è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶, å‘½åä¸º <code>demo.hs</code></p>
<p>BMI, Body Mass Index (èº«ä½“è´¨é‡æŒ‡æ•°)<br>
å®ƒä¸ä½“å†…è„‚è‚ªæ€»é‡å¯†åˆ‡ç›¸å…³ï¼Œå¸¸ç”¨æ¥è¡¡é‡äººä½“èƒ–ç˜¦ç¨‹åº¦ã€æ˜¯å¦å¥åº·</p>
<p>è®©æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªç¨‹åº, æ ¹æ®è¾“å…¥çš„bmiåˆ¤æ–­èƒ–ä¸ç˜¦å§</p>
<p><strong>ä½ å¯ä»¥è¿™æ ·è¿è¡Œä»¥ .hs ç»“å°¾çš„æ–‡ä»¶:</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>åœ¨ <code>demo.hs</code> æ‰€åœ¨çš„ç›®å½•ä¸‹, è¾“å…¥ <code>runghc demo.hs</code>, ä¸ä¼šç•™ä¸‹ç›®æ ‡æ–‡ä»¶</p>
</li>
<li class="lvl-2">
<p>è¾“å…¥ <code>ghc demo.hs</code>, ç•™ä¸‹ç›®æ ‡æ–‡ä»¶ <code>./demo</code></p>
</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>  bmi &gt; <span class="number">25</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">  <span class="keyword">else</span> putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure>
<p>å…ˆåˆ«åœ¨æ„é‚£ä¸ª <code>do</code> ä¸ <code>&lt;-</code> æ˜¯å•¥, æ— è§†å³å¯, åæ­£è¿™æ®µä»£ç ä½ åº”è¯¥ä¹Ÿçœ‹å¾—æ‡‚:<br>
ç¨‹åºä¼šè¯»å–è¾“å…¥, ä½œä¸º <code>bmi</code> çš„å€¼, éšåæ ¹æ®å¤§å°, åˆ¤æ–­æ˜¯èƒ–æ˜¯ç˜¦</p>
<p>å½“ç„¶, å¦‚æœä½ ä½¿ç”¨LSP, ä»£ç æ ¼å¼åŒ–ä¹‹å, ä½ å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™ä¸€æ®µ:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> bmi &gt; <span class="number">25</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">    <span class="keyword">else</span> putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿè›®ç¾è§‚çš„, ä½†æˆ‘æ›´å–œæ¬¢å‹è¡Œ ğŸ˜ƒ</p>
<h2 id="duo-if" id="å¤šIf">å¤šIf</h2>
<p>å…¶å®åœ¨ Haskell ä¸­æ ¹æœ¬ä¸å­˜åœ¨å¤šé‡Ifè¿™ç§ç©æ„å„¿, ä½ å¾€ä¸‹çœ‹å°±ä¼šæ‡‚â€¦</p>
<p>å…ˆå‰çš„ å•If å®åœ¨ä¸å¤Ÿ, æ²¡æœ‰åŒºåˆ†è¾“å…¥ä¸å¯¹åŠ²çš„æƒ…å†µ<br>
è€Œä¸”åªæ˜¯ç®€å•åœ°åˆ¤æ–­äº†èƒ–ç˜¦, è®©æˆ‘ä»¬å†åŠ ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦å¥åº·çš„æƒ…å†µå§</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> bmi &lt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;What?&quot;</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> bmi &gt; <span class="number">25</span> </span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> bmi &lt;= <span class="number">25</span> &amp;&amp; bmi &lt;= <span class="number">18.5</span> </span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;Healthy!!!&quot;</span></span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">    putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure>
<p>å“‡, çœ‹ç€å¥½ç¾, å¥½ç†Ÿæ‚‰!<br>
æ‰€ä»¥ä½ ä¸ºä»€ä¹ˆè¯´æ²¡æœ‰å¤šé‡Ifå‘¢?</p>
<p>åˆ«æ€¥, æ ¼å¼åŒ–ä¹‹å:</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- demo.hs</span></span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn <span class="string">&quot;Please input your BMI:&quot;</span></span><br><span class="line">  bmi &lt;- readLn</span><br><span class="line">  <span class="keyword">if</span> bmi &lt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">then</span> putStrLn <span class="string">&quot;What?&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">if</span> bmi &gt; <span class="number">25</span></span><br><span class="line">        <span class="keyword">then</span> putStrLn <span class="string">&quot;Fat!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">if</span> bmi &lt;= <span class="number">25</span> &amp;&amp; bmi &lt; <span class="number">18.5</span></span><br><span class="line">            <span class="keyword">then</span> putStrLn <span class="string">&quot;12&quot;</span></span><br><span class="line">            <span class="keyword">else</span> putStrLn <span class="string">&quot;Thin!!!&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ‡‚äº†å§? å®ƒåªæ˜¯ else ä¸­å†å¥—ä¸€ä¸ª if-else è€Œå·²<br>
è€Œä¸”å°±è¿ if-else, æˆ‘ä»¬éƒ½å¯ä»¥ç”¨è‡ªå·±å®šä¹‰çš„å‡½æ•°å–ä»£æ‰ (ä¹‹åä¼šè®²)<br>
å°±ç®—æˆ‘ä»¬ä¸å–ä»£ if-else, å®ƒçš„ä½¿ç”¨ç‡ä¹Ÿå¾ˆä½, æ¨¡å¼åŒ¹é…æ›´åŠ ç¾è§‚, ä¹Ÿæ›´å¼ºå¤§ (Guardä¹Ÿæ˜¯ä¹‹åä¼šè®²)</p>
<p>è¿™èŠ‚å°±åˆ°è¿™, çœ‹è¾‰å¤œ3çš„æœ€åä¸€é›†å»äº†~~</p>
]]></content>
      <tags>
        <tag>Haskell</tag>
      </tags>
  </entry>
  <entry>
    <title>haskell-basic-p5~&gt; ç±»å‹ä¸ç±»å‹ç±»</title>
    <url>/posts/haskell-basic/p5.html</url>
    <content><![CDATA[<blockquote>
<p>å…³äº Haskell ä¸­çš„ç±»å‹(Type), ä¸ç±»å‹ç±»(Typeclass)</p>
</blockquote>
<span id="more"></span>
<p>åŒç³»åˆ—ä¼ é€é—¨: <a href="/categories/haskell-basic">haskell-basic</a></p>
<h1 id="kai-pian">å¼€ç¯‡</h1>
]]></content>
      <tags>
        <tag>Haskell</tag>
      </tags>
  </entry>
</search>
